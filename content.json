{"meta":{"title":"YiDan ã® dada","subtitle":"","description":"","author":"wuxuan.chai","url":"https://cha1yi.github.io/dist","root":"/dist/"},"pages":[{"title":"å…³äº","date":"2021-01-16T17:37:28.597Z","updated":"2021-01-16T17:37:28.597Z","comments":true,"path":"about/index.html","permalink":"https://cha1yi.github.io/dist/about/index.html","excerpt":"","text":""},{"title":"æ–‡ç« åˆ†ç±»","date":"2021-01-16T17:37:28.598Z","updated":"2021-01-16T17:37:28.598Z","comments":true,"path":"categories/index.html","permalink":"https://cha1yi.github.io/dist/categories/index.html","excerpt":"","text":""},{"title":"æ‰€æœ‰æ ‡ç­¾","date":"2021-01-16T17:37:28.599Z","updated":"2021-01-16T17:37:28.599Z","comments":true,"path":"tags/index.html","permalink":"https://cha1yi.github.io/dist/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"OLAPæ¢³ç†","slug":"OLAPæ¢³ç†","date":"2021-06-03T01:14:18.474Z","updated":"2021-06-03T01:16:14.730Z","comments":true,"path":"2021/06/03/OLAPæ¢³ç†/","link":"","permalink":"https://cha1yi.github.io/dist/2021/06/03/OLAP%E6%A2%B3%E7%90%86/","excerpt":"","text":"OLAPæ¢³ç†ï¼ˆOnline Analytical Processingï¼‰åŸºæœ¬æ¦‚å¿µï¼š OLAPé¢å‘çš„æ˜¯å¤æ‚çš„å¤šç»´æ•°æ®æ¨¡å‹ ä¸€èˆ¬åº•å±‚çš„æ•°æ®ç»“æ„æ˜¯ä¸€ä¸ªäºŒç»´çš„æ•°æ®è¡¨çš„æ ·å­ å› ä¸ºä¼šæ¶‰åŠåˆ°ç»´åº¦æŒ‰ç…§åº¦é‡æ‹åºï¼Œåº¦é‡æŒ‰ç…§ç»´åº¦æ’åºï¼Œæ‰€ä»¥äºŒç»´æ•°æ®è¡¨çš„æ’åºç®—æ³•å¾ˆé‡è¦ï¼ˆä¼šæ¶‰åŠåˆ°å¤šç»´åº¦æ¯”è¾ƒå™¨é“¾ï¼Œè¿™é‡Œä¸æ˜¯ä¸€ä¸ªç»´åº¦å‚ä¸æ’åºï¼Œç±»ä¼¼äºsqlçš„order by a,b,câ€¦.ï¼‰ï¼Œæˆ‘ä»¬NewBIç”¨çš„æ’åºç®—æ³•åº”è¯¥æ˜¯è‡ªå·±å¼€å‘çš„ä¸€ä¸ªç®€æ˜“çš„å¿«é€Ÿæ’åº NewBIä¸­çš„OLAPçš„ç®—æ³•ä¸æ˜¯å¾ˆå¤šä¸æ˜¯å¾ˆå¤æ‚ï¼Œä¸»è¦å¤æ‚çš„åœ°æ–¹æœ‰OLAPæŸ¥è¯¢çš„ç»“æœé›†åˆå¹¶ï¼Œå°±æ˜¯ä¸¤ä¸ªäºŒç»´è¡¨ç»“æœé›†åˆå¹¶ï¼Œäº¤å‰è¡¨æ„å»ºï¼ˆéš¾ç‚¹ï¼‰ OLAPçš„æ ¸å¿ƒç ”ç©¶å¯¹è±¡æ˜¯Cubeæ¨¡å‹ï¼ˆæœ‰çš„ä¹Ÿå«ï¼Œæ•°æ®ç«‹æ–¹ï¼‰ åŒ…å«äº†ä¸‰ä¸ªåŸºæœ¬åˆ†ææ“ä½œï¼š ä¸‹é’» æŒ‰ç…§æ—¥æœŸç»´åº¦ï¼ˆå¹´-&gt;æœˆ-&gt;æ—¥ï¼‰è§’åº¦å»å¯¹æ•°æ®è¿›è¡ŒæŸ¥çœ‹ æŒ‰ç…§åœ°ç†ç»´åº¦ï¼ˆå›½å®¶-&gt;çœä»½-&gt;åŸå¸‚-&gt;ä¹¡æ‘ï¼‰é€æ­¥ä¸‹é’»æŸ¥çœ‹ ä¸Šå· ä¸‹é’»çš„åå‘æ“ä½œ åˆ‡ç‰‡å’Œåˆ‡å— æ¯”å¦‚æ•°æ®é›†ä¸­ç­›å–ä¸€ç»„æ•°æ®ï¼ˆåˆ‡ç‰‡ï¼‰ï¼Œä»ä¸åŒçš„è§’åº¦ï¼ˆåˆ‡å—ï¼‰å»æŸ¥çœ‹ï¼ˆæ¯”å¦‚è®¢å•ï¼Œä»æ—¶é—´ï¼Œæ¸ é“ï¼Œskuç­‰ï¼‰ OLAPçš„å»ºæ¨¡åŠä¼˜åŒ–ï¼ˆéš¾ç‚¹ï¼‰ æ˜Ÿå‹æ¨¡å‹å’Œé›ªèŠ±æ¨¡å‹çš„é€»è¾‘å»ºæ¨¡ æ ¹æ®æŸ¥è¯¢ç»´åº¦åŠ¨æ€ä¼˜åŒ–cubeï¼Œæ¯”å¦‚æ²¡æœ‰ç”¨åˆ°æŸä¸€ä¸ªè¡¨çš„ç»´åº¦å­—æ®µï¼Œé‚£ä¹ˆå¯ä»¥åœ¨æŸ¥è¯¢çš„æ—¶å€™ä¸å»åšjoinï¼Œå°†æ¨¡å‹ç®€åŒ– SQLè§£æï¼ˆéš¾ç‚¹ï¼‰ å°†cubeçš„å¤šç»´æ•°æ®æŸ¥è¯¢æ¨¡å‹ï¼Œè§£ææˆASTè¯­æ³•æ ‘ï¼Œç„¶åç¿»è¯‘æˆsqlæˆ–è€…MDXè¯­æ³•ï¼Œäº¤ç»™æ•°æ®åº“æ‰§è¡Œæˆ–è€…ç”ŸæˆMRã€‚è¿™é‡Œé¢ä¼šæ¶‰åŠåˆ°å¦‚sqlä¼˜åŒ–ï¼Œç»“æœæ˜ å°„ç­‰ å…¶ä»–çš„æ€æƒ³ åˆ†æ²»æ€æƒ³ï¼ˆforkjoinï¼‰ sqlä¼˜åŒ–ã€æ•°æ®å‹ç¼©ç­‰ è¿™ä¸ªæ˜¯BIè¿™ç§T+1çš„OLAPæ€æƒ³","categories":[{"name":"å·¥ä½œæ•´ç†","slug":"å·¥ä½œæ•´ç†","permalink":"https://cha1yi.github.io/dist/categories/%E5%B7%A5%E4%BD%9C%E6%95%B4%E7%90%86/"}],"tags":[],"author":"wuxuan.chai"},{"title":"DorisDBå®‰è£…","slug":"DorisDBæµ‹è¯•","date":"2021-05-28T07:43:34.118Z","updated":"2021-06-05T14:56:50.419Z","comments":true,"path":"2021/05/28/DorisDBæµ‹è¯•/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/28/DorisDB%E6%B5%8B%E8%AF%95/","excerpt":"","text":"ä¸€ã€æœºå™¨å‡†å¤‡ FrontendèŠ‚ç‚¹ æœºå™¨é…ç½® 16 Intel(R) Xeon(R) CPU E7- 4807 @ 1.87GHz 16G 300G 10.200.50.32 BackendèŠ‚ç‚¹ æœºå™¨é…ç½® be-01 8 Intel Core Processor (Broadwell) 24G 500G 10.200.50.31 be-02 8 Intel Core Processor (Broadwell) 24G 500G 10.200.50.16 æœºå™¨éœ€è¦æ”¯æŒCPUéœ€è¦æ”¯æŒAVX2æŒ‡ä»¤é›†ï¼Œ 1cat &#x2F;proc&#x2F;cpuinfo |grep avx2 è‹¥æœ‰è¾“å‡ºï¼Œåˆ™è¡¨æ˜æ”¯æŒã€‚å¦åˆ™è¡¨æ˜ä¸æ”¯æŒã€‚Doriså“äº®è¯ å…³é—­æ‰€æœ‰æœºå™¨çš„å†…å­˜swap 1swapoff -a äºŒã€ ç›¸å…³æ–‡æ¡£åœ°å€1.15.1æ ‡å‡†ç‰ˆæœ¬ä¸‹è½½åœ°å€:http://dorisdb-release.cdn.dorisdb.com/DorisDB-SE-1.15.1.tar.gz?Expires=1622383610&amp;OSSAccessKeyId=LTAI4GFYjbX9e7QmFnAAvkt8&amp;Signature=lJ%2BDjDl5Y7XzTXXshIGLbiCxCzs%3D Release Notes:https://forum.dorisdb.com/t/topic/236 æ–‡æ¡£åœ°å€:http://doc.dorisdb.com/ æµ‹è¯•FAQ:http://doc.dorisdb.com/2228586 ä¸‰ã€ç¯å¢ƒæ­å»º3.1 Frontendç¯å¢ƒ3.1.1 Java 8 ç¯å¢ƒä¸‹è½½Jdk1.8ï¼Œæ·»åŠ ç¯å¢ƒå˜é‡ 12345678910$ vim /etc/profile# è¿½åŠ JAVA_HOME=/var/java//jdk1.8CLASSPATH=.:$JAVA_HOME/libPATH=$JAVA_HOME/bin:$PATHexport JAVA_HOMEexport PATH$ source /etc/profile 3.1.2 å®‰è£…Mysql-client12$ rpm -ivh https://repo.mysql.com//mysql57-community-release-el7-11.noarch.rpm$ yum install mysql-community-client.x86_64 -y 3.1.3 é…ç½®fe123456789101112131415161718# ä¸‹è½½ï¼ˆè¿™ä¸ªé“¾æ¥wgetæ‰§è¡ŒæŠ¥é”™ï¼Œç”¨macä¸‹è½½å®Œæˆï¼Œä¼ åˆ°æœåŠ¡å™¨ï¼‰å¹¶è§£å‹DorisDBçš„å®‰è£…åŒ…ã€copy feæ–‡ä»¶å¤¹åˆ°é€‚å½“ä½ç½®$ cd ~$ wget http://dorisdb-release.cdn.dorisdb.com/DorisDB-SE-1.15.1.tar.gz?Expires=1622383610&amp;OSSAccessKeyId=LTAI4GFYjbX9e7QmFnAAvkt8&amp;Signature=lJ%2BDjDl5Y7XzTXXshIGLbiCxCzs%3D$ mv DorisDB-SE-1.15.1 doris-db$ cd /usr/etc/ &amp;&amp; mkdir -p doris-db$ cp -r ~/doris-db/fe .# è®¾ç½®feå…ƒæ•°æ®å­˜å‚¨ä½ç½®$ cd /usr/etc/doris-db/fe &amp;&amp; mkdir -p doris-meta# é…ç½®feçš„DORIS_HOMEç¯å¢ƒå˜é‡$ vim /etc/profile#è¿½åŠ export DORIS_HOME=/usr/etc/doris/fe$ source /etc/profile 3.1.4 å¯åŠ¨å¹¶æµ‹è¯•å®‰è£…ç»“æœ12345678910111213141516171819202122# å¯åŠ¨fe$ sh sh $DORIS_HOME/bin/start_fe.sh --daemon# é€šè¿‡mysql-clientè¿æ¥doris-db$ mysql -h 127.0.0.1 -P 9030 -u root# å¦‚æœæ­£å¸¸è¿›å…¥ï¼Œåˆ™è¡¨ç¤ºå¯åŠ¨æˆåŠŸ[root@kvm-5032 fe]# mysql -h 10.200.50.32 -P 9030 -u rootWelcome to the MySQL monitor. Commands end with ; or \\g.Your MySQL connection id is 1Server version: 5.1.0Copyright (c) 2000, 2021, Oracle and/or its affiliates.Oracle is a registered trademark of Oracle Corporation and/or itsaffiliates. Other names may be trademarks of their respectiveowners.Type &#x27;help;&#x27; or &#x27;\\h&#x27; for help. Type &#x27;\\c&#x27; to clear the current input statement.mysql&gt; è¿›å…¥ç½‘å€ï¼šhttp://10.200.50.32:8030/ 3.1.5 æ·»åŠ /åˆ é™¤be12345678# è¿›å…¥fe$ mysql -h 10.200.50.32 -P 9030 -u root# æ·»åŠ be$ ALTER SYSTEM ADD BACKEND &quot;10.200.50.16:9050&quot;;# åˆ é™¤be$ ALTER SYSTEM DROPP BACKEND &quot;10.200.50.16:9050&quot;; 3.1.6 æŸ¥çœ‹å½“å‰beçš„çŠ¶æ€123456789101112131415161718192021222324mysql&gt; show backends \\G*************************** 1. row *************************** BackendId: 10003 Cluster: default_cluster IP: 10.200.50.16 HeartbeatPort: 9050 BePort: 9060 HttpPort: 8040 BrpcPort: 8060 LastStartTime: 2021-05-31 11:27:51 LastHeartbeat: 2021-05-31 11:27:56 Alive: true SystemDecommissioned: falseClusterDecommissioned: false TabletNum: 0 DataUsedCapacity: .000 AvailCapacity: 456.262 GB TotalCapacity: 487.221 GB UsedPct: 6.35 % MaxDiskUsedPct: 6.35 % ErrMsg: Version: 1.15.1-6fb71ad Status: &#123;&quot;lastSuccessReportTabletsTime&quot;:&quot;2021-05-31 11:27:51&quot;&#125;1 row in set (0.01 sec) 3.2 Backendç¯å¢ƒ3.2.1 Beçš„ç¯å¢ƒé…ç½®1234567891011121314151617# ä¸‹è½½ï¼ˆè¿™ä¸ªé“¾æ¥wgetæ‰§è¡ŒæŠ¥é”™ï¼Œç”¨macä¸‹è½½å®Œæˆï¼Œä¼ åˆ°æœåŠ¡å™¨ï¼‰å¹¶è§£å‹DorisDBçš„å®‰è£…åŒ…ã€copy feæ–‡ä»¶å¤¹åˆ°é€‚å½“ä½ç½®$ cd ~$ wget http://dorisdb-release.cdn.dorisdb.com/DorisDB-SE-1.15.1.tar.gz?Expires=1622383610&amp;OSSAccessKeyId=LTAI4GFYjbX9e7QmFnAAvkt8&amp;Signature=lJ%2BDjDl5Y7XzTXXshIGLbiCxCzs%3D$ mv DorisDB-SE-1.15.1 doris-db$ cd /usr/etc/ &amp;&amp; mkdir -p doris-db$ cp -r ~/doris-db/be .# è®¾ç½®feå…ƒæ•°æ®å­˜å‚¨ä½ç½®$ cd /usr/etc/doris-db/fe &amp;&amp; mkdir -p doris-meta# é…ç½®feçš„DORIS_HOMEç¯å¢ƒå˜é‡$ vim /etc/profile#è¿½åŠ export DORIS_HOME=/usr/etc/doris/be$ source /etc/profile 3.2.2 å¯åŠ¨å¹¶æµ‹è¯•å®‰è£…ç»“æœ12# å¯åŠ¨fe$ sh sh $DORIS_HOME/bin/start_fe.sh --daemon è®¿é—®åœ°å€ï¼šhttp://10.200.50.16:8040/ åˆ°æ­¤beå®‰è£…å®Œæˆ å¤šèŠ‚ç‚¹ï¼Œé‡å¤3.1ã€3.2çš„æ“ä½œã€‚Doris-dbæ˜¯ä¸€ä¸ªè‡ªè¿ç»´çš„MPPæ¶æ„ï¼Œæ•´ä½“æ­å»ºæ¯”è¾ƒç®€å•ã€‚ å››ã€æ•°æ®æµ‹è¯•4.1 æ•°æ®åº“schemaåˆ›å»º123456789101112mysql&gt; create database db_test;Query OK, 0 rows affected (0.01 sec)mysql&gt; show databases;+--------------------+| Database |+--------------------+| _statistics_ || db_test || information_schema |+--------------------+3 rows in set (0.00 sec) 4.2 æ•°æ®è¡¨æœ¬æ¬¡æµ‹è¯•ä¸»è¦æ˜¯ä½¿ç”¨Doris-dbçš„æ›´æ–°æ¨¡å‹ï¼ŒDoris-dbå…±æœ‰ä¸‰ç§æ¨¡å‹ï¼š Unique(æ›´æ–°æ¨¡å‹) æŒ‡å®šUnique Keyï¼Œæ›´æ–°æ¨¡å‹ä¸­, æ’åºé”®æ»¡è¶³å”¯ä¸€æ€§çº¦æŸ, æˆä¸ºä¸»é”®.å½“ç›¸åŒä¸»é”®çš„æ•°æ®è¿›å…¥ï¼Œç‰ˆæœ¬å·ä¼šå¢åŠ ï¼Œåœ¨æŸ¥è¯¢çš„æ—¶å€™ä¼šè¿›è¡Œç‰ˆæœ¬å·è¿‡æ»¤ï¼Œé€‰å–ç‰ˆæœ¬å·è¾ƒé«˜çš„æ•°æ®å±•ç¤º DUPLICATE(æ˜ç»†æ¨¡å‹) å­˜å‚¨åŸå§‹æ•°æ® AGGREGATE(èšåˆæ¨¡å‹) æŒ‡å®šç»´åº¦å’Œèšåˆæ–¹å¼ï¼Œå½“æœ‰å¤šæ¡æ•°æ®å…·æœ‰ç›¸åŒç»´åº¦æ—¶ï¼Œdorisä¼šæŒ‰ç…§é¢„å®šçš„è§„åˆ™è¿›è¡Œèšåˆ é‡åˆ°çš„é—®é¢˜1ã€é›†ç¾¤è¦æ±‚Doris å¯¹é›†ç¾¤çš„æœ€ä½è¦æ±‚ä¸ºbeä¸º3ä¸ªï¼Œå¦åˆ™åœ¨åˆ›å»ºolapå¼•æ“çš„è¡¨çš„æ—¶å€™ï¼Œä¼šå‡ºç°ç±»ä¼¼çš„é”™è¯¯","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"Apache doriså»ºè¡¨æŒ‡å—","slug":"Apache doriså»ºè¡¨æŒ‡å—","date":"2021-05-27T09:41:37.701Z","updated":"2021-06-05T14:58:24.502Z","comments":true,"path":"2021/05/27/Apache doriså»ºè¡¨æŒ‡å—/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/27/Apache%20doris%E5%BB%BA%E8%A1%A8%E6%8C%87%E5%8D%97/","excerpt":"","text":"Name: â€˜CREATE TABLEâ€™Description: è¯¥è¯­å¥ç”¨äºåˆ›å»º tableã€‚è¯­æ³•ï¼š 1234567891011CREATE [EXTERNAL] TABLE [IF NOT EXISTS] [database.]table_name(column_definition1[, column_definition2, ...][, index_definition1[, ndex_definition12,]])[ENGINE &#x3D; [olap|mysql|broker|hive]][key_desc][COMMENT &quot;table comment&quot;];[partition_desc][distribution_desc][rollup_index][PROPERTIES (&quot;key&quot;&#x3D;&quot;value&quot;, ...)][BROKER PROPERTIES (&quot;key&quot;&#x3D;&quot;value&quot;, ...)] column_definition è¯­æ³•ï¼š col_name col_type [agg_type] [NULL | NOT NULL] [DEFAULT &quot;default_value&quot;] è¯´æ˜ï¼š col_nameï¼šåˆ—åç§° col_typeï¼šåˆ—ç±»å‹ 123456789101112131415161718192021222324252627282930313233TINYINTï¼ˆ1å­—èŠ‚ï¼‰ èŒƒå›´ï¼š-2^7 + 1 ~ 2^7 - 1SMALLINTï¼ˆ2å­—èŠ‚ï¼‰ èŒƒå›´ï¼š-2^15 + 1 ~ 2^15 - 1INTï¼ˆ4å­—èŠ‚ï¼‰ èŒƒå›´ï¼š-2^31 + 1 ~ 2^31 - 1BIGINTï¼ˆ8å­—èŠ‚ï¼‰ èŒƒå›´ï¼š-2^63 + 1 ~ 2^63 - 1LARGEINTï¼ˆ16å­—èŠ‚ï¼‰ èŒƒå›´ï¼š-2^127 + 1 ~ 2^127 - 1FLOATï¼ˆ4å­—èŠ‚ï¼‰ æ”¯æŒç§‘å­¦è®¡æ•°æ³•DOUBLEï¼ˆ12å­—èŠ‚ï¼‰ æ”¯æŒç§‘å­¦è®¡æ•°æ³•DECIMAL[(precision, scale)] (16å­—èŠ‚) ä¿è¯ç²¾åº¦çš„å°æ•°ç±»å‹ã€‚é»˜è®¤æ˜¯ DECIMAL(10, 0) precision: 1 ~ 27 scale: 0 ~ 9 å…¶ä¸­æ•´æ•°éƒ¨åˆ†ä¸º 1 ~ 18 ä¸æ”¯æŒç§‘å­¦è®¡æ•°æ³•DATEï¼ˆ3å­—èŠ‚ï¼‰ èŒƒå›´ï¼š0000-01-01 ~ 9999-12-31DATETIMEï¼ˆ8å­—èŠ‚ï¼‰ èŒƒå›´ï¼š0000-01-01 00:00:00 ~ 9999-12-31 23:59:59CHAR[(length)] å®šé•¿å­—ç¬¦ä¸²ã€‚é•¿åº¦èŒƒå›´ï¼š1 ~ 255ã€‚é»˜è®¤ä¸º1VARCHAR[(length)] å˜é•¿å­—ç¬¦ä¸²ã€‚é•¿åº¦èŒƒå›´ï¼š1 ~ 65533HLL (1~16385ä¸ªå­—èŠ‚) hllåˆ—ç±»å‹ï¼Œä¸éœ€è¦æŒ‡å®šé•¿åº¦å’Œé»˜è®¤å€¼ã€é•¿åº¦æ ¹æ®æ•°æ®çš„èšåˆ ç¨‹åº¦ç³»ç»Ÿå†…æ§åˆ¶ï¼Œå¹¶ä¸”HLLåˆ—åªèƒ½é€šè¿‡é…å¥—çš„hll_union_aggã€Hll_cardinalityã€hll_hashè¿›è¡ŒæŸ¥è¯¢æˆ–ä½¿ç”¨BITMAP bitmapåˆ—ç±»å‹ï¼Œä¸éœ€è¦æŒ‡å®šé•¿åº¦å’Œé»˜è®¤å€¼ã€‚è¡¨ç¤ºæ•´å‹çš„é›†åˆï¼Œå…ƒç´ æœ€å¤§æ”¯æŒåˆ°2^64 - 1 agg_typeï¼šèšåˆç±»å‹ï¼Œå¦‚æœä¸æŒ‡å®šï¼Œåˆ™è¯¥åˆ—ä¸º key åˆ—ã€‚å¦åˆ™ï¼Œè¯¥åˆ—ä¸º value åˆ— * SUMã€MAXã€MINã€REPLACE * HLL_UNION(ä»…ç”¨äºHLLåˆ—ï¼Œä¸ºHLLç‹¬æœ‰çš„èšåˆæ–¹å¼)ã€ * BITMAP_UNION(ä»…ç”¨äº BITMAP åˆ—ï¼Œä¸º BITMAP ç‹¬æœ‰çš„èšåˆæ–¹å¼)ã€ * REPLACE_IF_NOT_NULLï¼šè¿™ä¸ªèšåˆç±»å‹çš„å«ä¹‰æ˜¯å½“ä¸”ä»…å½“æ–°å¯¼å…¥æ•°æ®æ˜¯éNULLå€¼æ—¶ä¼šå‘ç”Ÿæ›¿æ¢è¡Œä¸ºï¼Œå¦‚æœæ–°å¯¼å…¥çš„æ•°æ®æ˜¯NULLï¼Œé‚£ä¹ˆDorisä»ç„¶ä¼šä¿ç•™åŸå€¼ã€‚æ³¨æ„ï¼šå¦‚æœç”¨åœ¨å»ºè¡¨æ—¶REPLACE_IF_NOT_NULLåˆ—æŒ‡å®šäº†NOT NULLï¼Œé‚£ä¹ˆDorisä»ç„¶ä¼šå°†å…¶è½¬åŒ–NULLï¼Œä¸ä¼šå‘ç”¨æˆ·æŠ¥é”™ã€‚ç”¨æˆ·å¯ä»¥å€ŸåŠ©è¿™ä¸ªç±»å‹å®Œæˆéƒ¨åˆ†åˆ—å¯¼å…¥çš„åŠŸèƒ½ã€‚ * è¯¥ç±»å‹åªå¯¹èšåˆæ¨¡å‹(key_descçš„typeä¸ºAGGREGATE KEY)æœ‰ç”¨ï¼Œå…¶å®ƒæ¨¡å‹ä¸éœ€è¦æŒ‡è¿™ä¸ªã€‚ æ˜¯å¦å…è®¸ä¸ºNULL: é»˜è®¤ä¸å…è®¸ä¸º NULLã€‚NULL å€¼åœ¨å¯¼å…¥æ•°æ®ï¿½ï¿½ï¿½ç”¨ \\N æ¥è¡¨ç¤º æ³¨æ„ï¼š BITMAP_UNIONèšåˆç±»å‹åˆ—åœ¨å¯¼å…¥æ—¶çš„åŸå§‹æ•°æ®ç±»å‹å¿…é¡»æ˜¯TINYINT,SMALLINT,INT,BIGINTã€‚ index_definition è¯­æ³•ï¼š `INDEX index_name (col_name[, col_name, ...]) [USING BITMAP] COMMENT &#39;xxxxxx&#39;` è¯´æ˜ï¼š index_nameï¼šç´¢å¼•åç§° col_nameï¼šåˆ—å æ³¨æ„ï¼š å½“å‰ä»…æ”¯æŒBITMAPç´¢å¼•ï¼Œ BITMAPç´¢å¼•ä»…æ”¯æŒåº”ç”¨äºå•åˆ— ENGINE ç±»å‹ é»˜è®¤ä¸º olapã€‚å¯é€‰ mysql, broker, hive å¦‚æœæ˜¯ mysqlï¼Œåˆ™éœ€è¦åœ¨ properties æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š 12345678PROPERTIES ( &quot;host&quot; &#x3D; &quot;mysql_server_host&quot;, &quot;port&quot; &#x3D; &quot;mysql_server_port&quot;, &quot;user&quot; &#x3D; &quot;your_user_name&quot;, &quot;password&quot; &#x3D; &quot;your_password&quot;, &quot;database&quot; &#x3D; &quot;database_name&quot;, &quot;table&quot; &#x3D; &quot;table_name&quot; ) æ³¨æ„ï¼š &quot;table&quot; æ¡ç›®ä¸­çš„ &quot;table_name&quot; æ˜¯ mysql ä¸­çš„çœŸå®è¡¨åã€‚ è€Œ CREATE TABLE è¯­å¥ä¸­çš„ table_name æ˜¯è¯¥ mysql è¡¨åœ¨ Doris ä¸­çš„åï¿½ï¿½ï¿½ï¼Œå¯ä»¥ä¸åŒã€‚ åœ¨ Doris åˆ›å»º mysql è¡¨çš„ç›®çš„æ˜¯å¯ä»¥é€šè¿‡ Doris è®¿é—® mysql æ•°æ®åº“ã€‚ è€Œ Doris æœ¬èº«å¹¶ä¸ç»´æŠ¤ã€å­˜å‚¨ä»»ä½• mysql æ•°æ®ã€‚ 2) å¦‚æœæ˜¯ brokerï¼Œè¡¨ç¤ºè¡¨çš„è®¿é—®éœ€è¦é€šè¿‡æŒ‡å®šçš„broker, éœ€è¦åœ¨ properties æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š 123456PROPERTIES (&quot;broker_name&quot; &#x3D; &quot;broker_name&quot;,&quot;path&quot; &#x3D; &quot;file_path1[,file_path2]&quot;,&quot;column_separator&quot; &#x3D; &quot;value_separator&quot;&quot;line_delimiter&quot; &#x3D; &quot;value_delimiter&quot;) å¦å¤–è¿˜éœ€è¦æä¾›Brokeréœ€è¦çš„Propertyä¿¡æ¯ï¼Œé€šè¿‡BROKER PROPERTIESæ¥ä¼ é€’ï¼Œä¾‹å¦‚HDFSéœ€è¦ä¼ å…¥ 1234BROKER PROPERTIES( &quot;username&quot; &#x3D; &quot;name&quot;, &quot;password&quot; &#x3D; &quot;password&quot;) è¿™ä¸ªæ ¹æ®ä¸åŒçš„Brokerç±»å‹ï¼Œéœ€è¦ä¼ å…¥çš„å†…å®¹ä¹Ÿä¸ç›¸åŒ æ³¨æ„ï¼š &quot;path&quot; ä¸­å¦‚æœæœ‰å¤šä¸ªæ–‡ä»¶ï¼Œç”¨é€—å·[,]åˆ†å‰²ã€‚å¦‚æœæ–‡ä»¶åä¸­åŒ…å«é€—å·ï¼Œé‚£ä¹ˆä½¿ç”¨ %2c æ¥æ›¿ä»£ã€‚å¦‚æœæ–‡ä»¶åä¸­åŒ…å« %ï¼Œä½¿ç”¨ %25 ä»£æ›¿ ç°åœ¨æ–‡ä»¶å†…å®¹æ ¼å¼æ”¯æŒCSVï¼Œæ”¯æŒGZï¼ŒBZ2ï¼ŒLZ4ï¼ŒLZO(LZOP) å‹ç¼©æ ¼å¼ã€‚ 3) å¦‚æœæ˜¯ hiveï¼Œåˆ™éœ€è¦åœ¨ properties æä¾›ä»¥ä¸‹ä¿¡æ¯ï¼š 123456PROPERTIES ( &quot;database&quot; &#x3D; &quot;hive_db_name&quot;, &quot;table&quot; &#x3D; &quot;hive_table_name&quot;, &quot;hive.metastore.uris&quot; &#x3D; &quot;thrift:&#x2F;&#x2F;127.0.0.1:9083&quot;) å…¶ä¸­ database æ˜¯ hive è¡¨å¯¹åº”çš„åº“åå­—ï¼Œtable æ˜¯ hive è¡¨çš„åå­—ï¼Œhive.metastore.uris æ˜¯ hive metastore æœåŠ¡åœ°å€ã€‚ æ³¨æ„ï¼šç›®å‰hiveå¤–éƒ¨è¡¨ä»…ç”¨äºSpark Loadä½¿ç”¨ï¼Œä¸æ”¯æŒæŸ¥è¯¢ã€‚ key_desc è¯­æ³•ï¼š `key_type(k1[,k2 ...])` è¯´æ˜ï¼š æ•°æ®æŒ‰ç…§æŒ‡å®šçš„keyåˆ—è¿›è¡Œæ’åºï¼Œä¸”æ ¹æ®ä¸åŒçš„key_typeå…·æœ‰ä¸åŒç‰¹æ€§ã€‚ key_typeæ”¯æŒä»¥ä¸‹ç±»å‹ï¼š AGGREGATE KEY:keyåˆ—ç›¸åŒçš„è®°å½•ï¼Œvalueåˆ—æŒ‰ç…§æŒ‡å®šçš„èšåˆç±»å‹è¿›è¡Œèšåˆï¼Œ é€‚åˆæŠ¥è¡¨ã€å¤šç»´åˆ†æç­‰ä¸šåŠ¡åœºæ™¯ã€‚ UNIQUE KEY:keyåˆ—ç›¸åŒçš„è®°å½•ï¼Œvalueåˆ—æŒ‰å¯¼å…¥é¡ºåºè¿›è¡Œè¦†ç›–ï¼Œ é€‚åˆæŒ‰keyåˆ—è¿›è¡Œå¢åˆ æ”¹æŸ¥çš„ç‚¹æŸ¥è¯¢ä¸šåŠ¡ã€‚ DUPLICATE KEY:keyåˆ—ç›¸åŒçš„è®°å½•ï¼ŒåŒæ—¶å­˜åœ¨äºDorisä¸­ï¼Œ é€‚åˆå­˜å‚¨æ˜ç»†æ•°æ®æˆ–è€…æ•°æ®æ— èšåˆç‰¹æ€§çš„ä¸šåŠ¡åœºæ™¯ã€‚ é»˜è®¤ä¸ºDUPLICATE KEYï¼Œkeyåˆ—ä¸ºåˆ—å®šä¹‰ä¸­å‰36ä¸ªå­—èŠ‚, å¦‚æœå‰36ä¸ªå­—èŠ‚çš„åˆ—æ•°å°äº3ï¼Œå°†ä½¿ç”¨å‰ä¸‰åˆ—ã€‚ æ³¨æ„ï¼š é™¤AGGREGATE KEYå¤–ï¼Œå…¶ä»–key_typeåœ¨å»ºè¡¨æ—¶ï¼Œvalueåˆ—ä¸éœ€è¦æŒ‡å®šèšåˆç±»å‹ã€‚ partition_desc partitionæè¿°æœ‰ä¸¤ç§ä½¿ç”¨æ–¹å¼ LESS THAN è¯­æ³•ï¼š 123456PARTITION BY RANGE (k1, k2, ...)(PARTITION partition_name1 VALUES LESS THAN MAXVALUE|(&quot;value1&quot;, &quot;value2&quot;, ...),PARTITION partition_name2 VALUES LESS THAN MAXVALUE|(&quot;value1&quot;, &quot;value2&quot;, ...)...) è¯´æ˜ï¼š ä½¿ï¿½ï¿½ï¿½æŒ‡å®šçš„ key åˆ—å’ŒæŒ‡å®šçš„æ•°å€¼èŒƒå›´è¿›è¡Œåˆ†åŒºã€‚ 1) åˆ†åŒºåç§°ä»…æ”¯æŒå­—æ¯å¼€å¤´ï¼Œå­—æ¯ã€æ•°å­—å’Œä¸‹åˆ’çº¿ç»„æˆ 2) ç›®å‰ä»…æ”¯æŒä»¥ä¸‹ç±»å‹çš„åˆ—ä½œä¸º Range åˆ†åŒºåˆ—ï¼Œä¸”åªèƒ½æŒ‡å®šä¸€ä¸ªåˆ†åŒºåˆ— TINYINT, SMALLINT, INT, BIGINT, LARGEINT, DATE, DATETIME 3) åˆ†åŒºä¸ºå·¦é—­å³å¼€åŒºé—´ï¼Œé¦–ä¸ªåˆ†åŒºçš„å·¦è¾¹ç•Œä¸ºåšæœ€å°å€¼ 4) NULL å€¼åªä¼šå­˜æ”¾åœ¨åŒ…å«æœ€å°å€¼çš„åˆ†åŒºä¸­ã€‚å½“åŒ…å«æœ€å°å€¼çš„åˆ†åŒºè¢«åˆ é™¤åï¼ŒNULL å€¼å°†æ— æ³•å¯¼å…¥ã€‚ 5) å¯ä»¥æŒ‡å®šä¸€åˆ—æˆ–å¤šåˆ—ä½œä¸ºåˆ†åŒºåˆ—ã€‚å¦‚æœåˆ†åŒºå€¼ç¼ºçœï¼Œåˆ™ä¼šé»˜è®¤å¡«å……æœ€å°å€¼ã€‚ æ³¨æ„ï¼š 1) åˆ†åŒºä¸€èˆ¬ç”¨äºæ—¶é—´ç»´åº¦çš„æ•°æ®ç®¡ç† 2) æœ‰æ•°æ®å›æº¯éœ€æ±‚çš„ï¼Œå¯ä»¥è€ƒè™‘é¦–ä¸ªåˆ†åŒºä¸ºç©ºåˆ†åŒºï¼Œä»¥ä¾¿åç»­å¢åŠ åˆ†åŒº 2ï¼‰Fixed Range è¯­æ³•ï¼š 123456PARTITION BY RANGE (k1, k2, k3, ...)(PARTITION partition_name1 VALUES [(&quot;k1-lower1&quot;, &quot;k2-lower1&quot;, &quot;k3-lower1&quot;,...), (&quot;k1-upper1&quot;, &quot;k2-upper1&quot;, &quot;k3-upper1&quot;, ...)),PARTITION partition_name2 VALUES [(&quot;k1-lower1-2&quot;, &quot;k2-lower1-2&quot;, ...), (&quot;k1-upper1-2&quot;, MAXVALUE, ))&quot;k3-upper1-2&quot;, ...) è¯´æ˜ï¼š 1ï¼‰Fixed Rangeæ¯”LESS THANç›¸å¯¹çµæ´»äº›ï¼Œå·¦å³åŒºé—´å®Œå…¨ç”±ç”¨æˆ·è‡ªå·±ç¡®å®š 2ï¼‰å…¶ä»–ä¸LESS THANä¿æŒåŒæ­¥ distribution_desc 1) Hash åˆ†æ¡¶ è¯­æ³•ï¼š `DISTRIBUTED BY HASH (k1[,k2 ...]) [BUCKETS num]` è¯´æ˜ï¼š ä½¿ç”¨æŒ‡å®šçš„ key åˆ—è¿›è¡Œå“ˆå¸Œåˆ†æ¡¶ã€‚é»˜è®¤åˆ†åŒºæ•°ä¸º10 å»ºè®®:å»ºè®®ä½¿ç”¨Hashåˆ†æ¡¶æ–¹å¼ PROPERTIES å¦‚æœ ENGINE ç±»å‹ä¸º olap å¯ä»¥åœ¨ properties è®¾ç½®è¯¥è¡¨æ•°æ®çš„åˆå§‹å­˜å‚¨ä»‹è´¨ã€å­˜å‚¨åˆ°æœŸæ—¶é—´å’Œå‰¯æœ¬æ•°ã€‚ 12345PROPERTIES ( &quot;storage_medium&quot; &#x3D; &quot;[SSD|HDD]&quot;, [&quot;storage_cooldown_time&quot; &#x3D; &quot;yyyy-MM-dd HH:mm:ss&quot;], [&quot;replication_num&quot; &#x3D; &quot;3&quot;] ) storage_mediumï¼š ç”¨äºæŒ‡å®šè¯¥åˆ†åŒºçš„åˆå§‹å­˜å‚¨ä»‹è´¨ï¼Œå¯é€‰æ‹© SSD æˆ– HDDã€‚é»˜è®¤åˆå§‹å­˜å‚¨ä»‹è´¨å¯é€šè¿‡feçš„é…ç½®æ–‡ä»¶ fe.conf ä¸­æŒ‡å®š default_storage_medium=xxxï¼Œå¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™é»˜è®¤ä¸º HDDã€‚ æ³¨æ„ï¼šå½“FEé…ç½®é¡¹ `enable_strict_storage_medium_check` ä¸º `True` æ—¶ï¼Œè‹¥é›†ç¾¤ä¸­æ²¡æœ‰è®¾ç½®å¯¹åº”çš„å­˜å‚¨ä»‹è´¨æ—¶ï¼Œå»ºè¡¨è¯­å¥ä¼šæŠ¥é”™ `Failed to find enough host in all backends with storage medium is SSD|HDD`. storage_cooldown_timeï¼š å½“è®¾ç½®å­˜å‚¨ä»‹è´¨ä¸º SSD æ—¶ï¼ŒæŒ‡å®šè¯¥åˆ†åŒºåœ¨ SSD ä¸Šçš„å­˜å‚¨åˆ°æœŸæ—¶é—´ã€‚ é»˜è®¤å­˜æ”¾ 30 å¤©ã€‚ æ ¼å¼ä¸ºï¼š&quot;yyyy-MM-dd HH:mm:ss&quot; replication_num: æŒ‡å®šåˆ†åŒºçš„å‰¯æœ¬æ•°ã€‚é»˜è®¤ä¸º 3 å½“è¡¨ä¸ºå•åˆ†åŒºè¡¨æ—¶ï¼Œè¿™äº›å±æ€§ä¸ºè¡¨çš„å±æ€§ã€‚ å½“è¡¨ä¸ºä¸¤çº§åˆ†åŒºæ—¶ï¼Œè¿™äº›å±æ€§ä¸ºé™„å±äºæ¯ä¸€ä¸ªåˆ†åŒºã€‚ å¦‚æœå¸Œæœ›ä¸åŒåˆ†åŒºæœ‰ä¸åŒå±æ€§ã€‚å¯ä»¥é€šè¿‡ ADD PARTITION æˆ– MODIFY PARTITION è¿›è¡Œæ“ä½œ 2 å¦‚æœ Engine ç±»å‹ä¸º olap, å¯ä»¥æŒ‡å®šæŸåˆ—ä½¿ç”¨ bloom filter ç´¢å¼• bloom filter ç´¢å¼•ä»…é€‚ç”¨äºæŸ¥è¯¢æ¡ä»¶ä¸º in å’Œ equal çš„æƒ…å†µï¼Œè¯¥åˆ—çš„å€¼è¶Šåˆ†æ•£æ•ˆæœè¶Šå¥½ ç›®å‰åªæ”¯æŒä»¥ä¸‹æƒ…å†µçš„åˆ—:é™¤äº† TINYINT FLOAT DOUBLE ç±»å‹ä»¥å¤–çš„ key åˆ—åŠèšåˆæ–¹æ³•ä¸º REPLACE çš„ value åˆ— 123PROPERTIES ( &quot;bloom_filter_columns&quot;&#x3D;&quot;k1,k2,k3&quot; ) 3) å¦‚æœå¸Œæœ›ä½¿ç”¨ Colocate Join ç‰¹æ€§ï¼Œéœ€è¦åœ¨ properties ä¸­æŒ‡å®š 123PROPERTIES ( &quot;colocate_with&quot;&#x3D;&quot;table1&quot; ) 4) å¦‚æœå¸Œæœ›ä½¿ç”¨åŠ¨æ€åˆ†åŒºç‰¹æ€§ï¼Œéœ€è¦åœ¨properties ä¸­æŒ‡å®š 1234567PROPERTIES ( &quot;dynamic_partition.enable&quot; &#x3D; &quot;true|false&quot;, &quot;dynamic_partition.time_unit&quot; &#x3D; &quot;DAY|WEEK|MONTH&quot;, &quot;dynamic_partition.start&quot; &#x3D; &quot;$&#123;integer_value&#125;&quot;, &quot;dynamic_partitoin.end&quot; &#x3D; &quot;$&#123;integer_value&#125;&quot;, &quot;dynamic_partition.prefix&quot; &#x3D; &quot;$&#123;string_value&#125;&quot;, &quot;dynamic_partition.buckets&quot; &#x3D; &quot;$&#123;integer_value&#125; dynamic_partition.enable: ç”¨äºæŒ‡å®šè¡¨çº§åˆ«çš„åŠ¨æ€åˆ†åŒºåŠŸèƒ½æ˜¯å¦å¼€å¯ã€‚é»˜è®¤ä¸º trueã€‚ dynamic_partition.time_unit: ç”¨äºæŒ‡å®šåŠ¨æ€æ·»åŠ åˆ†åŒºçš„æ—¶é—´å•ä½ï¼Œå¯é€‰æ‹©ä¸ºDAYï¼ˆå¤©ï¼‰ï¼ŒWEEK(å‘¨)ï¼ŒMONTHï¼ˆæœˆï¼‰ dynamic_partition.start: ç”¨äºæŒ‡å®šå‘å‰åˆ é™¤å¤šå°‘ä¸ªåˆ†åŒºã€‚å€¼å¿…é¡»å°äº0ã€‚é»˜è®¤ä¸º Integer.MIN_VALUEã€‚ dynamic_partition.end: ç”¨äºæŒ‡å®šæå‰åˆ›å»ºçš„åˆ†åŒºæ•°é‡ã€‚å€¼å¿…é¡»å¤§äº0ã€‚ dynamic_partition.prefix: ç”¨äºæŒ‡å®šåˆ›å»ºçš„åˆ†åŒºåå‰ç¼€ï¼Œä¾‹å¦‚åˆ†åŒºåå‰ç¼€ä¸ºpï¼Œåˆ™è‡ªåŠ¨åˆ›å»ºåˆ†åŒºåä¸ºp20200108 dynamic_partition.buckets: ç”¨äºæŒ‡å®šè‡ªåŠ¨åˆ›å»ºçš„åˆ†åŒºåˆ†æ¡¶æ•°é‡ 5) å»ºè¡¨æ—¶å¯ä»¥æ‰¹é‡åˆ›å»ºå¤šä¸ª Rollup è¯­æ³•ï¼š 123ROLLUP (rollup_name (column_name1, column_name2, ...) [FROM from_index_name] [PROPERTIES (&quot;key&quot;&#x3D;&quot;value&quot;, ...)],...) 6) å¦‚æœå¸Œæœ›ä½¿ç”¨ å†…å­˜è¡¨ ç‰¹æ€§ï¼Œéœ€è¦åœ¨ properties ä¸­æŒ‡å®š 123PROPERTIES ( &quot;in_memory&quot;&#x3D;&quot;true&quot;) å½“ in_memory å±æ€§ä¸º true æ—¶ï¼ŒDorisä¼šå°½å¯èƒ½å°†è¯¥è¡¨çš„æ•°æ®å’Œç´¢å¼•Cacheåˆ°BE å†…å­˜ä¸­ Examples: åˆ›å»ºä¸€ä¸ª olap è¡¨ï¼Œä½¿ç”¨ HASH åˆ†æ¡¶ï¼Œä½¿ç”¨åˆ—å­˜ï¼Œç›¸åŒkeyçš„è®°å½•è¿›è¡Œèšåˆ 123456789101112CREATE TABLE example_db.table_hash(k1 TINYINT,k2 DECIMAL(10, 2) DEFAULT &quot;10.5&quot;,v1 CHAR(10) REPLACE,v2 INT SUM)ENGINE&#x3D;olapAGGREGATE KEY(k1, k2)COMMENT &quot;my first doris table&quot;DISTRIBUTED BY HASH(k1) BUCKETS 32PROPERTIES (&quot;storage_type&quot;&#x3D;&quot;column&quot;); åˆ›å»ºä¸€ä¸ª olap è¡¨ï¼Œä½¿ç”¨ Hash åˆ†æ¡¶ï¼Œä½¿ç”¨åˆ—å­˜ï¼Œç›¸åŒkeyçš„è®°å½•è¿›è¡Œè¦†ç›–ï¼Œè®¾ç½®åˆå§‹å­˜å‚¨ä»‹è´¨å’Œå†·å´æ—¶é—´ 123456789101112131415CREATE TABLE example_db.table_hash(k1 BIGINT,k2 LARGEINT,v1 VARCHAR(2048) REPLACE,v2 SMALLINT SUM DEFAULT &quot;10&quot;)ENGINE&#x3D;olapUNIQUE KEY(k1, k2)DISTRIBUTED BY HASH (k1, k2) BUCKETS 32PROPERTIES(&quot;storage_type&quot;&#x3D;&quot;column&quot;ï¼Œ&quot;storage_medium&quot; &#x3D; &quot;SSD&quot;,&quot;storage_cooldown_time&quot; &#x3D; &quot;2015-06-04 00:00:00&quot;); åˆ›å»ºä¸€ä¸ª olap è¡¨ï¼Œä½¿ç”¨ Range åˆ†åŒºï¼Œä½¿ç”¨Hashåˆ†æ¡¶ï¼Œé»˜è®¤ä½¿ç”¨åˆ—å­˜ï¼Œç›¸åŒkeyçš„è®°å½•åŒæ—¶å­˜åœ¨ï¼Œè®¾ç½®åˆå§‹å­˜å‚¨ä»‹è´¨å’Œå†·å´æ—¶é—´ 1ï¼‰LESS THAN 1234567891011121314151617181920CREATE TABLE example_db.table_range(k1 DATE,k2 INT,k3 SMALLINT,v1 VARCHAR(2048),v2 DATETIME DEFAULT &quot;2014-02-04 15:36:00&quot;)ENGINE&#x3D;olapDUPLICATE KEY(k1, k2, k3)PARTITION BY RANGE (k1)(PARTITION p1 VALUES LESS THAN (&quot;2014-01-01&quot;),PARTITION p2 VALUES LESS THAN (&quot;2014-06-01&quot;),PARTITION p3 VALUES LESS THAN (&quot;2014-12-01&quot;))DISTRIBUTED BY HASH(k2) BUCKETS 32PROPERTIES(&quot;storage_medium&quot; &#x3D; &quot;SSD&quot;, &quot;storage_cooldown_time&quot; &#x3D; &quot;2015-06-04 00:00:00&quot;); è¯´æ˜ï¼š è¿™ä¸ªè¯­å¥ä¼šå°†æ•°æ®åˆ’åˆ†æˆå¦‚ä¸‹3ä¸ªåˆ†åŒºï¼š 123( &#123; MIN &#125;, &#123;&quot;2014-01-01&quot;&#125; )[ &#123;&quot;2014-01-01&quot;&#125;, &#123;&quot;2014-06-01&quot;&#125; )[ &#123;&quot;2014-06-01&quot;&#125;, &#123;&quot;2014-12-01&quot;&#125; ) ä¸åœ¨è¿™äº›åˆ†åŒºèŒƒå›´å†…çš„æ•°æ®å°†è§†ä¸ºéæ³•æ•°æ®è¢«è¿‡æ»¤ Fixed Range 12345678910111213141516171819CREATE TABLE table_range(k1 DATE,k2 INT,k3 SMALLINT,v1 VARCHAR(2048),v2 DATETIME DEFAULT &quot;2014-02-04 15:36:00&quot;)ENGINE&#x3D;olapDUPLICATE KEY(k1, k2, k3)PARTITION BY RANGE (k1, k2, k3)(PARTITION p1 VALUES [(&quot;2014-01-01&quot;, &quot;10&quot;, &quot;200&quot;), (&quot;2014-01-01&quot;, &quot;20&quot;, &quot;300&quot;)),PARTITION p2 VALUES [(&quot;2014-06-01&quot;, &quot;100&quot;, &quot;200&quot;), (&quot;2014-07-01&quot;, &quot;100&quot;, &quot;300&quot;)))DISTRIBUTED BY HASH(k2) BUCKETS 32PROPERTIES(&quot;storage_medium&quot; &#x3D; &quot;SSD&quot;); åˆ›å»ºä¸€ä¸ª mysql è¡¨ 123456789101112131415161718CREATE EXTERNAL TABLE example_db.table_mysql(k1 DATE,k2 INT,k3 SMALLINT,k4 VARCHAR(2048),k5 DATETIME)ENGINE&#x3D;mysqlPROPERTIES(&quot;host&quot; &#x3D; &quot;127.0.0.1&quot;,&quot;port&quot; &#x3D; &quot;8239&quot;,&quot;user&quot; &#x3D; &quot;mysql_user&quot;,&quot;password&quot; &#x3D; &quot;mysql_passwd&quot;,&quot;database&quot; &#x3D; &quot;mysql_db_test&quot;,&quot;table&quot; &#x3D; &quot;mysql_table_test&quot;) åˆ›å»ºä¸€ä¸ªæ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨HDFSä¸Šçš„ broker å¤–éƒ¨è¡¨, æ•°æ®ä½¿ç”¨ â€œ|â€ åˆ†å‰²ï¼Œâ€\\nâ€ æ¢è¡Œ 123456789101112131415161718CREATE EXTERNAL TABLE example_db.table_broker (k1 DATE,k2 INT,k3 SMALLINT,k4 VARCHAR(2048),k5 DATETIME)ENGINE&#x3D;brokerPROPERTIES (&quot;broker_name&quot; &#x3D; &quot;hdfs&quot;,&quot;path&quot; &#x3D; &quot;hdfs:&#x2F;&#x2F;hdfs_host:hdfs_port&#x2F;data1,hdfs:&#x2F;&#x2F;hdfs_host:hdfs_port&#x2F;data2,hdfs:&#x2F;&#x2F;hdfs_host:hdfs_port&#x2F;data3%2c4&quot;,&quot;column_separator&quot; &#x3D; &quot;|&quot;,&quot;line_delimiter&quot; &#x3D; &quot;\\n&quot;)BROKER PROPERTIES (&quot;username&quot; &#x3D; &quot;hdfs_user&quot;,&quot;password&quot; &#x3D; &quot;hdfs_password&quot;) åˆ›å»ºä¸€å¼ å«æœ‰HLLåˆ—çš„è¡¨ 1234567891011CREATE TABLE example_db.example_table(k1 TINYINT,k2 DECIMAL(10, 2) DEFAULT &quot;10.5&quot;,v1 HLL HLL_UNION,v2 HLL HLL_UNION)ENGINE&#x3D;olapAGGREGATE KEY(k1, k2)DISTRIBUTED BY HASH(k1) BUCKETS 32PROPERTIES (&quot;storage_type&quot;&#x3D;&quot;column&quot;); åˆ›å»ºä¸€å¼ å«æœ‰BITMAP_UNIONèšåˆç±»å‹çš„è¡¨ï¼ˆv1å’Œv2åˆ—çš„åŸå§‹æ•°æ®ç±»å‹å¿…é¡»æ˜¯TINYINT,SMALLINT,INTï¼‰ 1234567891011CREATE TABLE example_db.example_table(k1 TINYINT,k2 DECIMAL(10, 2) DEFAULT &quot;10.5&quot;,v1 BITMAP BITMAP_UNION,v2 BITMAP BITMAP_UNION)ENGINE&#x3D;olapAGGREGATE KEY(k1, k2)DISTRIBUTED BY HASH(k1) BUCKETS 32PROPERTIES (&quot;storage_type&quot;&#x3D;&quot;column&quot;); åˆ›å»ºä¸¤å¼ æ”¯æŒColocat Joinçš„è¡¨t1 å’Œt2 12345678910111213141516171819CREATE TABLE &#96;t1&#96; (&#96;id&#96; int(11) COMMENT &quot;&quot;,&#96;value&#96; varchar(8) COMMENT &quot;&quot;) ENGINE&#x3D;OLAPDUPLICATE KEY(&#96;id&#96;)DISTRIBUTED BY HASH(&#96;id&#96;) BUCKETS 10PROPERTIES (&quot;colocate_with&quot; &#x3D; &quot;t1&quot;);CREATE TABLE &#96;t2&#96; (&#96;id&#96; int(11) COMMENT &quot;&quot;,&#96;value&#96; varchar(8) COMMENT &quot;&quot;) ENGINE&#x3D;OLAPDUPLICATE KEY(&#96;id&#96;)DISTRIBUTED BY HASH(&#96;id&#96;) BUCKETS 10PROPERTIES (&quot;colocate_with&quot; &#x3D; &quot;t1&quot;); åˆ›å»ºä¸€ä¸ªæ•°æ®æ–‡ä»¶å­˜å‚¨åœ¨BOSä¸Šçš„ broker å¤–éƒ¨è¡¨ 12345678910111213CREATE EXTERNAL TABLE example_db.table_broker (k1 DATE)ENGINE&#x3D;brokerPROPERTIES (&quot;broker_name&quot; &#x3D; &quot;bos&quot;,&quot;path&quot; &#x3D; &quot;bos:&#x2F;&#x2F;my_bucket&#x2F;input&#x2F;file&quot;,)BROKER PROPERTIES ( &quot;bos_endpoint&quot; &#x3D; &quot;http:&#x2F;&#x2F;bj.bcebos.com&quot;, &quot;bos_accesskey&quot; &#x3D; &quot;xxxxxxxxxxxxxxxxxxxxxxxxxx&quot;, &quot;bos_secret_accesskey&quot;&#x3D;&quot;yyyyyyyyyyyyyyyyyyyy&quot;) åˆ›å»ºä¸€ä¸ªå¸¦æœ‰bitmap ç´¢å¼•çš„è¡¨ 12345678910111213CREATE TABLE example_db.table_hash(k1 TINYINT,k2 DECIMAL(10, 2) DEFAULT &quot;10.5&quot;,v1 CHAR(10) REPLACE,v2 INT SUM,INDEX k1_idx (k1) USING BITMAP COMMENT &#39;xxxxxx&#39;)ENGINE&#x3D;olapAGGREGATE KEY(k1, k2)COMMENT &quot;my first doris table&quot;DISTRIBUTED BY HASH(k1) BUCKETS 32PROPERTIES (&quot;storage_type&quot;&#x3D;&quot;column&quot;); åˆ›å»ºä¸€ä¸ªåŠ¨æ€åˆ†åŒºè¡¨(éœ€è¦åœ¨FEé…ç½®ä¸­å¼€å¯åŠ¨æ€åˆ†åŒºåŠŸèƒ½)ï¼Œè¯¥è¡¨æ¯å¤©æå‰åˆ›å»º3å¤©çš„åˆ†åŒºï¼Œå¹¶åˆ é™¤3å¤©å‰çš„åˆ†åŒºã€‚ä¾‹å¦‚ä»Šå¤©ä¸º2020-01-08ï¼Œåˆ™ä¼šåˆ›å»ºåˆ†åŒºåä¸ºp20200108, p20200109, p20200110, p20200111çš„åˆ†åŒº. åˆ†åŒºèŒƒå›´åˆ†åˆ«ä¸º: 1234[types: [DATE]; keys: [2020-01-08]; â€¥types: [DATE]; keys: [2020-01-09]; )[types: [DATE]; keys: [2020-01-09]; â€¥types: [DATE]; keys: [2020-01-10]; )[types: [DATE]; keys: [2020-01-10]; â€¥types: [DATE]; keys: [2020-01-11]; )[types: [DATE]; keys: [2020-01-11]; â€¥types: [DATE]; keys: [2020-01-12]; ) 12345678910111213141516171819202122232425CREATE TABLE example_db.dynamic_partition(k1 DATE,k2 INT,k3 SMALLINT,v1 VARCHAR(2048),v2 DATETIME DEFAULT &quot;2014-02-04 15:36:00&quot;)ENGINE&#x3D;olapDUPLICATE KEY(k1, k2, k3)PARTITION BY RANGE (k1)(PARTITION p1 VALUES LESS THAN (&quot;2014-01-01&quot;),PARTITION p2 VALUES LESS THAN (&quot;2014-06-01&quot;),PARTITION p3 VALUES LESS THAN (&quot;2014-12-01&quot;))DISTRIBUTED BY HASH(k2) BUCKETS 32PROPERTIES(&quot;storage_medium&quot; &#x3D; &quot;SSD&quot;,&quot;dynamic_partition.time_unit&quot; &#x3D; &quot;DAY&quot;,&quot;dynamic_partition.start&quot; &#x3D; &quot;-3&quot;,&quot;dynamic_partition.end&quot; &#x3D; &quot;3&quot;,&quot;dynamic_partition.prefix&quot; &#x3D; &quot;p&quot;,&quot;dynamic_partition.buckets&quot; &#x3D; &quot;32&quot; ); Create a table with rollup index12345678910111213141516171819 CREATE TABLE example_db.rolup_index_table ( event_day DATE, siteid INT DEFAULT &#39;10&#39;, citycode SMALLINT, username VARCHAR(32) DEFAULT &#39;&#39;, pv BIGINT SUM DEFAULT &#39;0&#39; ) AGGREGATE KEY(event_day, siteid, citycode, username) DISTRIBUTED BY HASH(siteid) BUCKETS 10 rollup ( r1(event_day,siteid), r2(event_day,citycode), r3(event_day) ) PROPERTIES(&quot;replication_num&quot; &#x3D; &quot;3&quot;);13. åˆ›å»ºä¸€ä¸ªå†…å­˜è¡¨ CREATE TABLE example_db.table_hash(k1 TINYINT,k2 DECIMAL(10, 2) DEFAULT â€œ10.5â€,v1 CHAR(10) REPLACE,v2 INT SUM,INDEX k1_idx (k1) USING BITMAP COMMENT â€˜xxxxxxâ€™)ENGINE=olapAGGREGATE KEY(k1, k2)COMMENT â€œmy first doris tableâ€DISTRIBUTED BY HASH(k1) BUCKETS 32PROPERTIES (â€œin_memoryâ€=â€trueâ€);12313. åˆ›å»ºä¸€ä¸ªhiveå¤–éƒ¨è¡¨ CREATE TABLE example_db.table_hive( k1 TINYINT, k2 VARCHAR(50), v INT)ENGINE=hivePROPERTIES( â€œdatabaseâ€ = â€œhive_db_nameâ€, â€œtableâ€ = â€œhive_table_nameâ€, â€œhive.metastore.urisâ€ = â€œthrift://127.0.0.1:9083â€);1","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"Macä½¿ç”¨prometheus","slug":"Macä½¿ç”¨prometheus","date":"2021-05-27T05:49:50.594Z","updated":"2021-06-05T14:59:09.113Z","comments":true,"path":"2021/05/27/Macä½¿ç”¨prometheus/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/27/Mac%E4%BD%BF%E7%94%A8prometheus/","excerpt":"","text":"å®‰è£…prometheus12345678910111213141516171819$ brew install prometheus==&gt; Downloading https://homebrew.bintray.com/bottles/prometheus-2.25.2.big_sur.bottle.tar.gz==&gt; Downloading from https://d29vzk4ow07wi7.cloudfront.net/3ebbcb9f2988c8663d54b7582c8934656c6f1c6f80e43b8a9071d74298bc5d90?response-content-disposition=attachment%3Bfilename%3D%22prometheus-2.25.2.big_su######################################################################## 100.0%==&gt; Pouring prometheus-2.25.2.big_sur.bottle.tar.gz==&gt; CaveatsWhen run from `brew services`, `prometheus` is run from`prometheus_brew_services` and uses the flags in: /usr/local/etc/prometheus.argsTo have launchd start prometheus now and restart at login: brew services start prometheusOr, if you don&#x27;t want/need a background service you can just run: prometheus --config.file=/usr/local/etc/prometheus.yml==&gt; SummaryğŸº /usr/local/Cellar/prometheus/2.25.2: 21 files, 156.4MB==&gt; `brew cleanup` has not been run in 30 days, running now...Pruned 0 symbolic links and 54 directories from /usr/local å¯åŠ¨ï¼š 1prometheus --web.listen-address=&quot;0.0.0.0:9040&quot; --config.file=/usr/local/etc/prometheus.yml å®‰è£…brew install grafana123456789101112$ brew install grafana==&gt; Downloading https://homebrew.bintray.com/bottles/grafana-7.5.1.big_sur.bottle.tar.gz==&gt; Downloading from https://d29vzk4ow07wi7.cloudfront.net/9aa51026c2292a6e18d2a678396f35508404cd79e06e5fcc797bd3431c039b40?response-content-disposition=attachment%3Bfilename%3D%22grafana-7.5.1.big_sur.bo######################################################################## 100.0%==&gt; Pouring grafana-7.5.1.big_sur.bottle.tar.gz==&gt; CaveatsTo have launchd start grafana now and restart at login: brew services start grafanaOr, if you don&#x27;t want/need a background service you can just run: grafana-server --config=/usr/local/etc/grafana/grafana.ini --homepath /usr/local/share/grafana --packaging=brew cfg:default.paths.logs=/usr/local/var/log/grafana cfg:default.paths.data=/usr/local/var/lib/grafana cfg:default.paths.plugins=/usr/local/var/lib/grafana/plugins==&gt; SummaryğŸº /usr/local/Cellar/grafana/7.5.1: 2,663 files, 179.5MB æµè§ˆå™¨è®¿é—®http://localhost:3000å°±å¯ä»¥çœ‹åˆ°Grafanaé¡µé¢","categories":[{"name":"å¼€å‘æ€»ç»“","slug":"å¼€å‘æ€»ç»“","permalink":"https://cha1yi.github.io/dist/categories/%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://cha1yi.github.io/dist/tags/%E8%BF%90%E7%BB%B4/"}],"author":"wuxuan.chai"},{"title":"Greenplumå­¦ä¹ ","slug":"greenplumå­¦ä¹ ","date":"2021-05-21T09:07:48.365Z","updated":"2021-06-05T14:56:50.429Z","comments":true,"path":"2021/05/21/greenplumå­¦ä¹ /","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/21/greenplum%E5%AD%A6%E4%B9%A0/","excerpt":"","text":"copy123456789101112131415161718192021222324252627COPY table [(column [, ...])] FROM &#123;&#39;file&#39; | STDIN&#125; [ [WITH] [BINARY] [OIDS] [HEADER] [DELIMITER [ AS ] &#39;delimiter&#39;] [NULL [ AS ] &#39;null string&#39;] [ESCAPE [ AS ] &#39;escape&#39; | &#39;OFF&#39;] [NEWLINE [ AS ] &#39;LF&#39; | &#39;CR&#39; | &#39;CRLF&#39;] [CSV [QUOTE [ AS ] &#39;quote&#39;] [FORCE NOT NULL column [, ...]] [FILL MISSING FIELDS] [[LOG ERRORS] SEGMENT REJECT LIMIT count [ROWS | PERCENT] ]COPY &#123;table [(column [, ...])] | (query)&#125; TO &#123;&#39;file&#39; | STDOUT&#125; [ [WITH] [ON SEGMENT] [BINARY] [OIDS] [HEADER] [DELIMITER [ AS ] &#39;delimiter&#39;] [NULL [ AS ] &#39;null string&#39;] [ESCAPE [ AS ] &#39;escape&#39; | &#39;OFF&#39;] [CSV [QUOTE [ AS ] &#39;quote&#39;] [FORCE QUOTE column [, ...]] ] [IGNORE EXTERNAL PARTITIONS ] full example: 1psql --u gpadmin -d wi -c &quot;copy public.asset_record from &#39;..&#x2F;200.csv&#39; with csv DELIMITER E&#39;\\t&#39; NULL &#39;\\N&#39;&quot;","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"-æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"NmonæœåŠ¡å™¨ç›‘æ§å·¥å…·","slug":"nmonæœåŠ¡å™¨ç›‘æ§","date":"2021-05-20T02:36:03.382Z","updated":"2021-05-20T02:45:46.883Z","comments":true,"path":"2021/05/20/nmonæœåŠ¡å™¨ç›‘æ§/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/20/nmon%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%9B%91%E6%8E%A7/","excerpt":"","text":"å®‰è£…1234567891011121314151617181920# æ–°å»ºä¸€ä¸ªnmonæ–‡ä»¶å¤¹mkdir nmon# è§£å‹tar xvfz nmon16e_mpginc.tar.gz# æ”¹åmv nmon_x86_64_centos7 /root/nmon# ç»™å·¥å…·æˆæƒchmod 777 nmon # è¿è¡Œ./root/nmon#ç”Ÿæˆæ–‡ä»¶ å»ºè®®-cä¸è¶…è¿‡330ï¼Œæ–‡ä»¶å¤§å°è¶…å‡º10Må¯èƒ½ä¼šå‡ºé”™./nmon -ft -s 10 -c 60 -m /root/nmon # å‚æ•°è¯´æ˜ -f ç›‘æ§ç»“æœä»¥æ–‡ä»¶å½¢å¼è¾“å‡ºï¼Œé»˜è®¤æœºå™¨å+æ—¥æœŸ.nmonæ ¼å¼ -F æŒ‡å®šè¾“å‡ºçš„æ–‡ä»¶åï¼Œæ¯”å¦‚test.nmon -s æŒ‡çš„æ˜¯é‡‡æ ·çš„é¢‘ç‡ï¼Œå•ä½ä¸ºæ¯«ç§’ -c æŒ‡çš„æ˜¯é‡‡æ ·çš„æ¬¡æ•°ï¼Œå³ä»¥ä¸Šé¢çš„é‡‡æ ·é¢‘ç‡é‡‡é›†å¤šå°‘æ¬¡ -m æŒ‡å®šç”Ÿæˆçš„æ–‡ä»¶ç›®å½•","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://cha1yi.github.io/dist/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[],"author":"wuxuan.chai"},{"title":"ClickHouseé…ç½®æ–‡ä»¶","slug":"Clickhouseé…ç½®æ–‡ä»¶","date":"2021-05-14T04:03:01.957Z","updated":"2021-06-05T14:56:50.438Z","comments":true,"path":"2021/05/14/Clickhouseé…ç½®æ–‡ä»¶/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/14/Clickhouse%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6/","excerpt":"","text":"é…ç½®æ–‡ä»¶æ³¨é‡ŠUser.xml12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;?xml version=&quot;1.0&quot;?&gt;&lt;yandex&gt; &lt;profiles&gt; &lt;!-- è¯»å†™ç”¨æˆ·è®¾ç½® --&gt; &lt;default&gt; &lt;max_memory_usage&gt;10000000000&lt;/max_memory_usage&gt; &lt;use_uncompressed_cache&gt;0&lt;/use_uncompressed_cache&gt; &lt;load_balancing&gt;random&lt;/load_balancing&gt; &lt;/default&gt; &lt;!-- åªå†™ç”¨æˆ·è®¾ç½® --&gt; &lt;readonly&gt; &lt;max_memory_usage&gt;10000000000&lt;/max_memory_usage&gt; &lt;use_uncompressed_cache&gt;0&lt;/use_uncompressed_cache&gt; &lt;load_balancing&gt;random&lt;/load_balancing&gt; &lt;readonly&gt;1&lt;/readonly&gt; &lt;/readonly&gt; &lt;/profiles&gt; &lt;!-- é…é¢ --&gt; &lt;quotas&gt; &lt;!-- Name of quota. --&gt; &lt;default&gt; &lt;interval&gt; &lt;duration&gt;3600&lt;/duration&gt; &lt;queries&gt;0&lt;/queries&gt; &lt;errors&gt;0&lt;/errors&gt; &lt;result_rows&gt;0&lt;/result_rows&gt; &lt;read_rows&gt;0&lt;/read_rows&gt; &lt;execution_time&gt;0&lt;/execution_time&gt; &lt;/interval&gt; &lt;/default&gt; &lt;/quotas&gt; &lt;users&gt; &lt;!-- è¯»å†™ç”¨æˆ· --&gt; &lt;default&gt; &lt;password_sha256_hex&gt;967f3bf355dddfabfca1c9f5cab39352b2ec1cd0b05f9e1e6b8f629705fe7d6e&lt;/password_sha256_hex&gt; &lt;networks incl=&quot;networks&quot; replace=&quot;replace&quot;&gt; &lt;ip&gt;::/0&lt;/ip&gt; &lt;/networks&gt; &lt;profile&gt;default&lt;/profile&gt; &lt;quota&gt;default&lt;/quota&gt; &lt;/default&gt; &lt;!-- åªè¯»ç”¨æˆ· --&gt; &lt;ck&gt; &lt;password_sha256_hex&gt;967f3bf355dddfabfca1c9f5cab39352b2ec1cd0b05f9e1e6b8f629705fe7d6e&lt;/password_sha256_hex&gt; &lt;networks incl=&quot;networks&quot; replace=&quot;replace&quot;&gt; &lt;ip&gt;::/0&lt;/ip&gt; &lt;/networks&gt; &lt;profile&gt;readonly&lt;/profile&gt; &lt;quota&gt;default&lt;/quota&gt; &lt;/ck&gt; &lt;/users&gt;&lt;/yandex&gt; metrika.xml12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788&lt;yandex&gt;&lt;!-- é›†ç¾¤é…ç½® --&gt;&lt;clickhouse_remote_servers&gt; &lt;!-- é›†ç¾¤åç§°--&gt; &lt;bip_ck_cluster&gt; &lt;shard&gt; &lt;internal_replication&gt;false&lt;/internal_replication&gt; &lt;replica&gt; &lt;host&gt;ck1.xxxx.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;replica&gt; &lt;host&gt;ck2.xxxx.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;/shard&gt; &lt;shard&gt; &lt;internal_replication&gt;false&lt;/internal_replication&gt; &lt;replica&gt; &lt;host&gt;ck2.xxxx.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;replica&gt; &lt;host&gt;ck3.xxxxa.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;/shard&gt; &lt;shard&gt; &lt;internal_replication&gt;false&lt;/internal_replication&gt; &lt;replica&gt; &lt;host&gt;ck3.xxxxa.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;replica&gt; &lt;host&gt;ck1.xxxx.com.cn&lt;/host&gt; &lt;port&gt;9000&lt;/port&gt; &lt;user&gt;default&lt;/user&gt; &lt;password&gt;******&lt;/password&gt; &lt;/replica&gt; &lt;/shard&gt; &lt;/bip_ck_cluster&gt;&lt;/clickhouse_remote_servers&gt;&lt;!-- æœ¬èŠ‚ç‚¹å‰¯æœ¬åç§°ï¼ˆè¿™é‡Œæ— ç”¨ï¼‰ --&gt;&lt;macros&gt; &lt;replica&gt;ck1&lt;/replica&gt;&lt;/macros&gt;&lt;!-- ç›‘å¬ç½‘ç»œï¼ˆè²Œä¼¼é‡å¤ï¼‰ --&gt;&lt;networks&gt; &lt;ip&gt;::/0&lt;/ip&gt;&lt;/networks&gt;&lt;!-- ZK --&gt;&lt;zookeeper-servers&gt; &lt;node index=&quot;1&quot;&gt; &lt;host&gt;1.xxxx.sina.com.cn&lt;/host&gt; &lt;port&gt;2181&lt;/port&gt; &lt;/node&gt; &lt;node index=&quot;2&quot;&gt; &lt;host&gt;2.xxxx.sina.com.cn&lt;/host&gt; &lt;port&gt;2181&lt;/port&gt; &lt;/node&gt; &lt;node index=&quot;3&quot;&gt; &lt;host&gt;3.xxxxp.sina.com.cn&lt;/host&gt; &lt;port&gt;2181&lt;/port&gt; &lt;/node&gt;&lt;/zookeeper-servers&gt;&lt;!-- æ•°æ®å‹ç¼©ç®—æ³• --&gt;&lt;clickhouse_compression&gt;&lt;case&gt; &lt;min_part_size&gt;10000000000&lt;/min_part_size&gt; &lt;min_part_size_ratio&gt;0.01&lt;/min_part_size_ratio&gt; &lt;method&gt;lz4&lt;/method&gt;&lt;/case&gt;&lt;/clickhouse_compression&gt;&lt;/yandex&gt; config.xml1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859&lt;?xml version=&quot;1.0&quot;?&gt;&lt;yandex&gt; &lt;!-- æ—¥å¿— --&gt; &lt;logger&gt; &lt;level&gt;trace&lt;/level&gt; &lt;log&gt;/data1/clickhouse/log/server.log&lt;/log&gt; &lt;errorlog&gt;/data1/clickhouse/log/error.log&lt;/errorlog&gt; &lt;size&gt;1000M&lt;/size&gt; &lt;count&gt;10&lt;/count&gt; &lt;/logger&gt; &lt;!-- ç«¯å£ --&gt; &lt;http_port&gt;8123&lt;/http_port&gt; &lt;tcp_port&gt;9000&lt;/tcp_port&gt; &lt;interserver_http_port&gt;9009&lt;/interserver_http_port&gt; &lt;!-- æœ¬æœºåŸŸå --&gt; &lt;interserver_http_host&gt;è¿™é‡Œéœ€è¦ç”¨åŸŸåï¼Œå¦‚æœåç»­ç”¨åˆ°å¤åˆ¶çš„è¯&lt;/interserver_http_host&gt; &lt;!-- ç›‘å¬IP --&gt; &lt;listen_host&gt;0.0.0.0&lt;/listen_host&gt; &lt;!-- æœ€å¤§è¿æ¥æ•° --&gt; &lt;max_connections&gt;64&lt;/max_connections&gt; &lt;!-- æ²¡ææ‡‚çš„å‚æ•° --&gt; &lt;keep_alive_timeout&gt;3&lt;/keep_alive_timeout&gt; &lt;!-- æœ€å¤§å¹¶å‘æŸ¥è¯¢æ•° --&gt; &lt;max_concurrent_queries&gt;16&lt;/max_concurrent_queries&gt; &lt;!-- å•ä½æ˜¯B --&gt; &lt;uncompressed_cache_size&gt;8589934592&lt;/uncompressed_cache_size&gt; &lt;mark_cache_size&gt;10737418240&lt;/mark_cache_size&gt; &lt;!-- å­˜å‚¨è·¯å¾„ --&gt; &lt;path&gt;/data1/clickhouse/&lt;/path&gt; &lt;tmp_path&gt;/data1/clickhouse/tmp/&lt;/tmp_path&gt; &lt;!-- useré…ç½® --&gt; &lt;users_config&gt;users.xml&lt;/users_config&gt; &lt;default_profile&gt;default&lt;/default_profile&gt; &lt;log_queries&gt;1&lt;/log_queries&gt; &lt;default_database&gt;default&lt;/default_database&gt; &lt;remote_servers incl=&quot;clickhouse_remote_servers&quot; /&gt; &lt;zookeeper incl=&quot;zookeeper-servers&quot; optional=&quot;true&quot; /&gt; &lt;macros incl=&quot;macros&quot; optional=&quot;true&quot; /&gt; &lt;!-- æ²¡ææ‡‚çš„å‚æ•° --&gt; &lt;builtin_dictionaries_reload_interval&gt;3600&lt;/builtin_dictionaries_reload_interval&gt; &lt;!-- æ§åˆ¶å¤§è¡¨çš„åˆ é™¤ --&gt; &lt;max_table_size_to_drop&gt;0&lt;/max_table_size_to_drop&gt; &lt;include_from&gt;/data1/clickhouse/metrika.xml&lt;/include_from&gt;&lt;/yandex&gt;","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"ClickHouseæ€§èƒ½æµ‹è¯•","slug":"Clickhouseæ€§èƒ½æµ‹è¯•","date":"2021-05-13T06:29:42.386Z","updated":"2021-06-05T14:56:50.436Z","comments":true,"path":"2021/05/13/Clickhouseæ€§èƒ½æµ‹è¯•/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/13/Clickhouse%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/","excerpt":"","text":"å‡†å¤‡é˜¶æ®µæœºå™¨é…ç½® Cluster CPU Cores Mem Disk master 8C Intel Core Processor (Haswell, IBRS) 16G 488G æ•°æ®æ¥æºï¼š 1http:&#x2F;&#x2F;goods.elasticsearch.dev.kisgame.net:9200&#x2F;p_asset_record clickhouseçš„å»ºè¡¨è¯­å¥ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758CREATE TABLE default.asset_record( `id` String COMMENT &#x27;ä¸»é”®UUID&#x27;, `card_no` Nullable(String) COMMENT &#x27;å¡å·ï¼ˆç”¨äºä¼šå‘˜ï¼‰ï¼Œæ‰“å°å°ç¥¨ï¼ˆç”¨äºæ™®é€šé¡¾å®¢ï¼‰&#x27;, `flow_type` Nullable(Int8) DEFAULT NULL COMMENT &#x27;æµæ°´ç±»å‹: 1-å¡èµ„äº§æµæ°´ 2: æ‰˜ç®¡å•æµæ°´&#x27;, `merchant_id` Nullable(String) COMMENT &#x27;å•†æˆ·ID&#x27;, `merchant_name` Nullable(String) COMMENT &#x27;å•†æˆ·åç§°&#x27;, `shop_id` Nullable(String) COMMENT &#x27;é—¨åº—ID&#x27;, `shop_code` Nullable(String) COMMENT &#x27;é—¨åº—ç¼–ç &#x27;, `shop_name` Nullable(String) COMMENT &#x27;é—¨åº—åç§°&#x27;, `member_id` Nullable(String) COMMENT &#x27;ä¼šå‘˜ID&#x27;, `member_name` Nullable(String) COMMENT &#x27;ä¼šå‘˜å§“å&#x27;, `id_number` Nullable(String) COMMENT &#x27;ä¼šå‘˜èº«ä»½è¯&#x27;, `mobile_number` Nullable(String) COMMENT &#x27;ä¼šå‘˜æ‰‹æœºå·&#x27;, `member_level` Nullable(String) COMMENT &#x27;ä¼šå‘˜ç­‰çº§&#x27;, `member_level_name` Nullable(String) COMMENT &#x27;ä¼šå‘˜ç­‰çº§åç§°&#x27;, `member_type` Nullable(Int8) DEFAULT NULL COMMENT &#x27;ä¼šå‘˜ç±»åˆ« 0-ä¼šå‘˜ 1-éä¼šå‘˜&#x27;, `ref_member_id` Nullable(String) COMMENT &#x27;å¼•ç”¨ä¼šå‘˜ID&#x27;, `biz_code` Nullable(String) COMMENT &#x27;ä¸šåŠ¡ç¼–ç &#x27;, `amount` Nullable(Decimal(15, 2)) DEFAULT NULL COMMENT &#x27;æ•°é¢&#x27;, `amount2` Nullable(Decimal(15, 2)) DEFAULT NULL COMMENT &#x27;æ•°é¢2&#x27;, `asset_id` Nullable(String) COMMENT &#x27;èµ„äº§ID&#x27;, `asset_type` Nullable(Int8) DEFAULT NULL COMMENT &#x27;èµ„äº§ç±»å‹ï¼š0æŸ¥æ¸¸æˆå¸ï¼Œ1æŸ¥å½©ç¥¨ï¼Œ2æŸ¥é“¶ç¥¨å¡ï¼Œ3æŸ¥æ¸¸æˆåˆ¸ï¼Œ 4æŠ¼é‡‘&#x27;, `change_flag` Nullable(Int8) DEFAULT NULL COMMENT &#x27;èµ„äº§å˜åŒ–ï¼š0: å¢åŠ å¯ç”¨èµ„äº§, 1: å‡å°‘å¯ç”¨èµ„äº§, 2ï¼šå¢åŠ å†»ç»“èµ„äº§, 3ï¼šå‡å°‘å†»ç»“èµ„äº§&#x27;, `order_code` Nullable(String) COMMENT &#x27;è®¢å•ç¼–ç &#x27;, `param1` Nullable(String) COMMENT &#x27;å‚æ•°1&#x27;, `param2` Nullable(String) COMMENT &#x27;å‚æ•°2&#x27;, `param3` Nullable(String) COMMENT &#x27;å‚æ•°3&#x27;, `parent_asset_id` Nullable(String) COMMENT &#x27;ä¸»èµ„äº§id&#x27;, `create_time` DateTime COMMENT &#x27;åˆ›å»ºæ—¶é—´&#x27;, `creator_id` Nullable(String) COMMENT &#x27;åˆ›å»ºäººID&#x27;, `creator_name` Nullable(String) COMMENT &#x27;åˆ›å»ºäººåç§°&#x27;, `create_pos_id` Nullable(String) COMMENT &#x27;åˆ›å»ºæœºå°ID&#x27;, `create_pos_name` Nullable(String) COMMENT &#x27;åˆ›å»ºæœºå°åç§°&#x27;, `cashier_type` Nullable(Int8) DEFAULT NULL COMMENT &#x27;æ”¶é“¶å°ç±»å‹ï¼š0.æ”¶é“¶å°,1.å…‘å¥–å°,2.ä¸€ä½“æœº,3.å–å¸æœº,4.å­˜å¸æœº&#x27;, `machine_category_id` Nullable(String) COMMENT &#x27;æœºå°åˆ†ç±»ID&#x27;, `machine_category_name` Nullable(String) COMMENT &#x27;æœºå°åˆ†ç±»åç§°&#x27;, `machine_id` Nullable(String) COMMENT &#x27;æœºå°ç±»å‹ID&#x27;, `machine_name` Nullable(String) COMMENT &#x27;æœºå°ç±»å‹åç§°&#x27;, `machine_instance_id` Nullable(String) COMMENT &#x27;æœºå°å®ä¾‹ID&#x27;, `machine_instance_name` Nullable(String) COMMENT &#x27;æœºå°å®ä¾‹åç§°&#x27;, `machine_instance_slot_id` Nullable(String) COMMENT &#x27;æŠ•å¸å£ID&#x27;, `device_id` Nullable(String) COMMENT &#x27;åˆ·å¡å™¨ID&#x27;, `device_name` Nullable(String) COMMENT &#x27;åˆ·å¡å™¨åç§°&#x27;, `record_status` Nullable(Int8) DEFAULT NULL COMMENT &#x27;æµæ°´çŠ¶æ€ï¼š0:æ­£å¸¸,1:å¼‚å¸¸&#x27;, `record_seq` Nullable(Int8) DEFAULT NULL COMMENT &#x27;åŒä¸€æ“ä½œäº§ç”Ÿçš„å¤šæ¡æµæ°´çš„æµæ°´åºå·&#x27;, `remark` Nullable(String) COMMENT &#x27;å¤‡æ³¨&#x27;, `machine_instance_slot_no` Nullable(Int8) DEFAULT NULL COMMENT &#x27;æœºå°æŠ•å¸å£åºå·&#x27;, `source_type` Int8 DEFAULT 0 COMMENT &#x27;æ•°æ®æ¥æºï¼š0-saas,1-è¿ç§»&#x27;, `ref_asset_id` Nullable(String) COMMENT &#x27;å…³è”ID&#x27;, `ref_asset_type` Nullable(Int8) DEFAULT NULL COMMENT &#x27;å…³è”ç±»å‹ (1 SVIPèµ é€)&#x27;, `business_model` Nullable(String) COMMENT &#x27;æœºå°è¥ä¸šæ¨¡å¼&#x27;, `item_drop_type` Nullable(String) COMMENT &#x27;ç‰©å“æ‰è½ç±»å‹ none:æ—  coin:æ¸¸æˆå¸ lottery:é£è±† gift:ç¤¼å“&#x27;)ENGINE = MergeTreePARTITION BY toYYYYMM(create_time)ORDER BY create_timeSETTINGS index_granularity = 8192 1clickhouse-client --queries-file p_asset_record.sql 1clickhouse-client -d mysql_database_31 --query &quot;select id,member_id,card_no,order_code,shop_id,ref_member_id,create_time,flow_type,merchant_id,merchant_name,shop_code,shop_name,member_name,id_number,mobile_number,member_level,member_level_name,member_type,biz_code,amount,amount2,asset_id,asset_type,change_flag,param1,param2,param3,parent_asset_id,creator_id,creator_name,create_pos_id,create_pos_name,cashier_type,machine_id,machine_category_id,machine_category_name,machine_name,machine_instance_id,machine_instance_name,machine_instance_slot_id,device_id,device_name,record_status,record_seq,remark,machine_instance_slot_no,source_type,ref_asset_id,ref_asset_type,business_model,item_drop_type from asset_record where create_time &gt;= &#x27;2021-05-01&#x27; and create_time &lt; &#x27;2021-05-02&#x27;&quot; &gt; asset_record_2021-05-01.csv æ³¨æ„: åˆ†åŒºé”®ã€æ’åºé”®ä¸è¦è®¾ç½®ä¸ºNullable åˆ†åŒºçš„ä¸ªæ•°ä¸è¦è¶…è¿‡10000ä¸ªï¼Œé¿å…æŸ¥è¯¢æ—¶ï¼ŒclickhouseåŠ è½½è¿‡å¤šçš„æ–‡ä»¶ï¼Œå¯¼è‡´æ€§èƒ½é™ä½ å•ä¸ªinsert blockä¸­æ•°æ®åˆ†åŒºï¼Œä¸è¦è¶…è¿‡ä¸€ç™¾ä¸ªï¼Œå¦åˆ™ä¼šå‡ºç°é”™è¯¯ 1too many partitions for single insert block (more than 100). the limit is controlled by &#39;max_partitions_per_insert_block&#39; setting. å¯ä»¥å»/etc/clickhouse-server/user.xmlçš„profiles-&gt;defaultä¸­è®¾ç½®max_partitions_per_insert_blockçš„åˆé€‚çš„å€¼ï¼Œä¸ç”¨é‡å¯ï¼Œç«‹å³ç”Ÿæ•ˆ ä¹Ÿå¯ä»¥max_bytes_to_merge_at_min_space_in_poolæ¥æ§åˆ¶mergeçš„æ•°æ®é‡åŠè°ƒæ•´mergeçš„çº¿ç¨‹æ•° æµ‹è¯•æ•°æ®å‡†å¤‡ä»tidbçš„æ•°æ®åº“asset_recordè¡¨ä¸­å¯¼å‡ºæ•°æ® 1SELECT table AS `è¡¨å`,sum( rows ) AS `æ€»è¡Œæ•°`,formatReadableSize ( sum( data_uncompressed_bytes ) ) AS `åŸå§‹å¤§å°`,formatReadableSize ( sum( data_compressed_bytes ) ) AS `å‹ç¼©åå¤§å°`,round( ( sum( data_compressed_bytes ) / sum( data_uncompressed_bytes ) ) * 100, 2 ) AS `å‹ç¼©ç‡` FROM system.parts WHERE database = &#x27;default&#x27; GROUP BY table æ•°æ®å†™å…¥insert query ï¼ˆç”¨çš„åœºæ™¯å¾ˆå°‘ï¼‰åº“å†…æ‹·è´é€Ÿåº¦ insert query æ–¹å¼ï¼š 1INSERT INTO p_asset_record SELECT * FROM asset_record WHERE create_time &lt; &#x27;2020-09-01&#x27; Progress: 13.33 million rows, 10.37 GB (312.73 thousand rows/s., 243.37 MB/s. 141188865è¡Œæ•°æ®å†™å…¥è€—æ—¶ï¼Œ498.468 secï¼Œçº¦ç­‰äº283245.595è¡Œ/sï¼ˆä¸­é—´æœ‰mergeçš„ç­‰å¾…æ—¶é—´ï¼‰ FLinkçš„jdbc-connectoræ‰¹æ¬¡æ’å…¥ï¼š50000rows/1s 295923920/(2422944323/1000) é€šè¿‡è¡¨å¼•æ“å»æ‹‰å–æ•°æ® å†…å­˜ä¼šè¢«æ‰“æ»¡ æŸ¥è¯¢åœºæ™¯æµ‹è¯•å…³è”ä¸€ä¸ªç»´åº¦è¡¨ï¼š ç»´åº¦è¡¨ï¼šshop_infoï¼ˆ740ï¼‰ 1select shop_id,count(1) from asset_record a left join shop_info s on a.shop_id = s.shop_id group by shop_id; äº‹å®è¡¨ï¼šfull_asset_record ï¼ˆ737570824ï¼‰ æŸ¥è¯¢sql12## æŸ¥è¯¢åº—é“ºå½“å¤©çš„æµæ°´è®°å½•ï¼ˆåˆ†é¡µç¬¬ä¸€é¡µï¼Œsize:20ï¼‰select * from full_asset_record where create_time &gt;= &#x27;2021-02-06 00:00:00&#x27; and create_time &lt; &#x27;2021-02-07 00:00:00&#x27; and shop_id = $&#123;shop_id&#125; and merchant_id = &#x27;dwj&#x27; order by create_time desc limit 0,20; 100QPS 1ClickHouse exception, code: 241, host: 10.200.50.71, port: 8123; Code: 241, e.displayText() &#x3D; DB::Exception: Memory limit (total) exceeded: would use 13.28 GiB (attempt to allocate chunk of 4273219 bytes), maximum: 13.28 GiB: (while reading column biz_code): (while reading from part &#x2F;var&#x2F;lib&#x2F;clickhouse&#x2F;store&#x2F;307&#x2F;3075421c-dae3-4f15-bcea-63fde922ba82&#x2F;202102_3285_3446_3&#x2F; from mark 1172 with max_rows_to_read &#x3D; 8192): While executing MergeTreeReverse (version 21.4.6.55 (official build))","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"","slug":"æµ‹è¯•ä¾‹å­","date":"2021-05-12T03:15:45.519Z","updated":"2021-05-13T03:20:05.313Z","comments":true,"path":"2021/05/12/æµ‹è¯•ä¾‹å­/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/12/%E6%B5%8B%E8%AF%95%E4%BE%8B%E5%AD%90/","excerpt":"","text":"æµ‹è¯•ä¾‹å­ï¼š å­—æ®µåï¼ˆKafkaä¸­çš„ä¿¡æ¯ï¼‰ ç±»å‹ userId long ç”¨æˆ·id itemId long å•†å“id categoryId long ç±»åˆ«id behaviorType String pv å•†å“è¯¦æƒ…é¡µï¼Œpvç­‰ä»·äºç‚¹å‡»| buy å•†å“è´­ä¹° |cart å°†å•†å“åŠ å…¥è´­ç‰©è½¦| fav æ”¶è—å•†å“ timestamp long æ—¶é—´æˆ³ è½¬æ¢è¿‡æ»¤ï¼šæ’é™¤pvçš„ç”¨æˆ·è¡Œä¸º 1`behaviorType` != &#x27;pv&#x27; å°†behaviorTypeè½¬æ¢æˆï¼šbuy-&gt;å•†å“è´­ä¹° cart-&gt;å°†å•†å“åŠ å…¥è´­ç‰©è½¦ fav-&gt;æ”¶è—å•†å“ 1234567891011121314151617181920212223SELECT `userId` AS &#x27;user_id&#x27;, `itemId` AS &#x27;item_id&#x27;, `categoryId` AS &#x27;category_id&#x27;,CASE WHEN `behaviorType` == &#x27;buy&#x27; THEN &#x27;å•†å“è´­ä¹°&#x27;CASE WHEN `behaviorType` == &#x27;cart&#x27; THEN &#x27;å°†å•†å“åŠ å…¥è´­ç‰©è½¦&#x27;CASE WHEN `behaviorType` == &#x27;fav&#x27; THEN &#x27;æ”¶è—å•†å“&#x27; ELSE &#x27;æœªçŸ¥&#x27; END AS &#x27;behavior_type&#x27;, `timestamp` AS &#x27;timestamp&#x27;, 1 AS &#x27;times&#x27; FROM &#x27;record&#x27; FOR &#x27;dwd_user_behavior&#x27; -- äº‹å®åç§°ï¼ˆå¿…å¡«ï¼‰KEY BY `timestamp` as &#x27;timestamp&#x27;,`userId` as &#x27;user_id&#x27; --æ•°æ®åº“æ“ä½œæ¡ä»¶PARTITION `userId` --åˆ†åŒºå€¼UNIQUE BY `userId`,`itemId`,`categoryId`,`timestamp` --å»é‡å¹‚ç­‰èŒOPERATION &#x27;OPERATION_INSERT&#x27; -- æ“ä½œç±»å‹(0: æ–°å¢, 1: ä¿®æ”¹, 2: åˆ é™¤ 3:æ–°å¢ or ä¿®æ”¹)ï¼Œé»˜è®¤ä¸ºæ–°å¢ è½¬æ¢å®šä¹‰ï¼šDefRecordTransform 123456789101112&#123; &quot;defRecordTransformId&quot;: &quot;ada151ce-1113-430a-88eb-0f3880ad1a9f&quot;, &quot;defName&quot;: &quot;cwx-user-behavior&quot;, &quot;defDescription&quot;: &quot;cwx-user-behavior&quot;, &quot;topicName&quot;: &quot;user_behavior&quot;, &quot;recordFilter&quot;: &quot;`behaviorType` != &#x27;pv&#x27;&quot;, &quot;transformDef&quot;: &quot;SELECT\\n\\t`userId` AS &#x27;user_id&#x27;,\\n\\t`itemId` AS &#x27;item_id&#x27;,\\n\\t`categoryId` AS &#x27;category_id&#x27;,\\nCASE\\n\\tWHEN `behaviorType` == &#x27;buy&#x27; THEN\\n\\t&#x27;å•†å“è´­ä¹°&#x27;\\nCASE\\n\\tWHEN `behaviorType` == &#x27;cart&#x27; THEN\\n\\t&#x27;å°†å•†å“åŠ å…¥è´­ç‰©è½¦&#x27;\\nCASE\\n\\tWHEN `behaviorType` == &#x27;fav&#x27; THEN\\n\\t&#x27;æ”¶è—å•†å“&#x27; ELSE &#x27;æœªçŸ¥&#x27; \\n\\tEND AS &#x27;behavior_type&#x27;,\\n\\t`timestamp` AS &#x27;timestamp&#x27;,\\n\\t1 AS &#x27;times&#x27; \\nFROM\\n\\t&#x27;record&#x27; \\nFOR &#x27;dwd_user_behavior&#x27; \\nKEY BY `timestamp` as &#x27;timestamp&#x27;,`userId` as &#x27;user_id&#x27;\\nPARTITION `userId` \\nUNIQUE BY `userId`,`itemId`,`categoryId`,`timestamp`\\nOPERATION &#x27;OPERATION_INSERT&#x27;&quot;, &quot;sourceInfo&quot;: &quot;user_behavior&quot;, &quot;targetInfo&quot;: &quot;dwd_user_behavior&quot;, &quot;chainType&quot;: 0, &quot;transformType&quot;: 3&#125; OperateContext: 12345678910&#123; &quot;topic&quot;: &quot;user_behavior&quot;, &quot;record&quot;: &#123; &quot;userId&quot;: 179, &quot;itemId&quot;: 146, &quot;categoryId&quot;: 5, &quot;behaviorType&quot;: &quot;fav&quot;, &quot;timestamp&quot;: 1620715517527 &#125;&#125; OperateResult: 1234567891011121314151617181920[ &#123; &quot;times&quot;: 1, &quot;category_id&quot;: 5, &quot;user_id&quot;: 179, &quot;item_id&quot;: 146, &quot;behavior_type&quot;: &quot;æ”¶è—å•†å“&quot;, &quot;_key&quot;: &#123; &quot;user_id&quot;: 179, &quot;timestamp&quot;: 1620715517527 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;179&quot;, &quot;i&quot;: &quot;17914651620715517527&quot;, &quot;n&quot;: &quot;dwd_user_behavior&quot;, &quot;o&quot;: 0 &#125;, &quot;timestamp&quot;: 1620715517527 &#125;] è®¡ç®—ç®—å­å®šä¹‰è½¬æ¢å®šä¹‰ï¼š 123456789101112SELECT `user_id` AS &#x27;user_id&#x27;, `item_id` AS &#x27;item_id&#x27;, `category_id` AS &#x27;category_id&#x27;, `behavior_type` AS &#x27;behavior_type&#x27;, `sum` AS &#x27;user_behavior_num&#x27;, `timestamp` AS &#x27;timestamp&#x27; FROM &#x27;record&#x27; FOR &#x27;dws_user_behavior&#x27; KEY BY `user_id` AS &#x27;user_id&#x27;PARTITION `user_id`UNIQUE BY `user_id`,`item_id`,`category_id` ç»“æœï¼š OperateContext: 1234567891011121314151617181920&#123; &quot;record&quot;: &#123; &quot;times&quot;: 1, &quot;category_id&quot;: 96, &quot;user_id&quot;: 81, &quot;item_id&quot;: 19, &quot;behavior_type&quot;: &quot;å•†å“è´­ä¹°&quot;, &quot;_key&quot;: &#123; &quot;user_id&quot;: 81, &quot;timestamp&quot;: 1620715203646 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;81&quot;, &quot;i&quot;: &quot;8119961620715203646&quot;, &quot;n&quot;: &quot;dwd_user_behavior&quot;, &quot;o&quot;: 0 &#125;, &quot;timestamp&quot;: 1620715203646 &#125;&#125; Map: 12345678910111213141516171819202122232425262728&#123; &quot;record&quot;: &#123; &quot;times&quot;: 1, &quot;category_id&quot;: 96, &quot;user_id&quot;: 81, &quot;item_id&quot;: 19, &quot;behavior_type&quot;: &quot;å•†å“è´­ä¹°&quot;, &quot;_key&quot;: &#123; &quot;user_id&quot;: 81, &quot;timestamp&quot;: 1620715203646 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;81&quot;, &quot;i&quot;: &quot;8119961620715203646&quot;, &quot;n&quot;: &quot;dwd_user_behavior&quot;, &quot;o&quot;: 0 &#125;, &quot;timestamp&quot;: 1620715203646 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;s|dws_user_behavior|null&quot; &#125;, &quot;dws_user_behavior&quot;: &#123; &quot;sum&quot;: [ 1 ] &#125;&#125; OperateResult: 123456789101112131415161718[ &#123; &quot;category_id&quot;: 96, &quot;user_id&quot;: 81, &quot;item_id&quot;: 19, &quot;behavior_type&quot;: &quot;å•†å“è´­ä¹°&quot;, &quot;_key&quot;: &#123; &quot;user_id&quot;: 81 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;81&quot;, &quot;i&quot;: &quot;811996&quot;, &quot;n&quot;: &quot;dws_user_behavior&quot; &#125;, &quot;user_behavior_num&quot;: 1, &quot;timestamp&quot;: 1620715203646 &#125;] è®¡ç®—å®šä¹‰ï¼› 12345678SELECT `user_id` AS &#x27;user_id&#x27;, sum(`times`) AS &#x27;sum&#x27; --æ±‡æ€»å­—æ®µFROM &#x27;record&#x27; GROUP BY `userId` --åˆ†ç»„æ¡ä»¶FOR &#x27;dws_user_behavior&#x27; -- dwsåç§° OperateContext: 1234567891011121314151617181920&#123; &quot;record&quot;: &#123; &quot;times&quot;: 1, &quot;category_id&quot;: 96, &quot;user_id&quot;: 81, &quot;item_id&quot;: 19, &quot;behavior_type&quot;: &quot;å•†å“è´­ä¹°&quot;, &quot;_key&quot;: &#123; &quot;user_id&quot;: 81, &quot;timestamp&quot;: 1620715203646 &#125;, &quot;_m&quot;: &#123; &quot;p&quot;: &quot;81&quot;, &quot;i&quot;: &quot;8119961620715203646&quot;, &quot;n&quot;: &quot;dwd_user_behavior&quot;, &quot;o&quot;: 0 &#125;, &quot;timestamp&quot;: 1620715203646 &#125;&#125; OperateResult: 1234567891011121314[ &#123; &quot;code&quot;: &quot;dws_user_behavior&quot;, &quot;user_id&quot;: 81, &quot;sum&quot;: [ 1 ], &quot;groupBy&quot;: [ null ], &quot;_key&quot;: &#123;&#125;, &quot;_m&quot;: &#123;&#125; &#125;] è¿‡æ»¤ï¼š 1`user_id` is not null","categories":[],"tags":[]},{"title":"ClickHouseå®‰è£…","slug":"Clickhouseå®‰è£…","date":"2021-05-11T04:42:17.209Z","updated":"2021-06-05T14:56:50.398Z","comments":true,"path":"2021/05/11/Clickhouseå®‰è£…/","link":"","permalink":"https://cha1yi.github.io/dist/2021/05/11/Clickhouse%E5%AE%89%E8%A3%85/","excerpt":"","text":"Dockerå®‰è£…ä¸‹è½½clickhouseé•œåƒï¼š 1$ docker pull yandex/clickhouse-server è¿è¡Œdockeré•œåƒï¼š 123$ mkdir /Users/wuxuan.chai/Documents/application/ck-home$ docker run -d --name clickhouse-server --ulimit nofile=262144:262144 -p 8123:8123 -p 9009:9009 -p 9090:9000 --volume=/Users/wuxuan.chai/Documents/application/ck-home:/var/lib/clickhouse yandex/clickhouse-server è‡³æ­¤dockerå•æœºéƒ¨ç½²å®Œæˆ å®˜æ–¹æµ‹è¯•ç”¨ä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122CREATE TABLE customer( C_CUSTKEY UInt32, C_NAME String, C_ADDRESS String, C_CITY LowCardinality(String), C_NATION LowCardinality(String), C_REGION LowCardinality(String), C_PHONE String, C_MKTSEGMENT LowCardinality(String))ENGINE = MergeTree ORDER BY (C_CUSTKEY);CREATE TABLE lineorder( LO_ORDERKEY UInt32, LO_LINENUMBER UInt8, LO_CUSTKEY UInt32, LO_PARTKEY UInt32, LO_SUPPKEY UInt32, LO_ORDERDATE Date, LO_ORDERPRIORITY LowCardinality(String), LO_SHIPPRIORITY UInt8, LO_QUANTITY UInt8, LO_EXTENDEDPRICE UInt32, LO_ORDTOTALPRICE UInt32, LO_DISCOUNT UInt8, LO_REVENUE UInt32, LO_SUPPLYCOST UInt32, LO_TAX UInt8, LO_COMMITDATE Date, LO_SHIPMODE LowCardinality(String))ENGINE = MergeTree PARTITION BY toYear(LO_ORDERDATE) ORDER BY (LO_ORDERDATE, LO_ORDERKEY);CREATE TABLE part( P_PARTKEY UInt32, P_NAME String, P_MFGR LowCardinality(String), P_CATEGORY LowCardinality(String), P_BRAND LowCardinality(String), P_COLOR LowCardinality(String), P_TYPE LowCardinality(String), P_SIZE UInt8, P_CONTAINER LowCardinality(String))ENGINE = MergeTree ORDER BY P_PARTKEY;CREATE TABLE supplier( S_SUPPKEY UInt32, S_NAME String, S_ADDRESS String, S_CITY LowCardinality(String), S_NATION LowCardinality(String), S_REGION LowCardinality(String), S_PHONE String)ENGINE = MergeTree ORDER BY S_SUPPKEY;$ clickhouse-client --password=default --query &quot;INSERT INTO customer FORMAT CSV&quot; &lt; customer.tbl$ clickhouse-client --password=default --query &quot;INSERT INTO part FORMAT CSV&quot; &lt; part.tbl$ clickhouse-client --password=default --query &quot;INSERT INTO supplier FORMAT CSV&quot; &lt; supplier.tbl$ clickhouse-client --password=default --query &quot;INSERT INTO lineorder FORMAT CSV&quot; &lt; lineorder.tbl-- å¯¼å…¥json clickhouse-client --query &quot;INSERT INTO doris_write_record_new FORMAT JSONEachRow&quot; &lt; write-speed.json--å°†star schemaè½¬æ¢ä¸ºflat schemaï¼šSET max_memory_usage = 20000000000;CREATE TABLE lineorder_flatENGINE = MergeTreePARTITION BY toYear(LO_ORDERDATE)ORDER BY (LO_ORDERDATE, LO_ORDERKEY) ASSELECT l.LO_ORDERKEY AS LO_ORDERKEY, l.LO_LINENUMBER AS LO_LINENUMBER, l.LO_CUSTKEY AS LO_CUSTKEY, l.LO_PARTKEY AS LO_PARTKEY, l.LO_SUPPKEY AS LO_SUPPKEY, l.LO_ORDERDATE AS LO_ORDERDATE, l.LO_ORDERPRIORITY AS LO_ORDERPRIORITY, l.LO_SHIPPRIORITY AS LO_SHIPPRIORITY, l.LO_QUANTITY AS LO_QUANTITY, l.LO_EXTENDEDPRICE AS LO_EXTENDEDPRICE, l.LO_ORDTOTALPRICE AS LO_ORDTOTALPRICE, l.LO_DISCOUNT AS LO_DISCOUNT, l.LO_REVENUE AS LO_REVENUE, l.LO_SUPPLYCOST AS LO_SUPPLYCOST, l.LO_TAX AS LO_TAX, l.LO_COMMITDATE AS LO_COMMITDATE, l.LO_SHIPMODE AS LO_SHIPMODE, c.C_NAME AS C_NAME, c.C_ADDRESS AS C_ADDRESS, c.C_CITY AS C_CITY, c.C_NATION AS C_NATION, c.C_REGION AS C_REGION, c.C_PHONE AS C_PHONE, c.C_MKTSEGMENT AS C_MKTSEGMENT, s.S_NAME AS S_NAME, s.S_ADDRESS AS S_ADDRESS, s.S_CITY AS S_CITY, s.S_NATION AS S_NATION, s.S_REGION AS S_REGION, s.S_PHONE AS S_PHONE, p.P_NAME AS P_NAME, p.P_MFGR AS P_MFGR, p.P_CATEGORY AS P_CATEGORY, p.P_BRAND AS P_BRAND, p.P_COLOR AS P_COLOR, p.P_TYPE AS P_TYPE, p.P_SIZE AS P_SIZE, p.P_CONTAINER AS P_CONTAINERFROM lineorder AS lINNER JOIN customer AS c ON c.C_CUSTKEY = l.LO_CUSTKEYINNER JOIN supplier AS s ON s.S_SUPPKEY = l.LO_SUPPKEYINNER JOIN part AS p ON p.P_PARTKEY = l.LO_PARTKEY æ•°æ®è¡¨ æ•°é‡(è¡Œ) customer 30000 lineorder 6001215 part 200000 supplier 2000 æŸ¥çœ‹æ•°æ®è¡¨çš„å†…å­˜å ç”¨12345678910SELECT table AS `è¡¨å`, sum(rows) AS `æ€»è¡Œæ•°`, formatReadableSize(sum(data_uncompressed_bytes)) AS `åŸå§‹å¤§å°`, formatReadableSize(sum(data_compressed_bytes)) AS `å‹ç¼©å¤§å°`, round((sum(data_compressed_bytes) / sum(data_uncompressed_bytes)) * 100, 2) AS `å‹ç¼©ç‡`FROM system.partswhere database = &#x27;default&#x27;GROUP BY table æŸ¥çœ‹mutationé˜Ÿåˆ—(update/delete)123456789SELECT database, table, command, create_time, is_doneFROM system.mutations æŸ¥çœ‹clickhouseæ­£åœ¨æ‰§è¡Œçš„æ¦‚è¦ä¿¡æ¯1SELECT * FROM system.metrics LIMIT 5 æŸ¥çœ‹Clickhouseåœ¨æ•´ä¸ªæœŸé—´ç´¯è®¡çš„æ¦‚è¦ä¿¡æ¯1SELECT event,value FROM system.events LIMIT 5 å®˜æ–¹æµ‹è¯•ç”¨ä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253Q1.1SELECT sum(LO_EXTENDEDPRICE * LO_DISCOUNT) AS revenue FROM lineorder_flat WHERE toYear(LO_ORDERDATE) = 1993 AND LO_DISCOUNT BETWEEN 1 AND 3 AND LO_QUANTITY &lt; 25;--ç»“æœï¼š1 rows in set. Elapsed: 0.303 sec. Processed 908.24 thousand rows, 7.27 MB (3.00 million rows/s., 24.01 MB/s.) Q1.2SELECT sum(LO_EXTENDEDPRICE * LO_DISCOUNT) AS revenue FROM lineorder_flat WHERE toYYYYMM(LO_ORDERDATE) = 199401 AND LO_DISCOUNT BETWEEN 4 AND 6 AND LO_QUANTITY BETWEEN 26 AND 35;--ç»“æœï¼š1 rows in set. Elapsed: 0.041 sec. Processed 81.92 thousand rows, 655.36 KB (1.98 million rows/s., 15.85 MB/s.) Q1.3SELECT sum(LO_EXTENDEDPRICE * LO_DISCOUNT) AS revenue FROM lineorder_flat WHERE toISOWeek(LO_ORDERDATE) = 6 AND toYear(LO_ORDERDATE) = 1994 AND LO_DISCOUNT BETWEEN 5 AND 7 AND LO_QUANTITY BETWEEN 26 AND 35;--ç»“æœï¼š1 rows in set. Elapsed: 0.020 sec. Processed 32.77 thousand rows, 262.14 KB (1.63 million rows/s., 13.06 MB/s.) Q2.1SELECT sum(LO_REVENUE), toYear(LO_ORDERDATE) AS year, P_BRAND FROM lineorder_flat WHERE P_CATEGORY = &#x27;MFGR#12&#x27; AND S_REGION = &#x27;AMERICA&#x27; GROUP BY year, P_BRAND ORDER BY year, P_BRAND;--ç»“æœï¼š280 rows in set. Elapsed: 1.432 sec. Processed 6.00 million rows, 61.97 MB (4.19 million rows/s., 43.27 MB/s.) Q2.2SELECT sum(LO_REVENUE), toYear(LO_ORDERDATE) AS year, P_BRAND FROM lineorder_flat WHERE P_BRAND BETWEEN &#x27;MFGR#2221&#x27; AND &#x27;MFGR#2228&#x27; AND S_REGION = &#x27;ASIA&#x27; GROUP BY year, P_BRAND ORDER BY year, P_BRAND;--ç»“æœï¼š56 rows in set. Elapsed: 0.180 sec. Processed 6.00 million rows, 55.96 MB (33.25 million rows/s., 310.06 MB/s.) Q2.3SELECT sum(LO_REVENUE), toYear(LO_ORDERDATE) AS year, P_BRAND FROM lineorder_flat WHERE P_BRAND = &#x27;MFGR#2239&#x27; AND S_REGION = &#x27;EUROPE&#x27; GROUP BY year, P_BRAND ORDER BY year, P_BRAND;--ç»“æœï¼š7 rows in set. Elapsed: 0.201 sec. Processed 6.00 million rows, 47.93 MB (29.80 million rows/s., 237.98 MB/s.) Q3.1SELECT C_NATION, S_NATION, toYear(LO_ORDERDATE) AS year, sum(LO_REVENUE) AS revenue FROM lineorder_flat WHERE C_REGION = &#x27;ASIA&#x27; AND S_REGION = &#x27;ASIA&#x27; AND year &gt;= 1992 AND year &lt;= 1997 GROUP BY C_NATION, S_NATION, year ORDER BY year asc, revenue desc;--ç»“æœï¼š150 rows in set. Elapsed: 0.881 sec. Processed 5.47 million rows, 54.76 MB (6.21 million rows/s., 62.18 MB/s.) Q3.2SELECT C_CITY, S_CITY, toYear(LO_ORDERDATE) AS year, sum(LO_REVENUE) AS revenue FROM lineorder_flat WHERE C_NATION = &#x27;UNITED STATES&#x27; AND S_NATION = &#x27;UNITED STATES&#x27; AND year &gt;= 1992 AND year &lt;= 1997 GROUP BY C_CITY, S_CITY, year ORDER BY year asc, revenue desc;--ç»“æœï¼š599 rows in set. Elapsed: 0.613 sec. Processed 5.47 million rows, 55.65 MB (8.92 million rows/s., 90.83 MB/s.) Q3.3SELECT C_CITY, S_CITY, toYear(LO_ORDERDATE) AS year, sum(LO_REVENUE) AS revenue FROM lineorder_flat WHERE (C_CITY = &#x27;UNITED KI1&#x27; OR C_CITY = &#x27;UNITED KI5&#x27;) AND (S_CITY = &#x27;UNITED KI1&#x27; OR S_CITY = &#x27;UNITED KI5&#x27;) AND year &gt;= 1992 AND year &lt;= 1997 GROUP BY C_CITY, S_CITY, year ORDER BY year asc, revenue desc;--ç»“æœï¼š24 rows in set. Elapsed: 0.182 sec. Processed 5.47 million rows, 26.90 MB (30.02 million rows/s., 147.71 MB/s.) Q3.4SELECT C_CITY, S_CITY, toYear(LO_ORDERDATE) AS year, sum(LO_REVENUE) AS revenue FROM lineorder_flat WHERE (C_CITY = &#x27;UNITED KI1&#x27; OR C_CITY = &#x27;UNITED KI5&#x27;) AND (S_CITY = &#x27;UNITED KI1&#x27; OR S_CITY = &#x27;UNITED KI5&#x27;) AND toYYYYMM(LO_ORDERDATE) = &#x27;199712&#x27; GROUP BY C_CITY, S_CITY, year ORDER BY year asc, revenue desc;--ç»“æœï¼š3 rows in set. Elapsed: 0.021 sec. Processed 82.63 thousand rows, 415.40 KB (3.98 million rows/s., 19.99 MB/s.) Q4.1SELECT toYear(LO_ORDERDATE) AS year, C_NATION, sum(LO_REVENUE - LO_SUPPLYCOST) AS profit FROM lineorder_flat WHERE C_REGION = &#x27;AMERICA&#x27; AND S_REGION = &#x27;AMERICA&#x27; AND (P_MFGR = &#x27;MFGR#1&#x27; OR P_MFGR = &#x27;MFGR#2&#x27;) GROUP BY year, C_NATION ORDER BY year, C_NATION;--ç»“æœï¼š35 rows in set. Elapsed: 0.773 sec. Processed 6.00 million rows, 84.09 MB (7.77 million rows/s., 108.80 MB/s.) Q4.2SELECT toYear(LO_ORDERDATE) AS year, S_NATION, P_CATEGORY, sum(LO_REVENUE - LO_SUPPLYCOST) AS profit FROM lineorder_flat WHERE C_REGION = &#x27;AMERICA&#x27; AND S_REGION = &#x27;AMERICA&#x27; AND (year = 1997 OR year = 1998) AND (P_MFGR = &#x27;MFGR#1&#x27; OR P_MFGR = &#x27;MFGR#2&#x27;) GROUP BY year, S_NATION, P_CATEGORY ORDER BY year, S_NATION, P_CATEGORY;--ç»“æœï¼š100 rows in set. Elapsed: 0.105 sec. Processed 1.45 million rows, 21.70 MB (13.80 million rows/s., 207.21 MB/s.) Q4.3SELECT toYear(LO_ORDERDATE) AS year, S_CITY, P_BRAND, sum(LO_REVENUE - LO_SUPPLYCOST) AS profit FROM lineorder_flat WHERE S_NATION = &#x27;UNITED STATES&#x27; AND (year = 1997 OR year = 1998) AND P_CATEGORY = &#x27;MFGR#14&#x27; GROUP BY year, S_CITY, P_BRAND ORDER BY year, S_CITY, P_BRAND;--ç»“æœï¼š694 rows in set. Elapsed: 0.101 sec. Processed 1.45 million rows, 22.33 MB (14.28 million rows/s., 220.66 MB/s.)","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"Canalç›¸å…³ç‚¹æ•´ç†","slug":"Canalç›¸å…³ç‚¹æ•´ç†","date":"2021-04-29T08:39:57.598Z","updated":"2021-05-06T03:17:04.586Z","comments":true,"path":"2021/04/29/Canalç›¸å…³ç‚¹æ•´ç†/","link":"","permalink":"https://cha1yi.github.io/dist/2021/04/29/Canal%E7%9B%B8%E5%85%B3%E7%82%B9%E6%95%B4%E7%90%86/","excerpt":"","text":"åŒæ­¥å®ä¾‹é…ç½®è¯¦æƒ…1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859################################################### mysql serverId , v1.0.26+ will autoGen# canal.instance.mysql.slaveId=0# enable gtid use true/falsecanal.instance.gtidon=false# position infocanal.instance.master.address=127.0.0.1:3306canal.instance.master.journal.name=canal.instance.master.position=canal.instance.master.timestamp=canal.instance.master.gtid=# rds oss binlogcanal.instance.rds.accesskey=canal.instance.rds.secretkey=canal.instance.rds.instanceId=# table meta tsdb infocanal.instance.tsdb.enable=true#canal.instance.tsdb.url=jdbc:mysql://127.0.0.1:3306/canal_tsdb#canal.instance.tsdb.dbUsername=canal#canal.instance.tsdb.dbPassword=canal#canal.instance.standby.address =#canal.instance.standby.journal.name =#canal.instance.standby.position =#canal.instance.standby.timestamp =#canal.instance.standby.gtid=# username/passwordcanal.instance.dbUsername=canalcanal.instance.dbPassword=canalcanal.instance.connectionCharset = UTF-8# enable druid Decrypt database passwordcanal.instance.enableDruid=false#canal.instance.pwdPublicKey=MFwwDQYJKoZIhvcNAQEBBQADSwAwSAJBALK4BUxdDltRRE5/zXpVEVPUgunvscYFtEip3pmLlhrWpacX7y7GCMo2/JM6LeHmiiNdH1FWgGCpUfircSwlWKUCAwEAAQ==# table regexcanal.instance.filter.regex=.*\\\\..*# table black regexcanal.instance.filter.black.regex=# table field filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)#canal.instance.filter.field=test1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch# table field black filter(format: schema1.tableName1:field1/field2,schema2.tableName2:field1/field2)#canal.instance.filter.black.field=test1.t_product:subject/product_image,test2.t_company:id/name/contact/ch# mq configcanal.mq.topic=example# dynamic topic route by schema or table regex#canal.mq.dynamicTopic=mytest1.user,mytest2\\\\..*,.*\\\\..*canal.mq.partition=0# hash partition config#canal.mq.partitionsNum=3#canal.mq.partitionHash=test.table:id^name,.*\\\\..*################################################# instance.propertiesä»‹ç»ï¼š instance.propertieså‚æ•°åˆ—è¡¨ï¼š å‚æ•°åå­— å‚æ•°è¯´æ˜ é»˜è®¤å€¼ canal.instance.mysql.slaveId mysqlé›†ç¾¤é…ç½®ä¸­çš„serverIdæ¦‚å¿µï¼Œéœ€è¦ä¿è¯å’Œå½“å‰mysqlé›†ç¾¤ä¸­idå”¯ä¸€ (v1.1.xç‰ˆæœ¬ä¹‹åcanalä¼šè‡ªåŠ¨ç”Ÿæˆï¼Œä¸éœ€è¦æ‰‹å·¥æŒ‡å®š) æ—  canal.instance.master.address mysqlä¸»åº“é“¾æ¥åœ°å€ 127.0.0.1:3306 canal.instance.master.journal.name mysqlä¸»åº“é“¾æ¥æ—¶èµ·å§‹çš„binlogæ–‡ä»¶ æ—  canal.instance.master.position mysqlä¸»åº“é“¾æ¥æ—¶èµ·å§‹çš„binlogåç§»é‡ æ—  canal.instance.master.timestamp mysqlä¸»åº“é“¾æ¥æ—¶èµ·å§‹çš„binlogçš„æ—¶é—´æˆ³ æ—  canal.instance.gtidon æ˜¯å¦å¯ç”¨mysql gtidçš„è®¢é˜…æ¨¡å¼ï¼Œè¯¦ç»†è§ï¼šã€æºç åˆ†æã€‘Canalä¹‹Binlogçš„å¯»æ‰¾è¿‡ç¨‹ false canal.instance.standby.gtid mysqlå¤‡åº“é“¾æ¥æ—¶å¯¹åº”çš„gtidä½ç‚¹ æ—  canal.instance.dbUsername mysqlæ•°æ®åº“è´¦æˆ· canal canal.instance.dbPassword mysqlæ•°æ®åº“å¯†ç  canal canal.instance.defaultDatabaseName mysqlé“¾æ¥æ—¶é»˜è®¤schema canal.instance.connectionCharset mysqlæ•°æ®è§£æç¼–ç  UTF-8 canal.instance.enableDruid å¢åŠ  ç›®æ ‡æ•°æ®åº“å¯†ç åŠ å¯†è§£å¯†ï¼Œé‡‡ç”¨druidæ–¹å¼è¿›è¡ŒåŠ å¯†è§£å¯† false canal.instance.pwdPublicKey åŠ å¯†çš„å…¬é’¥ æ—  canal.instance.tsdb.enable æ˜¯å¦å¼€å¯tablemetaçš„tsdbèƒ½åŠ› true canal.instance.tsdb.url jdbc urlçš„é…ç½® jdbc:mysql://127.0.0.1:3306/canal_tsdb canal.instance.tsdb.dbUsername tsdbç”¨æˆ·å canal canal.instance.tsdb.dbPassword tsdbå¯†ç  canal canal.instance.filter.regex mysql æ•°æ®è§£æç™½åå•ï¼ŒPerlæ­£åˆ™è¡¨è¾¾å¼.å¤šä¸ªæ­£åˆ™ä¹‹é—´ä»¥é€—å·(,)åˆ†éš”ï¼Œè½¬ä¹‰ç¬¦éœ€è¦åŒæ–œæ (\\)å¸¸è§ä¾‹å­ï¼š1. æ‰€æœ‰è¡¨ï¼š.* or .*\\\\..*2. canal schemaä¸‹æ‰€æœ‰è¡¨ï¼š canal\\\\..*3. canalä¸‹çš„ä»¥canalæ‰“å¤´çš„è¡¨ï¼šcanal\\\\.canal.*4. canal schemaä¸‹çš„ä¸€å¼ è¡¨ï¼šcanal\\\\.test15. å¤šä¸ªè§„åˆ™ç»„åˆä½¿ç”¨ï¼šcanal\\\\..*,mysql.test1,mysql.test2 (é€—å·åˆ†éš”) æ—  canal.instance.filter.black.regex Mysql æ•°æ®è§£æè¡¨çš„é»‘åå•ï¼Œè¡¨è¾¾å¼è§„åˆ™è§ç™½åå•è§„åˆ™ æ—  canal.instance.filter.field å­—æ®µç™½åå• exï¼štest1.t_product:id/subject/keywords,test2.t_company:id/name/contact/ch canal.instance.filter.black.field å­—æ®µé»‘åå• exï¼štest1.t_product:subject/product_image,test2.t_company:id/name/contact/ch canal.instance.rds.instanceId aliyun rdså¯¹åº”çš„å®ä¾‹idä¿¡æ¯(å¦‚æœä¸éœ€è¦åœ¨æœ¬åœ°binlogè¶…è¿‡18å°æ—¶è¢«æ¸…ç†åè‡ªåŠ¨ä¸‹è½½ossä¸Šçš„binlogï¼Œå¯ä»¥å¿½ç•¥è¯¥å€¼) æ—  canal.instance.rds.accesskey aliyun rdså¯¹åº”çš„å®ä¾‹ accessKey æ—  canal.instance.rds.secretkey aliyun rdså¯¹åº”çš„å®ä¾‹ secretKey æ—  canal.mq.topic æ¶ˆæ¯é˜Ÿåˆ—æ‰€å¯¹åº”çš„topicåç§°ï¼ˆå•topicæ—¶ä½¿ç”¨ï¼‰ Example canal.mq.partitionHash æ•£åˆ—è§„åˆ™å®šä¹‰ï¼Œåº“å.è¡¨åï¼šå”¯ä¸€ä¸»é”®ï¼Œæ¯”å¦‚schema.table.idã€‚å¤šä¸ªè¡¨ä¹‹é—´éœ€è¦ç”¨,éš”å¼€ test.table:id^name,.*\\\\..* canal.mq.partitionsNum æ•£åˆ—æ¨¡å¼ä¸‹çš„åˆ†åŒºæ•° 3 canal.mq.partition å•é˜Ÿåˆ—æ¨¡å¼çš„åˆ†åŒºä¸‹æ ‡ 0 canal.mq.dynamicTopic é’ˆå¯¹åº“åæˆ–è€…è¡¨æ˜å‘é€åŠ¨æ€çš„topicï¼Œéœ€è¦kafkaè®¾ç½®è‡ªåŠ¨åˆ›å»ºtopicï¼ˆå¤štopicæ—¶ä½¿ç”¨ï¼‰ mytest1.user,mytest2\\\\..*,.*\\\\..* æ³¨æ„ç‚¹ï¼š mysqlé“¾æ¥æ—¶çš„èµ·å§‹ä½ç½® canal.instance.master.journal.name + canal.instance.master.position : ç²¾ç¡®æŒ‡å®šä¸€ä¸ªbinlogä½ç‚¹ï¼Œè¿›è¡Œå¯åŠ¨ canal.instance.master.timestamp : æŒ‡å®šä¸€ä¸ªæ—¶é—´æˆ³ï¼Œcanalä¼šè‡ªåŠ¨éå†mysql binlogï¼Œæ‰¾åˆ°å¯¹åº”æ—¶é—´æˆ³çš„binlogä½ç‚¹åï¼Œè¿›è¡Œå¯åŠ¨ ä¸æŒ‡å®šä»»ä½•ä¿¡æ¯ï¼šé»˜è®¤ä»å½“å‰æ•°æ®åº“çš„ä½ç‚¹ï¼Œè¿›è¡Œå¯åŠ¨ã€‚(show master status) mysqlè§£æå…³æ³¨è¡¨å®šä¹‰ æ ‡å‡†çš„Perlæ­£åˆ™ï¼Œæ³¨æ„è½¬ä¹‰æ—¶éœ€è¦åŒæ–œæ ï¼š\\ mysqlé“¾æ¥çš„ç¼–ç  ç›®å‰canalç‰ˆæœ¬ä»…æ”¯æŒä¸€ä¸ªæ•°æ®åº“åªæœ‰ä¸€ç§ç¼–ç ï¼Œå¦‚æœä¸€ä¸ªåº“å­˜åœ¨å¤šä¸ªç¼–ç ï¼Œéœ€è¦é€šè¿‡filter.regexé…ç½®ï¼Œå°†å…¶æ‹†åˆ†ä¸ºå¤šä¸ªcanal instanceï¼Œä¸ºæ¯ä¸ªinstanceæŒ‡å®šä¸åŒçš„ç¼–ç ","categories":[{"name":"æ•°æ®å¤„ç†ç»„ä»¶","slug":"æ•°æ®å¤„ç†ç»„ä»¶","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"}],"tags":[{"name":"æ•°æ®å¤„ç†ç»„ä»¶","slug":"æ•°æ®å¤„ç†ç»„ä»¶","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"}],"author":"wuxuan.chai"},{"title":"CompletableFutureåº•å±‚å®ç°åŠåŠŸèƒ½ä»‹ç»","slug":"CompletableFutureåº•å±‚å®ç°åŠåŠŸèƒ½ä»‹ç»","date":"2021-04-28T06:15:14.386Z","updated":"2021-06-05T14:43:34.560Z","comments":true,"path":"2021/04/28/CompletableFutureåº•å±‚å®ç°åŠåŠŸèƒ½ä»‹ç»/","link":"","permalink":"https://cha1yi.github.io/dist/2021/04/28/CompletableFuture%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E5%8F%8A%E5%8A%9F%E8%83%BD%E4%BB%8B%E7%BB%8D/","excerpt":"","text":"CompletableFutureçš„ç»§æ‰¿å…³ç³» ä»ç»§æ‰¿å…³ç³»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼ŒCompletableFutureå®ç°äº†ä¸¤ä¸ªæ¥å£ï¼šCompetionStageå’ŒFutureã€‚ Futureæ¥å£æºç åŠæ³¨é‡Š12345678910111213141516package java.util.concurrent;public interface Future&lt;V&gt;&#123; boolean cancel(boolean mayInterrupIfRunning); boolean isCancelled(); boolean isDone(); V get() throws InterruptedException,ExecutionException; V get(long timeout,@NotNull TimeUnit unit) throws InterruptedException,ExecutionException;&#125; Futureç±»çš„ä½œç”¨ï¼ˆç¿»è¯‘è‡ªä»£ç æ³¨é‡Šï¼‰ï¼š Futureè¡¨ç¤ºå¼‚æ­¥è®¡ç®—çš„ç»“æœã€‚æä¾›çš„æ–¹æ³•ç”¨äºæ£€æŸ¥è®¡ç®—æ˜¯å¦å®Œæˆã€ç­‰å¾…å…¶å®Œæˆä»¥åŠæ£€ç´¢è®¡ç®—çš„ç»“æœã€‚ç»“æœåªèƒ½åœ¨è®¡ç®—å®Œæˆæ—¶ä½¿ç”¨æ–¹æ³•getè¿›è¡Œæ£€ç´¢ï¼Œå¿…è¦æ—¶é˜»å¡ï¼Œç›´åˆ°å®ƒå‡†å¤‡å¥½ã€‚cancelæ–¹æ³•æ‰§è¡Œå–æ¶ˆæ“ä½œã€‚æä¾›äº†å…¶ä»–æ–¹æ³•æ¥ç¡®å®šä»»åŠ¡æ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯è¢«å–æ¶ˆã€‚ä¸€æ—¦è®¡ç®—å®Œæˆï¼Œå°±ä¸èƒ½å–æ¶ˆè®¡ç®—ã€‚å¦‚æœä¸ºäº†å¯å–æ¶ˆè€Œä½¿ç”¨Futureï¼Œä½†ä¸æä¾›å¯ç”¨çš„ç»“æœï¼Œå¯ä»¥å£°æ˜Future&lt;?&gt;ï¼Œå¹¶è¿”å›nullä½œä¸ºåº•å±‚ä»»åŠ¡çš„ç»“æœã€‚ Futureä¸­çš„æºç å°±æä¾›äº†äº”ä¸ªæ–¹æ³•ï¼Œè¿™äº”ä¸ªæ–¹æ³•çš„åŠŸèƒ½æè¿°ï¼š cancel:å°è¯•å–æ¶ˆæ­¤ä»»åŠ¡çš„æ‰§è¡Œã€‚å¦‚æœä»»åŠ¡å·²ç»å®Œæˆã€å·²ç»è¢«å–æ¶ˆæˆ–ç”±äºå…¶ä»–åŸå› æ— æ³•å–æ¶ˆï¼Œåˆ™æ­¤å°è¯•å°†å¤±è´¥ã€‚å¦‚æœæˆåŠŸï¼Œå¹¶ä¸”åœ¨è°ƒç”¨cancelæ—¶è¯¥ä»»åŠ¡æ²¡æœ‰å¯åŠ¨ï¼Œåˆ™è¯¥ä»»åŠ¡æ°¸è¿œä¸åº”è¯¥è¿è¡Œã€‚å¦‚æœè¯¥ä»»åŠ¡å·²ç»å¯åŠ¨ï¼Œåˆ™mayInterruptIfRunningå‚æ•°ç¡®å®šæ‰§è¡Œè¯¥ä»»åŠ¡çš„çº¿ç¨‹æ˜¯å¦åº”è¯¥ä¸­æ–­ä»¥è¯•å›¾åœæ­¢è¯¥ä»»åŠ¡ã€‚è¯¥æ–¹æ³•è¿”å›åï¼Œåç»­å¯¹isDoneçš„è°ƒç”¨å°†å§‹ç»ˆè¿”å›trueã€‚å¦‚æœè¯¥æ–¹æ³•è¿”å›trueï¼Œåˆ™åç»­å¯¹isCancelledçš„è°ƒç”¨å°†å§‹ç»ˆè¿”å›trueã€‚ isCancelled:å¦‚æœæ­¤ä»»åŠ¡åœ¨æ­£å¸¸å®Œæˆä¹‹å‰è¢«å–æ¶ˆï¼Œåˆ™è¿”å›trueã€‚ isDone:å¦‚æœæ­¤ä»»åŠ¡å®Œæˆåˆ™è¿”å›trueã€‚å®Œæˆå¯èƒ½æ˜¯ç”±äºæ­£å¸¸ç»ˆæ­¢ã€å¼‚å¸¸æˆ–å–æ¶ˆâ€”â€”åœ¨æ‰€æœ‰è¿™äº›æƒ…å†µä¸‹ï¼Œæ­¤æ–¹æ³•å°†è¿”å›trueã€‚ get:é˜»å¡ç­‰å¾…æ–¹æ³•æ‰§è¡Œå®Œæˆè¿”å›ç»“æœ å¦‚æœéœ€è¦ç­‰å¾…è®¡ç®—å®Œæˆï¼Œç„¶åæ£€ç´¢å…¶ç»“æœã€‚ å¦‚æœéœ€è¦ï¼Œæœ€å¤šç­‰å¾…ç»™å®šçš„æ—¶é—´ï¼Œä»¥å®Œæˆè®¡ç®—ï¼Œç„¶åæ£€ç´¢å…¶ç»“æœ(å¦‚æœå¯ç”¨)ã€‚ CompletionStageæ¥å£æºç åŠæ³¨é‡Š12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879package java.util.concurrent;import java.util.function.Supplier;import java.util.function.Consumer;import java.util.function.BiConsumer;import java.util.function.Function;import java.util.function.BiFunction;import java.util.concurrent.Executor;public interface CompletionStage&lt;T&gt;&#123; public &lt;U&gt; CompletionStage&lt;U&gt; thenApply(Function&lt;? super T,? extends U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; thenApplyAsync(Function&lt;? super T,? extends U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; thenApplyAsync(Function&lt;? super T,? extends U&gt; fn,Executor executor); public CompletionStage&lt;Void&gt; thenAccept(Consumer&lt;? extends T&gt; action); public CompletionStage&lt;Void&gt; thenAcceptAsync(Consumer&lt;? extends T&gt; action); public CompletionStage&lt;Void&gt; thenRun(Runnable action); public CompletionStage&lt;Void&gt; thenRunAysc(Runnable action); public &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombine(CompletionStage&lt;? extends U&gt; other,BiFunction&lt;? super T,? super U,? extends V&gt; fn); public &lt;U,V&gt; CompletionStage&lt;V&gt; thenCombineAsync(CompletionStage&lt;? extends U&gt; other,BiFunction&lt;? super T,? super U,? extends V&gt; fn); public &lt;U,V&gt; CompletionStage&lt;V&gt; thenAcceptBoth(CompletionStage&lt;? extends U&gt; other,BiConsumer&lt;? extends T,? super U&gt; action); public &lt;U,V&gt; CompletionStage&lt;V&gt; thenAcceptBothAsync(CompletionStage&lt;? extends U&gt; other,BiConsumer&lt;? extends T,? super U&gt; action); public CompletionStage&lt;Void&gt; runAfterBoth(CompletionStage&lt;?&gt; other,Runnable action); public CompletionStage&lt;Void&gt; runAfterBothAsync(CompletionStage&lt;?&gt; other,Runnable action); public CompletionStage&lt;Void&gt; runAfterBothAsync(CompletionStage&lt;?&gt; other,Runnable action,Executor executor); public &lt;U&gt; CompletionStage&lt;U&gt; applyToEither(CompletionStage&lt;? extends T&gt; other,Function&lt;? super T, U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; applyToEitherAsync(CompletionStage&lt;? extends T&gt; other,Function&lt;? super T, U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; applyToEitherAsync(CompletionStage&lt;? extends T&gt; other,Function&lt;? super T, U&gt; fn,Executor executor); public CompletionStage&lt;Void&gt; acceptEither(CompletionStage&lt;? extends T&gt; other,Consumer&lt;? super T&gt; action); public CompletionStage&lt;Void&gt; acceptEitherAsync(CompletionStage&lt;? extends T&gt; other,Consumer&lt;? super T&gt; action); public CompletionStage&lt;Void&gt; acceptEitherAsync(CompletionStage&lt;? extends T&gt; other,Consumer&lt;? super T&gt; action,Executor executor); public CompletionStage&lt;Void&gt; runAfterEither(CompletionStage&lt;?&gt; other,Runnable action); public CompletionStage&lt;Void&gt; runAfterEitherAsync(CompletionStage&lt;?&gt; other,Runnable action); public CompletionStage&lt;Void&gt; runAfterEitherAsync(CompletionStage&lt;?&gt; other,Runnable action,Executor executor); public &lt;U&gt; CompletionStage&lt;U&gt; thenCompose(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; thenComposeAsync(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; thenComposeAsync(Function&lt;? super T, ? extends CompletionStage&lt;U&gt;&gt; fn,Executor executor); public CompletionStage&lt;T&gt; exceptionally(Function&lt;Throwable, ? extends T&gt; fn); public CompletionStage&lt;T&gt; whenComplete(BiConsumer&lt;? super T, ? super Throwable&gt; action); public CompletionStage&lt;T&gt; whenCompleteAsync(BiConsumer&lt;? super T, ? super Throwable&gt; action); public CompletionStage&lt;T&gt; whenCompleteAsync(BiConsumer&lt;? super T, ? super Throwable&gt; action,Executor executor); public &lt;U&gt; CompletionStage&lt;U&gt; handle(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; handleAsync(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn); public &lt;U&gt; CompletionStage&lt;U&gt; handleAsync(BiFunction&lt;? super T, Throwable, ? extends U&gt; fn,Executor executor); public CompletableFuture&lt;T&gt; toCompletableFuture(); &#125; CompletionStageæ¥å£çš„ä½œç”¨(ç¿»è¯‘ä»£ç çš„æ³¨é‡Š): ä¸€ä¸ªå¯èƒ½æ˜¯å¼‚æ­¥è®¡ç®—çš„é˜¶æ®µï¼Œå½“å¦ä¸€ä¸ªCompletionStageå®Œæˆæ—¶æ‰§è¡Œä¸€ä¸ªåŠ¨ä½œæˆ–è®¡ç®—ä¸€ä¸ªå€¼ã€‚ä¸€ä¸ªé˜¶æ®µåœ¨å®ƒçš„è®¡ç®—ç»ˆæ­¢æ—¶å®Œæˆï¼Œä½†è¿™å¯èƒ½åè¿‡æ¥è§¦å‘å…¶ä»–ç›¸å…³é˜¶æ®µã€‚åœ¨è¿™ä¸ªæ¥å£ä¸­å®šä¹‰çš„åŠŸèƒ½åªé‡‡ç”¨äº†ä¸€äº›åŸºæœ¬å½¢å¼ï¼Œå®ƒä»¬æ‰©å±•åˆ°ä¸€ç»„æ›´å¤§çš„æ–¹æ³•æ¥æ•è·ä¸€ç³»åˆ—çš„ä½¿ç”¨é£æ ¼: é˜¶æ®µæ‰§è¡Œçš„è®¡ç®—å¯ä»¥è¡¨ç¤ºä¸ºFunctionã€Consumeræˆ–Runnable(åˆ†åˆ«ä½¿ç”¨åç§°åŒ…æ‹¬applyã€acceptæˆ–runçš„æ–¹æ³•)ï¼Œè¿™å–å†³äºå®ƒæ˜¯å¦éœ€è¦å‚æ•°å’Œ/æˆ–äº§ç”Ÿç»“æœã€‚ä¾‹å¦‚ï¼š 1234stage .thenApply(x -&gt; square(x)) .thenAccept(x -&gt; System.out.print(x)) .thenRun(() -&gt; System.out.println()); å¦ä¸€ç§å½¢å¼(ç»„åˆ)åº”ç”¨çš„æ˜¯é˜¶æ®µæœ¬èº«çš„åŠŸèƒ½ï¼Œè€Œä¸æ˜¯å®ƒä»¬çš„ç»“æœã€‚ ä¸€ä¸ªé˜¶æ®µçš„æ‰§è¡Œå¯ä»¥ç”±å•ä¸ªé˜¶æ®µçš„å®Œæˆè§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±ä¸¤ä¸ªé˜¶æ®µçš„å®Œæˆè§¦å‘ï¼Œä¹Ÿå¯ä»¥ç”±ä¸¤ä¸ªé˜¶æ®µä¸­çš„ä»»ä½•ä¸€ä¸ªè§¦å‘ã€‚å•ä¸ªé˜¶æ®µä¸Šçš„ä¾èµ–å…³ç³»ä½¿ç”¨å¸¦å‰ç¼€çš„æ–¹æ³•è¿›è¡Œå®‰æ’ã€‚ç”±å®Œæˆè¿™ä¸¤ä¸ªé˜¶æ®µè€Œè§¦å‘çš„è§¦å‘å™¨å¯ä»¥ç»“åˆå®ƒä»¬çš„ç»“æœæˆ–æ•ˆæœï¼Œä½¿ç”¨ç›¸åº”çš„å‘½åæ–¹æ³•ã€‚ç”±è¿™ä¸¤ä¸ªé˜¶æ®µä¸­çš„ä»»ä½•ä¸€ä¸ªè§¦å‘çš„éƒ½ä¸èƒ½ä¿è¯ä¾èµ–é˜¶æ®µçš„è®¡ç®—ä½¿ç”¨å“ªä¸€ä¸ªç»“æœæˆ–æ•ˆæœã€‚ é˜¶æ®µä¹‹é—´çš„ä¾èµ–å…³ç³»æ§åˆ¶è®¡ç®—çš„è§¦å‘ï¼Œä½†ä¸èƒ½ä¿è¯ä»»ä½•ç‰¹å®šçš„é¡ºåºã€‚æ­¤å¤–ï¼Œæ–°é˜¶æ®µè®¡ç®—çš„æ‰§è¡Œå¯ä»¥ä»¥ä¸‰ç§æ–¹å¼ä¸­çš„ä»»ä½•ä¸€ç§å®‰æ’:é»˜è®¤æ‰§è¡Œã€é»˜è®¤å¼‚æ­¥æ‰§è¡Œ(ä½¿ç”¨å¸¦æœ‰åç¼€asyncçš„æ–¹æ³•ï¼Œä½¿ç”¨é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·)ï¼Œæˆ–è‡ªå®šä¹‰(é€šè¿‡æä¾›çš„Executor)ã€‚é»˜è®¤æ¨¡å¼å’Œå¼‚æ­¥æ¨¡å¼çš„æ‰§è¡Œå±æ€§æ˜¯ç”±CompletionStageå®ç°æŒ‡å®šçš„ï¼Œè€Œä¸æ˜¯è¿™ä¸ªæ¥å£ã€‚å¸¦æœ‰æ˜¾å¼Executorå‚æ•°çš„æ–¹æ³•å¯èƒ½å…·æœ‰ä»»æ„çš„æ‰§è¡Œå±æ€§ï¼Œç”šè‡³å¯èƒ½ä¸æ”¯æŒå¹¶å‘æ‰§è¡Œï¼Œä½†ä»¥é€‚åˆå¼‚æ­¥çš„æ–¹å¼è¿›è¡Œå¤„ç†ã€‚ ä¸¤ç§æ–¹æ³•å½¢å¼æ”¯æŒå¤„ç†ï¼Œæ— è®ºè§¦å‘é˜¶æ®µæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆ:å½“completeæ–¹æ³•å…è®¸æ— è®ºç»“æœå¦‚ä½•æ³¨å…¥ä¸€ä¸ªåŠ¨ä½œï¼Œå¦åˆ™åœ¨å…¶å®Œæˆæ—¶ä¿ç•™ç»“æœã€‚æ–¹æ³•å¥æŸ„å¦å¤–å…è®¸é˜¶æ®µè®¡ç®—æ›¿æ¢ç»“æœï¼Œè¯¥ç»“æœå¯èƒ½ä½¿å…¶ä»–ä¾èµ–é˜¶æ®µèƒ½å¤Ÿè¿›ä¸€æ­¥å¤„ç†ã€‚åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ªé˜¶æ®µçš„è®¡ç®—çªç„¶ç»ˆæ­¢ï¼Œå‡ºç°(æœªæ£€æŸ¥çš„)å¼‚å¸¸æˆ–é”™è¯¯ï¼Œé‚£ä¹ˆæ‰€æœ‰éœ€è¦å®ƒå®Œæˆçš„ä¾èµ–é˜¶æ®µä¹Ÿä¼šå¼‚å¸¸å®Œæˆï¼Œè€ŒCompletionExceptionå°†å¼‚å¸¸ä½œä¸ºå…¶åŸå› ã€‚å¦‚æœä¸€ä¸ªé˜¶æ®µä¾èµ–äºä¸¤ä¸ªé˜¶æ®µï¼Œå¹¶ä¸”ä¸¤ä¸ªé˜¶æ®µéƒ½æ˜¯å®Œå…¨çš„å¼‚å¸¸ï¼Œé‚£ä¹ˆCompletionExceptionå¯èƒ½å¯¹åº”äºè¿™äº›å¼‚å¸¸ä¸­çš„ä»»ä½•ä¸€ä¸ªã€‚å¦‚æœä¸€ä¸ªé˜¶æ®µä¾èµ–äºå…¶ä»–ä¸¤ä¸ªé˜¶æ®µä¸­çš„ä»»ä½•ä¸€ä¸ªï¼Œå¹¶ä¸”åªæœ‰å…¶ä¸­ä¸€ä¸ªå¼‚å¸¸å®Œæˆï¼Œåˆ™ä¸èƒ½ä¿è¯ä¾èµ–é˜¶æ®µæ˜¯æ­£å¸¸å®Œæˆè¿˜æ˜¯å¼‚å¸¸å®Œæˆã€‚åœ¨whenCompleteæ–¹æ³•çš„æƒ…å†µä¸‹ï¼Œå½“æä¾›çš„åŠ¨ä½œæœ¬èº«é‡åˆ°å¼‚å¸¸æ—¶ï¼Œå¦‚æœè¿˜æ²¡æœ‰å¼‚å¸¸å®Œæˆï¼Œåˆ™è¯¥é˜¶æ®µä¼šå¼‚å¸¸å®Œæˆå¹¶ä¼´éšæ­¤å¼‚å¸¸ã€‚ æ‰€æœ‰æ–¹æ³•éƒ½éµå¾ªä¸Šè¿°è§¦å‘ã€æ‰§è¡Œå’Œå¼‚å¸¸å®Œæˆè§„èŒƒ(è¿™äº›è§„èŒƒåœ¨å•ä¸ªæ–¹æ³•è§„èŒƒä¸­æ²¡æœ‰é‡å¤)ã€‚æ­¤å¤–ï¼Œå°½ç®¡ç”¨äºä¼ é€’å®Œæˆç»“æœ(å³Tç±»å‹çš„å‚æ•°)ç»™æ¥å—å®ƒä»¬çš„æ–¹æ³•çš„å‚æ•°å¯èƒ½ä¸ºç©ºï¼Œä½†ä¸ºä»»ä½•å…¶ä»–å‚æ•°ä¼ é€’ç©ºå€¼å°†å¯¼è‡´æŠ›å‡ºNullPointerExceptionã€‚ æ­¤æ¥å£ä¸å®šä¹‰ç”¨äºåˆå§‹åˆ›å»ºã€å¼ºåˆ¶å®Œæˆ(æ­£å¸¸æˆ–å¼‚å¸¸)ã€æ¢æµ‹å®ŒæˆçŠ¶æ€æˆ–ç»“æœæˆ–ç­‰å¾…é˜¶æ®µå®Œæˆçš„æ–¹æ³•ã€‚å®Œæˆé˜¶æ®µçš„å®æ–½å¯ä»¥æä¾›é€‚å½“çš„æ–¹æ³•æ¥è¾¾åˆ°è¿™äº›æ•ˆæœã€‚æ–¹æ³•toCompletableFutureé€šè¿‡æä¾›ä¸€ä¸ªé€šç”¨çš„è½¬æ¢ç±»å‹æ¥å®ç°æ­¤æ¥å£çš„ä¸åŒå®ç°ä¹‹é—´çš„äº’æ“ä½œæ€§ã€‚ CompletionStageä¸­çš„æºç å°±æä¾›äº†38ä¸ªæ–¹æ³•ï¼Œè¿™38ä¸ªæ–¹æ³•çš„åŠŸèƒ½æè¿°ï¼š thenApply:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¯¥é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥è¯¥é˜¶æ®µçš„ç»“æœä½œä¸ºæ‰€æä¾›å‡½æ•°çš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ thenApplyAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æ­¤é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœä½œä¸ºæ‰€æä¾›å‡½æ•°çš„å‚æ•°ã€‚ thenApplyAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ thenAccept:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¯¥é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥è¯¥é˜¶æ®µçš„ç»“æœä½œä¸ºæä¾›çš„åŠ¨ä½œçš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ thenAcceptAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æ­¤é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœä½œä¸ºæ‰€æä¾›çš„åŠ¨ä½œçš„å‚æ•°ã€‚ thenAcceptAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æ‰€æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœä½œä¸ºæ‰€æä¾›çš„åŠ¨ä½œçš„å‚æ•°ã€‚ thenRun:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå®ƒå°†æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ thenRunAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ thenRunAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ thenCombine:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µéƒ½æ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ thenCombineAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ¥æ‰§è¡Œè¿™ä¸ªæ–°çš„CompletionStageï¼Œå¹¶å°†ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ thenCombineAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ thenAcceptBoth:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µéƒ½æ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„åŠ¨ä½œçš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ thenAcceptBothAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ¥æ‰§è¡Œè¿™ä¸ªæ–°çš„CompletionStageï¼Œå¹¶å°†ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„åŠ¨ä½œçš„å‚æ•°ã€‚ thenAcceptBothAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†ä¸¤ä¸ªç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ runAfterBoth:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šçš„stageéƒ½æ­£å¸¸å®Œæˆæ—¶ï¼Œå®ƒå°†æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ runAfterBothAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œç»™å®šçš„åŠ¨ä½œ. runAfterBothAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªå’Œå¦ä¸€ä¸ªç»™å®šstageæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ applyToEither:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥ç›¸åº”çš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ applyToEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¯¥é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†ç›¸åº”çš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ applyToEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œï¼Œå¹¶å°†ç›¸åº”çš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ acceptEither:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥ç›¸åº”çš„ç»“æœä½œä¸ºæä¾›çš„åŠ¨ä½œçš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ acceptEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œï¼Œå¹¶å°†ç›¸åº”çš„ç»“æœä½œä¸ºæ‰€æä¾›çš„åŠ¨ä½œçš„å‚æ•°ã€‚ acceptEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œï¼Œå¹¶å°†ç›¸åº”çš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ runAfterEither:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå®ƒå°†æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ runAfterEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨è¿™ä¸ªé˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œç»™å®šçš„åŠ¨ä½œã€‚ runAfterEitherAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¿™ä¸ªæˆ–å¦ä¸€ä¸ªç»™å®šé˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œç»™å®šçš„æ“ä½œã€‚ thenCompose:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œå°†ä»¥æ­¤é˜¶æ®µä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°æ‰§è¡Œè¯¥é˜¶æ®µã€‚ thenComposeAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æ­¤é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µä½œä¸ºæ‰€æä¾›å‡½æ•°çš„å‚æ•°ã€‚ thenComposeAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ exceptionally:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå¼‚å¸¸å®Œæˆæ—¶ï¼Œå°†æ‰§è¡Œæ­¤é˜¶æ®µçš„å¼‚å¸¸ä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚ whenComplete:è¿”å›ä¸æ­¤é˜¶æ®µç›¸åŒçš„ç»“æœæˆ–å¼‚å¸¸çš„æ–°çš„CompletionStageï¼Œè¯¥ç»“æœæˆ–å¼‚å¸¸å°†åœ¨æ­¤é˜¶æ®µå®Œæˆæ—¶æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œç»™å®šçš„æ“ä½œå°†è¢«è°ƒç”¨ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ã€‚å½“åŠ¨ä½œè¿”å›æ—¶ï¼Œè¿”å›çš„é˜¶æ®µå®Œæˆã€‚å¦‚æœæä¾›çš„æ“ä½œæœ¬èº«é‡åˆ°å¼‚å¸¸ï¼Œåˆ™è¿”å›çš„é˜¶æ®µä¼šå¼‚å¸¸åœ°å®Œæˆæ­¤å¼‚å¸¸ï¼Œé™¤éæ­¤é˜¶æ®µä¹Ÿå¼‚å¸¸åœ°å®Œæˆã€‚ whenCompleteAsync:è¿”å›ä¸€ä¸ªä¸æ­¤é˜¶æ®µç›¸åŒçš„ç»“æœæˆ–å¼‚å¸¸çš„æ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µå®Œæˆæ—¶ï¼Œä½¿ç”¨æ­¤é˜¶æ®µçš„é»˜è®¤å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œç»™å®šçš„æ“ä½œã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œç»™å®šçš„æ“ä½œå°†è¢«è°ƒç”¨ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ã€‚å½“åŠ¨ä½œè¿”å›æ—¶ï¼Œè¿”å›çš„é˜¶æ®µå®Œæˆã€‚å¦‚æœæä¾›çš„æ“ä½œæœ¬èº«é‡åˆ°å¼‚å¸¸ï¼Œåˆ™è¿”å›çš„é˜¶æ®µä¼šå¼‚å¸¸åœ°å®Œæˆæ­¤å¼‚å¸¸ï¼Œé™¤éæ­¤é˜¶æ®µä¹Ÿå¼‚å¸¸åœ°å®Œæˆã€‚ whenCompleteAsync:è¿”å›ä¸€ä¸ªä¸æ­¤é˜¶æ®µç›¸åŒçš„ç»“æœæˆ–å¼‚å¸¸çš„æ–°çš„CompletionStageï¼Œåœ¨æ­¤é˜¶æ®µå®Œæˆæ—¶ä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œç»™å®šçš„æ“ä½œã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œç»™å®šçš„æ“ä½œå°†è¢«è°ƒç”¨ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰åˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ã€‚å½“åŠ¨ä½œè¿”å›æ—¶ï¼Œè¿”å›çš„é˜¶æ®µå®Œæˆã€‚å¦‚æœæä¾›çš„æ“ä½œæœ¬èº«é‡åˆ°å¼‚å¸¸ï¼Œåˆ™è¿”å›çš„é˜¶æ®µä¼šå¼‚å¸¸åœ°å®Œæˆæ­¤å¼‚å¸¸ï¼Œé™¤éæ­¤é˜¶æ®µä¹Ÿå¼‚å¸¸åœ°å®Œæˆã€‚ handle:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“è¯¥é˜¶æ®µæ­£å¸¸æˆ–å¼‚å¸¸å®Œæˆæ—¶ï¼Œå°†æ‰§è¡Œè¯¥é˜¶æ®µçš„ç»“æœå’Œå¼‚å¸¸ä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œè°ƒç”¨ç»™å®šçš„å‡½æ•°ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°çš„ç»“æœç”¨äºå®Œæˆè¿”å›çš„é˜¶æ®µã€‚ handleAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸æˆ–å¼‚å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æ­¤é˜¶æ®µé»˜è®¤çš„å¼‚æ­¥æ‰§è¡Œå·¥å…·æ‰§è¡Œï¼Œå°†æ­¤é˜¶æ®µçš„ç»“æœå’Œå¼‚å¸¸ä½œä¸ºæ‰€æä¾›å‡½æ•°çš„å‚æ•°ã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œè°ƒç”¨ç»™å®šçš„å‡½æ•°ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°çš„ç»“æœç”¨äºå®Œæˆè¿”å›çš„é˜¶æ®µã€‚ handleAsync:è¿”å›ä¸€ä¸ªæ–°çš„CompletionStageï¼Œå½“æ­¤é˜¶æ®µæ­£å¸¸æˆ–å¼‚å¸¸å®Œæˆæ—¶ï¼Œä½¿ç”¨æä¾›çš„Executoræ‰§è¡Œè¯¥é˜¶æ®µï¼Œå¹¶å°†æ­¤é˜¶æ®µçš„ç»“æœå’Œå¼‚å¸¸ä½œä¸ºæä¾›çš„å‡½æ•°çš„å‚æ•°ã€‚å½“è¿™ä¸€é˜¶æ®µå®Œæˆæ—¶ï¼Œè°ƒç”¨ç»™å®šçš„å‡½æ•°ï¼Œå¹¶å°†è¿™ä¸€é˜¶æ®µçš„ç»“æœ(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)å’Œå¼‚å¸¸(å¦‚æœæ²¡æœ‰ï¼Œåˆ™ä¸ºnull)ä½œä¸ºå‚æ•°ï¼Œå‡½æ•°çš„ç»“æœç”¨äºå®Œæˆè¿”å›çš„é˜¶æ®µã€‚ toCompletableFuture:è¿”å›ä¸€ä¸ªCompletableFutureï¼Œç»´æŠ¤ä¸æ­¤é˜¶æ®µç›¸åŒçš„å®Œæˆå±æ€§ã€‚å¦‚æœè¿™ä¸ªé˜¶æ®µå·²ç»æ˜¯ä¸€ä¸ªCompletableFutureï¼Œè¿™ä¸ªæ–¹æ³•å¯ä»¥è¿”å›è¿™ä¸ªé˜¶æ®µæœ¬èº«ã€‚å¦åˆ™ï¼Œè¯¥æ–¹æ³•çš„è°ƒç”¨å¯èƒ½ç­‰æ•ˆäºthenApply(x -&gt; x)ï¼Œä½†æ˜¯è¿”å›ä¸€ä¸ªCompletableFutureç±»å‹çš„å®ä¾‹ã€‚ä¸€ä¸ªCompletionStageå®ç°å¦‚æœä¸é€‰æ‹©ä¸å…¶ä»–äººäº’æ“ä½œï¼Œå¯èƒ½ä¼šæŠ›å‡ºUnsupportedOperationExceptionã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/categories/Java/"}],"tags":[{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://cha1yi.github.io/dist/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"}],"author":"wuxuan.chai"},{"title":"MySQLä¸PostGreSQLçš„åŒºåˆ«","slug":"Mysqlå’ŒPostgreSqlåŒºåˆ«","date":"2021-03-25T01:55:16.853Z","updated":"2021-06-05T14:56:50.414Z","comments":true,"path":"2021/03/25/Mysqlå’ŒPostgreSqlåŒºåˆ«/","link":"","permalink":"https://cha1yi.github.io/dist/2021/03/25/Mysql%E5%92%8CPostgreSql%E5%8C%BA%E5%88%AB/","excerpt":"","text":"MySQLä¸PostGreSQLçš„åŒºåˆ«ä¸€.PostgreSQLç›¸å¯¹äºMySQLçš„ä¼˜åŠ¿1ã€åœ¨SQLçš„æ ‡å‡†å®ç°ä¸Šè¦æ¯”MySQLå®Œå–„ï¼Œè€Œä¸”åŠŸèƒ½å®ç°æ¯”è¾ƒä¸¥è°¨ï¼›2ã€å­˜å‚¨è¿‡ç¨‹çš„åŠŸèƒ½æ”¯æŒè¦æ¯”MySQLå¥½ï¼Œå…·å¤‡æœ¬åœ°ç¼“å­˜æ‰§è¡Œè®¡åˆ’çš„èƒ½åŠ›ï¼›3ã€å¯¹è¡¨è¿æ¥æ”¯æŒè¾ƒå®Œæ•´ï¼Œä¼˜åŒ–å™¨çš„åŠŸèƒ½è¾ƒå®Œæ•´ï¼Œæ”¯æŒçš„ç´¢å¼•ç±»å‹å¾ˆå¤šï¼Œå¤æ‚æŸ¥è¯¢èƒ½åŠ›è¾ƒå¼ºï¼›4ã€PGä¸»è¡¨é‡‡ç”¨å †è¡¨å­˜æ”¾ï¼ŒMySQLé‡‡ç”¨ç´¢å¼•ç»„ç»‡è¡¨ï¼Œèƒ½å¤Ÿæ”¯æŒæ¯”MySQLæ›´å¤§çš„æ•°æ®é‡ã€‚5ã€PGçš„ä¸»å¤‡å¤åˆ¶å±äºç‰©ç†å¤åˆ¶ï¼Œç›¸å¯¹äºMySQLåŸºäºbinlogçš„é€»è¾‘å¤åˆ¶ï¼Œæ•°æ®çš„ä¸€è‡´æ€§æ›´åŠ å¯é ï¼Œå¤åˆ¶æ€§èƒ½æ›´é«˜ï¼Œå¯¹ä¸»æœºæ€§èƒ½çš„å½±å“ä¹Ÿæ›´å°ã€‚6ã€MySQLçš„å­˜å‚¨å¼•æ“æ’ä»¶åŒ–æœºåˆ¶ï¼Œå­˜åœ¨é”æœºåˆ¶å¤æ‚å½±å“å¹¶å‘çš„é—®é¢˜ï¼Œè€ŒPGä¸å­˜åœ¨ã€‚ äºŒã€MySQLç›¸å¯¹äºPGçš„ä¼˜åŠ¿ï¼š1ã€innodbçš„åŸºäºå›æ»šæ®µå®ç°çš„MVCCæœºåˆ¶ï¼Œç›¸å¯¹PGæ–°è€æ•°æ®ä¸€èµ·å­˜æ”¾çš„åŸºäºXIDçš„MVCCæœºåˆ¶ï¼Œæ˜¯å ä¼˜çš„ã€‚å› æ­¤MySQLçš„é€Ÿåº¦æ˜¯é«˜äºPGçš„ï¼› 2ã€MySQLé‡‡ç”¨ç´¢å¼•ç»„ç»‡è¡¨ï¼Œè¿™ç§å­˜å‚¨æ–¹å¼éå¸¸é€‚åˆåŸºäºä¸»é”®åŒ¹é…çš„æŸ¥è¯¢ã€åˆ æ”¹æ“ä½œï¼Œä½†æ˜¯å¯¹è¡¨ç»“æ„è®¾è®¡å­˜åœ¨çº¦æŸï¼› 3ã€MySQLçš„ä¼˜åŒ–å™¨è¾ƒç®€å•ï¼Œç³»ç»Ÿè¡¨ã€è¿ç®—ç¬¦ã€æ•°æ®ç±»å‹çš„å®ç°éƒ½å¾ˆç²¾ç®€ï¼Œéå¸¸é€‚åˆç®€å•çš„æŸ¥è¯¢æ“ä½œï¼› 4ã€MySQLåˆ†åŒºè¡¨çš„å®ç°è¦ä¼˜äºPGçš„åŸºäºç»§æ‰¿è¡¨çš„åˆ†åŒºå®ç°ï¼Œä¸»è¦ä½“ç°åœ¨åˆ†åŒºä¸ªæ•°è¾¾åˆ°ä¸Šåƒä¸Šä¸‡åçš„å¤„ç†æ€§èƒ½å·®å¼‚è¾ƒå¤§ã€‚ æ€»ç»“ï¼š PGå…·å¤‡æ›´é«˜çš„å¯é æ€§ï¼Œå¯¹æ•°æ®ä¸€è‡´æ€§å®Œæ•´æ€§çš„æ”¯æŒé«˜äºMySQLï¼Œå› æ­¤PGæ›´åŠ é€‚åˆä¸¥æ ¼çš„ä¼ä¸šåº”ç”¨åœºæ™¯ï¼ˆæ¯”å¦‚é‡‘èã€ç”µä¿¡ã€ERPã€CRMï¼‰ï¼›è€ŒMySQLæŸ¥è¯¢é€Ÿåº¦è¾ƒå¿«ï¼Œæ›´åŠ é€‚åˆä¸šåŠ¡é€»è¾‘ç›¸å¯¹ç®€å•ã€æ•°æ®å¯é æ€§è¦æ±‚è¾ƒä½çš„äº’è”ç½‘åœºæ™¯ï¼ˆæ¯”å¦‚googleã€facebookã€alibabaï¼‰ã€‚","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"","slug":"æ¶æ„æ€ç»´","date":"2021-03-19T09:19:03.896Z","updated":"2021-03-19T09:19:50.816Z","comments":true,"path":"2021/03/19/æ¶æ„æ€ç»´/","link":"","permalink":"https://cha1yi.github.io/dist/2021/03/19/%E6%9E%B6%E6%9E%84%E6%80%9D%E7%BB%B4/","excerpt":"","text":"dolphinschedule è°ƒåº¦ä¸­çš„ä¾èµ–é—®é¢˜æ˜¯ä¸ªéš¾é¢˜ã€ä½ è¦æ˜¯èƒ½ç†è§£æ·±åˆ»ä¹Ÿè¦å¥½å¥½è¯´ä¸€ä¸‹ newbiè¡€ç¼˜åˆ†æçš„æ€è·¯ æ•´ä½“è®¾è®¡æ€æƒ³ã€ç»„ä»¶è®¾è®¡æ€æƒ³ã€èµ„æºéš”ç¦»ã€å†…éƒ¨çš„æµå¼è®¾è®¡æ€æƒ³ã€mapreduceæ€æƒ³ etlä¸­ä¸­çš„æ‰§è¡Œå¼•æ“æ€æƒ³ä¹Ÿè¦èƒ½å¹ æµå¼æ€æƒ³ dbæŸ¥è¯¢ï¼Œcsvä¸‹è½½ã€excelä¸‹è½½ olapé‡Œé¢çš„æ•´ä½“è®¾è®¡æ€æƒ³è¦èƒ½è¯´æ˜ç™½ï¼Œæµå¼è®¡ç®—ã€ç¼“å­˜æ€æƒ³ã€spiæ€æƒ³ç­‰è¦èƒ½éšæ‰‹æ’µæ¥","categories":[],"tags":[]},{"title":"Dubboæ¶æ„å…¥é—¨","slug":"Dubbo-æ¶æ„å…¥é—¨","date":"2021-03-01T10:04:19.949Z","updated":"2021-03-01T10:06:49.236Z","comments":true,"path":"2021/03/01/Dubbo-æ¶æ„å…¥é—¨/","link":"","permalink":"https://cha1yi.github.io/dist/2021/03/01/Dubbo-%E6%9E%B6%E6%9E%84%E5%85%A5%E9%97%A8/","excerpt":"","text":"Dubboæ¶æ„Dubbo æ¶æ„ èŠ‚ç‚¹è§’è‰²è¯´æ˜ èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Provider æš´éœ²æœåŠ¡çš„æœåŠ¡æä¾›æ–¹ Consumer è°ƒç”¨è¿œç¨‹æœåŠ¡çš„æœåŠ¡æ¶ˆè´¹æ–¹ Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ Container æœåŠ¡è¿è¡Œå®¹å™¨ è°ƒç”¨å…³ç³»è¯´æ˜ æœåŠ¡å®¹å™¨è´Ÿè´£å¯åŠ¨ï¼ŒåŠ è½½ï¼Œè¿è¡ŒæœåŠ¡æä¾›è€…ã€‚ æœåŠ¡æä¾›è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œè‡ªå·±æä¾›çš„æœåŠ¡ã€‚ æœåŠ¡æ¶ˆè´¹è€…åœ¨å¯åŠ¨æ—¶ï¼Œå‘æ³¨å†Œä¸­å¿ƒè®¢é˜…è‡ªå·±æ‰€éœ€çš„æœåŠ¡ã€‚ æ³¨å†Œä¸­å¿ƒè¿”å›æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ç»™æ¶ˆè´¹è€…ï¼Œå¦‚æœæœ‰å˜æ›´ï¼Œæ³¨å†Œä¸­å¿ƒå°†åŸºäºé•¿è¿æ¥æ¨é€å˜æ›´æ•°æ®ç»™æ¶ˆè´¹è€…ã€‚ æœåŠ¡æ¶ˆè´¹è€…ï¼Œä»æä¾›è€…åœ°å€åˆ—è¡¨ä¸­ï¼ŒåŸºäºè½¯è´Ÿè½½å‡è¡¡ç®—æ³•ï¼Œé€‰ä¸€å°æä¾›è€…è¿›è¡Œè°ƒç”¨ï¼Œå¦‚æœè°ƒç”¨å¤±è´¥ï¼Œå†é€‰å¦ä¸€å°è°ƒç”¨ã€‚ æœåŠ¡æ¶ˆè´¹è€…å’Œæä¾›è€…ï¼Œåœ¨å†…å­˜ä¸­ç´¯è®¡è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´ï¼Œå®šæ—¶æ¯åˆ†é’Ÿå‘é€ä¸€æ¬¡ç»Ÿè®¡æ•°æ®åˆ°ç›‘æ§ä¸­å¿ƒã€‚ Dubbo æ¶æ„å…·æœ‰ä»¥ä¸‹å‡ ä¸ªç‰¹ç‚¹ï¼Œåˆ†åˆ«æ˜¯è¿é€šæ€§ã€å¥å£®æ€§ã€ä¼¸ç¼©æ€§ã€ä»¥åŠå‘æœªæ¥æ¶æ„çš„å‡çº§æ€§ã€‚ è¿é€šæ€§ æ³¨å†Œä¸­å¿ƒè´Ÿè´£æœåŠ¡åœ°å€çš„æ³¨å†Œä¸æŸ¥æ‰¾ï¼Œç›¸å½“äºç›®å½•æœåŠ¡ï¼ŒæœåŠ¡æä¾›è€…å’Œæ¶ˆè´¹è€…åªåœ¨å¯åŠ¨æ—¶ä¸æ³¨å†Œä¸­å¿ƒäº¤äº’ï¼Œæ³¨å†Œä¸­å¿ƒä¸è½¬å‘è¯·æ±‚ï¼Œå‹åŠ›è¾ƒå° ç›‘æ§ä¸­å¿ƒè´Ÿè´£ç»Ÿè®¡å„æœåŠ¡è°ƒç”¨æ¬¡æ•°ï¼Œè°ƒç”¨æ—¶é—´ç­‰ï¼Œç»Ÿè®¡å…ˆåœ¨å†…å­˜æ±‡æ€»åæ¯åˆ†é’Ÿä¸€æ¬¡å‘é€åˆ°ç›‘æ§ä¸­å¿ƒæœåŠ¡å™¨ï¼Œå¹¶ä»¥æŠ¥è¡¨å±•ç¤º æœåŠ¡æä¾›è€…å‘æ³¨å†Œä¸­å¿ƒæ³¨å†Œå…¶æä¾›çš„æœåŠ¡ï¼Œå¹¶æ±‡æŠ¥è°ƒç”¨æ—¶é—´åˆ°ç›‘æ§ä¸­å¿ƒï¼Œæ­¤æ—¶é—´ä¸åŒ…å«ç½‘ç»œå¼€é”€ æœåŠ¡æ¶ˆè´¹è€…å‘æ³¨å†Œä¸­å¿ƒè·å–æœåŠ¡æä¾›è€…åœ°å€åˆ—è¡¨ï¼Œå¹¶æ ¹æ®è´Ÿè½½ç®—æ³•ç›´æ¥è°ƒç”¨æä¾›è€…ï¼ŒåŒæ—¶æ±‡æŠ¥è°ƒç”¨æ—¶é—´åˆ°ç›‘æ§ä¸­å¿ƒï¼Œæ­¤æ—¶é—´åŒ…å«ç½‘ç»œå¼€é”€ æ³¨å†Œä¸­å¿ƒï¼ŒæœåŠ¡æä¾›è€…ï¼ŒæœåŠ¡æ¶ˆè´¹è€…ä¸‰è€…ä¹‹é—´å‡ä¸ºé•¿è¿æ¥ï¼Œç›‘æ§ä¸­å¿ƒé™¤å¤– æ³¨å†Œä¸­å¿ƒé€šè¿‡é•¿è¿æ¥æ„ŸçŸ¥æœåŠ¡æä¾›è€…çš„å­˜åœ¨ï¼ŒæœåŠ¡æä¾›è€…å®•æœºï¼Œæ³¨å†Œä¸­å¿ƒå°†ç«‹å³æ¨é€äº‹ä»¶é€šçŸ¥æ¶ˆè´¹è€… æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒå…¨éƒ¨å®•æœºï¼Œä¸å½±å“å·²è¿è¡Œçš„æä¾›è€…å’Œæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹è€…åœ¨æœ¬åœ°ç¼“å­˜äº†æä¾›è€…åˆ—è¡¨ æ³¨å†Œä¸­å¿ƒå’Œç›‘æ§ä¸­å¿ƒéƒ½æ˜¯å¯é€‰çš„ï¼ŒæœåŠ¡æ¶ˆè´¹è€…å¯ä»¥ç›´è¿æœåŠ¡æä¾›è€… å¥å£®æ€§ ç›‘æ§ä¸­å¿ƒå®•æ‰ä¸å½±å“ä½¿ç”¨ï¼Œåªæ˜¯ä¸¢å¤±éƒ¨åˆ†é‡‡æ ·æ•°æ® æ•°æ®åº“å®•æ‰åï¼Œæ³¨å†Œä¸­å¿ƒä»èƒ½é€šè¿‡ç¼“å­˜æä¾›æœåŠ¡åˆ—è¡¨æŸ¥è¯¢ï¼Œä½†ä¸èƒ½æ³¨å†Œæ–°æœåŠ¡ æ³¨å†Œä¸­å¿ƒå¯¹ç­‰é›†ç¾¤ï¼Œä»»æ„ä¸€å°å®•æ‰åï¼Œå°†è‡ªåŠ¨åˆ‡æ¢åˆ°å¦ä¸€å° æ³¨å†Œä¸­å¿ƒå…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æä¾›è€…å’ŒæœåŠ¡æ¶ˆè´¹è€…ä»èƒ½é€šè¿‡æœ¬åœ°ç¼“å­˜é€šè®¯ æœåŠ¡æä¾›è€…æ— çŠ¶æ€ï¼Œä»»æ„ä¸€å°å®•æ‰åï¼Œä¸å½±å“ä½¿ç”¨ æœåŠ¡æä¾›è€…å…¨éƒ¨å®•æ‰åï¼ŒæœåŠ¡æ¶ˆè´¹è€…åº”ç”¨å°†æ— æ³•ä½¿ç”¨ï¼Œå¹¶æ— é™æ¬¡é‡è¿ç­‰å¾…æœåŠ¡æä¾›è€…æ¢å¤ ä¼¸ç¼©æ€§ æ³¨å†Œä¸­å¿ƒä¸ºå¯¹ç­‰é›†ç¾¤ï¼Œå¯åŠ¨æ€å¢åŠ æœºå™¨éƒ¨ç½²å®ä¾‹ï¼Œæ‰€æœ‰å®¢æˆ·ç«¯å°†è‡ªåŠ¨å‘ç°æ–°çš„æ³¨å†Œä¸­å¿ƒ æœåŠ¡æä¾›è€…æ— çŠ¶æ€ï¼Œå¯åŠ¨æ€å¢åŠ æœºå™¨éƒ¨ç½²å®ä¾‹ï¼Œæ³¨å†Œä¸­å¿ƒå°†æ¨é€æ–°çš„æœåŠ¡æä¾›è€…ä¿¡æ¯ç»™æ¶ˆè´¹è€… å‡çº§æ€§å½“æœåŠ¡é›†ç¾¤è§„æ¨¡è¿›ä¸€æ­¥æ‰©å¤§ï¼Œå¸¦åŠ¨ITæ²»ç†ç»“æ„è¿›ä¸€æ­¥å‡çº§ï¼Œéœ€è¦å®ç°åŠ¨æ€éƒ¨ç½²ï¼Œè¿›è¡ŒæµåŠ¨è®¡ç®—ï¼Œç°æœ‰åˆ†å¸ƒå¼æœåŠ¡æ¶æ„ä¸ä¼šå¸¦æ¥é˜»åŠ›ã€‚ä¸‹å›¾æ˜¯æœªæ¥å¯èƒ½çš„ä¸€ç§æ¶æ„ï¼š èŠ‚ç‚¹è§’è‰²è¯´æ˜ èŠ‚ç‚¹ è§’è‰²è¯´æ˜ Deployer è‡ªåŠ¨éƒ¨ç½²æœåŠ¡çš„æœ¬åœ°ä»£ç† Repository ä»“åº“ç”¨äºå­˜å‚¨æœåŠ¡åº”ç”¨å‘å¸ƒåŒ… Scheduler è°ƒåº¦ä¸­å¿ƒåŸºäºè®¿é—®å‹åŠ›è‡ªåŠ¨å¢å‡æœåŠ¡æä¾›è€… Admin ç»Ÿä¸€ç®¡ç†æ§åˆ¶å° Registry æœåŠ¡æ³¨å†Œä¸å‘ç°çš„æ³¨å†Œä¸­å¿ƒ Monitor ç»Ÿè®¡æœåŠ¡çš„è°ƒç”¨æ¬¡æ•°å’Œè°ƒç”¨æ—¶é—´çš„ç›‘æ§ä¸­å¿ƒ","categories":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://cha1yi.github.io/dist/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}],"tags":[{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://cha1yi.github.io/dist/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"}],"author":"wuxuan.chai"},{"title":"Macå¸¸ç”¨çš„å‘½ä»¤","slug":"Macå¸¸ç”¨çš„å‘½ä»¤","date":"2021-02-05T02:48:25.783Z","updated":"2021-02-22T01:43:39.786Z","comments":true,"path":"2021/02/05/Macå¸¸ç”¨çš„å‘½ä»¤/","link":"","permalink":"https://cha1yi.github.io/dist/2021/02/05/Mac%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/","excerpt":"","text":"Macå¸¸ç”¨çš„å‘½ä»¤æŸ¥çœ‹ç«¯å£å ç”¨ï¼š 12$ lsof -i tcp:8080","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://cha1yi.github.io/dist/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[{"name":"Mac","slug":"Mac","permalink":"https://cha1yi.github.io/dist/tags/Mac/"}],"author":"wuxuan.chai"},{"title":"Java SPIæœºåˆ¶","slug":"Java SPIæœºåˆ¶","date":"2021-02-03T02:14:44.580Z","updated":"2021-02-03T07:28:27.410Z","comments":true,"path":"2021/02/03/Java SPIæœºåˆ¶/","link":"","permalink":"https://cha1yi.github.io/dist/2021/02/03/Java%20SPI%E6%9C%BA%E5%88%B6/","excerpt":"","text":"ä»€ä¹ˆæ˜¯Java SPIå‚ç…§ç™¾åº¦ç™¾ç§‘çš„SPIçš„è§£é‡Šï¼šç™¾åº¦ç™¾ç§‘ å®šä¹‰ SPI(Service Provider Interface)ï¼šæ˜¯ä¸€ä¸ªå†…ç½®çš„javaæ ‡å‡†ï¼Œå…è®¸ä¸åŒçš„å¼€å‘å»å®ç°æŸä¸ªç‰¹å®šçš„æœåŠ¡ï¼ŒæœåŠ¡æä¾›ä¸€ä¸ªæ ‡å‡†çš„æ¥å£åŠç”¨äºæä¾›æŸç§ç‰¹å®šçš„æœåŠ¡çš„æ¥å£ æ€§è´¨ SPIæ˜¯Java 1.5æ–°æ·»åŠ çš„ä¸€ä¸ªå†…ç½®æ ‡å‡†ï¼Œå…è®¸ä¸åŒçš„å¼€å‘è€…å»å®ç°æŸä¸ªç‰¹å®šçš„æœåŠ¡ã€‚ä¸€ä¸ªServiceå°±æ˜¯ä¸€ä¸ªæ¥å£æˆ–æŠ½è±¡ç±»ï¼Œè€ŒService Provideræ˜¯è¿™ä¸ªServiceçš„ä¸€ä¸ªç‰¹å®šå®ç°ç±» ã€‚ Java SPIçš„åº”ç”¨ä¸€ä¸ªç®€å•çš„åœºæ™¯ï¼Œé€šè¿‡å®šä¸€ä¸ªFactoryBeançš„æ ‡å‡†æ¥å£ï¼Œç”¨äºç”Ÿæˆä¸åŒçš„beançš„é€»è¾‘ã€‚ ç¬¬ä¸€æ­¥ï¼šå®šä¹‰ä¸€ä¸ªæ ‡å‡†çš„æ¥å£ 12345678910111213141516171819202122package com.yidan.spi;/** * @author wuxuan.chai * @date 2021/2/2 6:19 ä¸‹åˆ */public interface FactoryBeanSpi &#123; /** * æœåŠ¡å®ç°ç±»å•åˆ© * @param tClass å®ç°ç±» * @param &lt;T&gt; ç±»å‹æšä¸¾ * @return æœåŠ¡å®ç°ç±»å•åˆ© */ &lt;T&gt; T getInstance(Class&lt;T&gt; tClass) throws IllegalAccessException, InstantiationException; /** * æœåŠ¡ * @return æœåŠ¡ */ String getService();&#125; ç¬¬äºŒæ­¥ï¼šå†™ä¸€ä¸ªå®ç°ç±» 123456789101112131415161718192021package com.yidan.spi.services;import com.yidan.spi.FactoryBeanSpi;/** * @author wuxuan.chai * @date 2021/2/2 6:24 ä¸‹åˆ */public class MySpiFactoryBean implements FactoryBeanSpi &#123; @Override public &lt;T&gt; T getInstance(Class&lt;T&gt; tClass) throws IllegalAccessException, InstantiationException &#123; System.out.println(&quot;MySpiFactoryBeanåœ¨æ„å»ºï¼š&quot; + tClass.getName()); return tClass.newInstance(); &#125; @Override public String getService() &#123; return &quot;MySpiFactoryBean&quot;; &#125;&#125; ç¬¬ä¸‰æ­¥ï¼šåˆ›å»ºSPIçš„é…ç½®æ–‡ä»¶ åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºMETA-INF/servicesæ–‡ä»¶ç›®å½•ï¼Œç„¶åæ ¹æ®ç¬¬ä¸€æ­¥çš„æ¥å£ç±»å…¨é™å®šåç§°ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶ï¼Œå¦‚ï¼šcom.yidan.spi.FactoryBeanSpiï¼Œå†…å®¹ä¸ºï¼š 1com.yidan.spi.services.MySpiFactoryBean è¿™ä¸ªæ–‡ä»¶ä¸­æŒ‡å®šçš„æ˜¯æˆ‘ä»¬æ‰€æè¿°çš„å®ç°ç±»çš„ç±»å…¨é™å®šåï¼Œå¯ä»¥æœ‰å¤šä¸ªå®ç° ç¬¬å››æ­¥ï¼šä½¿ç”¨SPIå»åŠ è½½æˆ‘ä»¬çš„å®ç° 12345678910111213141516171819202122232425262728package com.yidan.spi.services;import com.yidan.spi.FactoryBeanSpi;import java.util.Optional;import java.util.ServiceLoader;import java.util.stream.StreamSupport;/** * @author wuxuan.chai * @date 2021/2/2 6:27 ä¸‹åˆ */public class MyBeanManager &#123; public static FactoryBeanSpi fetchFactoryBean() &#123; final ServiceLoader&lt;FactoryBeanSpi&gt; mySpiFactoryBeans = ServiceLoader.load(FactoryBeanSpi.class); final Optional&lt;FactoryBeanSpi&gt; factoryBeanOptional = StreamSupport.stream(mySpiFactoryBeans.spliterator(), false).findFirst(); final FactoryBeanSpi factoryBean = factoryBeanOptional.orElseThrow(() -&gt; new RuntimeException(&quot;SPI åŠ è½½å¤±è´¥ï¼Œæœªæ‰¾åˆ°ï¼š&quot; + FactoryBeanSpi.class.getName() + &quot;çš„å®ç°&quot;)); return factoryBean; &#125; public static void main(String[] args) throws InstantiationException, IllegalAccessException &#123; final FactoryBeanSpi mySpiFactoryBean = fetchFactoryBean(); mySpiFactoryBean.getInstance(MyBean.class); final String service = mySpiFactoryBean.getService(); System.out.println(service); &#125;&#125; åœ¨è¿™é‡Œé¢å®šä¹‰äº†ä¸€ä¸ªMyBeanï¼Œé€šè¿‡åˆšæ‰å®ç°çš„MySpiFactoryBeanå»æ„å»ºè¿™ä¸ªMyBeanå®ä¾‹ï¼Œç„¶åå»åšä¸ªç®€å•çš„ä¾‹å­ã€‚ 12345678910111213package com.yidan.spi.services;/** * @author wuxuan.chai * @date 2021/2/2 6:27 ä¸‹åˆ */public class MyBean &#123; public MyBean()&#123; System.out.println(&quot;MyBeanæ„é€ æ–¹æ³•&quot;); &#125;&#125; åœ¨MyBeanManagerä¸­ï¼ŒfetchFactoryBeançš„æ–¹æ³•ä¸­é€šè¿‡è°ƒç”¨ServiceLoader.load(FactoryBeanSpi.class);æ‰¾åˆ°æ‰€æœ‰çš„åœ¨com.yidan.spi.FactoryBeanSpiæ–‡ä»¶ä¸­æ³¨å†Œçš„å®ç°ç±»çš„å¯¹åº”å®ä¾‹ï¼Œç„¶ååŠ è½½åˆ°JVMä¸­ï¼Œç„¶åå°±èƒ½å¤Ÿå»ä½¿ç”¨æˆ‘ä»¬çš„å®ç°äº†ã€‚ æ‰§è¡Œç»“æœï¼š 1234MySpiFactoryBeanåœ¨æ„å»ºï¼šcom.yidan.spi.services.MyBeanMyBeanæ„é€ æ–¹æ³•MySpiFactoryBean é€šè¿‡è¿™ä¸ªç®€å•çš„ä¾‹å­ï¼Œå¯ä»¥ç®€å•é˜è¿°äº†SPIæœºåˆ¶çš„åŸç†ä»¥åŠä½¿ç”¨ é™¤æ­¤ä¹‹å¤–ï¼ŒSPIçš„åŠ è½½æœºåˆ¶è¿˜å¯ä»¥æ”¯æŒè‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œè°ƒç”¨å¦‚ï¼šServiceLoader.load(Class class,ClassLoader classLoader);è¿™ä¹ˆä¹…æ„å‘³ç€ï¼Œè¿™ä¸ªSPIæ˜¯å¯ä»¥åŠ¨æ€åŠ è½½çš„ï¼Œå¦‚ä¸€äº›åº”ç”¨çš„æ’ä»¶å¼€å‘ï¼Œåœ¨è®¾è®¡çš„æ—¶å€™å¯ä»¥ä½¿ç”¨SPIæœºåˆ¶ï¼Œè®¾è®¡å¥½æ’ä»¶çš„æ¥å£æ ‡å‡†ï¼Œé€šè¿‡SPIåŠ¨æ€åŠ è½½æ’ä»¶ï¼Œå®ç°ä¸é‡å¯åº”ç”¨å¹¶ä¸”åŠŸèƒ½æ‹“å±•ã€‚ Java SPIçš„ç”¨é€”ç›®å‰ï¼Œåœ¨æˆ‘ä»¬çš„æ—¥å¸¸å¼€å‘ä¸­ï¼Œæ¥è§¦åˆ°çš„æ¯”è¾ƒå¤šçš„SPIåŠ è½½æœºåˆ¶åº”è¯¥å°±æ˜¯javaçš„java.sql.Driver,æœ¬æ¬¡ä¸»è¦æ¢ç´¢ä¸‹javaçš„é©±åŠ¨æ ‡å‡†æ¥å£ä¸‹ï¼Œå„ä¸ªæ•°æ®åº“å‚å•†çš„é©±åŠ¨å®ç°ï¼Œä»¥åŠDriverManagerçš„SPIåŠ è½½ã€‚ åœ¨åˆ›å»ºæ•°æ®åº“è¿æ¥åšæŸ¥è¯¢çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸€èˆ¬æ­¥éª¤ä¸ºï¼ŒåŠ è½½é©±åŠ¨-&gt;åˆ›å»ºè¿æ¥-&gt;åˆ›å»ºé¢„æ‰§è¡ŒæŸ¥è¯¢-&gt;æ‰§è¡ŒæŸ¥è¯¢-&gt;é‡Šæ”¾è¿æ¥èµ„æºã€‚åœ¨JDBC 4.0ä¹‹å‰çš„ä»£ç ä¸€èˆ¬éƒ½æ˜¯è¿™ä¹ˆå†™ï¼š 123456789101112131415//åŠ è½½é©±åŠ¨ Class.forName(&quot;com.mysql.jdbc.Driver&quot;); //åˆ›å»ºè¿æ¥ final Connection connection = DriverManager.getConnection(&quot;æ•°æ®åº“jdbcURL&quot;, &quot;æ•°æ®åº“username&quot;, &quot;æ•°æ®åº“password&quot;); //é¢„æ‰§è¡Œ final PreparedStatement preparedStatement = connection.prepareStatement(&quot;select 1&quot;); //æ‰§è¡Œ final ResultSet resultSet = preparedStatement.executeQuery(); while (resultSet.next())&#123; //TODO è·å–ç»“æœ &#125; //é‡Šæ”¾èµ„æº preparedStatement.close(); connection.close(); åœ¨è¿™é‡Œé¢æˆ‘ä»¬éœ€è¦Class.forNameå°†driverClassåŠ è½½åˆ°jvmä¸­ï¼Œè®©DriverManageré€šè¿‡å‘ç°Driverçš„å®ç°ç±»ï¼Œåå°„è·å–driverçš„å®ä¾‹ï¼Œé€šè¿‡è°ƒç”¨driver.acceptUrl,å»æ ¹æ®jdbcurlå»è·å–é©±åŠ¨ç±»å‹åŒ¹é…driverã€‚ è€Œåœ¨JDBC4.0ä¹‹åä¸éœ€è¦è¿™ä¹ˆåšäº†ï¼Œå› ä¸ºDriverManageré»˜è®¤åˆå§‹åŒ–çš„æ—¶å€™é€šè¿‡SPIåŠ è½½äº†æ‰€æœ‰çš„é©±åŠ¨å®ç°ç±»ï¼Œæ‰€ä»¥ä¸éœ€è¦å†ç»§ç»­åšClass.forNameäº†ã€‚ä¸‹é¢æ‘˜äº†java.sql.DriverManagerçš„éƒ¨åˆ†ä»£ç  12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576public class DriverManager &#123; /** * é€šè¿‡æ£€æŸ¥ç³»ç»Ÿå±æ€§JDBCæ¥åŠ è½½åˆå§‹çš„JDBCé©±åŠ¨ç¨‹åºï¼Œç„¶åä½¿ç”¨&#123;@code ServiceLoader&#125;ï¼ˆSPIï¼‰æœºåˆ¶ */ static &#123; loadInitialDrivers(); println(&quot;JDBC DriverManager initialized&quot;); &#125; //åœ¨åŠ è½½åˆå§‹åŒ–çš„é©±åŠ¨ä¸­ï¼Œé¦–å…ˆæ ¹æ®ç¯å¢ƒå˜é‡jdbc.driverså»åŠ è½½é©±åŠ¨ï¼Œå†æ ¹æ®SPIè·å–é©±åŠ¨å®ç°ç±»ï¼ŒSPIçš„é©±åŠ¨å®ç°ç±»ç›´æ¥é€šè¿‡AccessController.doPrivilegedç›´æ¥åŠ è½½åˆ°äº†JVMä¸­ï¼Œç¯å¢ƒå˜é‡åŠ è½½çš„é€šè¿‡Class.forNameåŠ è½½JVMä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨è°ƒç”¨Driver.getConnectionä¸éœ€è¦åœ¨ä¹‹å‰è°ƒç”¨Class.forNameäº† private static void loadInitialDrivers() &#123; String drivers; try &#123; drivers = AccessController.doPrivileged(new PrivilegedAction&lt;String&gt;() &#123; public String run() &#123; return System.getProperty(&quot;jdbc.drivers&quot;); &#125; &#125;); &#125; catch (Exception ex) &#123; drivers = null; &#125; // If the driver is packaged as a Service Provider, load it. // Get all the drivers through the classloader // exposed as a java.sql.Driver.class service. // ServiceLoader.load() replaces the sun.misc.Providers() AccessController.doPrivileged(new PrivilegedAction&lt;Void&gt;() &#123; public Void run() &#123; ServiceLoader&lt;Driver&gt; loadedDrivers = ServiceLoader.load(Driver.class); Iterator&lt;Driver&gt; driversIterator = loadedDrivers.iterator(); /* Load these drivers, so that they can be instantiated. * It may be the case that the driver class may not be there * i.e. there may be a packaged driver with the service class * as implementation of java.sql.Driver but the actual class * may be missing. In that case a java.util.ServiceConfigurationError * will be thrown at runtime by the VM trying to locate * and load the service. * * Adding a try catch block to catch those runtime errors * if driver not available in classpath but it&#x27;s * packaged as service and that service is there in classpath. */ try&#123; while(driversIterator.hasNext()) &#123; driversIterator.next(); &#125; &#125; catch(Throwable t) &#123; // Do nothing &#125; return null; &#125; &#125;); println(&quot;DriverManager.initialize: jdbc.drivers = &quot; + drivers); if (drivers == null || drivers.equals(&quot;&quot;)) &#123; return; &#125; String[] driversList = drivers.split(&quot;:&quot;); println(&quot;number of Drivers:&quot; + driversList.length); for (String aDriver : driversList) &#123; try &#123; println(&quot;DriverManager.Initialize: loading &quot; + aDriver); Class.forName(aDriver, true, ClassLoader.getSystemClassLoader()); &#125; catch (Exception ex) &#123; println(&quot;DriverManager.Initialize: load failed: &quot; + ex); &#125; &#125; &#125; &#125; é™¤äº†java.sql.Driverä½¿ç”¨äº†SPIæœºåˆ¶å¤–ï¼ŒSpringä¸­ä¹Ÿä½¿ç”¨äº†SPIï¼Œåç»­æ„Ÿå…´è¶£å»å­¦ä¹ å­¦ä¹ ï¼ŒåŠ æ·±å¯¹Springçš„ç†è§£ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/categories/Java/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://cha1yi.github.io/dist/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"author":"wuxuan.chai"},{"title":"Springçš„äº‹åŠ¡æ–¹å¼","slug":"Springçš„äº‹åŠ¡æ–¹å¼","date":"2021-02-02T03:30:28.824Z","updated":"2021-02-02T09:02:53.609Z","comments":true,"path":"2021/02/02/Springçš„äº‹åŠ¡æ–¹å¼/","link":"","permalink":"https://cha1yi.github.io/dist/2021/02/02/Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%96%B9%E5%BC%8F/","excerpt":"","text":"Springçš„äº‹åŠ¡ç®¡ç†æ–¹å¼1ã€ç¼–ç¨‹å¼äº‹åŠ¡ï¼Œåœ¨ä»£ç ä¸­ç¡¬ç¼–ç ã€‚ï¼ˆä¸æ¨èä½¿ç”¨ï¼‰ 2ã€å£°æ˜å¼äº‹åŠ¡ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®ã€‚ï¼ˆæ¨èä½¿ç”¨ï¼‰ å£°æ˜å¼äº‹åŠ¡çš„ç§ç±»ï¼š1ã€åŸºäºxmlçš„å£°æ˜å¼çš„äº‹åŠ¡ 12345&lt;!-- äº‹åŠ¡ç®¡ç†å™¨ --&gt; &lt;bean id=&quot;txManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt; &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot;/&gt; &lt;/bean&gt; 2ã€åŸºäºæ³¨è§£çš„å£°æ˜å¼çš„äº‹åŠ¡ 12345@Transactionalpublic Tag add(Tag tag) &#123; //TODO æ•°æ®åº“æŒä¹…åŒ–æ“ä½œ&#125; Springäº‹åŠ¡çš„éš”ç¦»çº§åˆ«æŸ¥çœ‹äº†ä¸‹ï¼Œorg.springframework.transaction.TransactionDefinitionæ¥å£ï¼Œè¿™ä¸ªæ¥å£å®šä¹‰äº†springçš„äº‹åŠ¡çš„éš”ç¦»å±æ€§ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209package org.springframework.transaction;import org.springframework.lang.Nullable;/** * å®šä¹‰ä¸Springå…¼å®¹çš„äº‹åŠ¡å±æ€§çš„æ¥å£ã€‚åŸºäºç±»ä¼¼äºEJB CMTå±æ€§çš„ä¼ æ’­è¡Œä¸ºå®šä¹‰ã€‚ * &lt;p&gt; * è¯·æ³¨æ„ï¼Œé™¤éå¯åŠ¨å®é™…çš„æ–°äº‹åŠ¡ï¼Œå¦åˆ™ä¸ä¼šåº”ç”¨éš”ç¦»çº§åˆ«å’Œè¶…æ—¶è®¾ç½®ã€‚ç”±äºåªæœ‰PROPAGATION_REQUIREDã€PROPAGATION_REQUIRES_NEWå’ŒPROPAGATION_NESTEDä¼šå¯¼è‡´è¿™ç§æƒ…å†µï¼Œ * å› æ­¤åœ¨å…¶ä»–æƒ…å†µä¸‹é€šå¸¸ä¸éœ€è¦æŒ‡å®šè¿™äº›è®¾ç½®ã€‚æ­¤å¤–ï¼Œè¯·æ³¨æ„ï¼Œå¹¶éæ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨éƒ½æ”¯æŒè¿™äº›é«˜çº§ç‰¹æ€§ï¼Œå› æ­¤åœ¨ç»™å‡ºéé»˜è®¤å€¼æ—¶å¯èƒ½æŠ›å‡ºç›¸åº”çš„å¼‚å¸¸ã€‚ * &lt;p&gt; * read-onlyæ ‡å¿—é€‚ç”¨äºä»»ä½•äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œæ— è®ºæ˜¯ç”±å®é™…èµ„æºäº‹åŠ¡æ”¯æŒçš„äº‹åŠ¡è¿˜æ˜¯åœ¨èµ„æºçº§åˆ«ä¸Šè¿›è¡Œéäº‹åŠ¡æ“ä½œçš„äº‹åŠ¡ã€‚åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¯¥æ ‡å¿—å°†åªåº”ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„æ‰˜ç®¡èµ„æºï¼Œä¾‹å¦‚Hibernateä¼šè¯ã€‚ * * @author Juergen Hoeller * @see PlatformTransactionManager#getTransaction(TransactionDefinition) * @see org.springframework.transaction.support.DefaultTransactionDefinition * @see org.springframework.transaction.interceptor.TransactionAttribute * @since 08.05.2003 */public interface TransactionDefinition &#123; /** * æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * è¿™é€šå¸¸æ˜¯äº‹åŠ¡å®šä¹‰çš„é»˜è®¤è®¾ç½®ï¼Œé€šå¸¸å®šä¹‰äº‹åŠ¡åŒæ­¥èŒƒå›´ã€‚ */ int PROPAGATION_REQUIRED = 0; /** * æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * æ³¨æ„:å¯¹äºå…·æœ‰äº‹åŠ¡åŒæ­¥çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ŒPROPAGATION_SUPPORTSä¸å®Œå…¨æ²¡æœ‰äº‹åŠ¡ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºå®ƒå®šä¹‰äº†åŒæ­¥å¯èƒ½é€‚ç”¨çš„äº‹åŠ¡èŒƒå›´ã€‚ * å› æ­¤ï¼Œç›¸åŒçš„èµ„æº(JDBCè¿æ¥ã€Hibernateä¼šè¯ç­‰)å°†åœ¨æ•´ä¸ªæŒ‡å®šèŒƒå›´å†…å…±äº«ã€‚è¯·æ³¨æ„ï¼Œç¡®åˆ‡çš„è¡Œä¸ºå–å†³äºäº‹åŠ¡ç®¡ç†å™¨çš„å®é™…åŒæ­¥é…ç½®! * ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯·å°å¿ƒä½¿ç”¨PROPAGATION_SUPPORTS!ç‰¹åˆ«åœ°ï¼Œä¸è¦ä¾èµ–äºPROPAGATION_REQUIREDæˆ–PROPAGATION_REQUIRES_NEWåœ¨PROPAGATION_SUPPORTSèŒƒå›´å†…(è¿™å¯èƒ½ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„åŒæ­¥å†²çª)ã€‚ * å¦‚æœè¿™ç§åµŒå¥—æ˜¯ä¸å¯é¿å…çš„ï¼Œè¯·ç¡®ä¿é€‚å½“åœ°é…ç½®äº‹åŠ¡ç®¡ç†å™¨(é€šå¸¸åˆ‡æ¢åˆ°â€œåœ¨å®é™…äº‹åŠ¡ä¸ŠåŒæ­¥â€)ã€‚ * * @see org.springframework.transaction.support.AbstractPlatformTransactionManager#setTransactionSynchronization * @see org.springframework.transaction.support.AbstractPlatformTransactionManager#SYNCHRONIZATION_ON_ACTUAL_TRANSACTION */ int PROPAGATION_SUPPORTS = 1; /** * æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * æ³¨æ„ï¼ŒPROPAGATION_MANDATORYèŒƒå›´å†…çš„äº‹åŠ¡åŒæ­¥å°†å§‹ç»ˆç”±å‘¨å›´çš„äº‹åŠ¡é©±åŠ¨ã€‚ */ int PROPAGATION_MANDATORY = 2; /** * åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡(å¦‚æœå­˜åœ¨çš„è¯)ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * æ³¨æ„:å®é™…çš„äº‹åŠ¡æŒ‚èµ·å¹¶ä¸ä¼šåœ¨æ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨ä¸Šå¼€ç®±å³ç”¨ã€‚è¿™å°¤å…¶é€‚ç”¨äºorg.springframework.transaction.jta.JtaTransactionManagerï¼Œ * å®ƒéœ€è¦javax.transaction.TransactionManagerå¯ç”¨(åœ¨æ ‡å‡†Java EEä¸­æ˜¯ç‰¹å®šäºæœåŠ¡å™¨çš„)ã€‚ * PROPAGATION_REQUIRES_NEWä½œç”¨åŸŸæ€»æ˜¯å®šä¹‰è‡ªå·±çš„äº‹åŠ¡åŒæ­¥ã€‚ç°æœ‰çš„åŒæ­¥å°†è¢«æŒ‚èµ·å¹¶é€‚å½“æ¢å¤ã€‚ * * @see org.springframework.transaction.jta.JtaTransactionManager#setTransactionManager */ int PROPAGATION_REQUIRES_NEW = 3; /** * ä¸æ”¯æŒå½“å‰äº‹åŠ¡;è€Œæ˜¯æ€»æ˜¯ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * æ³¨æ„:å®é™…çš„äº‹åŠ¡æŒ‚èµ·å¹¶ä¸ä¼šåœ¨æ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨ä¸Šå¼€ç®±å³ç”¨ã€‚è¿™å°¤å…¶é€‚ç”¨äºorg.springframework.transaction.jta.JtaTransactionManagerï¼Œ * å®ƒéœ€è¦javax.transaction.TransactionManagerå¯ç”¨(åœ¨æ ‡å‡†Java EEä¸­æ˜¯ç‰¹å®šäºæœåŠ¡å™¨çš„)ã€‚ * æ³¨æ„ï¼Œäº‹åŠ¡åŒæ­¥åœ¨PROPAGATION_NOT_SUPPORTEDèŒƒå›´å†…ä¸å¯ç”¨ã€‚ç°æœ‰çš„åŒæ­¥å°†è¢«æŒ‚èµ·å¹¶é€‚å½“æ¢å¤ã€‚ * * @see org.springframework.transaction.jta.JtaTransactionManager#setTransactionManager */ int PROPAGATION_NOT_SUPPORTED = 4; /** * ä¸æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ * æ³¨æ„ï¼Œäº‹åŠ¡åŒæ­¥åœ¨PROPAGATION_NEVERèŒƒå›´å†…ä¸å¯ç”¨ã€‚ */ int PROPAGATION_NEVER = 5; /** * å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™è¡Œä¸ºç±»ä¼¼äºPROPAGATION_REQUIREDã€‚EJBä¸­æ²¡æœ‰ç±»ä¼¼çš„ç‰¹æ€§ã€‚ * æ³¨æ„:åµŒå¥—äº‹åŠ¡çš„å®é™…åˆ›å»ºåªèƒ½åœ¨ç‰¹å®šçš„äº‹åŠ¡ç®¡ç†å™¨ä¸Šå·¥ä½œã€‚å¼€ç®±å³ç”¨ï¼Œè¿™åªé€‚ç”¨äºJDBC org.springframework.jdbc.datasourceã€‚ * ä½¿ç”¨JDBC 3.0é©±åŠ¨ç¨‹åºæ—¶ä½¿ç”¨DataSourceTransactionManagerã€‚ä¸€äº›JTAæä¾›è€…å¯èƒ½ä¹Ÿæ”¯æŒåµŒå¥—äº‹åŠ¡ã€‚ * * @see org.springframework.jdbc.datasource.DataSourceTransactionManager */ int PROPAGATION_NESTED = 6; /** * ä½¿ç”¨åŸºç¡€æ•°æ®å­˜å‚¨çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚ * æ‰€æœ‰å…¶ä»–çº§åˆ«éƒ½å¯¹åº”JDBCéš”ç¦»çº§åˆ«ã€‚ * * @see java.sql.Connection */ int ISOLATION_DEFAULT = -1; /** * æŒ‡ç¤ºå¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»åƒè¯»ã€‚ * è¯¥çº§åˆ«å…è®¸ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹çš„è¡Œåœ¨è¯¥è¡Œçš„ä»»ä½•æ›´æ”¹æäº¤ä¹‹å‰è¢«å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–(â€œè„è¯»â€)ã€‚ * å¦‚æœä»»ä½•æ›´æ”¹è¢«å›æ»šï¼Œåˆ™ç¬¬äºŒä¸ªäº‹åŠ¡å°†æ£€ç´¢æ— æ•ˆçš„è¡Œã€‚ * * @see java.sql.Connection#TRANSACTION_READ_UNCOMMITTED */ int ISOLATION_READ_UNCOMMITTED = 1; // same as java.sql.Connection.TRANSACTION_READ_UNCOMMITTED; /** * æŒ‡ç¤ºé˜»æ­¢è„è¯»;ä¸å¯é‡å¤è¯»å–å’Œå¹»åƒè¯»å–å¯èƒ½ä¼šå‘ç”Ÿã€‚ * è¯¥çº§åˆ«ä»…ç¦æ­¢äº‹åŠ¡è¯»å–ä¸€è¡Œä¸­æœªæäº¤çš„æ›´æ”¹ã€‚ * * @see java.sql.Connection#TRANSACTION_READ_COMMITTED */ int ISOLATION_READ_COMMITTED = 2; // same as java.sql.Connection.TRANSACTION_READ_COMMITTED; /** * æŒ‡ç¤ºé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»;å¹»è¯»å¯èƒ½ä¼šå‘ç”Ÿã€‚ * è¯¥çº§åˆ«ç¦æ­¢äº‹åŠ¡è¯»å–æœªæäº¤æ›´æ”¹çš„è¡Œï¼Œä¹Ÿç¦æ­¢è¿™æ ·çš„æƒ…å†µ:ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€è¡Œï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¿®æ”¹è¯¥è¡Œï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡é‡æ–°è¯»å–è¯¥è¡Œï¼Œç¬¬äºŒæ¬¡è·å–ä¸åŒçš„å€¼(â€œä¸å¯é‡å¤è¯»å–â€)ã€‚ * * @see java.sql.Connection#TRANSACTION_REPEATABLE_READ */ int ISOLATION_REPEATABLE_READ = 4; // same as java.sql.Connection.TRANSACTION_REPEATABLE_READ; /** * æŒ‡ç¤ºé˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»åƒè¯»ã€‚ * è¿™ä¸ªæ°´å¹³è¿›ä¸€æ­¥åŒ…æ‹¬ISOLATION_REPEATABLE_READçš„ç¦ä»¤,ç¦æ­¢åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¯»å–æ‰€æœ‰è¡Œ,æ»¡è¶³æ¡ä»¶,ç¬¬äºŒä¸ªäº‹åŠ¡æ’å…¥ä¸€è¡Œ,æ»¡è¶³æ¡ä»¶,å’Œç¬¬ä¸€ä¸ªäº‹åŠ¡é‡æ–°è¯»å–ç›¸åŒçš„æ¡ä»¶ä¸‹,è·å–é¢å¤–çš„â€œå¹½çµâ€åœ¨ç¬¬äºŒè¡Œé˜…è¯»ã€‚ * * @see java.sql.Connection#TRANSACTION_SERIALIZABLE */ int ISOLATION_SERIALIZABLE = 8; // same as java.sql.Connection.TRANSACTION_SERIALIZABLE; /** * ä½¿ç”¨åŸºç¡€äº‹åŠ¡ç³»ç»Ÿçš„é»˜è®¤è¶…æ—¶ï¼Œå¦‚æœä¸æ”¯æŒè¶…æ—¶ï¼Œåˆ™ä¸ºnoneã€‚ * or none if timeouts are not supported. */ int TIMEOUT_DEFAULT = -1; /** * è¿”å›ä¼ æ’­è¡Œä¸ºã€‚ * å¿…é¡»è¿”å›è¯¥æ¥å£ä¸Šå®šä¹‰çš„PROPAGATION_XXXå¸¸é‡ä¹‹ä¸€ã€‚é»˜è®¤å€¼æ˜¯PROPAGATION_REQUIREDã€‚ * * @return the propagation behavior * @see #PROPAGATION_REQUIRED * @see org.springframework.transaction.support.TransactionSynchronizationManager#isActualTransactionActive() */ default int getPropagationBehavior() &#123; return PROPAGATION_REQUIRED; &#125; /** * è¿”å›éš”ç¦»çº§åˆ«ã€‚ * å¿…é¡»è¿”å›è¯¥æ¥å£ä¸­å®šä¹‰çš„ISOLATION_XXXå¸¸é‡ä¹‹ä¸€ã€‚è¿™äº›å¸¸é‡è¢«è®¾è®¡ä¸ºåŒ¹é…java.sql.Connectionä¸Šç›¸åŒå¸¸é‡çš„å€¼ã€‚ * ä¸“é—¨è®¾è®¡ç”¨äºä¸PROPAGATION_REQUIREDæˆ–PROPAGATION_REQUIRES_NEWä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒåªé€‚ç”¨äºæ–°å¯åŠ¨çš„äº‹åŠ¡ã€‚ * å¦‚æœæ‚¨å¸Œæœ›åœ¨å‚ä¸å…·æœ‰ä¸åŒéš”ç¦»çº§åˆ«çš„ç°æœ‰äº‹åŠ¡æ—¶æ‹’ç»éš”ç¦»çº§åˆ«å£°æ˜ï¼Œè¯·è€ƒè™‘å°†äº‹åŠ¡ç®¡ç†å™¨ä¸Šçš„â€œvalidateExistingTransactionsâ€æ ‡å¿—åˆ‡æ¢ä¸ºâ€œtrueâ€ã€‚ * é»˜è®¤å€¼ä¸ºISOLATION_DEFAULTã€‚è¯·æ³¨æ„ï¼Œä¸æ”¯æŒè‡ªå®šä¹‰éš”ç¦»çº§åˆ«çš„äº‹åŠ¡ç®¡ç†å™¨åœ¨ç»™å‡ºISOLATION_DEFAULTä»¥å¤–çš„ä»»ä½•å…¶ä»–çº§åˆ«æ—¶å°†æŠ›å‡ºå¼‚å¸¸ã€‚ * * @return the isolation level * @see #ISOLATION_DEFAULT * @see org.springframework.transaction.support.AbstractPlatformTransactionManager#setValidateExistingTransaction */ default int getIsolationLevel() &#123; return ISOLATION_DEFAULT; &#125; /** * è¿”å›äº‹åŠ¡è¶…æ—¶ã€‚ * å¿…é¡»è¿”å›ç§’æ•°ï¼Œæˆ–TIMEOUT_DEFAULTã€‚ * ä¸“é—¨è®¾è®¡ç”¨äºä¸PROPAGATION_REQUIREDæˆ–PROPAGATION_REQUIRES_NEWä¸€èµ·ä½¿ç”¨ï¼Œå› ä¸ºå®ƒåªé€‚ç”¨äºæ–°å¯åŠ¨çš„äº‹åŠ¡ã€‚ * è¯·æ³¨æ„ï¼Œä¸æ”¯æŒè¶…æ—¶çš„äº‹åŠ¡ç®¡ç†å™¨åœ¨ç»™å‡ºTIMEOUT_DEFAULTä»¥å¤–çš„ä»»ä½•è¶…æ—¶æ—¶å°†æŠ›å‡ºå¼‚å¸¸ã€‚ * * @return the transaction timeout */ default int getTimeout() &#123; return TIMEOUT_DEFAULT; &#125; /** * è¿”å›æ˜¯å¦ä¼˜åŒ–ä¸ºåªè¯»äº‹åŠ¡ã€‚ * åªè¯»æ ‡å¿—é€‚ç”¨äºä»»ä½•äº‹åŠ¡ä¸Šä¸‹æ–‡ï¼Œæ— è®ºæ˜¯ç”±å®é™…çš„èµ„æºäº‹åŠ¡(PROPAGATION_REQUIRED/ PROPAGATION_REQUIRES_NEW)æ”¯æŒï¼Œè¿˜æ˜¯åœ¨èµ„æºçº§åˆ«ä¸Šè¿›è¡Œéäº‹åŠ¡æ“ä½œ(PROPAGATION_SUPPORTS)ã€‚ * åœ¨åä¸€ç§æƒ…å†µä¸‹ï¼Œè¯¥æ ‡å¿—å°†åªåº”ç”¨äºåº”ç”¨ç¨‹åºä¸­çš„æ‰˜ç®¡èµ„æºï¼Œä¾‹å¦‚Hibernateä¼šè¯ã€‚ * è¿™åªæ˜¯ä½œä¸ºå®é™…äº‹åŠ¡å­ç³»ç»Ÿçš„æç¤º;å®ƒä¸ä¸€å®šä¼šå¯¼è‡´å†™è®¿é—®å°è¯•å¤±è´¥ã€‚ä¸èƒ½è§£é‡Šåªè¯»æç¤ºçš„äº‹åŠ¡ç®¡ç†å™¨åœ¨è¯·æ±‚åªè¯»äº‹åŠ¡æ—¶ä¸ä¼šæŠ›å‡ºå¼‚å¸¸ã€‚ * * @see org.springframework.transaction.support.TransactionSynchronization#beforeCommit(boolean) * @see org.springframework.transaction.support.TransactionSynchronizationManager#isCurrentTransactionReadOnly() */ default boolean isReadOnly() &#123; return false; &#125; /** * è¿”å›æ­¤äº‹åŠ¡çš„åç§°ã€‚å¯ä»¥ä¸ºç©ºã€‚ * è¿™å°†è¢«ç”¨ä½œäº‹åŠ¡ç›‘è§†å™¨ä¸­æ˜¾ç¤ºçš„äº‹åŠ¡åç§°(å¦‚æœé€‚ç”¨çš„è¯ï¼Œä¾‹å¦‚WebLogicçš„)ã€‚ * åœ¨Springçš„å£°æ˜æ€§äº‹åŠ¡ä¸­ï¼Œå…¬å¼€çš„åç§°å°†æ˜¯å®Œå…¨é™å®šçš„ç±»å+ &quot;ã€‚+æ–¹æ³•å(é»˜è®¤)ã€‚ * * @return the name of this transaction (&#123;@code null&#125; by default&#125; * @see org.springframework.transaction.interceptor.TransactionAspectSupport * @see org.springframework.transaction.support.TransactionSynchronizationManager#getCurrentTransactionName() */ @Nullable default String getName() &#123; return null; &#125; // Static builder methods /** * è¿”å›ä¸€ä¸ªä¸å¯ä¿®æ”¹çš„TransactionDefinitionå’Œé»˜è®¤å€¼ã€‚ * å‡ºäºå®šåˆ¶çš„ç›®çš„ï¼Œå¯ä»¥ä½¿ç”¨å¯ä¿®æ”¹çš„org.springframework.transaction.supportã€‚DefaultTransactionDefinitionä»£æ›¿ã€‚ * * @since 5.2 */ static TransactionDefinition withDefaults() &#123; return StaticTransactionDefinition.INSTANCE; &#125;&#125; æ€»ç»“ï¼š å…ˆç®€å•çš„å›é¡¾ä¸‹ï¼Œè„è¯»ã€å¹»è¯»ä¸ä¸å¯é‡å¤è¯»çš„åŸºæœ¬æ¦‚å¿µ è„è¯»ã€å¹»è¯»ä¸ä¸å¯é‡å¤è¯»è„è¯»ï¼šæŒ‡ä¸€ä¸ªäº‹åŠ¡ä¸­è®¿é—®åˆ°äº†å¦å¤–ä¸€ä¸ªäº‹åŠ¡æœªæäº¤çš„æ•°æ® ä¼šè¯1 ä¼šè¯2 begin begin update table set age = 10 where id = 1 select age from table where Id = 1 commit commit ä¼šè¯1å’Œä¼šè¯2ï¼ŒåŒæ—¶å¼€å¯äº‹åŠ¡ï¼Œåœ¨ä¼šè¯1æ‰§è¡ŒæŸ¥è¯¢ä¹‹å‰ï¼Œä¼šè¯2å¯¹idä¸º1çš„å¹´é¾„åšäº†ä¿®æ”¹ï¼Œå¯¼è‡´ä¼šè¯1åœ¨æŸ¥è¯¢idä¸º1çš„å¹´é¾„ä¸º10ï¼Œå…¶å®ä¼šè¯1æœŸæœ›æ‹¿åˆ°çš„æ˜¯ä¼šè¯2æ›´æ–°å‰çš„å€¼ï¼Œå¦‚æœä¼šè¯2å›æ»šäº‹åŠ¡ï¼Œåˆ™ä¼šè¯1æ‹¿åˆ°çš„ä»æ˜¯10ï¼Œè¿™å°±æ˜¯è„è¯» å¹»è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–2æ¬¡ï¼Œå¾—åˆ°çš„è®°å½•æ¡æ•°ä¸ä¸€è‡´ ä¼šè¯1 ä¼šè¯2 begin begin select age from table where Id &gt; 2 insert into table(id,age)values(5,10) Commit select age from table where Id &gt; 2 commit ä¼šè¯1äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œä¼šè¯2æ’å…¥äº†ä¸€ä¸ªå€¼ï¼Œå¯¼è‡´ä¸¤æ¬¡æŸ¥è¯¢çš„æ•°æ®ä¸ä¸€è‡´ ä¸å¯é‡å¤è¯»ï¼šä¸€ä¸ªäº‹åŠ¡è¯»å–åŒä¸€æ¡è®°å½•2æ¬¡ï¼Œå¾—åˆ°çš„ç»“æœä¸ä¸€è‡´ ä¼šè¯1 ä¼šè¯2 begin begin select age from table where Id = 1 update table set age = 10 where id = 1 commit select age from table where Id = 1 commit ä¼šè¯1äº‹åŠ¡è¿‡ç¨‹ä¸­ï¼Œä¼šè¯2æ›´æ–°äº†ä¸€ä¸ªå€¼ï¼Œå¯¼è‡´ä¸¤æ¬¡æŸ¥è¯¢çš„æ•°æ®ä¸ä¸€è‡´ å›åˆ°äº‹åŠ¡çš„æ€»ç»“ï¼š éš”ç¦»çº§åˆ« æè¿° ISOLATION_DEFAULT ä½¿ç”¨åŸºç¡€æ•°æ®å­˜å‚¨çš„é»˜è®¤éš”ç¦»çº§åˆ«ã€‚æ‰€æœ‰å…¶ä»–çº§åˆ«éƒ½å¯¹åº”JDBCéš”ç¦»çº§åˆ«ã€‚Mysql é»˜è®¤é‡‡ç”¨çš„ REPEATABLE_READéš”ç¦»çº§åˆ« Oracle é»˜è®¤é‡‡ç”¨çš„ READ_COMMITTEDéš”ç¦»çº§åˆ«. ISOLATION_READ_UNCOMMITTED æŒ‡ç¤ºå¯èƒ½å‘ç”Ÿè„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»åƒè¯»ã€‚è¯¥çº§åˆ«å…è®¸ä¸€ä¸ªäº‹åŠ¡ä¿®æ”¹çš„è¡Œåœ¨è¯¥è¡Œçš„ä»»ä½•æ›´æ”¹æäº¤ä¹‹å‰è¢«å¦ä¸€ä¸ªäº‹åŠ¡è¯»å–(â€œè„è¯»â€)ã€‚å¦‚æœä»»ä½•æ›´æ”¹è¢«å›æ»šï¼Œåˆ™ç¬¬äºŒä¸ªäº‹åŠ¡å°†æ£€ç´¢æ— æ•ˆçš„è¡Œã€‚ ISOLATION_READ_COMMITTED æŒ‡ç¤ºé˜»æ­¢è„è¯»;ä¸å¯é‡å¤è¯»å–å’Œå¹»åƒè¯»å–å¯èƒ½ä¼šå‘ç”Ÿã€‚è¯¥çº§åˆ«ä»…ç¦æ­¢äº‹åŠ¡è¯»å–ä¸€è¡Œä¸­æœªæäº¤çš„æ›´æ”¹ã€‚ ISOLATION_REPEATABLE_READ æŒ‡ç¤ºé˜²æ­¢è„è¯»å’Œä¸å¯é‡å¤è¯»;å¹»è¯»å¯èƒ½ä¼šå‘ç”Ÿã€‚è¯¥çº§åˆ«ç¦æ­¢äº‹åŠ¡è¯»å–æœªæäº¤æ›´æ”¹çš„è¡Œï¼Œä¹Ÿç¦æ­¢è¿™æ ·çš„æƒ…å†µ:ä¸€ä¸ªäº‹åŠ¡è¯»å–ä¸€è¡Œï¼Œç¬¬äºŒä¸ªäº‹åŠ¡ä¿®æ”¹è¯¥è¡Œï¼Œç¬¬ä¸€ä¸ªäº‹åŠ¡é‡æ–°è¯»å–è¯¥è¡Œï¼Œç¬¬äºŒæ¬¡è·å–ä¸åŒçš„å€¼(â€œä¸å¯é‡å¤è¯»å–â€)ã€‚ ISOLATION_SERIALIZABLE æŒ‡ç¤ºé˜²æ­¢è„è¯»ã€ä¸å¯é‡å¤è¯»å’Œå¹»åƒè¯»ã€‚è¿™ä¸ªæ°´å¹³è¿›ä¸€æ­¥åŒ…æ‹¬ISOLATION_REPEATABLE_READçš„ç¦ä»¤,ç¦æ­¢åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­è¯»å–æ‰€æœ‰è¡Œ,æ»¡è¶³æ¡ä»¶,ç¬¬äºŒä¸ªäº‹åŠ¡æ’å…¥ä¸€è¡Œ,æ»¡è¶³æ¡ä»¶,å’Œç¬¬ä¸€ä¸ªäº‹åŠ¡é‡æ–°è¯»å–ç›¸åŒçš„æ¡ä»¶ä¸‹,è·å–é¢å¤–çš„â€œå¹½çµâ€åœ¨ç¬¬äºŒè¡Œé˜…è¯»ã€‚ äº‹åŠ¡ä¼ æ’­è¡Œä¸º æè¿° PROPAGATION_REQUIRED æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚è¿™é€šå¸¸æ˜¯äº‹åŠ¡å®šä¹‰çš„é»˜è®¤è®¾ç½®ï¼Œé€šå¸¸å®šä¹‰äº‹åŠ¡åŒæ­¥èŒƒå›´ã€‚ PROPAGATION_SUPPORTS æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™ä»¥éäº‹åŠ¡æ–¹å¼æ‰§è¡Œã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ æ³¨æ„:å¯¹äºå…·æœ‰äº‹åŠ¡åŒæ­¥çš„äº‹åŠ¡ç®¡ç†å™¨ï¼ŒPROPAGATION_SUPPORTSä¸å®Œå…¨æ²¡æœ‰äº‹åŠ¡ç•¥æœ‰ä¸åŒï¼Œå› ä¸ºå®ƒå®šä¹‰äº†åŒæ­¥å¯èƒ½é€‚ç”¨çš„äº‹åŠ¡èŒƒå›´ã€‚ å› æ­¤ï¼Œç›¸åŒçš„èµ„æº(JDBCè¿æ¥ã€Hibernateä¼šè¯ç­‰)å°†åœ¨æ•´ä¸ªæŒ‡å®šèŒƒå›´å†…å…±äº«ã€‚è¯·æ³¨æ„ï¼Œç¡®åˆ‡çš„è¡Œä¸ºå–å†³äºäº‹åŠ¡ç®¡ç†å™¨çš„å®é™…åŒæ­¥é…ç½®! ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œè¯·å°å¿ƒä½¿ç”¨PROPAGATION_SUPPORTS!ç‰¹åˆ«åœ°ï¼Œä¸è¦ä¾èµ–äºPROPAGATION_REQUIREDæˆ–PROPAGATION_REQUIRES_NEWåœ¨PROPAGATION_SUPPORTSèŒƒå›´å†…(è¿™å¯èƒ½ä¼šå¯¼è‡´è¿è¡Œæ—¶çš„åŒæ­¥å†²çª)ã€‚ å¦‚æœè¿™ç§åµŒå¥—æ˜¯ä¸å¯é¿å…çš„ï¼Œè¯·ç¡®ä¿é€‚å½“åœ°é…ç½®äº‹åŠ¡ç®¡ç†å™¨(é€šå¸¸åˆ‡æ¢åˆ°â€œåœ¨å®é™…äº‹åŠ¡ä¸ŠåŒæ­¥â€)ã€‚ PROPAGATION_MANDATORY æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœå½“å‰æ²¡æœ‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ æ³¨æ„ï¼ŒPROPAGATION_MANDATORYèŒƒå›´å†…çš„äº‹åŠ¡åŒæ­¥å°†å§‹ç»ˆç”±å‘¨å›´çš„äº‹åŠ¡é©±åŠ¨ã€‚ PROPAGATION_REQUIRES_NEW ä¸æ”¯æŒå½“å‰äº‹åŠ¡;åˆ›å»ºä¸€ä¸ªæ–°äº‹åŠ¡ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡(å¦‚æœå­˜åœ¨çš„è¯)ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ æ³¨æ„:å®é™…çš„äº‹åŠ¡æŒ‚èµ·å¹¶ä¸ä¼šåœ¨æ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨ä¸Šå¼€ç®±å³ç”¨ã€‚è¿™å°¤å…¶é€‚ç”¨äºorg.springframework.transaction.jta.JtaTransactionManagerï¼Œ å®ƒéœ€è¦javax.transaction.TransactionManagerå¯ç”¨(åœ¨æ ‡å‡†Java EEä¸­æ˜¯ç‰¹å®šäºæœåŠ¡å™¨çš„)ã€‚ PROPAGATION_REQUIRES_NEWä½œç”¨åŸŸæ€»æ˜¯å®šä¹‰è‡ªå·±çš„äº‹åŠ¡åŒæ­¥ã€‚ç°æœ‰çš„åŒæ­¥å°†è¢«æŒ‚èµ·å¹¶é€‚å½“æ¢å¤ PROPAGATION_NOT_SUPPORTED ä¸æ”¯æŒå½“å‰äº‹åŠ¡;è€Œæ˜¯æ€»æ˜¯ä»¥éäº‹åŠ¡çš„æ–¹å¼æ‰§è¡Œã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ æ³¨æ„:å®é™…çš„äº‹åŠ¡æŒ‚èµ·å¹¶ä¸ä¼šåœ¨æ‰€æœ‰äº‹åŠ¡ç®¡ç†å™¨ä¸Šå¼€ç®±å³ç”¨ã€‚è¿™å°¤å…¶é€‚ç”¨äºorg.springframework.transaction.jta.JtaTransactionManagerï¼Œ å®ƒéœ€è¦javax.transaction.TransactionManagerå¯ç”¨(åœ¨æ ‡å‡†Java EEä¸­æ˜¯ç‰¹å®šäºæœåŠ¡å™¨çš„)ã€‚ æ³¨æ„ï¼Œäº‹åŠ¡åŒæ­¥åœ¨PROPAGATION_NOT_SUPPORTEDèŒƒå›´å†…ä¸å¯ç”¨ã€‚ç°æœ‰çš„åŒæ­¥å°†è¢«æŒ‚èµ·å¹¶é€‚å½“æ¢å¤ã€‚ PROPAGATION_NEVER ä¸æ”¯æŒå½“å‰äº‹åŠ¡;å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ã€‚ç±»ä¼¼äºåŒåçš„EJBäº‹åŠ¡å±æ€§ã€‚ æ³¨æ„ï¼Œäº‹åŠ¡åŒæ­¥åœ¨PROPAGATION_NEVERèŒƒå›´å†…ä¸å¯ç”¨ PROPAGATION_NESTED å¦‚æœå½“å‰äº‹åŠ¡å­˜åœ¨ï¼Œåˆ™åœ¨åµŒå¥—äº‹åŠ¡ä¸­æ‰§è¡Œï¼Œå¦åˆ™è¡Œä¸ºç±»ä¼¼äºPROPAGATION_REQUIREDã€‚EJBä¸­æ²¡æœ‰ç±»ä¼¼çš„ç‰¹æ€§ã€‚ æ³¨æ„:åµŒå¥—äº‹åŠ¡çš„å®é™…åˆ›å»ºåªèƒ½åœ¨ç‰¹å®šçš„äº‹åŠ¡ç®¡ç†å™¨ä¸Šå·¥ä½œã€‚å¼€ç®±å³ç”¨ï¼Œè¿™åªé€‚ç”¨äºJDBC org.springframework.jdbc.datasourceã€‚ ä½¿ç”¨JDBC 3.0é©±åŠ¨ç¨‹åºæ—¶ä½¿ç”¨DataSourceTransactionManagerã€‚ä¸€äº›JTAæä¾›è€…å¯èƒ½ä¹Ÿæ”¯æŒåµŒå¥—äº‹åŠ¡ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"}],"author":"wuxuan.chai"},{"title":"Springçš„Beançš„ç”Ÿå‘½å‘¨æœŸ","slug":"Springçš„Beançš„ç”Ÿå‘½å‘¨æœŸ","date":"2021-02-01T07:13:00.918Z","updated":"2021-02-02T03:22:57.647Z","comments":true,"path":"2021/02/01/Springçš„Beançš„ç”Ÿå‘½å‘¨æœŸ/","link":"","permalink":"https://cha1yi.github.io/dist/2021/02/01/Spring%E7%9A%84Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/","excerpt":"","text":"Springçš„Beançš„ç”Ÿå‘½å‘¨æœŸä¸€ã€ç”Ÿå‘½å‘¨æœŸæµç¨‹å›¾Spring bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸä»åˆ›å»ºSpringå®¹å™¨å¼€å§‹ï¼Œç›´åˆ°æœ€ç»ˆSpring å®¹å™¨é”€æ¯Beanï¼Œè¿™å…¶ä¸­åŒ…å«çš„ä¸€äº›äº†çš„å…³é”®ç‚¹ï¼ˆSpring Bean çš„ç”Ÿå‘½å‘¨æœŸï¼‰ åœ¨Springçš„5.xç‰ˆæœ¬ä¸­ï¼Œé€šè¿‡BeanFactoryçš„ç±»æ³¨é‡Šï¼Œå‘ç°ä»–å¯¹Spring Beanç”Ÿå‘½å‘¨æœŸåšäº†è¯¦ç»†çš„æè¿°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359package org.springframework.beans.factory;import org.springframework.beans.BeansException;import org.springframework.core.ResolvableType;import org.springframework.lang.Nullable;/** * The root interface for accessing a Spring bean container. * * &lt;p&gt;This is the basic client view of a bean container; * further interfaces such as &#123;@link ListableBeanFactory&#125; and * &#123;@link org.springframework.beans.factory.config.ConfigurableBeanFactory&#125; * are available for specific purposes. * * &lt;p&gt;This interface is implemented by objects that hold a number of bean definitions, * each uniquely identified by a String name. Depending on the bean definition, * the factory will return either an independent instance of a contained object * (the Prototype design pattern), or a single shared instance (a superior * alternative to the Singleton design pattern, in which the instance is a * singleton in the scope of the factory). Which type of instance will be returned * depends on the bean factory configuration: the API is the same. Since Spring * 2.0, further scopes are available depending on the concrete application * context (e.g. &quot;request&quot; and &quot;session&quot; scopes in a web environment). * * &lt;p&gt;The point of this approach is that the BeanFactory is a central registry * of application components, and centralizes configuration of application * components (no more do individual objects need to read properties files, * for example). See chapters 4 and 11 of &quot;Expert One-on-One J2EE Design and * Development&quot; for a discussion of the benefits of this approach. * * &lt;p&gt;Note that it is generally better to rely on Dependency Injection * (&quot;push&quot; configuration) to configure application objects through setters * or constructors, rather than use any form of &quot;pull&quot; configuration like a * BeanFactory lookup. Spring&#x27;s Dependency Injection functionality is * implemented using this BeanFactory interface and its subinterfaces. * * &lt;p&gt;Normally a BeanFactory will load bean definitions stored in a configuration * source (such as an XML document), and use the &#123;@code org.springframework.beans&#125; * package to configure the beans. However, an implementation could simply return * Java objects it creates as necessary directly in Java code. There are no * constraints on how the definitions could be stored: LDAP, RDBMS, XML, * properties file, etc. Implementations are encouraged to support references * amongst beans (Dependency Injection). * * &lt;p&gt;In contrast to the methods in &#123;@link ListableBeanFactory&#125;, all of the * operations in this interface will also check parent factories if this is a * &#123;@link HierarchicalBeanFactory&#125;. If a bean is not found in this factory instance, * the immediate parent factory will be asked. Beans in this factory instance * are supposed to override beans of the same name in any parent factory. * * &lt;p&gt;Bean factory implementations should support the standard bean lifecycle interfaces * as far as possible. The full set of initialization methods and their standard order is: * &lt;ol&gt; * &lt;li&gt;BeanNameAware&#x27;s &#123;@code setBeanName&#125; * &lt;li&gt;BeanClassLoaderAware&#x27;s &#123;@code setBeanClassLoader&#125; * &lt;li&gt;BeanFactoryAware&#x27;s &#123;@code setBeanFactory&#125; * &lt;li&gt;EnvironmentAware&#x27;s &#123;@code setEnvironment&#125; * &lt;li&gt;EmbeddedValueResolverAware&#x27;s &#123;@code setEmbeddedValueResolver&#125; * &lt;li&gt;ResourceLoaderAware&#x27;s &#123;@code setResourceLoader&#125; * (only applicable when running in an application context) * &lt;li&gt;ApplicationEventPublisherAware&#x27;s &#123;@code setApplicationEventPublisher&#125; * (only applicable when running in an application context) * &lt;li&gt;MessageSourceAware&#x27;s &#123;@code setMessageSource&#125; * (only applicable when running in an application context) * &lt;li&gt;ApplicationContextAware&#x27;s &#123;@code setApplicationContext&#125; * (only applicable when running in an application context) * &lt;li&gt;ServletContextAware&#x27;s &#123;@code setServletContext&#125; * (only applicable when running in a web application context) * &lt;li&gt;&#123;@code postProcessBeforeInitialization&#125; methods of BeanPostProcessors * &lt;li&gt;InitializingBean&#x27;s &#123;@code afterPropertiesSet&#125; * &lt;li&gt;a custom init-method definition * &lt;li&gt;&#123;@code postProcessAfterInitialization&#125; methods of BeanPostProcessors * &lt;/ol&gt; * * &lt;p&gt;On shutdown of a bean factory, the following lifecycle methods apply: * &lt;ol&gt; * &lt;li&gt;&#123;@code postProcessBeforeDestruction&#125; methods of DestructionAwareBeanPostProcessors * &lt;li&gt;DisposableBean&#x27;s &#123;@code destroy&#125; * &lt;li&gt;a custom destroy-method definition * &lt;/ol&gt; * * @author Rod Johnson * @author Juergen Hoeller * @author Chris Beams * @since 13 April 2001 * @see BeanNameAware#setBeanName * @see BeanClassLoaderAware#setBeanClassLoader * @see BeanFactoryAware#setBeanFactory * @see org.springframework.context.ResourceLoaderAware#setResourceLoader * @see org.springframework.context.ApplicationEventPublisherAware#setApplicationEventPublisher * @see org.springframework.context.MessageSourceAware#setMessageSource * @see org.springframework.context.ApplicationContextAware#setApplicationContext * @see org.springframework.web.context.ServletContextAware#setServletContext * @see org.springframework.beans.factory.config.BeanPostProcessor#postProcessBeforeInitialization * @see InitializingBean#afterPropertiesSet * @see org.springframework.beans.factory.support.RootBeanDefinition#getInitMethodName * @see org.springframework.beans.factory.config.BeanPostProcessor#postProcessAfterInitialization * @see DisposableBean#destroy * @see org.springframework.beans.factory.support.RootBeanDefinition#getDestroyMethodName */public interface BeanFactory &#123; /** * Used to dereference a &#123;@link FactoryBean&#125; instance and distinguish it from * beans &lt;i&gt;created&lt;/i&gt; by the FactoryBean. For example, if the bean named * &#123;@code myJndiObject&#125; is a FactoryBean, getting &#123;@code &amp;myJndiObject&#125; * will return the factory, not the instance returned by the factory. */ String FACTORY_BEAN_PREFIX = &quot;&amp;&quot;; /** * Return an instance, which may be shared or independent, of the specified bean. * &lt;p&gt;This method allows a Spring BeanFactory to be used as a replacement for the * Singleton or Prototype design pattern. Callers may retain references to * returned objects in the case of Singleton beans. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to retrieve * @return an instance of the bean * @throws NoSuchBeanDefinitionException if there is no bean with the specified name * @throws BeansException if the bean could not be obtained */ Object getBean(String name) throws BeansException; /** * Return an instance, which may be shared or independent, of the specified bean. * &lt;p&gt;Behaves the same as &#123;@link #getBean(String)&#125;, but provides a measure of type * safety by throwing a BeanNotOfRequiredTypeException if the bean is not of the * required type. This means that ClassCastException can&#x27;t be thrown on casting * the result correctly, as can happen with &#123;@link #getBean(String)&#125;. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to retrieve * @param requiredType type the bean must match; can be an interface or superclass * @return an instance of the bean * @throws NoSuchBeanDefinitionException if there is no such bean definition * @throws BeanNotOfRequiredTypeException if the bean is not of the required type * @throws BeansException if the bean could not be created */ &lt;T&gt; T getBean(String name, Class&lt;T&gt; requiredType) throws BeansException; /** * Return an instance, which may be shared or independent, of the specified bean. * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments, * overriding the specified default arguments (if any) in the bean definition. * @param name the name of the bean to retrieve * @param args arguments to use when creating a bean instance using explicit arguments * (only applied when creating a new instance as opposed to retrieving an existing one) * @return an instance of the bean * @throws NoSuchBeanDefinitionException if there is no such bean definition * @throws BeanDefinitionStoreException if arguments have been given but * the affected bean isn&#x27;t a prototype * @throws BeansException if the bean could not be created * @since 2.5 */ Object getBean(String name, Object... args) throws BeansException; /** * Return the bean instance that uniquely matches the given object type, if any. * &lt;p&gt;This method goes into &#123;@link ListableBeanFactory&#125; by-type lookup territory * but may also be translated into a conventional by-name lookup based on the name * of the given type. For more extensive retrieval operations across sets of beans, * use &#123;@link ListableBeanFactory&#125; and/or &#123;@link BeanFactoryUtils&#125;. * @param requiredType type the bean must match; can be an interface or superclass * @return an instance of the single bean matching the required type * @throws NoSuchBeanDefinitionException if no bean of the given type was found * @throws NoUniqueBeanDefinitionException if more than one bean of the given type was found * @throws BeansException if the bean could not be created * @since 3.0 * @see ListableBeanFactory */ &lt;T&gt; T getBean(Class&lt;T&gt; requiredType) throws BeansException; /** * Return an instance, which may be shared or independent, of the specified bean. * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments, * overriding the specified default arguments (if any) in the bean definition. * &lt;p&gt;This method goes into &#123;@link ListableBeanFactory&#125; by-type lookup territory * but may also be translated into a conventional by-name lookup based on the name * of the given type. For more extensive retrieval operations across sets of beans, * use &#123;@link ListableBeanFactory&#125; and/or &#123;@link BeanFactoryUtils&#125;. * @param requiredType type the bean must match; can be an interface or superclass * @param args arguments to use when creating a bean instance using explicit arguments * (only applied when creating a new instance as opposed to retrieving an existing one) * @return an instance of the bean * @throws NoSuchBeanDefinitionException if there is no such bean definition * @throws BeanDefinitionStoreException if arguments have been given but * the affected bean isn&#x27;t a prototype * @throws BeansException if the bean could not be created * @since 4.1 */ &lt;T&gt; T getBean(Class&lt;T&gt; requiredType, Object... args) throws BeansException; /** * Return a provider for the specified bean, allowing for lazy on-demand retrieval * of instances, including availability and uniqueness options. * @param requiredType type the bean must match; can be an interface or superclass * @return a corresponding provider handle * @since 5.1 * @see #getBeanProvider(ResolvableType) */ &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(Class&lt;T&gt; requiredType); /** * Return a provider for the specified bean, allowing for lazy on-demand retrieval * of instances, including availability and uniqueness options. * @param requiredType type the bean must match; can be a generic type declaration. * Note that collection types are not supported here, in contrast to reflective * injection points. For programmatically retrieving a list of beans matching a * specific type, specify the actual bean type as an argument here and subsequently * use &#123;@link ObjectProvider#orderedStream()&#125; or its lazy streaming/iteration options. * @return a corresponding provider handle * @since 5.1 * @see ObjectProvider#iterator() * @see ObjectProvider#stream() * @see ObjectProvider#orderedStream() */ &lt;T&gt; ObjectProvider&lt;T&gt; getBeanProvider(ResolvableType requiredType); /** * Does this bean factory contain a bean definition or externally registered singleton * instance with the given name? * &lt;p&gt;If the given name is an alias, it will be translated back to the corresponding * canonical bean name. * &lt;p&gt;If this factory is hierarchical, will ask any parent factory if the bean cannot * be found in this factory instance. * &lt;p&gt;If a bean definition or singleton instance matching the given name is found, * this method will return &#123;@code true&#125; whether the named bean definition is concrete * or abstract, lazy or eager, in scope or not. Therefore, note that a &#123;@code true&#125; * return value from this method does not necessarily indicate that &#123;@link #getBean&#125; * will be able to obtain an instance for the same name. * @param name the name of the bean to query * @return whether a bean with the given name is present */ boolean containsBean(String name); /** * Is this bean a shared singleton? That is, will &#123;@link #getBean&#125; always * return the same instance? * &lt;p&gt;Note: This method returning &#123;@code false&#125; does not clearly indicate * independent instances. It indicates non-singleton instances, which may correspond * to a scoped bean as well. Use the &#123;@link #isPrototype&#125; operation to explicitly * check for independent instances. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @return whether this bean corresponds to a singleton instance * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @see #getBean * @see #isPrototype */ boolean isSingleton(String name) throws NoSuchBeanDefinitionException; /** * Is this bean a prototype? That is, will &#123;@link #getBean&#125; always return * independent instances? * &lt;p&gt;Note: This method returning &#123;@code false&#125; does not clearly indicate * a singleton object. It indicates non-independent instances, which may correspond * to a scoped bean as well. Use the &#123;@link #isSingleton&#125; operation to explicitly * check for a shared singleton instance. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @return whether this bean will always deliver independent instances * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @since 2.0.3 * @see #getBean * @see #isSingleton */ boolean isPrototype(String name) throws NoSuchBeanDefinitionException; /** * Check whether the bean with the given name matches the specified type. * More specifically, check whether a &#123;@link #getBean&#125; call for the given name * would return an object that is assignable to the specified target type. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @param typeToMatch the type to match against (as a &#123;@code ResolvableType&#125;) * @return &#123;@code true&#125; if the bean type matches, * &#123;@code false&#125; if it doesn&#x27;t match or cannot be determined yet * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @since 4.2 * @see #getBean * @see #getType */ boolean isTypeMatch(String name, ResolvableType typeToMatch) throws NoSuchBeanDefinitionException; /** * Check whether the bean with the given name matches the specified type. * More specifically, check whether a &#123;@link #getBean&#125; call for the given name * would return an object that is assignable to the specified target type. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @param typeToMatch the type to match against (as a &#123;@code Class&#125;) * @return &#123;@code true&#125; if the bean type matches, * &#123;@code false&#125; if it doesn&#x27;t match or cannot be determined yet * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @since 2.0.1 * @see #getBean * @see #getType */ boolean isTypeMatch(String name, Class&lt;?&gt; typeToMatch) throws NoSuchBeanDefinitionException; /** * Determine the type of the bean with the given name. More specifically, * determine the type of object that &#123;@link #getBean&#125; would return for the given name. * &lt;p&gt;For a &#123;@link FactoryBean&#125;, return the type of object that the FactoryBean creates, * as exposed by &#123;@link FactoryBean#getObjectType()&#125;. This may lead to the initialization * of a previously uninitialized &#123;@code FactoryBean&#125; (see &#123;@link #getType(String, boolean)&#125;). * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @return the type of the bean, or &#123;@code null&#125; if not determinable * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @since 1.1.2 * @see #getBean * @see #isTypeMatch */ @Nullable Class&lt;?&gt; getType(String name) throws NoSuchBeanDefinitionException; /** * Determine the type of the bean with the given name. More specifically, * determine the type of object that &#123;@link #getBean&#125; would return for the given name. * &lt;p&gt;For a &#123;@link FactoryBean&#125;, return the type of object that the FactoryBean creates, * as exposed by &#123;@link FactoryBean#getObjectType()&#125;. Depending on the * &#123;@code allowFactoryBeanInit&#125; flag, this may lead to the initialization of a previously * uninitialized &#123;@code FactoryBean&#125; if no early type information is available. * &lt;p&gt;Translates aliases back to the corresponding canonical bean name. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the name of the bean to query * @param allowFactoryBeanInit whether a &#123;@code FactoryBean&#125; may get initialized * just for the purpose of determining its object type * @return the type of the bean, or &#123;@code null&#125; if not determinable * @throws NoSuchBeanDefinitionException if there is no bean with the given name * @since 5.2 * @see #getBean * @see #isTypeMatch */ @Nullable Class&lt;?&gt; getType(String name, boolean allowFactoryBeanInit) throws NoSuchBeanDefinitionException; /** * Return the aliases for the given bean name, if any. * &lt;p&gt;All of those aliases point to the same bean when used in a &#123;@link #getBean&#125; call. * &lt;p&gt;If the given name is an alias, the corresponding original bean name * and other aliases (if any) will be returned, with the original bean name * being the first element in the array. * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance. * @param name the bean name to check for aliases * @return the aliases, or an empty array if none * @see #getBean */ String[] getAliases(String name);&#125; å¯¹BeanFactoryçš„ç”Ÿå‘½å‘¨æœŸçš„å†…å®¹å¦‚ä¸‹ï¼š BeanFactoryæ˜¯è®¿é—®SpringBeanå®¹å™¨çš„å…¥å£ã€‚ è¿™æ˜¯SpringBeanå®¹å™¨çš„åŸºæœ¬å®¢æˆ·ç«¯è§†å›¾ï¼Œå…¶ä»–çš„æ¥å£å¦‚ListableBeanFactoryå’ŒConfigurableBeanFactoryæ˜¯ç”¨äºå…¶ä»–çš„ç‰¹æ®Šåœºæ™¯ è¿™ä¸ªæ¥å£æ˜¯ç”±åŒ…å«è®¸å¤šbeanå®šä¹‰çš„å¯¹è±¡å®ç°çš„ï¼Œæ¯ä¸ªbeanå®šä¹‰éƒ½ç”±ä¸€ä¸ªå­—ç¬¦ä¸²åç§°å”¯ä¸€æ ‡è¯†ã€‚æ ¹æ®beanå®šä¹‰ï¼Œå·¥å‚å°†è¿”å›åŒ…å«å¯¹è±¡çš„ç‹¬ç«‹å®ä¾‹(åŸå‹è®¾è®¡æ¨¡å¼)ï¼Œæˆ–è€…å•ä¸ªå…±äº«å®ä¾‹(å•ä¾‹è®¾è®¡æ¨¡å¼çš„ä¼˜è¶Šé€‰æ‹©ï¼Œåœ¨å•ä¾‹è®¾è®¡æ¨¡å¼ä¸­ï¼Œå®ä¾‹æ˜¯å·¥å‚èŒƒå›´å†…çš„å•ä¾‹)ã€‚è¿”å›å“ªç§ç±»å‹çš„å®ä¾‹å–å†³äºbeanå·¥å‚é…ç½®:APIæ˜¯ç›¸åŒçš„ã€‚è‡ªSpring 2.0ä»¥æ¥ï¼Œè¿›ä¸€æ­¥çš„ä½œç”¨åŸŸå–å†³äºå…·ä½“çš„åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡(ä¾‹å¦‚ã€‚webç¯å¢ƒä¸­çš„â€œè¯·æ±‚â€å’Œâ€œä¼šè¯â€ä½œç”¨åŸŸ)ã€‚ è¿™ç§æ–¹æ³•çš„è¦ç‚¹æ˜¯BeanFactoryæ˜¯åº”ç”¨ç¨‹åºç»„ä»¶çš„ä¸­å¿ƒæ³¨å†Œä¸­å¿ƒï¼Œå¹¶é›†ä¸­åº”ç”¨ç¨‹åºç»„ä»¶çš„é…ç½®(ä¾‹å¦‚ï¼Œå•ä¸ªå¯¹è±¡ä¸å†éœ€è¦è¯»å–å±æ€§æ–‡ä»¶)ã€‚æœ‰å…³è¿™ç§æ–¹æ³•çš„å¥½å¤„çš„è®¨è®ºï¼Œè¯·å‚é˜…â€œä¸“å®¶ä¸€å¯¹ä¸€J2EEè®¾è®¡å’Œå¼€å‘â€çš„ç¬¬4ç« å’Œç¬¬11ç« ã€‚ è¯·æ³¨æ„ï¼Œä¾èµ–ä¾èµ–æ³¨å…¥(â€œæ¨â€é…ç½®)é€šè¿‡setteræˆ–æ„é€ å‡½æ•°æ¥é…ç½®åº”ç”¨ç¨‹åºå¯¹è±¡é€šå¸¸æ¯”ä½¿ç”¨ä»»ä½•å½¢å¼çš„â€œæ‹‰â€é…ç½®(å¦‚BeanFactoryæŸ¥æ‰¾)æ›´å¥½ã€‚Springçš„ä¾èµ–é¡¹æ³¨å…¥åŠŸèƒ½æ˜¯ä½¿ç”¨è¿™ä¸ªBeanFactoryæ¥å£åŠå…¶å­æ¥å£æ¥å®ç°çš„ã€‚ é€šå¸¸ï¼ŒBeanFactoryå°†åŠ è½½å­˜å‚¨åœ¨é…ç½®æº(å¦‚XMLæ–‡æ¡£)ä¸­çš„beanå®šä¹‰ï¼Œå¹¶ä½¿ç”¨org.springframeworkã€‚é…ç½®beançš„beanåŒ…ã€‚ç„¶è€Œï¼Œå®ç°å¯ä»¥ç›´æ¥åœ¨Javaä»£ç ä¸­è¿”å›å®ƒåˆ›å»ºçš„å¿…è¦Javaå¯¹è±¡ã€‚å¯¹äºå¦‚ä½•å­˜å‚¨å®šä¹‰æ²¡æœ‰ä»»ä½•é™åˆ¶:LDAPã€RDBMSã€XMLã€å±æ€§æ–‡ä»¶ç­‰ç­‰ã€‚é¼“åŠ±å®ç°æ”¯æŒbeanä¹‹é—´çš„å¼•ç”¨(ä¾èµ–æ³¨å…¥)ã€‚ ä¸ListableBeanFactoryä¸­çš„æ–¹æ³•ç›¸æ¯”ï¼Œå¦‚æœè¿™æ˜¯ä¸€ä¸ªå±‚æ¬¡ç»“æ„çš„beanfactoryï¼Œé‚£ä¹ˆè¿™ä¸ªæ¥å£ä¸­çš„æ‰€æœ‰æ“ä½œéƒ½å°†æ£€æŸ¥çˆ¶å·¥å‚ã€‚å¦‚æœåœ¨è¿™ä¸ªå·¥å‚å®ä¾‹ä¸­æ‰¾ä¸åˆ°beanï¼Œå°†è¯¢é—®ç›´æ¥çš„çˆ¶å·¥å‚ã€‚è¿™ä¸ªå·¥å‚å®ä¾‹ä¸­çš„beanåº”è¯¥è¦†ç›–ä»»ä½•çˆ¶å·¥å‚ä¸­åŒåçš„bean Beanå·¥å‚å®ç°åº”è¯¥å°½å¯èƒ½æ”¯æŒæ ‡å‡†çš„Beanç”Ÿå‘½å‘¨æœŸæ¥å£ã€‚å®Œæ•´çš„åˆå§‹åŒ–æ–¹æ³•åŠå…¶æ ‡å‡†é¡ºåºæ˜¯: 1ã€BeanNameAwareçš„setBeanName2ã€BeanClassLoaderAwareçš„setBeanClassLoader3ã€BeanFactoryAwareçš„setBeanFactory4ã€EnvironmentAwareçš„setEnvironment5ã€EmbeddedValueResolverAwareçš„setEmbeddedValueResolver6ã€ResourceLoaderAwareçš„setResourceLoader(ä»…é€‚ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ—¶)7ã€ApplicationEventPublisherAwareçš„setApplicationEventPublisher(ä»…é€‚ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ—¶)8ã€MessageSourceAwareçš„setMessageSource(ä»…é€‚ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ—¶)9ã€ApplicationContextAwareçš„setApplicationContext(ä»…é€‚ç”¨äºåœ¨åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­è¿è¡Œæ—¶)10ã€ServletContextAwareçš„setServletContext(ä»…é€‚ç”¨äºè¿è¡Œåœ¨webåº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡)11ã€BeanPostProcessorsçš„postProcessBeforeInitializationæ–¹æ³•12ã€InitializingBeançš„afterPropertiesSet13ã€è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•å®šä¹‰14ã€BeanPostProcessorsçš„postProcessAfterInitializationæ–¹æ³• åœ¨å…³é—­beanå·¥å‚æ—¶ï¼Œåº”ç”¨ä»¥ä¸‹ç”Ÿå‘½å‘¨æœŸæ–¹æ³•: 1ã€DestructionAwareBeanPostProcessorsçš„æ–¹æ³•postProcessBeforeDestruction2ã€DisposableBeançš„é”€æ¯3ã€è‡ªå®šä¹‰çš„é”€æ¯æ–¹æ³•å®šä¹‰ é€šè¿‡ä»£ç è§‚å¯Ÿbeançš„åˆå§‹åŒ–æµç¨‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677package com.yidan.spring.bean.period;import org.springframework.beans.BeansException;import org.springframework.beans.factory.*;/** * @author wuxuan.chai * @date 2021/2/1 4:34 ä¸‹åˆ */public class MyBean implements BeanFactoryAware, BeanNameAware, InitializingBean, DisposableBean &#123; private BeanFactory beanFactory; private String beanName; private String service; private String user; @Override public void setBeanFactory(BeanFactory beanFactory) throws BeansException &#123; System.out.println(&quot;ã€BeanFactoryAwareæ¥å£ã€‘ è°ƒç”¨setBeanFactory&quot;); this.beanFactory = beanFactory; &#125; public MyBean() &#123; System.out.println(&quot;ã€æ„é€ å™¨ã€‘è°ƒç”¨beançš„æ„é€ å™¨å®ä¾‹åŒ–&quot;); &#125; @Override public void setBeanName(String name) &#123; System.out.println(&quot;ã€BeanNameAwareæ¥å£ã€‘è°ƒç”¨setBeanName&quot;); this.beanName = name; &#125; @Override public void destroy() throws Exception &#123; System.out.println(&quot;ã€DisposableBeanæ¥å£ã€‘è°ƒç”¨destroy&quot;); &#125; @Override public void afterPropertiesSet() throws Exception &#123; System.out.println(&quot;ã€InitializingBeanæ¥å£ã€‘è°ƒç”¨afterPropertiesSet&quot;); &#125; public BeanFactory getBeanFactory() &#123; return beanFactory; &#125; public String getBeanName() &#123; return beanName; &#125; public String getService() &#123; return service; &#125; public void setService(String service) &#123; System.out.println(&quot;ã€å±æ€§æ³¨å…¥ã€‘service&quot;); this.service = service; &#125; public String getUser() &#123; return user; &#125; public void setUser(String user) &#123; System.out.println(&quot;ã€å±æ€§æ³¨å…¥ã€‘user&quot;); this.user = user; &#125; public void myInit() &#123; System.out.println(&quot;ã€init-methodã€‘è°ƒç”¨&lt;bean&gt;çš„init-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•&quot;); &#125; public void myDestory() &#123; System.out.println(&quot;ã€destory-methodã€‘è°ƒç”¨&lt;bean&gt;çš„destory-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•&quot;); &#125;&#125; é…ç½®beançš„åˆå§‹åŒ–ï¼š 1234567891011121314151617181920package com.yidan.spring.bean.period;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * @author wuxuan.chai * @date 2021/2/2 10:29 ä¸Šåˆ */@Configurationpublic class BeanConfig &#123; @Bean(initMethod = &quot;myInit&quot;, destroyMethod = &quot;myDestory&quot;) public MyBean myBean() &#123; final MyBean myBean = new MyBean(); myBean.setService(&quot;well done&quot;); myBean.setUser(&quot;jack&quot;); return myBean; &#125;&#125; åˆå§‹åŒ–å®¹å™¨ï¼Œçœ‹æ‰“å°çš„æ—¥å¿—ï¼š 123456789101112131415161718192021222324252627282930 . ____ _ __ _ _ &#x2F;\\\\ &#x2F; ___&#39;_ __ _ _(_)_ __ __ _ \\ \\ \\ \\( ( )\\___ | &#39;_ | &#39;_| | &#39;_ \\&#x2F; _&#96; | \\ \\ \\ \\ \\\\&#x2F; ___)| |_)| | | | | || (_| | ) ) ) ) &#39; |____| .__|_| |_|_| |_\\__, | &#x2F; &#x2F; &#x2F; &#x2F; &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F; :: Spring Boot :: (v2.3.0.RELEASE)2021-02-02 11:20:54.928 INFO 10698 --- [ main] com.yidan.spring.bean.Application : Starting Application on chaiwuxuandeMacBook-Pro.local with PID 10698 (&#x2F;Users&#x2F;wuxuan.chai&#x2F;Documents&#x2F;project&#x2F;springboot-learn&#x2F;Spring-bean&#x2F;target&#x2F;classes started by wuxuan.chai in &#x2F;Users&#x2F;wuxuan.chai&#x2F;Documents&#x2F;project&#x2F;springboot-learn)2021-02-02 11:20:54.932 INFO 10698 --- [ main] com.yidan.spring.bean.Application : No active profile set, falling back to default profiles: default2021-02-02 11:20:56.030 INFO 10698 --- [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat initialized with port(s): 1314 (http)2021-02-02 11:20:56.041 INFO 10698 --- [ main] o.apache.catalina.core.StandardService : Starting service [Tomcat]2021-02-02 11:20:56.041 INFO 10698 --- [ main] org.apache.catalina.core.StandardEngine : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]2021-02-02 11:20:56.159 INFO 10698 --- [ main] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;] : Initializing Spring embedded WebApplicationContext2021-02-02 11:20:56.159 INFO 10698 --- [ main] o.s.web.context.ContextLoader : Root WebApplicationContext: initialization completed in 1181 msã€æ„é€ å™¨ã€‘è°ƒç”¨beançš„æ„é€ å™¨å®ä¾‹åŒ–ã€å±æ€§æ³¨å…¥ã€‘serviceã€å±æ€§æ³¨å…¥ã€‘userã€BeanNameAwareæ¥å£ã€‘è°ƒç”¨setBeanNameã€BeanFactoryAwareæ¥å£ã€‘ è°ƒç”¨setBeanFactoryã€InitializingBeanæ¥å£ã€‘è°ƒç”¨afterPropertiesSetã€init-methodã€‘è°ƒç”¨&lt;bean&gt;çš„init-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•2021-02-02 11:20:56.448 INFO 10698 --- [ main] o.s.s.concurrent.ThreadPoolTaskExecutor : Initializing ExecutorService &#39;applicationTaskExecutor&#39;2021-02-02 11:20:56.679 INFO 10698 --- [ main] o.s.b.w.embedded.tomcat.TomcatWebServer : Tomcat started on port(s): 1314 (http) with context path &#39;&#39;2021-02-02 11:20:56.690 INFO 10698 --- [ main] com.yidan.spring.bean.Application : Started Application in 2.127 seconds (JVM running for 2.751)Disconnected from the target VM, address: &#39;127.0.0.1:59808&#39;, transport: &#39;socket&#39;2021-02-02 11:20:58.684 INFO 10698 --- [extShutdownHook] o.s.s.concurrent.ThreadPoolTaskExecutor : Shutting down ExecutorService &#39;applicationTaskExecutor&#39;ã€DisposableBeanæ¥å£ã€‘è°ƒç”¨destroyã€destory-methodã€‘è°ƒç”¨&lt;bean&gt;çš„destory-methodå±æ€§æŒ‡å®šçš„åˆå§‹åŒ–æ–¹æ³•","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"}],"author":"wuxuan.chai"},{"title":"ç®—æ³•çš„æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦","slug":"ç®—æ³•çš„æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦","date":"2021-01-22T03:40:06.625Z","updated":"2021-01-27T06:10:03.044Z","comments":true,"path":"2021/01/22/ç®—æ³•çš„æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/22/%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/","excerpt":"","text":"ç®—æ³•çš„æ—¶é—´ä¸ç©ºé—´å¤æ‚åº¦åœ¨æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ï¼Œè¡¡é‡ç®—æ³•çš„æ€§èƒ½ï¼Œä¸€èˆ¬éƒ½æ˜¯é€šè¿‡æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦ä¸¤ä¸ªç»´åº¦å»æ¯”è¾ƒï¼Œæœ¬æ–‡å°±æ˜¯æ¢³ç†ä¸€ä¸‹æˆ‘ä»¬æ˜¯å¦‚ä½•è®¡ç®—æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦çš„ã€‚ æ—¶é—´å¤æ‚åº¦æ—¶é—´å¤æ‚åº¦ï¼šæŒ‡è¿è¡Œå½“å‰ç®—æ³•æ‰€æ¶ˆè€—çš„æ—¶é—´ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ã€æ—¶é—´å¤æ‚åº¦ã€‘æ¥æè¿°ã€‚ è¯´åˆ°æ—¶é—´å¤æ‚åº¦ï¼Œæˆ‘ä»¬ç¬¬ä¸€æ—¶é—´æƒ³åˆ°çš„è‚¯å®šæ˜¯ï¼Œç®—æ³•ä»æ‰§è¡Œå¼€å§‹åˆ°æ‰§è¡Œç»“æŸæ‰€ä½¿ç”¨çš„æ—¶é—´ã€‚è¿™ä¹ˆæƒ³å›ºç„¶æ˜¯å¯¹çš„ï¼Œä½†æ˜¯ä»”ç»†å“ï¼Œè¿˜æ˜¯æœ‰å¼Šç«¯çš„ã€‚ä¸åŒçš„æœºå™¨è¿è¡Œç›¸åŒçš„ä»£ç ï¼Œæ—¶é—´ä¼šå¤§ä¸ä¸€æ ·ï¼Œå–å†³äºæœºå™¨çš„CPUçš„æ‰§è¡Œè¿ç®—çš„æ•ˆç‡ã€‚å¦‚æœæœºå™¨ç›¸åŒï¼Œèµ„æºå¯¹ç­‰çš„æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è€ƒè™‘çš„å¯èƒ½å°±æ˜¯ä»£ç å±‚é¢çš„ä¸€äº›é—®é¢˜å°±ä¼šå¤šä¸€äº›ï¼Œæ­¤æ—¶æ—¶é—´å¤æ‚åº¦å°±æ˜¯ä¸€ä¸ªé‡è¦çš„è¯„åˆ¤æ ‡å‡†ã€‚ ä¸€èˆ¬æ—¶é—´å¤æ‚åº¦åˆ†ä¸ºï¼šO(1)ã€O(n)ã€O(mlogn)ã€O(nm) O(1)12345public void o1()&#123; int i = 10; i+=1; System.out.println(i);&#125; O(1)çš„æ—¶é—´å¤æ‚åº¦è¡¨ç¤ºï¼Œæ— è®ºä»£ç æ‰§è¡Œå¤šå°‘è¡Œï¼Œåªè¦æ²¡æœ‰å¾ªç¯ç»“æ„ï¼Œä»£ç çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸ºO(1)ã€‚å¦‚ä¸Šè¿°ä»£ç ï¼Œä»–æ‰§è¡Œçš„æ¶ˆè€—æ—¶é—´å’ŒæŸä¸ªå˜é‡çš„å¢é•¿æ˜¯æ²¡æœ‰å…³ç³»çš„ï¼Œæ—¶é—´å¤æ‚åº¦å§‹ç»ˆä¸ºO(1)ã€‚ O(n)1234567public void On()&#123; int n = 10; for (int i = 0; i &lt; n; i++) &#123; System.out.println(n); &#125;&#125; O(n)çš„æ—¶é—´å¤æ‚åº¦è¡¨ç¤ºï¼Œå½“nçš„å˜åŒ–ä¸º10æ—¶ï¼Œå¾ªç¯ä¼šæ‰§è¡Œåæ¬¡ï¼Œå³æ—¶é—´å¤æ‚åº¦æ—¶éšç€nçš„å˜åŒ–è€Œçº¿æ€§å˜åŒ–çš„ã€‚ O(log n)1234567public void logn() &#123; int i = 10; int j = 0; while (j &lt; i) &#123; j *= 2; &#125;&#125; åœ¨ä¸Šè¿°ä¾‹å­ä¸­ï¼Œæ¯æ¬¡å¾ªç¯ä¸­ï¼Œjçš„å€¼éƒ½ä¼šä¹˜ä»¥2(å¯ä»¥è®¤ä¸ºn)ï¼Œæ‰€ä»¥å½“å¾ªç¯mæ¬¡åjçš„å€¼å°±å¤§äºiäº†ï¼Œå¾ªç¯å°±é€€å‡ºäº†ï¼Œå› æ­¤æ—¶é—´å¤æ‚åº¦å°±ä¸º lognmï¼Œæ‰€ä»¥å¤æ‚åº¦ä¸€èˆ¬ç®€åŒ–ä¸ºlog n O(nm)1234567for (int i = 0; i &lt; n; i++) &#123; for (int i1 = 0; i1 &lt; n; i1++) &#123; j = i; j++; &#125;&#125; åœ¨ä¸Šè¿°ä¸­çš„ä¾‹å­ä¸­ï¼ŒåµŒå¥—äº†ä¸¤å±‚çš„nå¾ªç¯ï¼Œä»–çš„æ—¶é—´å¤æ‚åº¦å°±ä¸ºO(n*n), å³ä¸ºO(n2)ï¼Œå¦‚æœæœ‰må±‚åµŒå¥—ï¼Œé‚£ä¹ˆæ—¶é—´å¤æ‚åº¦ä¸ºO(nm) å¦‚æœä¸Šè¿°ä¾‹å­ä¸­ï¼Œå¦‚æœåµŒå¥—çš„å¾ªç¯æ—¶é—´å¤æ‚åº¦ä¸ºO(m),é‚£ä¹ˆæ•´ä½“æ—¶é—´å¤æ‚ä¸ºO(n*m)ã€‚ ç©ºé—´å¤æ‚åº¦ç©ºé—´å¤æ‚åº¦æ˜¯å¯¹ä¸€ä¸ªç®—æ³•åœ¨è¿è¡Œçš„è¿‡ç¨‹ä¸­å ç”¨å­˜å‚¨ç©ºé—´çš„ä¸€ä¸ªåº¦é‡æŒ‡æ ‡ï¼ŒåŒæ—¶ååº”å ç”¨ç©ºé—´çš„ä¸€ä¸ªè¶‹åŠ¿ã€‚ ç©ºé—´å¤æ‚åº¦æ¯”è¾ƒå¸¸ç”¨çš„æœ‰ï¼ŒO(1),O(n),O(n2) O(1)å¦‚æœç¨‹åºè¿è¡Œæ‰€éœ€çš„ä¸´æ—¶ç©ºé—´ä¸éšç€æŸä¸ªå˜é‡çš„å˜åŒ–è€Œå˜åŒ–ï¼Œé‚£ä¹ˆç®—æ³•çš„ç©ºé—´å¤æ‚åº¦ä¸ºä¸€ä¸ªå¸¸é‡ 12345int i = 1;int j = 1;++ i;j ++;int m = j + i; å¦‚ä¸Šè¿°çš„æè¿°ï¼Œæ‰§è¡Œæ‰€éœ€çš„ç©ºé—´å’Œiã€jã€mæ²¡æœ‰å…³ç³»ï¼Œæ‰€ä»¥ä»–çš„ç©ºé—´å¤æ‚åº¦ä¸ºO(1) O(n)12345int[] a &#x3D; new int[n];for (int i &#x3D; 0; i &lt; n; i++) &#123; a[i] &#x3D; i;&#125; ä¸Šè¿°çš„ä¾‹å­ä¸­ï¼Œæ•°ç»„açš„ç©ºé—´å’Œnçš„å€¼æˆçº¿æ€§å…³ç³»ï¼Œå³næœ‰å¤šå¤§ï¼Œæ•°ç»„å°±æœ‰å¤šé•¿ï¼Œæ‰€ä»¥å†…å­˜ç©ºé—´å’Œnæ˜¯æˆçº¿æ€§å…³ç³»ï¼Œæ‰€ä»¥ç©ºé—´å¤æ‚åº¦ä¸ºO(n) O(nm)1234567int[] a = new int[n];for (int i = 0; i &lt; n; i++) &#123; for (int ii = 0; i &lt; n; i++) &#123; a[i] = ii; &#125;&#125; ä¸Šè¿°ä¾‹å­ä¸­ï¼ŒåŒå±‚å¾ªç¯ä¸­æ•°ç»„çš„é•¿åº¦å’Œnã€ä»¥åŠå¾ªç¯çš„åµŒå¥—å±‚mæ•°æœ‰å…³ï¼Œæ‰€ä»¥å†…å­˜ç©ºé—´å’Œnã€mçš„å…³ç³»ä¸ºnm,å…¶ç©ºé—´å¤æ‚åº¦ä¸ºï¼šO(nm) æ€»ç»“è¿™é‡Œå€¼æ˜¯ç½—åˆ—åŸºæœ¬çš„æ¦‚å¿µï¼Œå…·ä½“çš„ç®—æ³•å¤æ‚åº¦è®¡ç®—å¤§è‡´å¯ä»¥å‚è€ƒè¿™ä¸ªæ€è·¯å»æ¨æ–­ã€‚å¯èƒ½å­˜åœ¨è¯¯è§£ï¼Œåç»­å­¦ä¹ å†åšæ”¹æ­£ã€‚","categories":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/categories/%E7%AE%97%E6%B3%95/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/tags/%E7%AE%97%E6%B3%95/"}],"author":"wuxuan.chai"},{"title":"GreenPlumçš„ç™¾åˆ†ä½æ•°çš„å®ç°","slug":"GPçš„ç™¾åˆ†ä½æ•°çš„å®ç°","date":"2021-01-20T03:11:37.157Z","updated":"2021-01-20T03:12:53.110Z","comments":true,"path":"2021/01/20/GPçš„ç™¾åˆ†ä½æ•°çš„å®ç°/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/20/GP%E7%9A%84%E7%99%BE%E5%88%86%E4%BD%8D%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/","excerpt":"","text":"GreenPlumçš„ç™¾åˆ†ä½æ•°çš„å®ç°ä¸€ã€è®¡ç®—å…¬å¼ äºŒã€å®ç°æ€è·¯è®¡ç®—ç™¾åˆ†ä½æ•°1ã€ç¡®å®šæ•°ç»„ å¦‚ä¸‹æ•°ç»„ï¼š 3710 3755 3850 3880 3880 3890 3920 3940 3950 4050 4130 4325 1 2 3 4 5 6 7 8 9 10 11 12 2ã€ç¡®å®šæ•°ç»„åœ¨æœ‰åºåºåˆ—ä¸­çš„ä½ç½® 3ã€æ ¹æ®å…¬å¼ï¼Œè®¡ç®—ç™¾åˆ†ä½æ•°æ‰€åœ¨çš„ä½ç½® $$Lp = (n +1)p/100$$å…¬å¼æè¿°ï¼š pè¡¨ç¤ºç™¾åˆ†æ•° nè¡¨ç¤ºæ•°ç»„çš„é•¿åº¦ 4ã€æ ¹æ®å…¬å¼ï¼Œè®¡ç®—ç™¾åˆ†æ•°$$R= Array[Floor(Lp)] + (Lp-Floor(Lp))*(Array[Ceil(Lp)]-Array[Floor(Lp)])$$å…¬å¼æè¿°ï¼š Array[N] è¡¨ç¤ºæ•°ç»„ä¸­ä½ç½®ä½Nçš„å…ƒç´  Floor[N] è¡¨ç¤ºå‘é›¶å–æ•´ Ceil[N] è¡¨ç¤ºèƒŒé›¶å–æ•´ Lp è¡¨ç¤ºç™¾åˆ†æ•°æ‰€åœ¨çš„ä½ç½® è®¡ç®—ç™¾åˆ†ä½1ã€ç¡®å®šå…ƒç´ åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼ˆIï¼‰ 2ã€æ•°ç»„çš„é•¿åº¦è¡¨ç¤ºä¸ºï¼ŒL$$R = 100I/ï¼ˆL+1ï¼‰$$ ä¸‰ã€PSqlå»å®ç°è¿™ä¸ªé€»è¾‘è®¡ç®—ç™¾åˆ†ä½æ•°1ã€å‡†å¤‡æ•°æ® 12345678910111213141516171819202122CREATE TABLE &quot;persent_table&quot; ( &quot;keyword&quot; varchar(255) COLLATE &quot;pg_catalog&quot;.&quot;default&quot;, &quot;play_count&quot; float8);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 9.2);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 7.5);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 7.5);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 22);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 50.1);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;lol&#x27;, 6.2);INSERT INTO &quot;persent_table&quot; VALUES (&#x27;lol&#x27;, 9.8);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 223.5);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 208.7);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 122.9);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 68.4);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 49.6);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 47.3);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 43);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 42.4);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 41.6);INSERT INTO &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) VALUES (&#x27;è‹±é›„è”ç›Ÿæ‰‹æ¸¸&#x27;, 37); 2ã€ç¡®å®šæ•°ç»„å’Œæ¯ä¸€ä¸ªæ•°ç»„çš„ä½ç½® å°†æ•°æ®æŒ‰ç…§keyworldåˆ†ç»„æ ¹æ®play_countçš„å€¼ä»å°åˆ°å¤§æ’åˆ— 12345SELECT ROW_NUMBER() OVER ( PARTITION BY t1.keyword ORDER BY t1.play_count ASC ) AS seq, * FROM persent_table t1 ç»“æœï¼š 3ã€è®¡ç®—ç™¾åˆ†ä½æ•°æ‰€åœ¨çš„ä½ç½®ï¼Œä¾‹å­ä¸­ä½¿ç”¨50ç™¾åˆ†ä½ 12345678910SELECT keyword, 0.5 * ( COUNT ( 1 ) + 1 ) AS number_index, FLOOR (0.5 * ( COUNT ( 1 ) + 1 )) AS min_value, CEIL (0.5 * ( COUNT ( 1 ) + 1 )) AS max_value FROM persent_table WHERE play_count IS NOT NULL GROUP BY keyword ç»“æœï¼š ç»“æœå­—æ®µè§£é‡Šï¼š number_index: è¡¨ç¤º50ç™¾åˆ†ä½æ‰€å¯¹åº”çš„æ•°å€¼æ‰€åœ¨æ•°ç»„ä¸­çš„ä½ç½® min_value/max_value:è¡¨ç¤º50ç™¾åˆ†ä½æ‰€å¯¹åº”çš„æ•°å€¼æ‰€åœ¨çš„å®é™…æ•°ç»„å…ƒç´ æ‰€åœ¨çš„åŒºé—´ å¦‚ï¼š keywordä¸ºâ€lolâ€æ‰€å¯¹åº”çš„play_countçš„æ•°ç»„ä¸­50ç™¾åˆ†ä½æ•°ä½ç½®ä¸º4 keywordä¸ºâ€œè‹±é›„è”ç›Ÿæ‰‹æ¸¸â€œæ‰€å¯¹åº”çš„play_countçš„æ•°ç»„ä¸­50ç™¾åˆ†ä½æ•°ä½ç½®ä¸º5å’Œ6ä¹‹é—´ 4ã€æ ¹æ®å…¬å¼ï¼Œè®¡ç®—ç™¾åˆ†æ•° 123456789101112131415161718192021SELECT t3.keyword, (t2.number_index - FLOOR ( t2.number_index )) * (MAX ( t3.play_count ) - MIN ( t3.play_count )) + MIN ( t3.play_count ) AS persent_val FROM ( SELECT ROW_NUMBER () OVER ( PARTITION BY t1.keyword ORDER BY t1.play_count ASC ) AS seq,* FROM persent_table t1 ) t3 INNER JOIN ( SELECT keyword, 0.5 * ( COUNT ( 1 ) + 1 ) AS number_index, FLOOR (0.5 * ( COUNT ( 1 ) + 1 )) AS min_value, CEIL (0.5 * ( COUNT ( 1 ) + 1 )) AS max_value FROM persent_table WHERE play_count IS NOT NULL GROUP BY keyword ) t2 ON t3.keyword = t2.keyword AND ( seq = max_value OR seq = min_value ) GROUP BY t3.keyword, t2.number_index; ç»“æœï¼š å’Œæ­¥éª¤2ä¸­çš„æ•°æ®å¯¹æ¯”ï¼š lolçš„seq = 4çš„play_count = 9.2 è‹±é›„è”ç›Ÿæ‰‹æ¸¸ çš„ 5&lt; seq &lt; 6 çš„play_count å€¼åŒºé—´ä¸ºï¼š47.3 ï½ 49.6 ç”¨å…¬å¼éªŒè¯ 47.3 + 0.5*ï¼ˆ49.6 - 47.3ï¼‰= 48.45 è®¡ç®—ç™¾åˆ†ä½1ã€æ±‚åˆ†ç»„ä¸‹çš„æ•°ç»„é•¿åº¦ 123456789SELECT keyword, COUNT ( 1 ) AS count_val FROM persent_table WHERE play_count IS NOT NULL GROUP BY keyword ç»“æœï¼š 2ã€è®¡ç®—æ¯ä¸ªæ•°ç»„å…ƒç´ æ‰€åœ¨çš„ä½ç½®çš„ç™¾åˆ†ä½ 123456SELECT t1.keyword, 100 * (ROW_NUMBER () OVER ( PARTITION BY t1.keyword ORDER BY t1.play_count DESC )) / ( t2.count_val + 1 ) AS persent FROM persent_table t1 LEFT JOIN ( SELECT keyword, COUNT ( 1 ) AS count_val FROM persent_table WHERE play_count IS NOT NULL GROUP BY keyword ) t2 ON t1.keyword = t2.keyword ç»“æœï¼š å’Œè®¡ç®—ç™¾åˆ†ä½æ•°è¿›è¡Œå¯¹æ¯”ï¼šå¾ˆæ˜æ˜¾å‘ç°lolçš„ä½ç½®ä¸º4çš„ç™¾åˆ†ä½ä¸º50","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/tags/%E7%AE%97%E6%B3%95/"},{"name":"SQL","slug":"SQL","permalink":"https://cha1yi.github.io/dist/tags/SQL/"}],"author":"wuxuan.chai"},{"title":"Javaçš„ä½è¿ç®—","slug":"javaçš„ä½è¿ç®—","date":"2021-01-19T08:37:39.865Z","updated":"2021-01-22T01:48:01.263Z","comments":true,"path":"2021/01/19/javaçš„ä½è¿ç®—/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/19/java%E7%9A%84%E4%BD%8D%E8%BF%90%E7%AE%97/","excerpt":"","text":"Javaçš„ä½è¿ç®—åŸºç¡€æ¦‚å¿µä½ï¼šè¡¨ç¤ºäºŒè¿›åˆ¶ä½ã€‚æ˜¯äºŒè¿›åˆ¶è®¡æ•°ç³»ç»Ÿä¸­ç”¨æ¥è¡¨ç¤ºå°äº2çš„æ•´æ•°ï¼Œä¸€èˆ¬ç”¨0æˆ–è€…1è¡¨ç¤ºï¼Œæ˜¯å…·æœ‰ç›¸ç­‰æ¦‚ç‡çš„ä¸¤ç§çŠ¶æ€çš„ä¸€ç§ï¼ŒäºŒè¿›åˆ¶ä½çš„ä½æ•°å¯ä»¥è¡¨ç¤ºä¸€ä¸ªæœºå™¨å­—çš„å­—é•¿ï¼Œä¸€ä¸ªäºŒè¿›åˆ¶åŒ…å«çš„ä¿¡æ¯é‡ç§°ä¹‹ä¸º1bitã€‚ åŸç ï¼šäºŒè¿›åˆ¶çš„å®šç‚¹è¡¨ç¤ºæ³•ï¼Œå³é«˜ä½ä¸ºç¬¦å·ä½ï¼Œâ€™0â€™ è¡¨ç¤ºä¸ºæ­£ï¼Œâ€™1â€™ è¡¨ç¤ºä¸ºè´Ÿï¼Œå…¶ä½™ä½è¡¨ç¤ºæ•°å€¼å¤§å°ã€‚ åç ï¼šæ­£æ•°çš„åç ä¸å…¶åŸç ç›¸åŒï¼›è´Ÿæ•°çš„åç æ˜¯å¯¹æ­£æ•°é€ä½å–åï¼Œç¬¦å·ä½ä¿æŒä¸º1ã€‚ è¡¥ç ï¼šæ­£æ•°çš„è¡¥ç ä¸å…¶åŸç ç›¸åŒï¼Œè´Ÿæ•°ä½çš„è¡¥ç æ˜¯åœ¨å…¶åç çš„æœ«ä½åŠ 1ã€‚ Practiceä¸ºä»€ä¹ˆjavaä¸­çš„intç±»å‹çš„å€¼å–å€¼èŒƒå›´ä¸ºï¼š-231 ~ 231-1 ï¼Ÿ Integerå ç”¨4byteï¼Œ1byteå ç”¨8bitï¼šæœ€å¤§çš„æ­£æ•°åŸç ï¼š01111111 11111111 11111111 11111111æœ€å°çš„è´Ÿæ•°åŸç ï¼š10000000 00000000 00000000 00000000è®¡ç®—æœºå­˜ä½¿ç”¨çš„éƒ½æ˜¯è¡¥ç ï¼šæœ€å¤§çš„æ­£æ•°çš„è¡¥ç ï¼š01111111 11111111 11111111 11111111 -&gt; 231-1æœ€å¤§çš„è´Ÿæ•°çš„è¡¥ç ï¼š11111111 11111111 11111111 11111111 +1 -&gt; -231-1 + 1 = -231 åŸç ã€åç ã€è¡¥ç çš„äº§ç”Ÿã€ä»¥åŠåº”ç”¨åœ¨è‡ªç„¶ç•Œä¸­ï¼Œæˆ‘ä»¬è®¡æ•°ä¸€èˆ¬éƒ½æ˜¯ä»æ­£æ•°è®¡æ•°ï¼Œæ¯”å¦‚ã€ä¸€æ£µæ ‘ã€ä¸¤å¤´ç‰›ã€ä¸‰åªç¾Šâ€¦.ä¸å­˜åœ¨è´Ÿä¸€æ£µæ ‘ã€è´Ÿä¸¤å¤´ç‰›ã€è´Ÿä¸‰åªç¾Šâ€¦éƒ½æ˜¯æˆ‘ä»¬åœ¨ç”Ÿäº§ç”Ÿæ´»ä¸­ï¼ŒåŠ å…¥äº†ç»Ÿè®¡ä¹‹åæ‰å¼•å…¥äº†è´Ÿçš„æ¦‚å¿µã€‚ åœ¨ä¸Šé¢æˆ‘ä»¬äº†è§£åˆ°ï¼Œæ­£æ•°çš„åŸç ã€åç ã€è¡¥ç éƒ½æ˜¯ç›¸åŒçš„ï¼Œè€Œè´Ÿæ•°çš„åç æ˜¯åŸç çš„å–åï¼Œè¡¥ç æ˜¯åç +1ã€‚æ˜¯ä¸æ˜¯è§‰å¾—åç æ˜¯é’ˆå¯¹è´Ÿæ•°è®¾è®¡çš„å‘¢ï¼Ÿå“ˆå“ˆã€‚ã€‚ åœ¨è®¡ç®—æœºä¸­å¦‚ä½•å¤„ç† -7 + 7 = 0çš„è®¡ç®—å‘¢ï¼Ÿ ä»¥4BITçš„æ•°ä¸ºä¾‹ï¼Œé«˜ä½ä½œä¸ºç¬¦å·ä½ï¼š å¦‚æœä»åŸç çš„è§’åº¦-&gt; -7ï¼š 1111 7ï¼š 0111 å¦‚æœæ‹¿åŸç åšåŠ æ³•è®¡ç®—çš„è¯ï¼š 1 0110 é«˜ä½èˆå»-&gt; 0110 = 6 ç»“æœå¾ˆæ˜¾ç„¶é”™äº†ï¼ å¦‚æœä»åç çš„è§’åº¦-&gt; -7: 1000 7: 0111 å¦‚æœæ‹¿åç åšåŠ æ³•è®¡ç®—çš„è¯ï¼š 1111 = -7 ç»“æœå¾ˆæ˜¾ç„¶ä¹Ÿæ˜¯é”™çš„ï¼ å¦‚æœä»è¡¥ç çš„è§’åº¦-&gt; -7: 1001 7: 0111 å¦‚æœæ‹¿è¡¥ç åšåŠ æ³•è®¡ç®—çš„è¯ï¼š 1 0000 ä¸¢åˆ°é«˜ä½çš„ç¬¦å·ä½ï¼Œç»“æœä¸º0 çœ‹ç»“æœå°±æ˜¯è¿™ä¹ˆå·§åˆï¼ï¼ï¼ ç»¼ä¸Šï¼Œè¡¥ç æ˜¯åšåŠ å‡æ³•æœ€å¥½çš„é€‰æ‹©ã€‚ è¯´åˆ°ç°åœ¨ï¼Œæ˜¯ä¸æ˜¯è§‰å¾—è¡¥ç å°±æ˜¯ä¸ºäº†è®¡ç®—è€Œè®¾è®¡çš„å‘¢ï¼Ÿå“ˆå“ˆã€‚ã€‚ã€‚ ä½è¿ç®—å…³äºä½è¿ç®—ï¼Œè¿™é‡Œè¿ç”¨å“²å­¦ä¸Šä¸‰ä¸ªç©¶æé—®é¢˜è¯•å›¾è®²è§£æ¸…æ¥šä½è¿ç®—ç©¶ç«Ÿæ˜¯ä½•æ–¹ç¥åœ£ï¼šä»€ä¹ˆæ˜¯ä½è¿ç®—ï¼Ÿä½è¿ç®—çš„ä½œç”¨ï¼Ÿä½è¿ç®—æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ ä»€ä¹ˆæ˜¯ä½è¿ç®—ï¼Ÿç¨‹åºä¸­çš„æ‰€æœ‰æ•°åœ¨è®¡ç®—æœºå†…å­˜ä¸­éƒ½æ˜¯ä»¥äºŒè¿›åˆ¶çš„å½¢å¼å‚¨å­˜çš„ã€‚ä½è¿ç®—å°±æ˜¯ç›´æ¥å¯¹æ•´æ•°åœ¨å†…å­˜ä¸­çš„äºŒè¿›åˆ¶ä½è¿›è¡Œæ“ä½œã€‚æ¯”å¦‚ï¼Œandè¿ç®—æœ¬æ¥æ˜¯ä¸€ä¸ªé€»è¾‘è¿ç®—ç¬¦ï¼Œä½†æ•´æ•°ä¸æ•´æ•°ä¹‹é—´ä¹Ÿå¯ä»¥è¿›è¡Œandè¿ç®—ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ6çš„äºŒè¿›åˆ¶æ˜¯110ï¼Œ11çš„äºŒè¿›åˆ¶æ˜¯1011ï¼Œé‚£ä¹ˆ6 and 11çš„ç»“æœå°±æ˜¯2ï¼Œå®ƒæ˜¯äºŒè¿›åˆ¶å¯¹åº”ä½è¿›è¡Œé€»è¾‘è¿ç®—çš„ç»“æœï¼ˆ0è¡¨ç¤ºFalseï¼Œ1è¡¨ç¤ºTrueï¼Œç©ºä½éƒ½å½“0å¤„ç†ï¼‰ã€‚ä¸‹è¡¨åˆ—å‡ºäº†ä½è¿ç®—ç¬¦çš„åŸºæœ¬è¿ç®—:å‡è®¾ï¼šä¸¤ä¸ª4bitçš„æ•°ï¼Œé«˜ä½è¡¨ç¤ºç¬¦å·ä½ï¼ŒA=3ï¼ŒB=7bit(A)= 0011 bit(B)= 0111 è¿ç®—ç¬¦ æè¿° ä¾‹å­ æŒ‰ä½ä¸ï¼ˆ&amp;ï¼‰ å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯1ï¼Œåˆ™ç»“æœä¸º1ï¼Œå¦åˆ™ä¸º0 A&amp;B=3ï¼Œå³ 0011 æŒ‰ä½æˆ–ï¼ˆï½œï¼‰ å¦‚æœç›¸å¯¹åº”ä½éƒ½æ˜¯0ï¼Œåˆ™ç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1 A|B=7, å³ 0111 æŒ‰ä½å¼‚æˆ–ï¼ˆ^ï¼‰ å¦‚æœç›¸å¯¹åº”ä½å€¼ç›¸åŒï¼Œåˆ™ç»“æœä¸º0ï¼Œå¦åˆ™ä¸º1 A^B= 4, å³ 0100 æŒ‰ä½å–åï¼ˆ~ï¼‰ æŒ‰ä½å–åè¿ç®—ç¬¦ç¿»è½¬æ“ä½œæ•°çš„æ¯ä¸€ä½ï¼Œå³0å˜æˆ1ï¼Œ1å˜æˆ0 ~A=-4, å³ 1100 å·¦ç§» ï¼ˆ&lt;&lt;ï¼‰ æŒ‰ä½å·¦ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å·¦ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•° A&lt;&lt;2=-4, å³ 1100 å³ç§» ï¼ˆ&gt;&gt;ï¼‰ æŒ‰ä½å³ç§»è¿ç®—ç¬¦ã€‚å·¦æ“ä½œæ•°æŒ‰ä½å³ç§»å³æ“ä½œæ•°æŒ‡å®šçš„ä½æ•° B&gt;&gt;2=1, å³0001 ä½è¿ç®—çš„ä½œç”¨ï¼Ÿä½è¿ç®—å…¶å®åœ¨æˆ‘ä»¬æ—¥å¸¸å¼€å‘è¿‡ç¨‹ä¸­ç»å¸¸ä¼šå¿½ç•¥æ‰ï¼Œå› ä¸ºæˆ‘ä»¬ä¹ æƒ¯äº†ä½¿ç”¨intæˆ–è€…longå€¼è¿›è¡Œè®¡ç®—ï¼Œè€Œå¿½ç•¥äº†åº•å±‚çš„è®¡ç®—é€»è¾‘ã€‚æ‰¾ä¸€ä¸ªä½¿ç”¨äº†ä½è¿ç®—çš„ä»£ç ç ”ç©¶ä¸‹ï¼šcopyè‡ªjava.long.Integerçš„é™æ€æ–¹æ³• 12345678910111213141516171819/** * è¿”å›ä¸€ä¸ªintå€¼ï¼Œæœ€å¤šä¸€ä¸ª1ä½ï¼Œä½äºæŒ‡å®šintå€¼çš„æœ€é«˜(&quot;æœ€å·¦&quot;)1ä½çš„ä½ç½®ã€‚å¦‚æœæŒ‡å®šçš„å€¼åœ¨å…¶2çš„è¡¥ç äºŒè¿›åˆ¶è¡¨ç¤ºä¸­æ²¡æœ‰1ä½ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœå®ƒç­‰äº0ï¼Œåˆ™è¿”å›0ã€‚. * * @param i the value whose highest one bit is to be computed * @return an &#123;@code int&#125; value with a single one-bit, in the position * of the highest-order one-bit in the specified value, or zero if * the specified value is itself equal to zero. * @since 1.5 */public static int highestOneBit(int i) &#123; // HD, Figure 3-1 i |= (i &gt;&gt; 1); i |= (i &gt;&gt; 2); i |= (i &gt;&gt; 4); i |= (i &gt;&gt; 8); i |= (i &gt;&gt; 16); return i - (i &gt;&gt;&gt; 1);&#125; æ–¹æ³•æµç¨‹ï¼š 123456789101112131415public static int highestOneBit(int i) &#123; //è¾“å…¥çš„i = 17 -&gt; 00000000 00000000 00000000 00010001 int left = i &gt;&gt; 1; // 00000000 00000000 00000000 00001000 i = i | left; //00000000 00000000 00000000 00011001 1 +8 +16 = 25 left = i &gt;&gt; 2; //00000000 00000000 00000000 0000110 i = i | left; //00000000 00000000 00000000 00011111 1+2+4+8+16 =31 left = i &gt;&gt; 4;//00000000 00000000 00000000 00000001 i = i | left; //00000000 00000000 00000000 00011111 31 left = i &gt;&gt; 8; //00000000 00000000 00000000 00000000 i = i | left; // 00000000 00000000 00000000 00011111 left = i &gt;&gt; 16; //00000000 00000000 00000000 00000000 i = i | left; //00000000 00000000 00000000 00011111 1+2+4+8+16 = 31 final int i1 = i &gt;&gt;&gt; 1; //00000000 00000000 00000000 00001111 1+2+4+8=15 return i-i1; // 31 -15 = 16&#125; é€šè¿‡ä¸Šè¿°ä»£ç å¯ä»¥çŸ¥é“ï¼Œè¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯ä¸€ä¸ªæ±‚æœ€é«˜ä½çš„å€¼ï¼Œæ¯”å¦‚17çš„æœ€é«˜ä½æ˜¯16ï¼Œé€šè¿‡ä¸æ–­çš„å³ç§»åšæˆ–è¿ç®—ï¼Œå°†17çš„é™¤é«˜ä½æ„å¤–çš„å…¶ä»–ä½å…¨éƒ¨å¡«ä¸º1ï¼Œå¾—åˆ°æœ€ç»ˆçš„iï¼Œç„¶åé€šè¿‡i-i&gt;&gt;&gt;1å¾—åˆ°é«˜ä½çš„å€¼ ä½è¿ç®—æœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿé€šè¿‡ä¸Šé¢çš„ä»£ç ï¼Œå¯ä»¥çœ‹åˆ°ä½è¿ç®—æ˜¯å¾ˆå®¹æ˜“è§£å†³è¿™ç§çœ‹ä¼¼éå¸¸å¤æ‚çš„é€»è¾‘ï¼Œå¦ä¸€æ–¹é¢å¦‚æœä»æ•°æ®å­¦è®¡ç®—çš„è§’åº¦ï¼Œæˆ‘ä»¬å¯èƒ½éœ€è¦å¼•ç”¨å…¶ä»–çš„è¾…åŠ©å‚æ•°å’Œå¯¹è±¡ï¼Œå»å¯¹å…¶åšè®¡ç®—å¯èƒ½ä¼šæ›´åŠ å¤æ‚ã€‚ä½è¿ç®—æ˜¯è®¡ç®—æœºçš„æœ€å®¹æ˜“è¯»æ‡‚çš„è®¡ç®—é€»è¾‘ï¼Œæ‰€ä»¥é€Ÿåº¦æ€§èƒ½æ˜¯æœ€å¥½çš„ã€‚ æ€»ç»“è®¡ç®—æœºçš„ä½è¿ç®—è®¾è®¡çœŸçš„æ˜¯åšå¤§ç²¾æ·±ï¼Œæˆ‘æ·±æ·±å—å…¶è®¡ç®—é€»è¾‘æ‰€æŠ˜æœï¼Œé€šè¿‡å¯¹äºŒè¿›åˆ¶ä½è¿ç®—çš„å­¦ä¹ ï¼ŒåŠ æ·±äº†å¯¹ä½è¿ç®—çš„å°è±¡ï¼Œå¯èƒ½å­˜åœ¨ä¸€äº›é”™è¯¯çš„ç†è§£ï¼Œæ¬¢è¿æŒ‡æ­£ï¼Œä¸ç”šæ„Ÿæ¿€ã€‚","categories":[{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/categories/Java/"}],"tags":[{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/tags/%E7%AE%97%E6%B3%95/"}],"author":"wuxuan.chai"},{"title":"Dockerç›¸å…³å‘½ä»¤","slug":"Dockerç›¸å…³å‘½ä»¤","date":"2021-01-18T14:39:45.626Z","updated":"2021-05-26T08:19:24.543Z","comments":true,"path":"2021/01/18/Dockerç›¸å…³å‘½ä»¤/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Docker%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/","excerpt":"","text":"Dockerè®¿é—®macå®¿ä¸»æœºå™¨çš„ipé€šè¿‡åŸŸåçš„è®¿é—®ï¼š script1docker.for.mac.host.internal dockerå®¹å™¨å¼€æœºå¯åŠ¨ 1234#å¯åŠ¨æ—¶æŒ‡å®šdocker run -d --restart=always --name prometheus -p 9070:9090 prom/prometheus#å¯åŠ¨åä¿®æ”¹docker update --restart=always å®¹å™¨id dockerå®¹å™¨rootç”¨æˆ·è¿›å…¥,è§£å†³linuxç”¨æˆ·æ²¡æƒé™ 1docker exec -u 0 -it å®¹å™¨id /bin/bash docker æŸ¥çœ‹æ—¥å¿— 123456789101112docker logs [OPTIONS] CONTAINER Options: --details æ˜¾ç¤ºæ›´å¤šçš„ä¿¡æ¯ -f, --follow è·Ÿè¸ªå®æ—¶æ—¥å¿— --since string æ˜¾ç¤ºè‡ªæŸä¸ªtimestampä¹‹åçš„æ—¥å¿—ï¼Œæˆ–ç›¸å¯¹æ—¶é—´ï¼Œå¦‚42mï¼ˆå³42åˆ†é’Ÿï¼‰ --tail string ä»æ—¥å¿—æœ«å°¾æ˜¾ç¤ºå¤šå°‘è¡Œæ—¥å¿—ï¼Œ é»˜è®¤æ˜¯all -t, --timestamps æ˜¾ç¤ºæ—¶é—´æˆ³ --until string æ˜¾ç¤ºè‡ªæŸä¸ªtimestampä¹‹å‰çš„æ—¥å¿—ï¼Œæˆ–ç›¸å¯¹æ—¶é—´ï¼Œå¦‚42mï¼ˆå³42åˆ†é’Ÿï¼‰ æŸ¥çœ‹æŒ‡å®šæ—¶é—´åçš„æ—¥å¿—ï¼Œåªæ˜¾ç¤ºæœ€å100è¡Œï¼š 1$ docker logs -f -t --since=&quot;2018-02-08&quot; --tail=100 CONTAINER_ID æŸ¥çœ‹æœ€è¿‘30åˆ†é’Ÿçš„æ—¥å¿—: 1$ docker logs --since 30m CONTAINER_ID æŸ¥çœ‹æŸæ—¶é—´ä¹‹åçš„æ—¥å¿—ï¼š 1$ docker logs -t --since=&quot;2018-02-08T13:23:37&quot; CONTAINER_ID æŸ¥çœ‹æŸæ—¶é—´æ®µæ—¥å¿—ï¼š 1$ docker logs -t --since=&quot;2018-02-08T13:23:37&quot; --until &quot;2018-02-09T12:23:37&quot; CONTAINER_ID","categories":[{"name":"Docker","slug":"Docker","permalink":"https://cha1yi.github.io/dist/categories/Docker/"}],"tags":[{"name":"docker","slug":"docker","permalink":"https://cha1yi.github.io/dist/tags/docker/"}],"author":"wuxuan.chai"},{"title":"Prestoä»å…¥é—¨åˆ°æ”¾å¼ƒ","slug":"Prestoä»å…¥é—¨åˆ°æ”¾å¼ƒ","date":"2021-01-18T14:31:26.572Z","updated":"2021-06-05T14:56:50.423Z","comments":true,"path":"2021/01/18/Prestoä»å…¥é—¨åˆ°æ”¾å¼ƒ/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Presto%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/","excerpt":"","text":"Presttoä»å…¥é—¨åˆ°æ”¾å¼ƒprestoå®‰è£…ç¯å¢ƒï¼šåœ¨è‡ªå·±çš„macä¸Šé€šè¿‡dockerï¼Œå®‰è£…ä¸€ä¸ªdockerå•æœºç‰ˆçš„prestoï¼Œå­¦ä¹ prestoçš„åŸºæœ¬ä½¿ç”¨ã€‚ script1docker pull prestosql/presto è¿è¡Œpresto: script1docker run -p 1314:8080 --name presto prestosql/presto å¯åŠ¨æˆåŠŸåæ—¥å¿—ä¼šæ‰“å°ï¼šINFO main io.prestosql.server.PrestoServer ======== SERVER STARTED ======== è¿è¡Œ Presto CLI script1docker exec -it presto presto prestoå¸¸ç”¨å‘½ä»¤å¢åŠ catalog123456789101112131415# è¿›å…¥prestoçš„dockerå®¹å™¨æ ¹ç›®å½•docker exec -it ee418177a59e bash # è¿›å…¥catalogçš„é…ç½®ç›®å½•cd /data/presto/etc/catalog# æ–°å¢catalogvi mysql5.propertiesåŠ å…¥mysql5çš„é…ç½®---connector.name = mysqlconnection-url = jdbc:mysql://docker.for.mac.host.internal:3305connection-user = rootconnection-password = ch199407---ä¿å­˜é…ç½®ï¼Œé‡å¯presto æ³¨æ„ï¼š 1ã€connector.name=mysql è¡¨ç¤ºconnectorçš„ç±»å‹ï¼Œprestoæ”¯æŒmysqlã€redisã€hiveã€‚ã€‚ã€‚ ä¹Ÿå¯ä»¥è‡ªå®šä¹‰connectorï¼Œéœ€è¦é¢å¤–å¼€å‘ 2ã€é…ç½®æ–‡ä»¶ä½mysql5.propertiesï¼Œé‚£ä¹ˆé‡å¯ä¹‹åï¼Œprestoä¸­å°±ä¼šæœ‰ä¸€ä¸ªmysql5çš„catalogï¼Œé…ç½®æ–‡ä»¶å’Œcatalogæ˜¯ä¸€ä¸€å¯¹åº”çš„ã€‚ å±•ç¤ºcatalog123456789101112131415161718192021#è¿›å…¥prestoçš„clidocker exec -it presto presto#å±•ç¤ºæ‰€æœ‰çš„catalogshow catalogs&gt; Catalog --------- jmx memory mysql5 mysql8 system tpcds tpch (7 rows)Query 20210119_152711_00021_nvbet, FINISHED, 1 nodeSplits: 19 total, 19 done (100.00%)1.41 [0 rows, 0B] [0 rows/s, 0B/s]","categories":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}],"tags":[{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"}],"author":"wuxuan.chai"},{"title":"è®°kafkaå¯åŠ¨å¤±è´¥","slug":"kafkaé”™è¯¯å¤„ç†è§£å†³æ€»ç»“","date":"2021-01-18T02:19:33.851Z","updated":"2021-01-18T02:22:01.165Z","comments":true,"path":"2021/01/18/kafkaé”™è¯¯å¤„ç†è§£å†³æ€»ç»“/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/kafka%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E8%A7%A3%E5%86%B3%E6%80%BB%E7%BB%93/","excerpt":"","text":"åœºæ™¯åœ¨é¡¹ç›®å¼€å‘ä¸­ï¼Œéœ€è¦ä½¿ç”¨åˆ°kafkaï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•æœ¬åœ°ç¯å¢ƒçš„kafkaéƒ½æ— æ³•å¯åŠ¨ï¼ŒzookeeperçŠ¶æ€æ˜¯æ­£å¸¸çš„ï¼Œkafkaå°±æ˜¯èµ·ä¸æ¥ï¼Œå¯¼è‡´é¡¹ç›®çš„æ—¥å¿—æ¶ˆè´¹çš„ä»»åŠ¡ä¸€ç›´é˜»å¡ã€‚é‡æ–°å¯åŠ¨ä¼šå‘ç”Ÿå¼‚å¸¸ï¼šInconsistentClusterIdExceptionã€‚ å¼‚å¸¸çš„ä¿¡æ¯1234567ERROR Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)kafka.common.InconsistentClusterIdException: The Cluster ID F-bhGf-3T1qgjuQ0c1wCRw doesn&#39;t match stored clusterId Some(FO2XIwDrSSiJSeWo4B80hQ) in meta.properties. The broker is trying to join the wrong cluster. Configured zookeeper.connect may be wrong. at kafka.server.KafkaServer.startup(KafkaServer.scala:223) at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:44) at kafka.Kafka$.main(Kafka.scala:82) at kafka.Kafka.main(Kafka.scala) .... åŸå› åˆ†æåŠè§£å†³æ–¹æ¡ˆkafkaçš„é…ç½®æ—¥å¿—è·¯å¾„ï¼Œç”¨æ¥ä¿å­˜kafkaçš„æ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¿¡æ¯ï¼Œå¦‚æœkafkaå¼‚å¸¸å…³é—­ï¼Œæ—¥å¿—è®°å½•å°±ä¼šå‡ºç°å¼‚å¸¸ï¼Œä¼šæŠŠå½“æ—¶çš„æƒ…å†µè®°å½•åœ¨meta.propertiesæ–‡ä»¶ä¸­ï¼Œé‡å¯æ—¶ï¼Œæ­¤æ–‡ä»¶ä¼šå¯¹å¯åŠ¨äº§ç”Ÿå½±å“ã€‚åŸå› æ˜¯ï¼Œé‡Œé¢è®°å½•äº†borker å’Œcluster-id,å¯¼è‡´çš„æŠ¥é”™ã€‚ è§£å†³æ–¹å¼ æ¸…ç©ºæ—¥å¿—ç›®å½•ã€æ—¥å¿—ä¸é‡è¦æˆ–å¯ä»¥å®¹å¿æ—¥å¿—ä¸¢å¤±ã€‘ã€‚ è°ƒæ•´æ—¥å¿—ç›®å½•ã€éœ€è¦ä¿®æ”¹é…ç½®ã€‘ã€‚ åˆ é™¤æ—¥å¿—ç›®å½•ä¸‹çš„meta.propertiesæ–‡ä»¶ã€‚","categories":[{"name":"é¡¹ç›®ç®¡ç†","slug":"é¡¹ç›®ç®¡ç†","permalink":"https://cha1yi.github.io/dist/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"}],"tags":[{"name":"kafka","slug":"kafka","permalink":"https://cha1yi.github.io/dist/tags/kafka/"}],"author":"wuxuan.chai"},{"title":"CentOS7å¸¸ç”¨å‘½ä»¤","slug":"CentOS7å¸¸ç”¨å‘½ä»¤","date":"2021-01-18T02:18:08.079Z","updated":"2021-05-27T11:00:13.257Z","comments":true,"path":"2021/01/18/CentOS7å¸¸ç”¨å‘½ä»¤/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/CentOS7%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/","excerpt":"","text":"CentOS7å¸¸ç”¨å‘½ä»¤1ã€æœåŠ¡å™¨ä¹‹é—´copyæ–‡ä»¶12# å°†æ–‡ä»¶spark-3.0.1-bin-hadoop2.7.tgz copyåˆ°node1æœºå™¨çš„/home/wuxuan/package/ç›®å½•ä¸‹$ scp spark-3.0.1-bin-hadoop2.7.tgz wuxuan@node1:/home/wuxuan/package/ 2ã€é˜²ç«å¢™ç›¸å…³æ“ä½œ123456789101112#æŸ¥çœ‹é˜²ç«å¢™çŠ¶æ€$ firewall-cmd --state# å…³é—­é˜²ç«å¢™$ systemctl stop firewalld.service# å¯åŠ¨é˜²ç«å¢™$ systemctl start firewalld.service# é‡å¯ç½‘å¡$ systemctl restart network.service CentOSä¹‹é—´è®¾ç½®å…å¯†è®¿é—®ä¸€ã€å‡†å¤‡é˜¶æ®µå‡†å¤‡ä¸¤å°æœºå™¨ï¼š192.168.100.11 node1192.168.100.12 node2 äºŒã€è®¾ç½®hostsåœ¨æ¯å°æœºå™¨ä¸­è®¾ç½®hosts 123456$ vim /etc/hosts#æ·»åŠ hosts192.168.100.11 node1 192.168.100.12 node2 ä¸‰ã€æ¯å°æœºå™¨è®¾ç½®hostnameï¼ˆä¸»æœºåç§°ï¼‰è®¾ç½®hostname 12345678# ç™»é™†åˆ°192.168.100.11$ hostname node1# ç™»é™†åˆ°192.168.100.12$ hostname node2 å››ã€ç»™æ¯å°æœºå™¨ç”Ÿæˆsshå¯†é’¥1234567891011121314151617# ç™»é™†åˆ°192.168.100.11$ cd /root/.ssh$ ssh-keygen -t rsa$ lsid_rsa id_rsa.pub# å°†æœºå™¨çš„å…¬é’¥å¤‡ä»½$ cp id_rsa.pub &gt;&gt; authorized_keys# å°†æ–‡ä»¶ä¼ è¾“ç»™æœºå™¨192.168.100.12$ scp authorized_keys root@node2:/root/.ssh/# ç™»é™†åˆ°192.168.100.12 $ hostname node2$ cat id_rsa.pub &gt;&gt; authorized_keys åˆ°æ­¤node2çš„authorized_keysåŒ…å«node1å’Œnode2çš„å…¬é’¥é‡å¤æ­¤æ“ä½œï¼Œå³å¯å®ç°node1å’Œnode2çš„å…å¯†è®¿é—® æµ‹è¯•: 12$ ssh node2Last login: Fri Nov 13 16:01:17 2020 from node1 äº”ã€æŸ¥çœ‹ç³»ç»Ÿèµ„æº123456789101112131415161718192021222324252627282930# æŸ¥çœ‹æ“ä½œç³»ç»Ÿå†…æ ¸ä¿¡æ¯[root@sdw1 third]# uname -aLinux sdw1 3.10.0-957.el7.x8664 #1 SMP Thu Nov 8 23:39:32 UTC 2018 x8664 x8664 x8664 GNU/Linux# æŸ¥çœ‹CPUå‹å·[root@sdw1 third]# cat /proc/cpuinfo | grep name | cut -f2 -d: | uniq -c 20 Intel(R) Xeon(R) Silver 4210 CPU @ 2.20GHz # æŸ¥çœ‹å†…å­˜æ€»é‡[root@sdw1 third]# grep MemTotal /proc/meminfoMemTotal: 32346828 kB#æŸ¥çœ‹ç£ç›˜ç©ºé—´å¤§å°$ df -h#æŸ¥çœ‹å½“å‰æ–‡ä»¶å¤¹æ‰€æœ‰æ–‡ä»¶å¤§å°$ du -sh#æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤¹å¤§å°$ du -h /data#æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤¹ä¸‹æ‰€æœ‰æ–‡ä»¶çš„å¤§å°$ du -h /data/#æŸ¥çœ‹æŒ‡å®šæ–‡ä»¶å¤§å°$ du -h data.logæŸ¥çœ‹ç›®å½•æŒ‚è½½ç‚¹df /dataåŠ ä¸Š-khä»¥gå•ä½æ˜¾ç¤ºdf /data -kh pythonå¯åŠ¨ä¸€ä¸ªä¸‹è½½æœåŠ¡1.æŠŠDesktopç›®å½•å½“æˆæ ¹ç›®å½• 1cd Desktop 2.python2å¯åŠ¨ä¸‹è½½æœåŠ¡å™¨ 1python2 -m SimpleHttpServer 3.python3å¯åŠ¨ä¸‹è½½æœåŠ¡å™¨ 1python3 -m http.server 4.æµè§ˆå™¨è®¿é—®http://127.0.0.1:8000/ python3å®‰è£…centosçš„yumåº“æ˜¯æ²¡æœ‰python3çš„ï¼Œæœ‰ç½‘ç»œçš„æ—¶å€™å¯ä»¥é€šè¿‡æ·»åŠ epel-releaseå†é€šè¿‡yumå®‰è£…ï¼š ä¸‹è½½epelï¼š 12sudo yum install epel-releaseå¤åˆ¶ä»£ç  å®‰è£…python3ï¼š 12sudo yum install -y python36å¤åˆ¶ä»£ç  éªŒè¯ 1234python3 --versionPython 3.6.8 æŸ¥çœ‹IOä¸ºäº†æ–¹ä¾¿å„ä½å’Œè‡ªå·±ä»Šåé‡åˆ°æ­¤ç±»é—®é¢˜èƒ½å°½å¿«è§£å†³ï¼Œæˆ‘è¿™é‡Œå°†æŸ¥çœ‹linuxæœåŠ¡å™¨ç¡¬ç›˜IOè®¿é—®è´Ÿè·çš„æ–¹æ³•åŒå¤§å®¶ä¸€èµ·åˆ†äº«ï¼š topå‘½ä»¤æŸ¥çœ‹â€‹ top - 16:15:05 up 6 days, 6:25, 2 users, load average: 1.45, 1.77, 2.14 Tasks: 147 total, 1 running, 146 sleeping, 0 stopped, 0 zombie Cpu(s): 0.2% us, 0.2% sy, 0.0% ni, 86.9% id, 12.6% wa, 0.0% hi, 0.0% si Mem: 4037872k total, 4003648k used, 34224k free, 5512k buffers Swap: 7164948k total, 629192k used, 6535756k free, 3511184k cached æŸ¥çœ‹12.6% wa IOç­‰å¾…æ‰€å ç”¨çš„CPUæ—¶é—´çš„ç™¾åˆ†æ¯”,é«˜è¿‡30%æ—¶IOå‹åŠ›é«˜ ç”¨iostat -x 1 10 å¦‚æœ iostat æ²¡æœ‰ï¼Œè¦ yum install sysstat avg-cpu: %user %nice %sys %iowait %idle 0.00 0.00 0.25 33.46 66.29 Device: rrqm/s wrqm/s r/s w/s rsec/s wsec/s rkB/s wkB/s avgrq-sz avgqu-sz await svctm %util sda 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 sdb 0.00 1122 17.00 9.00 192.00 9216.00 96.00 4608.00 123.79 137.23 1033.43 13.17 100.10 sdc 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 0.00 æŸ¥çœ‹%util 100.10 %idle 66.29 å¦‚æœ %util æ¥è¿‘ 100%ï¼Œè¯´æ˜äº§ç”Ÿçš„I/Oè¯·æ±‚å¤ªå¤šï¼ŒI/Oç³»ç»Ÿå·²ç»æ»¡è´Ÿè·ï¼Œè¯¥ç£ç›˜å¯èƒ½å­˜åœ¨ç“¶é¢ˆã€‚ idleå°äº70% IOå‹åŠ›å°±è¾ƒå¤§äº†,ä¸€èˆ¬è¯»å–é€Ÿåº¦æœ‰è¾ƒå¤šçš„wait. åŒæ—¶å¯ä»¥ç»“åˆvmstat æŸ¥çœ‹æŸ¥çœ‹bå‚æ•°(ç­‰å¾…èµ„æºçš„è¿›ç¨‹æ•°) vmstat -1 å¦‚æœä½ æƒ³å¯¹ç¡¬ç›˜åšä¸€ä¸ªIOè´Ÿè·çš„å‹åŠ›æµ‹è¯•å¯ä»¥ç”¨å¦‚ä¸‹å‘½ä»¤ time dd if=/dev/zero bs=1M count=2048 of=direct_2G æ­¤å‘½ä»¤ä¸ºåœ¨å½“å‰ç›®å½•ä¸‹æ–°å»ºä¸€ä¸ª2Gçš„æ–‡ä»¶ æˆ‘ä»¬åœ¨æ–°å»ºæ–‡ä»¶å¤¹çš„åŒæ—¶æ¥æµ‹è¯•IOçš„è´Ÿè·æƒ…å†µ å†é€šè¿‡å¦‚ä¸‹è„šæœ¬æŸ¥çœ‹é«˜å³°çš„è¿›ç¨‹ioæƒ…å†µ monitor_io_stats.sh #!/bin/sh /etc/init.d/syslog stop echo 1 &gt; /proc/sys/vm/block_dump sleep 60 dmesg | awk â€˜/(READ|WRITE|dirtied)/ {process[$1]++} END {for (x in process) \\ print process[x],x}â€™ |sort -nr |awk â€˜{print $2 â€œ â€œ $1}â€™ | \\ head -n 10 echo 0 &gt; /proc/sys/vm/block_dump /etc/init.d/syslog start æˆ–è€…ç”¨iodump.plè„šæœ¬","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://cha1yi.github.io/dist/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[{"name":"CentOS","slug":"CentOS","permalink":"https://cha1yi.github.io/dist/tags/CentOS/"}],"author":"wuxuan.chai"},{"title":"SpringBootè‡ªå®šä¹‰starter","slug":"SpringBootè‡ªå®šä¹‰starter","date":"2021-01-18T01:57:06.360Z","updated":"2021-02-22T01:41:55.570Z","comments":true,"path":"2021/01/18/SpringBootè‡ªå®šä¹‰starter/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89starter/","excerpt":"","text":"SpringBootè‡ªå®šä¹‰starterå­¦ä¹ èƒŒæ™¯&nbsp;&nbsp;æœ€è¿‘å’ŒåŒäº‹åœ¨å¼€å‘ä¸€ä¸ªå«åšæ•°æ®å‡†å¤‡çš„é¡¹ç›®ï¼Œç”¨åˆ°äº†SpringBootï¼ˆpsï¼šä¹‹å‰çš„é¡¹ç›®ç”¨çš„æ˜¯ssmï¼Œç¬¬ä¸€æ¬¡æ­£å¼ä½¿ç”¨SpringBootï¼‰,ç°åœ¨å¯¹äºè¿™ç§å¼€ç®±å³ç”¨çš„SpringBoot-Starteræ„Ÿåˆ°æ— æ¯”çš„æƒŠå¹ï¼Œéœ€è¦ä½¿ç”¨æŸä¸ªä¸­é—´ä»¶ï¼Œåªéœ€å¼•å…¥ç„¶åé™„åŠ å°‘è®¸é…ç½®å³å¯æŠ•å…¥ç”Ÿäº§ã€‚ä»Šå¤©å°±å¼€å§‹å­¦ä¹ ä¸€ä¸‹SpringBootçš„starterçš„å¼€å‘è§„èŒƒã€‚ Starterçš„æ„æˆ1ã€å‘½ååˆ›å»ºä¸€ä¸ªå·¥ç¨‹å«åšFlyway-spring-boot-starter Spring å®˜æ–¹å¯¹ starter çš„å‘½åæ˜¯æœ‰è§„èŒƒçš„ï¼Œåªæœ‰å®˜æ–¹æä¾›çš„ starter, æ‰èƒ½å‘½åä¸º spring-boot-starter-{name}, æ¯”å¦‚ spring-boot-starter-web; è€Œå¯¹äºéå®˜æ–¹çš„ï¼Œéœ€ä»¥ {name}-spring-boot-starter çš„æ ¼å¼å‘½åã€‚ 2ã€å¢åŠ Spring-Boot-AutoConfigurationä¾èµ–123456&lt;!-- è‡ªåŠ¨åŒ–é…ç½®ä¾èµ–ï¼Œè‡ªå®šä¹‰ starter æ ¸å¿ƒä¾èµ–åŒ… --&gt;&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-autoconfigure&lt;/artifactId&gt;&lt;/dependency&gt; 3ã€æ–°å¢è‡ªåŠ¨é…ç½®ç±»&nbsp;&nbsp;åˆ›å»ºç±» FlyWayAutoConfiguration æ¥å®ç°è‡ªåŠ¨é…ç½®åŒ–åŠŸèƒ½ 12345678910111213141516171819202122232425package com.yidan.flyway;import org.springframework.boot.autoconfigure.condition.ConditionalOnClass;import org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;import org.springframework.boot.context.properties.EnableConfigurationProperties;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;/** * @author wuxuan.chai * @date 2020/10/19 5:57 ä¸‹åˆ */@Configuration@ConditionalOnClass(SelfService.class)@EnableConfigurationProperties(SelfProperties.class)public class FlyWayAutoConfiguration &#123; @Bean @ConditionalOnMissingBean public SelfService selfService() &#123; return new SelfService(); &#125;&#125; æ¥ä¸‹æ¥ï¼Œå¯¹ä¸Šé¢ç›¸å…³æ³¨è§£è¯´æ˜ä¸€ä¸‹ï¼š@Configuration: æ ‡æ³¨ç±»ä¸ºä¸€ä¸ªé…ç½®ç±»ï¼Œè®© spring å»æ‰«æå®ƒï¼›@ConditionalOnClassï¼šæ¡ä»¶æ³¨è§£ï¼Œåªæœ‰åœ¨ classpath è·¯å¾„ä¸‹å­˜åœ¨æŒ‡å®š class æ–‡ä»¶æ—¶ï¼Œæ‰ä¼šå®ä¾‹åŒ– Beanï¼›@EnableConfigurationPropertiesï¼šä½¿æŒ‡å®šé…ç½®ç±»ç”Ÿæ•ˆï¼›@Bean: åˆ›å»ºä¸€ä¸ªå®ä¾‹ç±»æ³¨å…¥åˆ° Spring Ioc å®¹å™¨ä¸­ï¼›@ConditionalOnMissingBeanï¼šæ¡ä»¶æ³¨è§£ï¼Œæ„æ€æ˜¯ï¼Œä»…å½“ Ioc å®¹å™¨ä¸å­˜åœ¨æŒ‡å®šç±»å‹çš„ Bean æ—¶ï¼Œæ‰ä¼šåˆ›å»º Beanã€‚ 4ã€è‡ªå®šä¹‰é…ç½®ç±»åŠåŠŸèƒ½å®ç°åˆ›å»ºè‡ªå®šä¹‰é…ç½®ç±» SelfProperties 123456789101112131415161718192021package com.yidan.flyway;import org.springframework.boot.context.properties.ConfigurationProperties;/** * @author wuxuan.chai * @date 2020/10/19 6:01 ä¸‹åˆ */@ConfigurationProperties(prefix = &quot;flyway.self&quot;)public class SelfProperties &#123; private String message = &quot;hello flyway&quot;; public String getMessage() &#123; return message; &#125; public void setMessage(String message) &#123; this.message = message; &#125;&#125; åˆ›å»ºSelfServiceä¸šåŠ¡æ–¹æ³• 1234567891011121314151617package com.yidan.flyway;import javax.annotation.Resource;/** * @author wuxuan.chai * @date 2020/10/19 6:04 ä¸‹åˆ */public class SelfService &#123; @Resource private SelfProperties selfProperties; public String message() &#123; return selfProperties.getMessage(); &#125;&#125; 5ã€åˆ›å»ºspring.factoriesæ–‡ä»¶&nbsp;&nbsp;åœ¨resourceç›®å½•ä¸‹åˆ›å»ºMETA-INFç›®å½•ï¼Œåœ¨è¯¥ç›®å½•ä¸‹åˆ›å»ºspring.factoriesæ–‡ä»¶ã€‚Spring Boot ä¼šåœ¨å¯åŠ¨æ—¶ï¼Œè‡ªåŠ¨ä¼šå»æŸ¥æ‰¾æŒ‡å®šæ–‡ä»¶ /META-INF/spring.factoriesï¼Œè‹¥æœ‰ï¼Œå°±ä¼šæ ¹æ®é…ç½®çš„ç±»çš„å…¨è·¯å¾„å»è‡ªåŠ¨åŒ–é…ç½®ã€‚ 1org.springframework.boot.autoconfigure.EnableAutoConfiguration=com.yidan.flyway.FlywayAutoConfiguration 6ã€è‡ªå®šä¹‰çš„é…ç½®ä¿¡æ¯å…ƒæ•°æ®æè¿°æˆ‘ä»¬åœ¨å¼€å‘SpringBootçš„é¡¹ç›®æ—¶ï¼Œåœ¨å†™application.properties(æˆ–application.yml)æ—¶ï¼ŒIDEAä¼šè‡ªåŠ¨æ™ºèƒ½æé†’ï¼Œkeyå’Œvalueçš„å€¼ã€‚å®ƒæ˜¯å¦‚ä½•åšåˆ°çš„å‘¢ï¼Ÿåœ¨Springçš„å®˜æ–¹æ–‡æ¡£ä¸­æœ‰ç›¸å¯¹åº”çš„ä»‹ç»SpringBootè‡ªå®šä¹‰é…ç½®è¯¦è§£ åœ¨Resourseç›®å½•ä¸‹çš„META-INF åˆ›å»º:spring-configuration-metadata.json 1234567891011121314151617181920212223242526272829303132333435363738394041424344&#123; &quot;groups&quot;: [ &#123; &quot;sourceType&quot;: &quot;com.yidan.flyway.SelfProperties&quot;, &quot;type&quot;: &quot;com.yidan.flyway.SelfProperties&quot;, &quot;name&quot;: &quot;flyway.self&quot; &#125; ], &quot;hints&quot;: [ &#123; &quot;name&quot;: &quot;flyway.self.message&quot;, &quot;values&quot;: [ &#123; &quot;value&quot;:&quot;hello flyway&quot;, &quot;description&quot;: &quot;ç¬¬ä¸€ä¸ªå€¼&quot; &#125;, &#123; &quot;value&quot;: &quot;hello configuration&quot;, &quot;description&quot;: &quot;ç¬¬äºŒä¸ªå€¼&quot; &#125; ], &quot;providers&quot;: [ &#123; &quot;name&quot;: &quot;flyway starter&quot;, &quot;parameters&quot;: &quot;123&quot; &#125; ] &#125; ], &quot;properties&quot;: [ &#123; &quot;name&quot;: &quot;flyway.self.message&quot;, &quot;type&quot;: &quot;java.lang.String&quot;, &quot;description&quot;: &quot;è‡ªå®šä¹‰çš„é…ç½®&quot;, &quot;sourceType&quot;: &quot;com.yidan.flyway.SelfProperties&quot;, &quot;defaultValue&quot;: &quot;hello flyway&quot;, &quot;deprecation&quot;: &#123; &quot;level&quot;: &quot;warning&quot;, &quot;reason&quot;: &quot;æµ‹è¯•å¿½ç•¥ç†ç”±&quot;, &quot;replacement&quot;: &quot;hello configuration&quot; &#125; &#125; ]&#125; é¡¹ç›®ä½¿ç”¨å¼•å…¥ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;com.yidan&lt;/groupId&gt; &lt;artifactId&gt;flyway-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;$&#123;project.version&#125;&lt;/version&gt;&lt;/dependency&gt; ä½¿ç”¨æˆ‘ä»¬è‡ªåŠ¨è£…é…çš„beanï¼š SelfService, ä¿®æ”¹é…ç½®æ–‡ä»¶ä¸­ï¼šflyway.self.message=hello configuration ï¼ˆæ­¤æ—¶IDEAä¼šè‡ªåŠ¨æç¤ºæˆ‘ä»¬è‡ªå®šä¹‰çš„keyï¼Œç”šè‡³æœ‰å€¼çš„æ¨èï¼‰ 1234567891011121314151617181920212223package com.yidan.passport;import com.yidan.flyway.SelfService;import org.springframework.web.bind.annotation.GetMapping;import org.springframework.web.bind.annotation.RestController;import javax.annotation.Resource;/** * @author wuxuan.chai * @date 2020/10/19 6:08 ä¸‹åˆ */@RestControllerpublic class TestController &#123; @Resource private SelfService selfService; @GetMapping(&quot;/get&quot;) public String message() &#123; return selfService.message(); &#125;&#125; æµ‹è¯•ï¼š 12$ curl http:&#x2F;&#x2F;localhost:6002&#x2F;gethello configuration å®Œï¼Œåç»­é‡åˆ°å†åšè¡¥å……ï¼ï¼ï¼","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"}],"author":"wuxuan.chai"},{"title":"SpringBootå•å…ƒæµ‹è¯•æ•´ç†","slug":"SpringBootæµ‹è¯•ç³»ç»Ÿæ•´ç†","date":"2021-01-18T01:56:07.559Z","updated":"2021-02-22T01:41:42.177Z","comments":true,"path":"2021/01/18/SpringBootæµ‹è¯•ç³»ç»Ÿæ•´ç†/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/SpringBoot%E6%B5%8B%E8%AF%95%E7%B3%BB%E7%BB%9F%E6%95%B4%E7%90%86/","excerpt":"","text":"SpringBootå•å…ƒæµ‹è¯•æ•´ç†Spring boot ä½œä¸ºå½“å‰æœ€æµè¡Œçš„javaåç«¯å¼€å‘æ¡†æ¶ï¼Œé›†æˆäº†å¾ˆå¤šéå¸¸æœ‰ç”¨çš„ä¸œè¥¿ï¼Œä»Šå¤©æ¢ç´¢ï¼šSpringboot testå¼•å…¥ä¾èµ–ï¼š 12345&lt;dependency&gt; &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt; &lt;artifactId&gt;spring-boot-starter-test&lt;/artifactId&gt; &lt;scope&gt;test&lt;/scope&gt;&lt;/dependency&gt; ä¸€ã€æµ‹è¯•æ–¹å¼çš„æ•´ç†1.1ã€å•å…ƒæµ‹è¯•åœ¨ç»´åŸºç™¾ç§‘ä¸­çš„è§£é‡Šï¼š åœ¨è®¡ç®—æœºç¼–ç¨‹ä¸­ï¼Œå•å…ƒæµ‹è¯•ï¼ˆè‹±è¯­ï¼šUnit Testingï¼‰åˆç§°ä¸ºæ¨¡å—æµ‹è¯•ï¼Œæ˜¯é’ˆå¯¹ç¨‹åºæ¨¡å—ï¼ˆè½¯ä»¶è®¾è®¡çš„æœ€å°å•ä½ï¼‰æ¥è¿›è¡Œæ­£ç¡®æ€§æ£€éªŒçš„æµ‹è¯•å·¥ä½œã€‚ç¨‹åºå•å…ƒæ˜¯åº”ç”¨çš„æœ€å°å¯æµ‹è¯•éƒ¨ä»¶ã€‚åœ¨è¿‡ç¨‹åŒ–ç¼–ç¨‹ä¸­ï¼Œä¸€ä¸ªå•å…ƒå°±æ˜¯å•ä¸ªç¨‹åºã€å‡½æ•°ã€è¿‡ç¨‹ç­‰ï¼›å¯¹äºé¢å‘å¯¹è±¡ç¼–ç¨‹ï¼Œæœ€å°å•å…ƒå°±æ˜¯æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºç±»ï¼ˆè¶…ç±»ï¼‰ã€æŠ½è±¡ç±»ã€æˆ–è€…æ´¾ç”Ÿç±»ï¼ˆå­ç±»ï¼‰ä¸­çš„æ–¹æ³•ã€‚ ä¾‹å¦‚åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬éƒ½æ˜¯è¿™ä¹ˆåšå•å…ƒæµ‹è¯•çš„ï¼š 12345678public class UtilsTest &#123; @Test public void testStringBuilder()&#123; String result = new StringBuilder().append(1).append(1).toString(); assert &quot;11&quot;.equals(result); &#125;&#125; é€šå¸¸æ¥è¯´ï¼Œå¼€å‘æ¯å½“ä¿®æ”¹ä¸€æ¬¡æ–¹æ³•ï¼Œéƒ½ä¼šé‡æ–°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä»¥ä¿è¯ç¨‹åºçš„æ–¹æ³•æ˜¯æ­£ç¡®çš„ã€‚è™½ç„¶å•å…ƒæµ‹è¯•åœ¨å¼€å‘è¿‡ç¨‹ä¸­ä¸æ˜¯å¿…é¡»çš„ï¼Œä½†æ˜¯å¯¹äºå¼€å‘æ¥è¯´æ˜¯éå¸¸æœ‰å¿…è¦çš„ï¼Œå±äºå¼€å‘è‡ªæµ‹çš„ä¸€ç§éå¸¸å®ç”¨çš„æ‰‹æ®µï¼Œå‡å°‘ä»£ç å‡ºç°bugçš„æœºç‡ã€‚ 1.2ã€é›†æˆæµ‹è¯• é›†æˆæµ‹è¯•ï¼ˆæœ‰æ—¶ç§°ä¸ºé›†æˆå’Œæµ‹è¯•(Integration Testing)ï¼Œç¼©å†™ä¸ºIï¼†Tï¼‰æ˜¯è½¯ä»¶æµ‹è¯•çš„é˜¶æ®µï¼Œåœ¨è¯¥é˜¶æ®µä¸­ï¼Œå°†å„ä¸ªè½¯ä»¶æ¨¡å—ç»„åˆåœ¨ä¸€èµ·å¹¶ä½œä¸ºä¸€ä¸ªæ•´ä½“è¿›è¡Œæµ‹è¯•ã€‚é›†æˆæµ‹è¯•ä¸­è¿›è¡Œè¯„ä¼°ä¾ä»æ€§çš„ç³»ç»Ÿæˆ–éƒ¨ä»¶çš„ä¸æŒ‡å®šçš„åŠŸèƒ½è¦æ±‚ã€‚[1]å®ƒå‘ç”Ÿåœ¨å•å…ƒæµ‹è¯•ä¹‹åå’ŒéªŒè¯æµ‹è¯•ä¹‹å‰ã€‚é›†æˆæµ‹è¯•ä»¥ç»è¿‡å•å…ƒæµ‹è¯•çš„è¾“å…¥æ¨¡å—ä¸ºå‡†ï¼Œå°†å®ƒä»¬æŒ‰è¾ƒå¤§çš„èšåˆåˆ†ç»„ï¼Œåº”ç”¨é›†æˆæµ‹è¯•è®¡åˆ’ä¸­å®šä¹‰çš„æµ‹è¯•è¿™äº›èšåˆï¼Œå¹¶æä¾›é›†æˆç³»ç»Ÿä½œä¸ºç³»ç»Ÿæµ‹è¯•å‡†å¤‡å°±ç»ªçš„è¾“å‡ºã€‚ é›†æˆæµ‹è¯•å’Œå•å…ƒæµ‹è¯•çš„åŒºåˆ«åœ¨äºï¼Œå•å…ƒæµ‹è¯•ä»…ä»…æµ‹è¯•çš„ä¸€èˆ¬æ˜¯ä¸€ä¸ªæ–¹æ³•(å•å…ƒ)ï¼Œä¸æ¶‰åŠåˆ°æ–¹æ³•ç»„åˆæµ‹è¯•ï¼Œå› æ­¤é›†æˆæµ‹è¯•å°†å®Œæˆå¤šä¸ªå•å…ƒçš„ç»„åˆæµ‹è¯•ï¼Œä»¥æµ‹è¯•åœ¨å…·æœ‰ä¸šåŠ¡åœºæ™¯çš„é€»è¾‘ä¸‹è¿›è¡Œçš„æµ‹è¯•é›†æˆï¼Œæ‰€ä»¥ä¸€èˆ¬å•å…ƒæµ‹è¯•åœ¨é›†æˆæµ‹è¯•ä¹‹å‰ã€‚ 1.3ã€Mockæµ‹è¯•Mockæµ‹è¯•å±äºä¸€ç§ç‰¹æ®Šçš„æµ‹è¯•åœºæ™¯ï¼Œåœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ç”±äºååŒå¼€å‘çš„åŸå› ï¼Œè‡ªå·±éœ€è¦æµ‹è¯•è‡ªå·±å¼€å‘çš„ä¸šåŠ¡ï¼Œä½†æ˜¯ä¸šåŠ¡ä¸­åˆä¾èµ–äº†åŒäº‹å¼€å‘çš„ä¸€äº›åŠŸèƒ½ã€‚æŒ‰ç…§æ­£å¸¸çš„æµ‹è¯•é€»è¾‘ï¼Œå¯èƒ½ä¼šå‡ºç°æ— æ³•æ­£å¸¸çš„å®Œæˆæµ‹è¯•éœ€æ±‚ï¼Œç”šè‡³ä»£ç éƒ½æ— æ³•æ‰§è¡Œï¼Œæ­¤æ—¶å°±å¯ä»¥ä½¿ç”¨Mockæµ‹è¯•çš„æ–¹æ³•æ–¹æ³•ã€‚Mockæµ‹è¯•çš„åŸç†å¤§è‡´ä¸ºï¼šå¦‚æœæµ‹è¯•çš„æ–¹æ³•ä¾èµ–æœªçŸ¥çš„å¯¹è±¡æ—¶ï¼Œå¯ä»¥é€šè¿‡Mockå»æŠ½è±¡è¿™ä¸ªæœªçŸ¥çš„å¯¹è±¡ï¼Œå¹¶å¯¹æœªçŸ¥çš„å¯¹è±¡çš„æ–¹æ³•è¿›è¡ŒæŠ½è±¡è¿”å›æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œä»¥ä¾›æˆ‘ä»¬çš„æµ‹è¯•ä½¿ç”¨ã€‚ä»¥æ­¤å®Œæˆæˆ‘ä»¬çš„æ–¹æ³•æµ‹è¯•éœ€æ±‚ã€‚Spring Bootçš„æµ‹è¯•æ¨¡å—æ”¯æŒMockæµ‹è¯•å’Œjunitæµ‹è¯•ã€‚å› æ­¤æˆ‘ä»¬åœ¨SpringBootå¼€å‘æ—¶ï¼Œå¯ä»¥åœ¨å¼•å…¥äº†Springbootæµ‹è¯•æ¨¡å—åç›´æ¥äº«å—Mockæµ‹è¯•å’ŒJunitå•å…ƒæµ‹è¯•å¸¦æ¥çš„ä¾¿åˆ©ã€‚ äºŒã€Springbootå¸¸ç”¨çš„æµ‹è¯•æ–¹æ³•2.1ã€æµ‹è¯•æ™®é€šå·¥å…·æ–¹æ³•æ‰€è°“æ™®é€šçš„æ–¹æ³•ï¼Œç±»ä¼¼äºå·¥å…·ç±»ä¸­çš„å·¥å…·æ–¹æ³•ï¼Œä¸ä¾èµ–äºä»»ä½•å¤–éƒ¨ç¯å¢ƒï¼Œä¾‹å¦‚Springä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œredis templateï¼ŒMysql jdbcç­‰ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥ä½¿ç”¨Junitå¯¹å…¶è¿›è¡Œæµ‹è¯•ã€‚ 1234567public class UtilsTest &#123; @Test public void testStringBuilder()&#123; String result = new StringBuilder().append(1).append(1).toString(); assert &quot;11&quot;.equals(result); &#125;&#125; 2.3ã€æµ‹è¯•ä¸šåŠ¡æ–¹æ³•åœ¨Springä¸­çš„ä¸šåŠ¡æ–¹æ³•ï¼Œéƒ½æ˜¯é€šè¿‡IOCç›´æ¥æ³¨å…¥åˆ°Spring å®¹å™¨ä¸­çš„ï¼Œç®€å•çš„ä½¿ç”¨Junitæ˜¯æ— æ³•ç›´æ¥æ‰§è¡Œçš„ï¼Œå¿…é¡»æŒ‡å®šSpringçš„ä¸Šä¸‹æ–‡ä¿¡æ¯ï¼Œä¿è¯å…¶è¿è¡Œæ—¶èƒ½å¤Ÿä»Springå®¹å™¨ä¸­è·å–åˆ°å¯¹åº”çš„ä¾èµ–Beanã€‚ä¾‹å¦‚ï¼š 1234567891011121314151617@SpringBootTest@RunWith(SpringRunner.class)public class CarServiceTest &#123; @Autowired public CarService carService; @Test @Rollback @Transactional public void testAdd()&#123; Car car = new Car(); car.setType(&quot;SUV&quot;); car.setName(&quot;BMW&quot;); car = carService.add(car); System.out.println(car); &#125;&#125; æµ‹è¯•CarServiceä¸­çš„ä¸€ä¸ªaddæ–¹æ³•ï¼Œå¹¶ä¸”æ³¨å…¥äº†CarServiceçš„Beanï¼Œ@Transactional å¼€å¯äº†è¯¥æ–¹æ³•çš„äº‹åŠ¡ï¼Œ@Rollbackçš„æ„æ€æ˜¯ï¼Œæ‰§è¡Œç©æµ‹è¯•æ–¹æ³•ï¼Œäº‹åŠ¡å›æ»šï¼Œå³ä¸ä¼šä¿®æ”¹æ•°æ®åº“çš„æ•°æ®ã€‚@Rollbackå¿…é¡»é…åˆ@Transactional ï¼Œä¹Ÿå°±æ˜¯åªæœ‰äº‹åŠ¡å¼€å¯äº†ï¼Œæ‰ä¼šç”Ÿæ•ˆã€‚ 2.3ã€æµ‹è¯•Restfulæ¥å£åœ¨å¼€å‘è¿‡ç¨‹ä¸­ï¼Œéœ€è¦æµ‹è¯•æä¾›ç»™å‰ç«¯çš„æ¥å£ï¼Œä¸€èˆ¬æœ‰ä¸¤ç§æ–¹å¼ï¼š postmanï¼šå¥½å¤„èƒ½å¤Ÿå’Œå¯¹åº”çš„googleæ’ä»¶ä¸€èµ·é…åˆä½¿ç”¨ï¼Œå…±äº«googleæµè§ˆå™¨çš„cookieä¿¡æ¯ MockMvcçš„æ–¹å¼ï¼šå¥½å¤„å°±æ˜¯çº¯ä»£ç æµ‹è¯•ï¼Œå¯ä»¥æ§åˆ¶æ•°æ®å…¥åº“ï¼Œä¹Ÿèƒ½å¾—åˆ°æ›´è¯¦ç»†è¯·æ±‚æ•°æ®ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576@SpringBootTest@RunWith(SpringRunner.class)public class CarControllerTest &#123; private MockMvc mockMvc; @Autowired private WebApplicationContext wac; @Before public void setupMockMvc()&#123; mockMvc = MockMvcBuilders.webAppContextSetup(wac).build(); &#125; @SneakyThrows @Test public void testListCar()&#123; mockMvc.perform(get(&quot;/car/list/&quot;)).andDo(MockMvcResultHandlers.print()); &#125; @SneakyThrows @Test @Rollback @Transactional public void testAdd()&#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;name\\&quot;: \\&quot;BMW\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;SUV\\&quot;\\n&quot; + &quot;&#125;&quot;; mockMvc.perform(post(&quot;/car/&quot;).accept(MediaType.APPLICATION_JSON_VALUE).content(json).contentType(MediaType.APPLICATION_JSON_VALUE)) .andDo(MockMvcResultHandlers.print()); &#125;&#125;//æµ‹è¯•çš„ç»“æœï¼š /** * * MockHttpServletRequest: * HTTP Method = POST * Request URI = /car/ * Parameters = &#123;&#125; * Headers = [Content-Type:&quot;application/json&quot;, Accept:&quot;application/json&quot;, Content-Length:&quot;40&quot;] * Body = &lt;no character encoding set&gt; * Session Attrs = &#123;&#125; * * Handler: * Type = com.yiyi.controller.CarController * Method = com.yiyi.controller.CarController#add(Car) * * Async: * Async started = false * Async result = null * * Resolved Exception: * Type = null * * ModelAndView: * View name = null * View = null * Model = null * * FlashMap: * Attributes = null * * MockHttpServletResponse: * Status = 200 * Error message = null * Headers = [Content-Type:&quot;application/json&quot;] * Content type = application/json * Body = &#123;&quot;id&quot;:27,&quot;name&quot;:&quot;BMW&quot;,&quot;type&quot;:&quot;SUV&quot;&#125; * Forwarded URL = null * Redirected URL = null * Cookies = [] */ åœ¨é¢çš„æµ‹è¯•ä¾‹å­ä¸­ï¼Œåšäº†ä¸¤ä»¶äº‹ï¼š1ã€å¼€å¯äº†Springbootçš„æµ‹è¯•ï¼Œåˆå§‹åŒ–äº†Springçš„ä¸Šä¸‹æ–‡ç¯å¢ƒ2ã€é€šè¿‡webä¸Šä¸‹æ–‡ï¼Œåˆå§‹åŒ–äº†MockMvcçš„Beanï¼Œä¾¿äºæ¥å£çš„è¯·æ±‚ 2.4ã€ç‰¹æ®Šåœºæ™¯ä¸‹ï¼Œè‡ªå®šä¹‰é…ç½®çš„æµ‹è¯•2.4.1ã€æŒ‡å®šprofileçš„æ–¹å¼æ–°å¢é…ç½®æ–‡ä»¶application-test.xmlå°†@ActiveProfilesè®¾ç½®ä¸ºtestï¼Œåœ¨è¿è¡Œæµ‹è¯•æ—¶ï¼Œå°†ä¼šæŒ‰ç…§ä¸Šé¢çš„é…ç½®æ–‡ä»¶è¿›è¡Œåˆå§‹åŒ–Spring bean 12345678910111213141516171819202122232425@SpringBootTest@RunWith(SpringRunner.class)@ActiveProfiles(&quot;test&quot;)public class CarServiceTest &#123; @Autowired public CarService carService; @Value(&quot;$&#123;test.value&#125;&quot;) private int value; @Test public void testAdd()&#123; Car car = new Car(); car.setType(&quot;SUV&quot;); car.setName(&quot;BMW&quot;); car = carService.add(car); System.out.println(car); &#125; @Test public void testGetValue()&#123; assert value == 2; &#125;&#125; 2.5ã€Mockæµ‹è¯•çš„ä½¿ç”¨1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374@SpringBootTest@RunWith(SpringRunner.class)public class MockTest &#123; @MockBean private CarService carService; public MockMvc mockMvc; @Autowired public WebApplicationContext context; @Before public void setUp()&#123; mockMvc = MockMvcBuilders.webAppContextSetup(context).build(); &#125; @SneakyThrows @Test public void testAddCar()&#123; //æµ‹è¯•æ·»åŠ CarController çš„addCaræ¥å£ï¼Œä½¿ç”¨MockBeanæ¨¡æ‹Ÿçš„CarServiceçš„Bean Car car = new Car(); car.setId(111L); car.setName(&quot;BYD&quot;); car.setType(&quot;SUV&quot;); Car car1 = new Car(); //æœŸæœ›è°ƒç”¨addCaræ–¹æ³•ä¼ å…¥ä¸€ä¸ªcar1è¿”å›ä¸€ä¸ªcarçš„å¯¹è±¡ï¼Œå¯¹è±¡çš„æ•°æ®ä¸º id=111Lï¼Œname=BYDï¼Œ type=SUV Mockito.when(carService.add(car1)).thenReturn(car); String json = &quot;&#123;&#125;&quot;; mockMvc.perform(post(&quot;/car/&quot;).accept(MediaType.APPLICATION_JSON_VALUE).content(json).contentType(MediaType.APPLICATION_JSON_VALUE)) .andDo(MockMvcResultHandlers.print()); //æ‰§è¡Œç»“æœï¼š /** * MockHttpServletRequest: * HTTP Method = POST * Request URI = /car/ * Parameters = &#123;&#125; * Headers = [Content-Type:&quot;application/json&quot;, Accept:&quot;application/json&quot;, Content-Length:&quot;2&quot;] * Body = &lt;no character encoding set&gt; * Session Attrs = &#123;&#125; * * Handler: * Type = com.yiyi.controller.CarController * Method = com.yiyi.controller.CarController#add(Car) * * Async: * Async started = false * Async result = null * * Resolved Exception: * Type = null * * ModelAndView: * View name = null * View = null * Model = null * * FlashMap: * Attributes = null * * MockHttpServletResponse: * Status = 200 * Error message = null * Headers = [Content-Type:&quot;application/json&quot;] * Content type = application/json * Body = &#123;&quot;id&quot;:111,&quot;name&quot;:&quot;BYD&quot;,&quot;type&quot;:&quot;SUV&quot;&#125; * Forwarded URL = null * Redirected URL = null * Cookies = [] */ &#125;&#125; åœ¨è¿™ä¸ªæµ‹è¯•ä»£ç ä¸­ï¼Œæ¨¡æ‹Ÿäº†ä¸€ä¸ªCarServiceçš„beanï¼Œå¹¶ä¸”æ¨¡æ‹Ÿäº†CarService#add(car)çš„æ–¹æ³•å‚æ•°åŠè¿”å›çš„ç»“æœã€‚æ‰€ä»¥Controllerçš„æ¥å£è°ƒç”¨ä¾èµ–äº†è¿™ä¸ªæ¨¡æ‹Ÿçš„æ–¹æ³•ï¼Œæ‰€ä»¥è¿”å›çš„ç»“æœå’Œæˆ‘ä»¬é¢„æœŸæ¨¡æ‹Ÿçš„ç»“æœæ˜¯ä¸€è‡´çš„ã€‚é’ˆå¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œå¦‚æœåœ¨ä¸mockçš„æ–¹æ³•çš„å‰æä¸‹è°ƒç”¨Mockå‡ºæ¥çš„CarSerVice#list()æ–¹æ³•ï¼Œç»“æœä¼šæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿå›å»æ‰§è¡ŒåŸæœ¬çš„Springçš„ä»£ç†æ–¹æ³•æ“ä½œæ•°æ®åº“è¿˜æ˜¯æŠ¥é”™å‘¢ï¼Ÿ 123456789101112131415161718192021222324252627282930313233@SpringBootTest@RunWith(SpringRunner.class)public class MockTest &#123; @MockBean private CarService carService; public MockMvc mockMvc; @Autowired public WebApplicationContext context; @Before public void setUp()&#123; mockMvc = MockMvcBuilders.webAppContextSetup(context).build(); &#125; @Test public void testList()&#123; Car car = new Car(); car.setName(&quot;BYD&quot;); car.setType(&quot;SUV&quot;); Car car1 = carService.add(car); System.out.println(&quot;carï¼š&quot;+car1); List&lt;Car&gt; list = carService.list(); System.out.println(&quot;carList:&quot;+list); //result: /** * carï¼šnull * carList:[] */ &#125;&#125; ç»“æœè¡¨æ˜:æ²¡æœ‰æ‰§è¡Œæ•°æ®åº“çš„æ“ä½œï¼Œè€Œæ˜¯mockè¿”å›çš„æ˜¯æ–¹æ³•çš„é»˜è®¤å€¼ã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"}],"author":"wuxuan.chai"},{"title":"Springäº‹ä»¶é©±åŠ¨æ¨¡å‹","slug":"Springäº‹ä»¶é©±åŠ¨æ¨¡å‹","date":"2021-01-18T01:52:51.420Z","updated":"2021-01-18T01:56:37.009Z","comments":true,"path":"2021/01/18/Springäº‹ä»¶é©±åŠ¨æ¨¡å‹/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Spring%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B/","excerpt":"","text":"ä¸€ã€Spring äº‹ä»¶é©±åŠ¨çš„ç®€ä»‹äº‹ä»¶é©±åŠ¨æ¨¡å‹ï¼Œç®€å•ç†è§£å°±æ˜¯å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼ŒSpringé’ˆå¯¹è¿™ç§å‘å¸ƒ-è®¢é˜…æ¨¡å‹ä½œå‡ºäº†ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œåº”ç”¨é—´çš„å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨Spring AMQPå’Œ Spring for Apache Kafkaï¼Œç»“åˆRabbitæˆ–è€…kafkaç­‰æ¶ˆæ¯ä¸­é—´ä»¶å®Œæˆã€‚åº”ç”¨å†…çš„å‘å¸ƒ-è®¢é˜…æ¨¡å‹ï¼Œå¯ä»¥ä½¿ç”¨Spring çš„Applicationä¸Šä¸‹æ–‡æä¾›çš„æ–¹æ¡ˆè§£å†³ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦æè¿°Spring çš„åº”ç”¨å†…çš„äº‹ä»¶é©±åŠ¨çš„å®ç°ä»¥åŠåº”ç”¨ã€‚ äºŒã€Spring åº”ç”¨å†…çš„äº‹ä»¶é©±åŠ¨æ¨¡å‹ç¤ºä¾‹2.1ã€éœ€æ±‚èƒŒæ™¯é¡µé¢åŸ‹ç‚¹ï¼Œæ”¶é›†ç”¨æˆ·è®¿é—®ä¿¡æ¯ï¼Œå¹¶è®°å½•åˆ°æ•°æ®åº“ï¼Œå¹¶ä¸”æ ¹æ®ç”¨æˆ·çš„PVï¼Œä½œå‡ºé€‚å½“çš„å•†å“é‚®ä»¶æ¨é€ 2.2ã€éœ€æ±‚æ‹†è§£ å‰ç«¯éœ€è¦æ”¶é›†ç”¨æˆ·åœ¨å½“å‰é¡µé¢çš„è®¿é—®ä¿¡æ¯ï¼Œè°ƒç”¨åç«¯æä¾›çš„åŸ‹ç‚¹æ¥å£ï¼Œå°†æ•°æ®æä¾›ç»™åç«¯å¤„ç†ã€‚ï¼ˆå‰ç«¯åŠŸèƒ½ä¸åšç¤ºä¾‹ï¼‰ åç«¯çš„åŸ‹ç‚¹æ¥å£ï¼Œè°ƒç”¨å‘å¸ƒæ¶ˆæ¯çš„æ–¹æ³•ï¼ˆå‘å¸ƒäº‹ä»¶ï¼‰ åç«¯éœ€è¦å¼€å‘å¯¹åº”çš„äº‹ä»¶è®¢é˜…æ–¹æ³•ï¼Œå°†äº‹ä»¶è§£æå¹¶æŒä¹…åŒ–ï¼Œä»¥åŠä½œå‡ºé€‚å½“çš„é‚®ä»¶æ¨é€2.3ã€ä»£ç å®ç°1ã€åŸ‹ç‚¹æ¥å£12345678910111213141516171819202122232425262728293031package com.yiyi;import com.yiyi.service.MyEventService;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.http.MediaType;import org.springframework.web.bind.annotation.PutMapping;import org.springframework.web.bind.annotation.RequestMapping;import org.springframework.web.bind.annotation.RequestParam;import org.springframework.web.bind.annotation.RestController;/** * @author wuxuan.chai * @date 2020/6/22 12:59 ä¸‹åˆ */@RestController@RequestMapping(value = &quot;/&quot;,produces = MediaType.APPLICATION_JSON_VALUE)public class EventController &#123; private final MyEventService myEventService; @Autowired public EventController(MyEventService myEventService) &#123; this.myEventService = myEventService; &#125; @PutMapping(&quot;send/&quot;) public void sendMessage(@RequestParam String msg)&#123; myEventService.publishEvent(msg); &#125;&#125; 2ã€å®šä¹‰äº‹ä»¶æ¥å—ç±»12345678910111213141516171819202122232425262728package com.yiyi.event;import lombok.Getter;import org.springframework.context.ApplicationEvent;/** * @author wuxuan.chai * @date 2020/6/22 12:51 ä¸‹åˆ */@Getterpublic class MyEvent extends ApplicationEvent &#123; //å‰ç«¯çš„åŸ‹ç‚¹æ”¶é›†ä¿¡æ¯ private String msg; /** * Create a new &#123;@code ApplicationEvent&#125;. * * @param source the object on which the event initially occurred or with * which the event is associated (never &#123;@code null&#125;) */ public MyEvent(Object source) &#123; super(source); &#125; public MyEvent(Object source, String msg) &#123; super(source); this.msg = msg; &#125;&#125; 3ã€å‘å¸ƒäº‹ä»¶12345678910111213141516171819202122232425262728package com.yiyi.service;import com.yiyi.event.MyEvent;import org.springframework.beans.BeansException;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import org.springframework.stereotype.Component;/** * @author wuxuan.chai * @date 2020/6/22 12:52 ä¸‹åˆ */@Componentpublic class MyEventService implements ApplicationContextAware &#123; private ApplicationContext applicationContext; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; //å‘å¸ƒäº‹ä»¶ public void publishEvent(String msg)&#123; MyEvent myEvent = new MyEvent(this,msg); applicationContext.publishEvent(myEvent); &#125;&#125; 4.è®¢é˜…äº‹ä»¶ 12345678910111213141516171819202122232425package com.yiyi.compoent;import com.yiyi.event.MyEvent;import lombok.extern.slf4j.Slf4j;import org.springframework.context.event.EventListener;import org.springframework.stereotype.Component;/** * @author wuxuan.chai * @date 2020/6/22 12:55 ä¸‹åˆ */@Component@Slf4jpublic class EventListenerComponent &#123; @EventListener public void getEvent(MyEvent myEvent) &#123; log.info(&quot;æŒä¹…åŒ–ç”¨æˆ·çš„æµè§ˆè®°å½•ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @EventListener public void sendEmail(MyEvent myEvent) &#123; log.info(&quot;å‘é€Emailï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125;&#125; 5ã€æ‰§è¡Œç»“æœ 1232020-06-22 18:01:25.599 INFO 14040 --- [nio-1234-exec-2] c.yiyi.compoent.EventListenerComponent : æŒä¹…åŒ–ç”¨æˆ·çš„æµè§ˆè®°å½•ï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro2020-06-22 18:01:25.599 INFO 14040 --- [nio-1234-exec-2] c.yiyi.compoent.EventListenerComponent : å‘é€Emailï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro 2.4ã€å®ç°ä¼˜åŒ–çš„æ€è€ƒåŠå®ç°æ–¹æ³•1ã€å¦‚ä½•æé«˜åŸ‹ç‚¹çš„å¹¶å‘ï¼Ÿç­”ï¼šSpring æä¾›äº†æ–¹æ³•å¼‚æ­¥æ‰§è¡Œçš„åŠŸèƒ½ï¼Œéœ€è¦å¼€å¯å¼‚æ­¥æ‰§è¡Œâ€”â€“@EnableAsyncã€‚ç„¶åé€šè¿‡@Asyncå¼€å¯è®¢é˜…è€…å¼‚æ­¥æ¶ˆè´¹äº‹ä»¶ï¼Œå¼‚æ­¥æ‰§è¡Œçš„æœ¬è´¨ï¼Œå°±æ˜¯å°†æ–¹æ³•çš„æ‰§è¡Œçš„é€»è¾‘æ”¾åˆ°ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸­å»æ‰§è¡Œã€‚ç¤ºä¾‹ï¼š(1)ã€å¼€å¯å¼‚æ­¥æ‰§è¡Œ 12345678910111213141516171819202122232425262728293031323334353637383940package com.yiyi.config;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import org.springframework.scheduling.annotation.AsyncConfigurer;import org.springframework.scheduling.annotation.EnableAsync;import org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;import java.util.concurrent.Executor;import java.util.concurrent.ThreadPoolExecutor;/** * @author wuxuan.chai * @date 2020/6/22 1:27 ä¸‹åˆ */@Configuration@EnableAsyncpublic class AsyncListenerConfig implements AsyncConfigurer &#123; //å®šä¹‰ä¸€ä¸ªçº¿ç¨‹æ±  @Override @Bean(name = &quot;taskExecutor&quot;) public Executor getAsyncExecutor() &#123; ThreadPoolTaskExecutor executor = new ThreadPoolTaskExecutor(); executor.initialize(); //è®¾ç½®æ ¸å¿ƒçº¿ç¨‹æ•° executor.setCorePoolSize(10); //è®¾ç½®æœ€å¤§çº¿ç¨‹æ•° executor.setMaxPoolSize(20); //è®¾ç½®é˜Ÿåˆ—çš„å¤§å° executor.setQueueCapacity(1000); //è®¾ç½®æœ€å¤§çš„çº¿ç¨‹ç©ºé—²æ—¶é—´ executor.setKeepAliveSeconds(300); //è®¾ç½®çº¿ç¨‹åç§° executor.setThreadNamePrefix(&quot;event-executor-&quot;); //æ‹’ç»ç­–ç•¥ executor.setRejectedExecutionHandler(new ThreadPoolExecutor.CallerRunsPolicy()); return new ExceptionHandlingAsyncTaskExecutor(executor); &#125;&#125; (2)ã€è®¾ç½®å¼‚æ­¥æ‰§è¡Œçš„ä»»åŠ¡æ‰§è¡Œå™¨ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768package com.yiyi.config;import lombok.AllArgsConstructor;import lombok.NoArgsConstructor;import lombok.extern.slf4j.Slf4j;import org.springframework.core.task.AsyncTaskExecutor;import java.util.concurrent.Callable;import java.util.concurrent.Future;/** * ç”¨ç‹¬ç«‹çš„çº¿ç¨‹æ¥åŒ…è£…ï¼Œç±»ä¼¼ä¸@Async * @author wuxuan.chai * @date 2020/6/22 2:58 ä¸‹åˆ */@AllArgsConstructor@NoArgsConstructor@Slf4jpublic class HandlingAsyncTaskExecutor implements AsyncTaskExecutor &#123; public AsyncTaskExecutor executor; @Override public void execute(Runnable task, long startTimeout) &#123; executor.execute(createWrappedRunnable(task), startTimeout); &#125; @Override public void execute(Runnable task) &#123; executor.execute(createWrappedRunnable(task)); &#125; @Override public Future&lt;?&gt; submit(Runnable task) &#123; return executor.submit(createWrappedRunnable(task)); &#125; @Override public &lt;T&gt; Future&lt;T&gt; submit(Callable&lt;T&gt; task) &#123; return executor.submit(createCallable(task)); &#125; private &lt;T&gt; Callable&lt;T&gt; createCallable(final Callable&lt;T&gt; callable) &#123; return () -&gt; &#123; try &#123; return callable.call(); &#125; catch (Exception e) &#123; handle(e); throw e; &#125; &#125;; &#125; private Runnable createWrappedRunnable(Runnable task) &#123; return () -&gt; &#123; try &#123; task.run(); &#125; catch (Exception e) &#123; handle(e); throw e; &#125; &#125;; &#125; private void handle(Exception e) &#123; log.error(&quot;å¼‚æ­¥æ‰§è¡ŒæŠ¥é”™ï¼š&#123;&#125;&quot;, e.getMessage(), e); &#125;&#125; (3)ã€å¼‚æ­¥æ¶ˆè´¹äº‹ä»¶ 12345678910111213141516171819202122232425262728package com.yiyi.compoent;import com.yiyi.event.MyEvent;import lombok.extern.slf4j.Slf4j;import org.springframework.context.event.EventListener;import org.springframework.stereotype.Component;import org.springframework.scheduling.annotation.Async;/** * @author wuxuan.chai * @date 2020/6/22 12:55 ä¸‹åˆ */@Component@Slf4jpublic class EventListenerComponent &#123; @EventListener @Async public void getEvent(MyEvent myEvent) &#123; log.info(&quot;æŒä¹…åŒ–ç”¨æˆ·çš„æµè§ˆè®°å½•ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @EventListener @Async public void sendEmail(MyEvent myEvent) &#123; log.info(&quot;å‘é€Emailï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125;&#125; è‡³æ­¤ï¼Œå‘é€é‚®ä»¶å’ŒæŒä¹…åŒ–æµè§ˆè®°å½•éƒ½æ˜¯å¼‚æ­¥æ‰§è¡Œçš„äº†ï¼ŒåŸ‹ç‚¹æ¥å£çš„httpé“¾æ¥ä¼šç«‹å³é‡Šæ”¾ã€‚å¯¹äºæ‰§è¡ŒåŸ‹ç‚¹çš„æ¥å£æ‰§è¡Œæ¥è®²ï¼Œèƒ½å¤Ÿå¤šæ”¯æŒä¸€äº›å¹¶å‘ï¼Œå½“ç„¶å¯ä»¥åœ¨æ­¤åŸºç¡€ä¸Šç»§ç»­ä¼˜åŒ–ï¼Œä¾‹å¦‚æ‰¹é‡æŒä¹…åŒ–ï¼Œæ‰¹é‡å‘é€emailç­‰ã€‚æœ€å¤§é™åº¦çš„åˆ©ç”¨çº¿ç¨‹ã€‚ 2ã€å¦‚æœæŒä¹…åŒ–å¤±è´¥äº†ï¼Œå¦‚ä½•åšåˆ°ä¸è®©é‚®ä»¶å‘é€ï¼Ÿç­”ï¼šåœ¨ä¹‹å‰å¼€å‘çš„CRUDä¸­ï¼Œæˆ‘ä»¬é¿å…ç¨‹åºé”™è¯¯å¯¼è‡´è„åº“ï¼Œä¸€èˆ¬åœ¨åšDMLæ“ä½œçš„æ—¶å€™ï¼Œéƒ½ä¼šåŠ å…¥äº‹åŠ¡ã€‚ä¸ä¹‹ç±»ä¼¼ï¼Œè®¢é˜…è€…ä¹Ÿä¼šæœ‰äº‹åŠ¡çš„æ¦‚å¿µã€‚ç¤ºä¾‹ï¼šå‘å¸ƒäº‹ä»¶ï¼Œæ·»åŠ äº‹åŠ¡ 123456789101112131415161718192021222324252627282930313233343536373839package com.yiyi.service;import com.yiyi.domain.EventDomain;import com.yiyi.domain.EventMapper;import com.yiyi.event.MyEvent;import org.springframework.beans.BeansException;import org.springframework.beans.factory.annotation.Autowired;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import org.springframework.stereotype.Component;import org.springframework.transaction.annotation.Transactional;/** * @author wuxuan.chai * @date 2020/6/22 12:52 ä¸‹åˆ */@Componentpublic class MyEventService implements ApplicationContextAware &#123; private ApplicationContext applicationContext; @Autowired private EventMapper eventMapper; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; @Transactional(rollbackFor = Exception.class) public void publishEvent(String msg) throws Exception &#123; MyEvent myEvent = new MyEvent(this,msg); applicationContext.publishEvent(myEvent); EventDomain eventDomain = new EventDomain(); eventDomain.setMessage(msg); eventMapper.save(eventDomain); throw new Exception(&quot;errorï¼&quot;); &#125;&#125; è®¢é˜…äº‹ä»¶ï¼Œç»™getEventSecondæ–¹æ³•æ·»åŠ äº‹åŠ¡ç›‘å¬æ³¨è§£ 12345678910111213141516171819202122232425262728293031323334package com.yiyi.compoent;import com.yiyi.event.MyEvent;import lombok.extern.slf4j.Slf4j;import org.springframework.context.event.EventListener;import org.springframework.core.annotation.Order;import org.springframework.stereotype.Component;import org.springframework.transaction.event.TransactionalEventListener;/** * @author wuxuan.chai * @date 2020/6/22 12:55 ä¸‹åˆ */@Component@Slf4jpublic class EventListenerComponent &#123; @EventListener @Order(2) public void getEventFirst(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @TransactionalEventListener @Order(1) public void getEventSecond(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬äºŒä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @EventListener @Order(3) public void getEventThird(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125;&#125; æ‰§è¡Œç»“æœï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768692020-06-22 22:12:42.980 INFO 14373 --- [nio-1234-exec-3] c.yiyi.compoent.EventListenerComponent : æˆ‘æ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro2020-06-22 22:12:42.980 INFO 14373 --- [nio-1234-exec-3] c.yiyi.compoent.EventListenerComponent : æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼šæŸ¥çœ‹äº†åä¸ºMate40 proHibernate: select next_val as id_val from hibernate_sequence for updateHibernate: update hibernate_sequence set next_val= ? where next_val=?java.lang.Exception: errorï¼ at com.yiyi.service.MyEventService.publishEvent(MyEventService.java:36) at com.yiyi.service.MyEventService$$FastClassBySpringCGLIB$$f3a92ba1.invoke(&lt;generated&gt;) at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:771) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:749) at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:366) at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:118) at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186) at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:749) at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:691) at com.yiyi.service.MyEventService$$EnhancerBySpringCGLIB$$fb19b4c8.publishEvent(&lt;generated&gt;) at com.yiyi.EventController.sendMessage(EventController.java:29) at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190) at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138) at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793) at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943) at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) at org.springframework.web.servlet.FrameworkServlet.doPut(FrameworkServlet.java:920) at javax.servlet.http.HttpServlet.service(HttpServlet.java:663) at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) at javax.servlet.http.HttpServlet.service(HttpServlet.java:741) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343) at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373) at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590) at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) at java.lang.Thread.run(Thread.java:748) é€šè¿‡ä¸Šè¿°çš„æ‰§è¡Œç»“æœå¾ˆå®¹æ˜“çœ‹å‡ºï¼Œ@TransactionalEventListeneræ³¨è§£æ‰€åœ¨çš„æ–¹æ³•æ˜¯åœ¨å‘å¸ƒè€…çš„äº‹åŠ¡å®Œæˆä¹‹åè¿›è¡Œè°ƒç”¨çš„ï¼Œè€Œä¸”æ‰§è¡Œçš„é¡ºåºè½åäº@EventListenerã€‚é™¤æ­¤ä¹‹å¤–ï¼Œ@EventListenerï¼Œä¸ç®¡å‘å¸ƒè€…äº‹åŠ¡æ˜¯å¦æäº¤ï¼Œéƒ½ä¼šæ‰§è¡Œè®¢é˜…çš„é€»è¾‘ã€‚:::tipè®¢é˜…æ‰§è¡Œçš„é¡ºåºï¼š@EventListener&gt;@EventListener+@Async&gt;@TransactionalEventListener::: 3ã€å¦‚ä½•ä¿æŒè®¢é˜…è¢«æœ‰åºæ‰§è¡Œï¼Ÿç­”ï¼šSpringæä¾›@Orderçš„æšä¸¾ï¼Œé€šè¿‡è¿™ä¸ªæˆ‘ä»¬å¯ä»¥ç»™è®¢é˜…è€…è®¾ç½®é¡ºåºï¼Œé‚£ä¹ˆåœ¨æ¶ˆè´¹äº‹ä»¶çš„æ—¶å€™ï¼Œå°±ä¼šéµå¾ªè¿™ä¸ªé¡ºåºã€‚ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132package com.yiyi.compoent;import com.yiyi.event.MyEvent;import lombok.extern.slf4j.Slf4j;import org.springframework.context.event.EventListener;import org.springframework.core.annotation.Order;import org.springframework.stereotype.Component;/** * @author wuxuan.chai * @date 2020/6/22 12:55 ä¸‹åˆ */@Component@Slf4jpublic class EventListenerComponent &#123; @EventListener @Order(2) public void getEventFirst(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @EventListener @Order(1) public void getEventSecond(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬äºŒä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125; @EventListener @Order(3) public void getEventThird(MyEvent myEvent) &#123; log.info(&quot;æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼š&#123;&#125;&quot;, myEvent.getMsg()); &#125;&#125; æ‰§è¡Œç»“æœï¼š 1232020-06-22 18:30:34.689 INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent : æˆ‘æ˜¯ç¬¬äºŒä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro2020-06-22 18:30:34.691 INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent : æˆ‘æ˜¯ç¬¬ä¸€ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro2020-06-22 18:30:34.691 INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent : æˆ‘æ˜¯ç¬¬ä¸‰ä¸ªæ”¶åˆ°æ¶ˆæ¯ï¼šæŸ¥çœ‹äº†åä¸ºMate40 pro ä¸‰ã€Spring äº‹ä»¶é©±åŠ¨çš„åŸç†","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"},{"name":"äº‹ä»¶é©±åŠ¨","slug":"äº‹ä»¶é©±åŠ¨","permalink":"https://cha1yi.github.io/dist/tags/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/"}],"author":"wuxuan.chai"},{"title":"Spring Cache æºç å­¦ä¹ ï¼Œè‡ªå®šä¹‰CacheManager","slug":"Spring Cache æºç å­¦ä¹ ï¼Œè‡ªå®šä¹‰CacheManager","date":"2021-01-18T01:48:30.711Z","updated":"2021-02-22T01:42:31.433Z","comments":true,"path":"2021/01/18/Spring Cache æºç å­¦ä¹ ï¼Œè‡ªå®šä¹‰CacheManager/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Spring%20Cache%20%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89CacheManager/","excerpt":"","text":"Spring Cache æºç å­¦ä¹ ï¼Œè‡ªå®šä¹‰CacheManagerä¸€ã€å­¦ä¹ èƒŒæ™¯&emsp;&emsp;æœ€è¿‘ä¸€ç›´åœ¨å­¦ä¹ Spring bootçš„æ¡†æ¶ï¼Œå› ä¸ºä¹‹å‰ä¸€ç›´æ¥è§¦çš„éƒ½æ˜¯Spring + Spring mvc + mybatisçš„ssmæ¡†æ¶ï¼Œå¯¹äºçº¦å®šå¤§äºé…ç½®çš„è¿™ç§å¼€å‘ç†å¿µè¿˜æ˜¯ä¸å¤ªç†Ÿæ‚‰å’Œä¸Šæ‰‹ï¼Œæ‰€ä»¥å†³å®šç³»ç»Ÿå­¦ä¹ ä¸‹Springbootã€‚æœ€è¿‘åœ¨çœ‹é¡¹ç›®ä»£ç ï¼Œå¯¹ä»£ç ä¸­Spring cacheçš„ä¸€äº›è‡ªå®šä¹‰æ‹“å±•å¾ˆæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥å°±å¥½å¥½æ•´ç†ä¸‹ã€‚ï¼ˆåŸºäºSpring 5.2.6-release ç‰ˆæœ¬ï¼‰ äºŒã€Spring Cacheçš„æºç å­¦ä¹ 2.1ã€Spring Cacheçš„æ ¸å¿ƒæ¥å£2.1.1ã€Cache123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163package org.springframework.cache;import java.util.concurrent.Callable;import org.springframework.lang.Nullable;/** * å®šä¹‰é€šç”¨ç¼“å­˜æ“ä½œçš„æ¥å£ã€‚ * * &lt;b&gt;æ³¨æ„ï¼š&lt;/b&gt;ç”±äºç¼“å­˜çš„ä¸€èˆ¬ç”¨æ³•ï¼Œå»ºè®®å®ç°å…è®¸å­˜å‚¨&lt;tt&gt; null &lt;/tt&gt;å€¼ï¼ˆä¾‹å¦‚ï¼Œå­˜å‚¨è¿”å›&#123;@code null&#125;çš„æ–¹æ³•ï¼‰ã€‚ * * @author Costin Leau * @author Juergen Hoeller * @author Stephane Nicoll * @since 3.1 */public interface Cache &#123; /** * è¿”å›ç¼“å­˜çš„åç§° */ String getName(); /** * è¿”å›åŸºç¡€æœ¬æœºç¼“å­˜æä¾›ç¨‹åºã€‚è¿™é‡Œæ˜¯æŒ‡ç¼“å­˜å®ç°ç±»å¯¹è±¡,è¿”å›ç±»å‹ä¸ºClass&lt;T extend Cache&gt; class */ Object getNativeCache(); /** * è¿”å›æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ã€‚ &lt;p&gt;å¦‚æœç¼“å­˜ä¸åŒ…å«è¯¥é”®çš„æ˜ å°„ï¼Œåˆ™è¿”å›&#123;@code null&#125;ï¼› å¦åˆ™ï¼Œç¼“å­˜çš„å€¼ï¼ˆæœ¬èº«å¯èƒ½ä¸º&#123;@code null&#125;ï¼‰å°†åœ¨&#123;@link * ValueWrapper&#125;ä¸­è¿”å›ã€‚ * @param key è¦è¿”å›å…¶å…³è”å€¼çš„key * @return æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ï¼Œè¯¥å€¼åŒ…å«åœ¨&#123;@link ValueWrapper&#125;ä¸­ï¼Œè¯¥å€¼ä¹Ÿå¯ä»¥ä¿å­˜ç¼“å­˜çš„&#123;@code null&#125;å€¼ã€‚ ç›´æ¥è¿”å›&#123;@code null&#125;è¡¨ç¤ºç¼“* å­˜ä¸åŒ…å«è¯¥é”®çš„æ˜ å°„ã€‚ * @see #get(Object, Class) * @see #get(Object, Callable) */ @Nullable ValueWrapper get(Object key); /** * è¿”å›æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ï¼Œé€šå¸¸æŒ‡å®šè¿”å›å€¼å°†å¼ºåˆ¶è½¬æ¢ä¸ºçš„ç±»å‹ã€‚ &lt;p&gt;æ³¨æ„ï¼š&#123;@code get&#125;çš„æ­¤å˜ä½“ä¸å…è®¸åŒºåˆ†å·²ç¼“å­˜çš„&#123;@code null&#125;å€¼å’Œæ ¹æœ¬æ‰¾ä¸ * åˆ°ç¼“å­˜æ¡ç›®ã€‚ ä¸ºæ­¤ï¼Œè¯·ä½¿ç”¨æ ‡å‡†çš„&#123;@link #get(Objectï¼‰&#125;å˜ä½“ã€‚ * @param key è¦è¿”å›å…¶å…³è”å€¼çš„key * @param type éœ€è¦è¿”å›å€¼çš„ç±»å‹ï¼ˆå¯ä»¥ä¸º&#123;@code null&#125;æ¥ç»•è¿‡ç±»å‹æ£€æŸ¥ï¼›å¦‚æœåœ¨ç¼“å­˜ä¸­æ‰¾åˆ°&#123;@code null&#125;å€¼ï¼Œåˆ™æŒ‡å®šçš„ç±»å‹æ— å…³ç´§è¦ï¼‰ * @return æ­¤é«˜é€Ÿç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ï¼ˆæœ¬èº«å¯ä»¥æ˜¯&#123;@code null&#125;ï¼‰ï¼Œå¦‚æœé«˜é€Ÿç¼“å­˜ä¸åŒ…å«æ­¤é”®çš„æ˜ å°„ï¼Œåˆ™è¿˜å¯ä»¥æ˜¯&#123;@code null&#125; * @throws IllegalStateException å¦‚æœæ‰¾åˆ°äº†é«˜é€Ÿç¼“å­˜æ¡ç›®ä½†æœªèƒ½åŒ¹é…æŒ‡å®šçš„ç±»å‹ * @since 4.0 * @see #get(Object) */ @Nullable &lt;T&gt; T get(Object key, @Nullable Class&lt;T&gt; type); /** * è¿”å›æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ï¼Œå¹¶åœ¨å¿…è¦æ—¶ä»&#123;@code valueLoader&#125;è·å–è¯¥å€¼ã€‚ æ­¤æ–¹æ³•ä¸ºå¸¸è§„çš„â€œå¦‚æœå·²ç¼“å­˜ï¼Œåˆ™è¿”å›ï¼›å¦åˆ™åˆ›å»ºï¼Œç¼“å­˜å¹¶è¿”å›â€æ¨¡å¼æä¾› * äº†ç®€å•çš„æ›¿ä»£æ–¹æ³•ã€‚ &lt;p&gt;å¦‚æœå¯èƒ½ï¼Œå®ç°åº”ç¡®ä¿åŠ è½½æ“ä½œæ˜¯åŒæ­¥çš„ï¼Œä»¥ä¾¿åœ¨åŒæ—¶è®¿é—®åŒä¸€é”®çš„æƒ…å†µä¸‹ï¼Œä»…è°ƒç”¨ä¸€æ¬¡æŒ‡å®šçš„&#123;@code valueLoader&#125;ã€‚ &lt;p&gt;å¦‚æœ *&#123;@code valueLoader&#125;å¼•å‘å¼‚å¸¸ï¼Œåˆ™å°†å…¶åŒ…è£…åœ¨&#123;@link ValueRetrievalException&#125;ä¸­ * @param key è¦è¿”å›å…¶å…³è”å€¼çš„key * @return æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ * @throws ValueRetrievalException å¦‚æœ&#123;@code valueLoader&#125;æŠ›å‡ºå¼‚å¸¸ * @since 4.3 * @see #get(Object) */ @Nullable &lt;T&gt; T get(Object key, Callable&lt;T&gt; valueLoader); /** * å°†æŒ‡å®šçš„å€¼ä¸æ­¤é«˜é€Ÿç¼“å­˜ä¸­çš„æŒ‡å®šé”®ç›¸å…³è”ã€‚ &lt;p&gt;å¦‚æœé«˜é€Ÿç¼“å­˜å…ˆå‰åŒ…å«æ­¤é”®çš„æ˜ å°„ï¼Œåˆ™æ—§å€¼å°†ç”±æŒ‡å®šå€¼æ›¿æ¢ã€‚ &lt;p&gt;å¯ä»¥ä»¥å¼‚æ­¥æˆ–å»¶è¿Ÿçš„æ–¹å¼æ‰§è¡Œå®é™…æ³¨å†Œï¼Œéš * åçš„æŸ¥æ‰¾å¯èƒ½ä»æœªçœ‹åˆ°è¯¥æ¡ç›®ã€‚ ä¾‹å¦‚ï¼Œäº‹åŠ¡æ€§ç¼“å­˜è£…é¥°å™¨å¯èƒ½å°±æ˜¯è¿™ç§æƒ…å†µã€‚ ä½¿ç”¨&#123;@link #putIfAbsent&#125;ä¿è¯ç«‹å³æ³¨å†Œã€‚ * @param key the key with which the specified value is to be associated * @param value the value to be associated with the specified key * @see #putIfAbsent(Object, Object) */ void put(Object key, @Nullable Object value); /** * å¦‚æœå°šæœªå°†æŒ‡å®šå€¼ä¸è¯¥é«˜é€Ÿç¼“å­˜ä¸­çš„æŒ‡å®šé”®åŸå­å…³è”ï¼Œåˆ™è¯¥å€¼å°šæœªè®¾ç½®ã€‚ &lt;p&gt;è¿™ç­‰æ•ˆäºï¼š&lt;pre&gt; &lt;code&gt; ValueWrapper existingValue = cache.getï¼ˆkeyï¼‰; å¦‚æœï¼ˆexistingValue == nullï¼‰&#123;cache.putï¼ˆkeyï¼Œvalueï¼‰; è¿”å›ç°å­˜å€¼ï¼› &lt;/ code&gt; &lt;/ pre&gt;ï¼Œä½†è¯¥æ“ä½œæ˜¯åŸå­æ‰§è¡Œçš„ã€‚ è™½ç„¶æ‰€æœ‰å¼€ç®±å³ç”¨çš„&#123;@link CacheManager&#125;å®ç°éƒ½å¯ä»¥è‡ªåŠ¨æ‰§è¡Œæ”¾ç½®ï¼Œä½†æ“ä½œä¹Ÿå¯ä»¥åˆ†ä¸¤ä¸ªæ­¥éª¤å®ç°ï¼Œä¾‹å¦‚ ä»¥éåŸå­æ–¹å¼æ£€æŸ¥å­˜åœ¨æ€§å¹¶éšåæ”¾ç½®ã€‚ æœ‰å…³æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·æŸ¥çœ‹æ‰€ä½¿ç”¨çš„æœ¬æœºç¼“å­˜å®ç°çš„æ–‡æ¡£ã€‚ &lt;p&gt;é»˜è®¤å®ç°æ²¿ç€ä¸Šé¢çš„ä»£ç ç‰‡æ®µå§”æ‰˜ç»™&#123;@link #getï¼ˆObjectï¼‰&#125;å’Œ&#123;@link #putï¼ˆObjectï¼ŒObjectï¼‰&#125;ã€‚ * @param key ä¸æŒ‡å®šå€¼å…³è”çš„é”® * @param value ä¸æŒ‡å®šé”®å…³è”çš„å€¼ * @return æ­¤ç¼“å­˜å°†æŒ‡å®šé”®æ˜ å°„åˆ°çš„å€¼ï¼ˆæœ¬èº«å¯èƒ½æ˜¯&#123;@code null&#125;ï¼‰ï¼Œå¦‚æœåœ¨æ­¤è°ƒç”¨ä¹‹å‰ç¼“å­˜ä¸åŒ…å«è¯¥é”®çš„ä»»ä½•æ˜ å°„ï¼Œåˆ™è¿˜ä¸º&#123;@code null&#125;ã€‚ å› æ­¤ï¼Œè¿”å›&#123;@code null&#125;è¡¨ç¤ºç»™å®šçš„&#123;@code value&#125;å·²ä¸å¯†é’¥ç›¸å…³è”ã€‚ * @since 4.1 * @see #put(Object, Object) */ @Nullable default ValueWrapper putIfAbsent(Object key, @Nullable Object value) &#123; ValueWrapper existingValue = get(key); if (existingValue == null) &#123; put(key, value); &#125; return existingValue; &#125; /** * å¦‚æœå­˜åœ¨ï¼Œè¯·ä»æ­¤ç¼“å­˜ä¸­é€€å‡ºæ­¤é”®çš„æ˜ å°„ã€‚ &lt;p&gt;å¯ä»¥ä»¥å¼‚æ­¥æˆ–å»¶è¿Ÿçš„æ–¹å¼æ‰§è¡Œå®é™…é€å‡ºï¼Œéšåçš„æŸ¥æ‰¾å¯èƒ½ä»ä¼šçœ‹åˆ°è¯¥æ¡ç›®ã€‚ ä¾‹å¦‚ï¼Œäº‹åŠ¡æ€§ç¼“å­˜è£…é¥°å™¨å¯èƒ½å°±æ˜¯è¿™ç§æƒ…å†µã€‚ ä½¿ç”¨&#123;@link #evictIfPresent&#125;ç¡®ä¿ç«‹å³åˆ é™¤ã€‚ * @param key è¦ä»ç¼“å­˜ä¸­åˆ é™¤å…¶æ˜ å°„çš„é”® * @see #evictIfPresent(Object) */ void evict(Object key); /** * å¦‚æœå­˜åœ¨æ­¤é”®ï¼Œåˆ™ä»æ­¤ç¼“å­˜ä¸­é€€å‡ºè¯¥é”®çš„æ˜ å°„ï¼Œå¹¶æœŸæœ›è¯¥é”®å¯¹äºåç»­æŸ¥æ‰¾ç«‹å³ä¸å¯è§ã€‚ &lt;p&gt;é»˜è®¤å®ç°å§”æ´¾ç»™&#123;@link #evictï¼ˆObjectï¼‰&#125;ï¼Œå¯¹äºæœªç¡®å®šçš„å…ˆå‰å­˜åœ¨çš„é”®ï¼Œè¿”å›&#123;@code false&#125;ã€‚ é¼“åŠ±é«˜é€Ÿç¼“å­˜æä¾›è€…ï¼Œå°¤å…¶æ˜¯é«˜é€Ÿç¼“å­˜è£…é¥°å™¨ï¼Œå¦‚æœå¯èƒ½çš„è¯ï¼ˆä¾‹å¦‚ï¼Œåœ¨äº‹åŠ¡ä¸­é€šå¸¸å»¶è¿Ÿçš„é«˜é€Ÿç¼“å­˜æ“ä½œçš„æƒ…å†µä¸‹ï¼‰æ‰§è¡Œç«‹å³é©±é€å¹¶å¯é åœ°ç¡®å®šç»™å®šå¯†é’¥çš„å…ˆå‰å­˜åœ¨ã€‚ * @param key è¦ä»ç¼“å­˜ä¸­åˆ é™¤å…¶æ˜ å°„çš„é”® * @return &#123;@code true&#125;ï¼ˆå¦‚æœä»¥å‰çŸ¥é“ç¼“å­˜å¯¹æ­¤é”®æœ‰æ˜ å°„ï¼‰ï¼Œ&#123;@ code false&#125;ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰ï¼ˆæˆ–è€…æ— æ³•ç¡®å®šå…ˆå‰çš„å­˜åœ¨ï¼‰ * @since 5.2 * @see #evict(Object) */ default boolean evictIfPresent(Object key) &#123; evict(key); return false; &#125; /** * é€šè¿‡åˆ é™¤æ‰€æœ‰æ˜ å°„æ¥æ¸…é™¤ç¼“å­˜ã€‚ &lt;p&gt;å¯ä»¥ä»¥å¼‚æ­¥æˆ–å»¶è¿Ÿçš„æ–¹å¼æ‰§è¡Œå®é™…æ¸…é™¤ï¼Œéšåçš„æŸ¥æ‰¾å¯èƒ½ä»ä¼šçœ‹åˆ°æ¡ç›®ã€‚ ä¾‹å¦‚ï¼Œäº‹åŠ¡æ€§ç¼“å­˜è£…é¥°å™¨å¯èƒ½å°±æ˜¯è¿™ç§æƒ…å†µã€‚ ä½¿ç”¨&#123;@link #invalidateï¼ˆï¼‰&#125;å¯ä»¥ç¡®ä¿ç«‹å³åˆ é™¤æ¡ç›®ã€‚ * @see #invalidate() */ void clear(); /** * é€šè¿‡åˆ é™¤æ‰€æœ‰æ˜ å°„æ¥ä½¿ç¼“å­˜æ— æ•ˆï¼Œå¹¶æœŸæœ›æ‰€æœ‰æ¡ç›®å¯¹äºéšåçš„æŸ¥æ‰¾ç«‹å³ä¸å¯è§ã€‚ @return &#123;@code true&#125;ï¼ˆå¦‚æœä»¥å‰çŸ¥é“è¯¥ç¼“å­˜å…·æœ‰æ˜ å°„ï¼‰ï¼Œ&#123;@ code false&#125;ï¼ˆå¦‚æœæ²¡æœ‰ï¼‰ï¼ˆæˆ–è€…å¦‚æœæ— æ³•ç¡®å®šå…ˆå‰æ˜¯å¦å­˜åœ¨æ¡ç›®ï¼‰ * @since 5.2 * @see #clear() */ default boolean invalidate() &#123; clear(); return false; &#125; /** * ä»£è¡¨ç¼“å­˜å€¼çš„ï¼ˆåŒ…è£…ï¼‰å¯¹è±¡ã€‚ */ @FunctionalInterface interface ValueWrapper &#123; /** * è¿”å›ç¼“å­˜ä¸­çš„å®é™…å€¼ã€‚ */ @Nullable Object get(); &#125; /** * å¦‚æœå€¼åŠ è½½ç¨‹åºå›è°ƒå› å¼‚å¸¸è€Œå¤±è´¥ï¼Œåˆ™ä»&#123;@link #get(Objectï¼ŒCallableï¼‰&#125;å¼•å‘åŒ…è£…å™¨å¼‚å¸¸ã€‚ * @since 4.3 */ @SuppressWarnings(&quot;serial&quot;) class ValueRetrievalException extends RuntimeException &#123; @Nullable private final Object key; public ValueRetrievalException(@Nullable Object key, Callable&lt;?&gt; loader, Throwable ex) &#123; super(String.format(&quot;Value for key &#x27;%s&#x27; could not be loaded using &#x27;%s&#x27;&quot;, key, loader), ex); this.key = key; &#125; @Nullable public Object getKey() &#123; return this.key; &#125; &#125;&#125; 2.1.2ã€CacheManager12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849/* * Copyright 2002-2019 the original author or authors. * * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;); * you may not use this file except in compliance with the License. * You may obtain a copy of the License at * * https://www.apache.org/licenses/LICENSE-2.0 * * Unless required by applicable law or agreed to in writing, software * distributed under the License is distributed on an &quot;AS IS&quot; BASIS, * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. * See the License for the specific language governing permissions and * limitations under the License. */package org.springframework.cache;import java.util.Collection;import org.springframework.lang.Nullable;/** * Springçš„ä¸­å¤®ç¼“å­˜ç®¡ç†å™¨SPIã€‚ * * &lt;p&gt;å…è®¸æ£€ç´¢å‘½åçš„&#123;@link Cache&#125;åŒºåŸŸã€‚ * * @author Costin Leau * @author Sam Brannen * @since 3.1 */public interface CacheManager &#123; /** * è·å–ä¸ç»™å®šåç§°å…³è”çš„ç¼“å­˜ã€‚ &lt;p&gt;è¯·æ³¨æ„ï¼Œå¦‚æœæœ¬æœºæä¾›ç¨‹åºæ”¯æŒï¼Œåˆ™ç¼“å­˜å¯èƒ½ä¼šåœ¨è¿è¡Œæ—¶å»¶è¿Ÿåˆ›å»ºã€‚ * @param name ç¼“å­˜æ ‡è¯†ç¬¦ï¼ˆä¸å¾—ä¸º&#123;@code null&#125;ï¼‰ * @return å…³è”çš„ç¼“å­˜ï¼Œå¦‚æœä¸å­˜åœ¨æˆ–æ— æ³•åˆ›å»ºï¼Œåˆ™ä¸º&#123;@code null&#125; */ @Nullable Cache getCache(String name); /** * è·å–æ­¤ç®¡ç†å™¨å·²çŸ¥çš„ç¼“å­˜åç§°çš„é›†åˆã€‚ * @return ç¼“å­˜ç®¡ç†å™¨å·²çŸ¥çš„æ‰€æœ‰ç¼“å­˜çš„åç§° */ Collection&lt;String&gt; getCacheNames();&#125; 2.1.3ã€Cacheç›¸å…³çš„æ³¨è§£Spring cache ä¸ºäº†æ–¹ä¾¿æˆ‘ä»¬å¯¹ç¼“å­˜çš„ä½¿ç”¨ï¼Œæä¾›äº†äº”ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„æ³¨è§£ï¼š @Cacheable @CachePut @CacheEvict @Caching @CacheConfig 2.1.3.1ã€@Cacheableæºç æ³¨é‡Šç¿»è¯‘ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119package org.springframework.cache.annotation;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Inherited;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import java.util.concurrent.Callable;import org.springframework.core.annotation.AliasFor;/** * æ ‡æ³¨å¯ä»¥ç¼“å­˜è°ƒç”¨æ–¹æ³•ï¼ˆæˆ–ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼‰ç»“æœçš„æ³¨é‡Šã€‚ * * &lt;p&gt;æ¯æ¬¡è°ƒç”¨å»ºè®®çš„æ–¹æ³•æ—¶ï¼Œéƒ½ä¼šåº”ç”¨ç¼“å­˜è¡Œä¸ºï¼Œæ£€æŸ¥æ˜¯å¦å·²ä¸ºç»™å®šå‚æ•°è°ƒç”¨äº†è¯¥æ–¹æ³•ã€‚ é€šå¸¸é»˜è®¤è®¾ç½®åªæ˜¯ä½¿ç”¨æ–¹æ³•å‚æ•°æ¥è®¡ç®—å¯†é’¥ï¼Œä½†æ˜¯å¯ä»¥é€šè¿‡&#123;@link #key&#125;å±æ€§æä¾›SpELè¡¨è¾¾å¼ï¼Œæˆ–è€…è‡ªå®šä¹‰&#123;@link org.springframework.cache.interceptor.KeyGenerator&#125;å®ç°å¯ä»¥æ›¿æ¢ é»˜è®¤å€¼ä¹‹ä¸€ï¼ˆè¯·å‚è§&#123;@link #keyGenerator&#125;ï¼‰ã€‚ * * &lt;p&gt;å¦‚æœåœ¨é«˜é€Ÿç¼“å­˜ä¸­æ‰¾ä¸åˆ°æ‰€è®¡ç®—é”®çš„å€¼ï¼Œåˆ™å°†è°ƒç”¨ç›®æ ‡æ–¹æ³•ï¼Œå¹¶å°†è¿”å›çš„å€¼å­˜å‚¨åœ¨å…³è”çš„é«˜é€Ÿç¼“å­˜ä¸­ã€‚ è¯·æ³¨æ„ï¼ŒJava8çš„&#123;@code Optional&#125;è¿”å›ç±»å‹æ˜¯è‡ªåŠ¨å¤„ç†çš„ï¼Œå¹¶ä¸”å…¶å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ * * &lt;p&gt;æ­¤æ³¨é‡Šå¯ç”¨ä½œ&lt;em&gt;å…ƒæ³¨é‡Š&lt;/ em&gt;ï¼Œä»¥åˆ›å»ºå…·æœ‰å±æ€§è¦†ç›–çš„è‡ªå®šä¹‰&lt;em&gt;ç»„æˆçš„æ³¨é‡Š&lt;/ em&gt;ã€‚ * * @author Costin Leau * @author Phillip Webb * @author Stephane Nicoll * @author Sam Brannen * @since 3.1 * @see CacheConfig */@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)@Retention(RetentionPolicy.RUNTIME)@Inherited@Documentedpublic @interface Cacheable &#123; /** * ç¼“å­˜åç§°çš„åˆ«å */ @AliasFor(&quot;cacheNames&quot;) String[] value() default &#123;&#125;; /** * å­˜å‚¨æ–¹æ³•è°ƒç”¨ç»“æœçš„ç¼“å­˜çš„åç§°ã€‚ * &lt;p&gt;åç§°å¯ç”¨äºç¡®å®šç›®æ ‡ç¼“å­˜ï¼ˆæˆ–å¤šä¸ªç¼“å­˜ï¼‰ï¼Œä¸ç‰¹å®šBeanå®šä¹‰çš„é™å®šç¬¦å€¼æˆ–Beanåç§°åŒ¹é…ã€‚ * @since 4.2 * @see #value * @see CacheConfig#cacheNames */ @AliasFor(&quot;value&quot;) String[] cacheNames() default &#123;&#125;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String key() default &quot;&quot;; /** * è¦ä½¿ç”¨çš„è‡ªå®šä¹‰&#123;@link org.springframework.cache.interceptor.KeyGenerator&#125;çš„beanåç§°ã€‚ &lt;p&gt;ä¸&#123;@link #key&#125;å±æ€§äº’æ–¥ã€‚ * @see CacheConfig#keyGenerator */ String keyGenerator() default &quot;&quot;; /** * è‡ªå®šä¹‰&#123;@link org.springframework.cache.CacheManager&#125;çš„beanåç§°ï¼Œç”¨äºåˆ›å»ºé»˜è®¤çš„&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰ã€‚ * &lt;p&gt;ä¸&#123;@link #cacheResolver&#125;å±æ€§äº’æ–¥ã€‚ * @see org.springframework.cache.interceptor.SimpleCacheResolver * @see CacheConfig#cacheManager */ String cacheManager() default &quot;&quot;; /** * è¦ä½¿ç”¨çš„å®šåˆ¶&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;çš„beanåç§°ã€‚ * @see CacheConfig#cacheResolver */ String cacheResolver() default &quot;&quot;; /** * Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰è¡¨è¾¾å¼ï¼Œç”¨äºä½¿æ–¹æ³•ç¼“å­˜æˆä¸ºæ¡ä»¶ã€‚ * &lt;p&gt;é»˜è®¤å€¼ä¸º&#123;@codeâ€œâ€&#125;ï¼Œè¿™æ„å‘³ç€æ–¹æ³•ç»“æœå§‹ç»ˆè¢«ç¼“å­˜ã€‚ * &lt;p&gt; SpELè¡¨è¾¾å¼æ ¹æ®æä¾›ä»¥ä¸‹å…ƒæ•°æ®çš„ä¸“ç”¨ä¸Šä¸‹æ–‡è¿›è¡Œè¯„ä¼°ï¼š&lt;ul&gt; * &lt;li&gt; &#123;@ codeï¼ƒroot.method&#125;ï¼Œ&#123;@ codeï¼ƒroot.target&#125;å’Œ&#123;@code #rootã€‚ ç¼“å­˜&#125;ï¼Œåˆ†åˆ«å¼•ç”¨&#123;@link java.lang.reflect.Methodæ–¹æ³•&#125;ï¼Œç›®æ ‡å¯¹è±¡å’Œå—å½±å“çš„ç¼“å­˜ã€‚&lt;/li&gt; * &lt;li&gt;æ–¹æ³•åç§°çš„å¿«æ·æ–¹å¼ï¼ˆ&#123;@codeï¼ƒroot.methodName &#125;ï¼‰å’Œç›®æ ‡ç±»åˆ«ï¼ˆ&#123;@codeï¼ƒroot.targetClass&#125;ï¼‰ä¹Ÿå¯ç”¨ã€‚ * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args [1]&#125;ï¼Œ&#123;@ codeï¼ƒp1&#125;æˆ–&#123;@codeï¼ƒa1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; &lt;/ ul&gt; */ String condition() default &quot;&quot;; /** * Springè¡¨è¾¾å¼è¯­è¨€ï¼ˆSpELï¼‰è¡¨è¾¾å¼ç”¨äºå¦å†³æ–¹æ³•ç¼“å­˜ã€‚ * &lt;p&gt;ä¸&#123;@link #condition&#125;ä¸åŒï¼Œæ­¤è¡¨è¾¾å¼æ˜¯åœ¨è°ƒç”¨æ–¹æ³•åæ±‚å€¼çš„ï¼Œå› æ­¤å¯ä»¥å¼•ç”¨&#123;@code result&#125;ã€‚ * &lt;p&gt;é»˜è®¤å€¼ä¸º&#123;@codeâ€œâ€&#125;ï¼Œè¡¨ç¤ºæ°¸è¿œä¸ä¼šå¦å†³ç¼“å­˜ã€‚ * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; * @since 3.2 */ String unless() default &quot;&quot;; /** * å¦‚æœå¤šä¸ªçº¿ç¨‹è¯•å›¾ä¸ºåŒä¸€é”®åŠ è½½å€¼ï¼Œåˆ™åŒæ­¥åŸºç¡€æ–¹æ³•çš„è°ƒç”¨ã€‚ åŒæ­¥å¸¦æ¥äº†ä¸¤ä¸ªé™åˆ¶ï¼š * &lt;ol&gt; * &lt;li&gt;ä¸æ”¯æŒ&#123;@link #unlessï¼ˆï¼‰&#125;&lt;/li&gt; * &lt;li&gt;åªèƒ½æŒ‡å®šä¸€ä¸ªç¼“å­˜&lt;/li&gt; * &lt;li&gt;ä¸èƒ½åˆå¹¶å…¶ä»–ä¸ç¼“å­˜ç›¸å…³çš„æ“ä½œ&lt;/li&gt; * &lt;/ol&gt; * è¿™å®é™…ä¸Šæ˜¯ä¸€ä¸ªæç¤ºï¼Œæ‚¨æ­£åœ¨ä½¿ç”¨çš„å®é™…ç¼“å­˜æä¾›ç¨‹åºå¯èƒ½ä¸ä»¥åŒæ­¥æ–¹å¼æ”¯æŒå®ƒã€‚ æ£€æŸ¥æ‚¨çš„æä¾›ç¨‹åºæ–‡æ¡£ï¼Œä»¥è·å–æœ‰å…³å®é™…è¯­ä¹‰çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ã€‚ * @since 4.3 * @see org.springframework.cache.Cache#get(Object, Callable) */ boolean sync() default false;&#125; ä¸»è¦å‚æ•° æè¿° ç”¨æ³• value cacheNames çš„åˆ«å @Cacheable(â€œmysqlCacheâ€) cacheNames ç¼“å­˜çš„åç§° @Cacheable(cacheNames = MysqlCache.NAME) key ç¼“å­˜çš„keyï¼Œæ”¯æŒSpring EL è¡¨è¾¾å¼ @Cacheable(cacheNames = MysqlCache.NAME, key = â€œâ€˜CacheDemoService-getâ€™+ args[0]â€) @Cacheable(cacheNames = MysqlCache.NAME, key = â€œâ€˜CacheDemoService-getâ€™+ #p0â€) @Cacheable(cacheNames = MysqlCache.NAME, key = â€œâ€˜CacheDemoService-getâ€™+ #a0â€) keyGenerator keyçš„æ„é€ å™¨ï¼Œå’Œkeyå±æ€§äº’æ–¥ éœ€è¦å®šä¹‰ä¸€ä¸ªcustomerKeyGeneratorçš„bean @Cacheable(cacheNames = MysqlCache.NAME, keyGenerator = â€œcustomerKeyGeneratorâ€) cacheManager æŒ‡å®šCacheManagerï¼Œéœ€è¦å…ˆå®šä¹‰CacheManagerçš„beanï¼ŒæŒ‡å®šååˆ™ä¸èƒ½æŒ‡å®šcacheResolverï¼Œä¸¤è€…äº’æ–¥ï¼Œå¦‚ä¸æŒ‡å®šï¼Œåˆ™ä½¿ç”¨æ³¨å…¥çš„é»˜è®¤çš„CacheManagerBean @Cacheable(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€ï¼‰ cacheResolver æŒ‡å®šcacheResolverçš„beançš„åç§°ï¼Œå’ŒcacheManageräº’æ–¥ æš‚æ—¶æœªåšæµ‹è¯• condition æ˜¯å¦ä½¿ç”¨æ–¹æ³•ç¼“å­˜æ¡ä»¶ï¼Œé»˜è®¤â€œâ€ï¼Œæ˜¯å¦å»å–æ–¹æ³•ç¼“å­˜ï¼Œåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰è®¡ç®—æ¡ä»¶ç»“æœ @Cacheable(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€,condition=â€œ#a0 == â€˜xxâ€™â€) unless å¦å†³æ–¹æ³•çš„ç»“æœç¼“å­˜ï¼Œé»˜è®¤â€œâ€ï¼Œå§‹ç»ˆç¼“å­˜æ–¹æ³•ï¼Œå¦‚æœæ¡ä»¶ä¸æˆç«‹åˆ™ä¸ç¼“å­˜æ–¹æ³•ç»“æœï¼Œåœ¨æ–¹æ³•æ‰§è¡Œç»“æœåè®¡ç®—æ¡ä»¶ç»“æœ @Cacheable(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€,unless=â€œ#a0 == â€˜xxâ€™â€) sync å¤šçº¿ç¨‹è®¿é—®æ–¹æ³•ï¼Œæ˜¯å¦åŒæ­¥ç¼“å­˜ï¼Œé»˜è®¤å€¼ä¸ºfalseï¼Œä½¿ç”¨æœ‰ä¸‰ä¸ªé™åˆ¶ï¼Œä¸æ”¯æŒunlessï¼Œåªèƒ½æŒ‡å®šä¸€ä¸ªç¼“å­˜ï¼Œä¸èƒ½ä¸@Cachingä¸€èµ·ä½¿ç”¨ @Cacheable(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€,sync=false) 2.1.3.2ã€@CachePutæºç æ³¨é‡Šç¿»è¯‘ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105package org.springframework.cache.annotation;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Inherited;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import org.springframework.core.annotation.AliasFor;/** * æŒ‡ç¤ºæ–¹æ³•ï¼ˆæˆ–ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼‰è§¦å‘&#123;@link org.springframework.cache.Cacheï¼ƒput(Objectï¼ŒObjectï¼‰cache put&#125;æ“ä½œçš„æ³¨é‡Šã€‚ * * &lt;p&gt;ä¸&#123;@link Cacheable @Cacheable&#125;æ³¨é‡Šç›¸åï¼Œæ­¤æ³¨é‡Šä¸ä¼šå¯¼è‡´å»ºè®®çš„æ–¹æ³•è¢«è·³è¿‡ã€‚ è€Œæ˜¯ï¼Œå®ƒæ€»æ˜¯ä½¿æ–¹æ³•è¢«è°ƒç”¨å¹¶å°†å…¶ç»“æœå­˜å‚¨åœ¨å…³è”çš„ç¼“å­˜ä¸­ã€‚ è¯·æ³¨æ„ï¼ŒJava8çš„&#123;@code Optional&#125;è¿”å›ç±»å‹æ˜¯è‡ªåŠ¨å¤„ç†çš„ï¼Œå¹¶ä¸”å…¶å†…å®¹å­˜å‚¨åœ¨ç¼“å­˜ä¸­ï¼ˆå¦‚æœå­˜åœ¨ï¼‰ã€‚ * * &lt;p&gt;æ­¤æ³¨é‡Šå¯ç”¨ä½œ&lt;em&gt;å…ƒæ³¨é‡Š&lt;/ em&gt;ï¼Œä»¥åˆ›å»ºå…·æœ‰å±æ€§è¦†ç›–çš„è‡ªå®šä¹‰&lt;em&gt;ç»„æˆçš„æ³¨é‡Š&lt;/ em&gt;ã€‚ * * @author Costin Leau * @author Phillip Webb * @author Stephane Nicoll * @author Sam Brannen * @since 3.1 * @see CacheConfig */@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)@Retention(RetentionPolicy.RUNTIME)@Inherited@Documentedpublic @interface CachePut &#123; /** * åˆ«å&#123;@link #cacheNames&#125;. */ @AliasFor(&quot;cacheNames&quot;) String[] value() default &#123;&#125;; /** * ç”¨äºç¼“å­˜æ”¾ç½®æ“ä½œçš„ç¼“å­˜åç§°ã€‚ * &lt;p&gt;åç§°å¯ä»¥ç”¨æ¥ç¡®å®šç›®æ ‡ç¼“å­˜ï¼ˆæˆ–å¤šä¸ªç¼“å­˜ï¼‰ï¼Œä¸ç‰¹å®šbeanå®šä¹‰çš„é™å®šç¬¦å€¼æˆ–beanåç§°åŒ¹é…ã€‚ * @since 4.2 * @see #value * @see CacheConfig#cacheNames */ @AliasFor(&quot;value&quot;) String[] cacheNames() default &#123;&#125;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String key() default &quot;&quot;; /** * è¦ä½¿ç”¨çš„è‡ªå®šä¹‰&#123;@link org.springframework.cache.interceptor.KeyGenerator&#125;çš„beanåç§°ã€‚ &lt;p&gt;ä¸&#123;@link #key&#125;å±æ€§äº’æ–¥ã€‚ * @see CacheConfig#keyGenerator */ String keyGenerator() default &quot;&quot;; /** * è‡ªå®šä¹‰&#123;@link org.springframework.cache.CacheManager&#125;çš„beanåç§°ï¼Œç”¨äºåˆ›å»ºé»˜è®¤çš„&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰ã€‚ * &lt;p&gt;ä¸&#123;@link #cacheResolver&#125;å±æ€§äº’æ–¥ã€‚ * @see org.springframework.cache.interceptor.SimpleCacheResolver * @see CacheConfig#cacheManager */ String cacheManager() default &quot;&quot;; /** * è¦ä½¿ç”¨çš„å®šåˆ¶&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;çš„beanåç§°ã€‚ * @see CacheConfig#cacheResolver */ String cacheResolver() default &quot;&quot;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String condition() default &quot;&quot;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String unless() default &quot;&quot;;&#125; ä¸»è¦å‚æ•° æè¿° æ³¨é‡Š value åŒCacheable @CachePut(â€œmysqlCacheâ€) cacheNames åŒCacheable @CachePut(cacheNames=â€mysqlCacheâ€) key åŒCacheable @CachePut(cacheNames=â€mysqlCacheâ€,key=â€#a1â€) keyGenerator åŒCacheable @CachePut(cacheNames=â€mysqlCacheâ€,keyGenerator=â€customKeyGeneratorâ€) cacheManager åŒCacheable @CachePut(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€) cacheResolver() åŒCacheable æš‚æœªæµ‹è¯• condition åŒCacheable @CachePut(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€,condition=â€#a1 == â€˜xxxâ€™â€) unless åŒCacheable @CachePut(cacheNames = MysqlCache.NAME, cacheManager=â€mysqlCacheManagerâ€,keyGenerator = â€œcustomerKeyGeneratorâ€,unless=â€#a1 == â€˜xxxâ€™â€) 2.1.3.3ã€@CacheEvictæºç æ³¨é‡Šç¿»è¯‘ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106package org.springframework.cache.annotation;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Inherited;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;import org.springframework.core.annotation.AliasFor;/** * è¡¨ç¤ºæ–¹æ³•ï¼ˆæˆ–ç±»ä¸­çš„æ‰€æœ‰æ–¹æ³•ï¼‰è§¦å‘&#123;@link org.springframework.cache.Cacheï¼ƒevictï¼ˆObjectï¼‰cache evict&#125;æ“ä½œçš„æ³¨é‡Šã€‚ * * &lt;p&gt;æ­¤æ³¨é‡Šå¯ç”¨ä½œ&lt;em&gt;å…ƒæ³¨é‡Š&lt;/ em&gt;ï¼Œä»¥åˆ›å»ºå…·æœ‰å±æ€§è¦†ç›–çš„è‡ªå®šä¹‰&lt;em&gt;ç»„æˆçš„æ³¨é‡Š&lt;/ em&gt;ã€‚ * * @author Costin Leau * @author Stephane Nicoll * @author Sam Brannen * @since 3.1 * @see CacheConfig */@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)@Retention(RetentionPolicy.RUNTIME)@Inherited@Documentedpublic @interface CacheEvict &#123; /** * åˆ«å &#123;@link #cacheNames&#125;. */ @AliasFor(&quot;cacheNames&quot;) String[] value() default &#123;&#125;; /** * ç”¨äºç¼“å­˜é€å‡ºæ“ä½œçš„ç¼“å­˜åç§°ã€‚ &lt;p&gt;åç§°å¯ç”¨äºç¡®å®šç›®æ ‡ç¼“å­˜ï¼ˆæˆ–å¤šä¸ªç¼“å­˜ï¼‰ï¼Œä¸ç‰¹å®šBeanå®šä¹‰çš„é™å®šç¬¦å€¼æˆ–Beanåç§°åŒ¹é…ã€‚ * @since 4.2 * @see #value * @see CacheConfig#cacheNames */ @AliasFor(&quot;value&quot;) String[] cacheNames() default &#123;&#125;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String key() default &quot;&quot;; /** * è‡ªå®šä¹‰keyç”Ÿæˆå™¨çš„beanåå­—&#123;@link org.springframework.cache.interceptor.KeyGenerator&#125; * to use. * &lt;p&gt;ä¸ &#123;@link #key&#125; äº’æ–¥ * @see CacheConfig#keyGenerator */ String keyGenerator() default &quot;&quot;; /** * è‡ªå®šä¹‰&#123;@link org.springframework.cache.CacheManager&#125;çš„beanåç§°ï¼Œç”¨äºåˆ›å»ºé»˜è®¤çš„&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰ã€‚ * &lt;p&gt;ä¸&#123;@link #cacheResolver&#125; äº’æ–¥. * @see org.springframework.cache.interceptor.SimpleCacheResolver * @see CacheConfig#cacheManager */ String cacheManager() default &quot;&quot;; /** * è‡ªå®šä¹‰çš„beançš„åç§°&#123;@link org.springframework.cache.interceptor.CacheResolver&#125; * to use. * @see CacheConfig#cacheResolver */ String cacheResolver() default &quot;&quot;; /** * ç”¨äºåŠ¨æ€è®¡ç®—é”®çš„Springè¡¨è¾¾å¼è¯­è¨€(SpEL)è¡¨è¾¾å¼ã€‚ * * é»˜è®¤å€¼æ˜¯&#123;@code &quot;&quot;&#125;ï¼Œæ„å‘³ç€æ‰€æœ‰çš„æ–¹æ³•å‚æ•°éƒ½ä¼šè¢«è€ƒè™‘ä½œä¸ºä¸€ä¸ªkeyï¼Œé™¤éè‡ªå®šä¹‰çš„keyç”Ÿæˆå™¨ç”Ÿæ•ˆã€‚ &#123;@link #keyGenerator&#125; * * spring elè¡¨è¾¾å¼çš„è®¡ç®—å–å†³äºä¸Šå°æ–‡æä¾›çš„å…ƒæ•°æ®ï¼š * åŒ…å«&#123;@code #root.method&#125;, &#123;@code #root.target&#125;, and &#123;@code #root.caches&#125; å¼•ç”¨&#123;@link java.lang.reflect.Method method&#125;ï¼Œç›®æ ‡å¯¹è±¡ï¼Œå’Œå—å½±å“çš„ç¼“å­˜ã€‚è¿˜æä¾›äº†(&#123;@code #root.methodName&#125;) æ–¹æ³•åç§° (&#123;@code #root.targetClass&#125;)ç›®æ ‡ç±»åç§°çš„å¿«æ·æ–¹å¼ * æ–¹æ³•å‚æ•°å¯ä»¥ä½œä¸ºå…³è”ç´¢å¼• * &lt;li&gt;æ–¹æ³•å‚æ•°å¯ä»¥é€šè¿‡ç´¢å¼•è®¿é—®ã€‚ ä¾‹å¦‚ï¼Œå¯ä»¥é€šè¿‡&#123;@codeï¼ƒroot.args[1]&#125;ï¼Œ&#123;@ code #p1&#125;æˆ–&#123;@code #a1&#125;è®¿é—®ç¬¬äºŒä¸ªè‡ªå˜é‡ã€‚ å¦‚æœè¯¥ä¿¡æ¯å¯ç”¨ï¼Œä¹Ÿå¯ä»¥æŒ‰åç§°è®¿é—®å‚æ•°ã€‚&lt;/li&gt; */ String condition() default &quot;&quot;; /** * æ˜¯å¦åˆ é™¤ç¼“å­˜å†…çš„æ‰€æœ‰æ¡ç›®ã€‚ * &lt;p&gt;é»˜è®¤æƒ…å†µä¸‹ï¼Œä»…åˆ é™¤å…³è”é”®ä¸‹çš„å€¼ã€‚ * &lt;p&gt;è¯·æ³¨æ„ï¼Œä¸å…è®¸å°†æ­¤å‚æ•°è®¾ç½®ä¸º&#123;@code true&#125;å¹¶æŒ‡å®š&#123;@link #key&#125;ã€‚ */ boolean allEntries() default false; /** * åœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹å‰æ˜¯å¦åº”è¯¥æ”¶å›ã€‚ * &lt;p&gt;å°†æ­¤å±æ€§è®¾ç½®ä¸º&#123;@code true&#125;ï¼Œå°†å¯¼è‡´é©±é€å‘ç”Ÿï¼Œè€Œä¸æ–¹æ³•ç»“æœæ— å…³ï¼ˆå³ï¼Œæ˜¯å¦å¼•å‘å¼‚å¸¸ï¼‰ã€‚ * &lt;p&gt;é»˜è®¤å€¼ä¸º&#123;@code false&#125;ï¼Œè¿™æ„å‘³ç€å°†åœ¨æˆåŠŸè°ƒç”¨å»ºè®®çš„æ–¹æ³•åï¼ˆå³ä»…åœ¨è°ƒç”¨æœªå¼•å‘å¼‚å¸¸çš„æƒ…å†µä¸‹ï¼‰&lt;/ em&gt;è¿›è¡Œç¼“å­˜é€å‡ºæ“ä½œã€‚ */ boolean beforeInvocation() default false;&#125; ä¸»è¦å‚æ•° æè¿° ç”¨æ³• value åŒCacheable @CacheEvict(â€œmysqlCacheâ€) cacheNames åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€) key åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€#a1â€) keyGenerator åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€customKeyGeneratorâ€) cacheManager åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€customKeyGeneratorâ€,cacheManager=â€customCacheManagerâ€) cacheResolver åŒCacheable æš‚æ—¶æœªæµ‹è¯• condition åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€#a1â€,condition=â€#a1 == trueâ€) unless åŒCacheable @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€#a1â€,unless=â€#a1 == trueâ€) allEntries æ˜¯å¦åˆ é™¤è¯¥ç¼“å­˜å®ä¾‹ä¸‹çš„æ‰€æœ‰ç¼“å­˜çš„ä¿¡æ¯ï¼Œé»˜è®¤å€¼ï¼šfalseï¼Œå½“å€¼ä¸ºtrueæ—¶ï¼Œåˆ™ä¸å±æ€§keyäº’æ–¥ @CacheEvict(cacheNames=â€mysqlCacheâ€,allEntries = false beforeInvocation åœ¨è°ƒç”¨è¯¥æ–¹æ³•ä¹‹å‰æ˜¯å¦ç§»é™¤ç¼“å­˜ï¼Œé»˜è®¤ä¸ºfalseï¼Œå¦‚æœä¸ºtrueæ—¶ï¼Œåˆ™ç§»é™¤ç¼“å­˜å’Œæ–¹æ³•æ˜¯å¦æ‰§è¡Œå¼‚å¸¸æ— å…³ @CacheEvict(cacheNames=â€mysqlCacheâ€,key=â€#a1â€,unless=â€#a1 == trueâ€,beforeInvocation = true) 2.1.3.4ã€@Cachingæºç æ³¨é‡Šç¿»è¯‘ï¼š 1234567891011121314151617181920212223242526272829303132package org.springframework.cache.annotation;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Inherited;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;/** * å¤šä¸ªï¼ˆä¸åŒæˆ–ç›¸åŒç±»å‹çš„ï¼‰ç¼“å­˜æ³¨é‡Šçš„ç»„æ³¨é‡Šã€‚ * * &lt;p&gt;æ­¤æ³¨é‡Šå¯ç”¨ä½œ&lt;em&gt;å…ƒæ³¨é‡Š&lt;/ em&gt;ï¼Œä»¥åˆ›å»ºå…·æœ‰å±æ€§è¦†ç›–çš„è‡ªå®šä¹‰&lt;em&gt;ç»„æˆçš„æ³¨é‡Š&lt;/ em&gt;ã€‚ * * @author Costin Leau * @author Chris Beams * @since 3.1 */@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)@Retention(RetentionPolicy.RUNTIME)@Inherited@Documentedpublic @interface Caching &#123; Cacheable[] cacheable() default &#123;&#125;; CachePut[] put() default &#123;&#125;; CacheEvict[] evict() default &#123;&#125;;&#125; 2.1.3.5ã€@CacheConfigæºç æ³¨é‡Šç¿»è¯‘: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package org.springframework.cache.annotation;import java.lang.annotation.Documented;import java.lang.annotation.ElementType;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;import java.lang.annotation.Target;/** * &#123;@code @CacheConfig&#125;æä¾›äº†ä¸€ç§åœ¨ç±»çº§åˆ«å…±äº«ä¸ç¼“å­˜ç›¸å…³çš„å¸¸è§è®¾ç½®çš„æœºåˆ¶ã€‚ * * &lt;p&gt;å½“ç»™å®šç±»ä¸Šå­˜åœ¨æ­¤æ‰¹æ³¨æ—¶ï¼Œå®ƒå°†ä¸ºè¯¥ç±»ä¸­å®šä¹‰çš„ä»»ä½•ç¼“å­˜æ“ä½œæä¾›ä¸€ç»„é»˜è®¤è®¾ç½®ã€‚ * * @author Stephane Nicoll * @author Sam Brannen * @since 4.1 */@Target(ElementType.TYPE)@Retention(RetentionPolicy.RUNTIME)@Documentedpublic @interface CacheConfig &#123; /** * è¦ä¸ºå¸¦æ³¨é‡Šçš„ç±»ä¸­å®šä¹‰çš„ç¼“å­˜æ“ä½œè€ƒè™‘çš„é»˜è®¤ç¼“å­˜çš„åç§°ã€‚ * &lt;p&gt;å¦‚æœåœ¨æ“ä½œçº§åˆ«æœªè®¾ç½®ä»»ä½•å€¼ï¼Œåˆ™å°†ä½¿ç”¨è¿™äº›å€¼è€Œä¸æ˜¯é»˜è®¤å€¼ã€‚ * &lt;p&gt;å¯ç”¨äºç¡®å®šç›®æ ‡ç¼“å­˜ï¼ˆæˆ–å¤šä¸ªç¼“å­˜ï¼‰ï¼Œä¸ * é™å®šç¬¦å€¼æˆ–ç‰¹å®šbeanå®šä¹‰çš„beanåç§°ã€‚ */ String[] cacheNames() default &#123;&#125;; /** * é»˜è®¤&#123;@link org.springframework.cache.interceptor.KeyGenerator&#125;çš„beanå * &lt;p&gt;å¦‚æœåœ¨æ“ä½œçº§åˆ«æœªè®¾ç½®ä»»ä½•å€¼ï¼Œåˆ™ä½¿ç”¨è¯¥å€¼ä»£æ›¿é»˜è®¤å€¼ã€‚ * &lt;p&gt;å¯†é’¥ç”Ÿæˆå™¨ä¸è‡ªå®šä¹‰å¯†é’¥äº’æ–¥ã€‚ å½“è¿™æ ·çš„é’¥åŒ™æ˜¯ * ä¸ºæ“ä½œå®šä¹‰çš„ï¼Œæ­¤å¯†é’¥ç”Ÿæˆå™¨çš„å€¼å°†è¢«å¿½ç•¥ã€‚ */ String keyGenerator() default &quot;&quot;; /** * è‡ªå®šä¹‰&#123;@link org.springframework.cache.CacheManager&#125;çš„beanåç§°ï¼Œç”¨äºåˆ›å»ºé»˜è®¤&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;ï¼ˆå¦‚æœå°šæœªè®¾ç½®ï¼‰ã€‚ * &lt;p&gt;å¦‚æœåœ¨æ“ä½œçº§åˆ«æœªè®¾ç½®è§£æå™¨å’Œç¼“å­˜ç®¡ç†å™¨ï¼Œå¹¶ä¸”æœªé€šè¿‡&#123;@link #cacheResolver&#125;è®¾ç½®ç¼“å­˜è§£æå™¨ï¼Œåˆ™ä½¿ç”¨è¯¥è§£æå™¨è€Œä¸æ˜¯é»˜è®¤å€¼ã€‚ @see org.springframework.cache.interceptor.SimpleCacheResolver */ String cacheManager() default &quot;&quot;; /** * è¦ä½¿ç”¨çš„å®šåˆ¶&#123;@link org.springframework.cache.interceptor.CacheResolver&#125;çš„beanåç§°ã€‚ * &lt;p&gt;å¦‚æœåœ¨æ“ä½œçº§åˆ«æœªè®¾ç½®è§£æå™¨å’Œç¼“å­˜ç®¡ç†å™¨ï¼Œåˆ™ä½¿ç”¨è¯¥è§£æå™¨è€Œä¸æ˜¯é»˜è®¤å€¼ã€‚ */ String cacheResolver() default &quot;&quot;;&#125; è¯¥æ³¨è§£åªèƒ½ä½¿ç”¨åœ¨ç±»ä¸Šï¼Œä¸ºè¯¥ç±»ä¸­çš„@Cacheableã€@CachePutã€@CacheEvictæä¾›cacheNamesã€cacheManagerã€keyGeneratorã€cacheResolveré»˜è®¤çš„è®¾ç½®ã€‚ä¸éš¾å‘ç°è¿™äº›å€¼éƒ½æ˜¯Spring çš„beançš„å®ä¾‹åç§°ã€‚ ä¸»è¦å‚æ•° æè¿° ç”¨æ³• cacheNames ç¼“å­˜åç§°çš„beançš„åç§°,é»˜è®¤å€¼ï¼šâ€œâ€ï¼Œåˆ™ä»¥å®é™…çš„è®¾ç½®ä¸ºå‡† @CacheConfig(cacheNames=â€mysqlCacheâ€) cacheManager ç¼“å­˜ç®¡ç†å™¨çš„beançš„åç§°,é»˜è®¤å€¼ï¼šâ€œâ€ï¼Œåˆ™ä»¥å®é™…çš„è®¾ç½®ä¸ºå‡† @CacheConfig(cacheManager=â€customCacheManagerâ€) keyGenerator keyç”Ÿæˆå™¨çš„beançš„åç§°,é»˜è®¤å€¼ï¼šâ€œâ€ï¼Œåˆ™ä»¥å®é™…çš„è®¾ç½®ä¸ºå‡† @CacheConfig(keyGenerator=â€customKeyGnenratorâ€) cacheResolver ç¼“å­˜å®ç°çš„beançš„åç§°,é»˜è®¤å€¼ï¼šâ€œâ€ï¼Œåˆ™ä»¥å®é™…çš„è®¾ç½®ä¸ºå‡† @CacheConfig(cacheResolver=â€customCacheResolverâ€) ä¸‰ã€Spring Cacheçš„å®ç°åŸç†3.1ã€åŸºæœ¬å®ç°åŸç†&emsp;&emsp;Springçš„ç¼“å­˜å®ç°ï¼Œä¾èµ–äºSpring AOPï¼Œé€šè¿‡è·å–ä¸Šé¢è®²è¿°çš„äº”ä¸ªæ³¨è§£çš„åˆ‡ç‚¹ä½ç½®ï¼Œæ¥å®ç°å¯¹åº”çš„åŠŸèƒ½ã€‚&emsp;&emsp;é‚£ä¹ˆæ„å‘³ç€å¦‚æœè¦ä½¿ç”¨ç¼“å­˜æˆ–è€…ç¼“å­˜ç”Ÿæ•ˆå‰æï¼Œæ‰€æœ‰çš„ç¼“å­˜æ–¹æ³•è°ƒç”¨å®ä¾‹éƒ½å¿…é¡»æ˜¯Spring ä»£ç†çš„Beanã€‚å¦åˆ™çš„è¯å°±æ— æ³•ä½¿ç”¨ã€‚ 3.2ã€æ ¸å¿ƒå®ç°ç±»Spring Cacheçš„æ ¸å¿ƒç±»çš„ä¾èµ–å…³ç³»å›¾ï¼š Spring Cacheçš„æ‰§è¡Œé€»è¾‘ï¼š 3.3ã€Spring Cache æ³¨è§£å¤±æ•ˆçš„åœºæ™¯åœ¨å¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œå¯èƒ½ä¼šå‘ç°ç¼“å­˜æ²¡æœ‰ç”Ÿæ•ˆï¼ŒåŸå› å¯èƒ½å¦‚ä¸‹ï¼š 1ã€æ–¹æ³•æ‰€åœ¨çš„Beanæ²¡æœ‰æ³¨å…¥åˆ°Springçš„å®¹å™¨2ã€æ–¹æ³•æ˜¯ç§æœ‰çš„æˆ–è€…æ˜¯finalä¿®é¥°çš„3ã€æ–¹æ³•çš„è°ƒç”¨å¯¹è±¡ä¸ºéSpringçš„ä»£ç†ç±»ï¼Œç±»ä¼¼äºthis.method()æ–¹å¼è°ƒç”¨ å››ã€è‡ªå®šä¹‰Spring Cacheåœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ï¼Œåšäº†ä¸€ä¸ªç®€å•çš„å°demoæ‹“å±•äº†ä¸€ä¸ªCacheæ–¹å¼ï¼Œå°è¯•å°†ç¼“å­˜å­˜å‚¨åˆ°Mysqlçš„æ•°æ®è¡¨ä¸­ã€‚ 4.1ã€å‡†å¤‡é˜¶æ®µ æŠ€æœ¯é€‰å‹ ç‰ˆæœ¬ java 1.8.0_241 Spring boot 2.3.0.release Spring jpa 2.3.0.release æ•°æ®åº“ Mysql 5.x Spring boot test 2.3.0.release å®ä½“ç±»åŠ å¼ºå·¥å…· lombok 4.2ã€åˆ›å»ºç¼“å­˜è¡¨çš„CRUD123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109package com.yiyi.cache.cache.entity;import lombok.Data;import javax.persistence.*;import java.time.LocalDateTime;/** * @author wuxuan.chai * @date 2020/6/4 1:42 ä¸‹åˆ */@Data@Entity(name = &quot;t_cache&quot;)public class CacheObject &#123; @Id @GeneratedValue(strategy = GenerationType.AUTO) private Long id; @Column(name = &quot;cache_key&quot;,nullable = false) private String cacheKey; @Column(name = &quot;cache_value&quot;,nullable = false) private String cacheValue; @Column(name = &quot;create_date&quot;,nullable = false) private LocalDateTime createDate;&#125;package com.yiyi.cache.cache.entity;import org.springframework.data.jpa.repository.JpaRepository;import org.springframework.data.jpa.repository.Modifying;import org.springframework.transaction.annotation.Transactional;/** * @author wuxuan.chai * @date 2020/6/4 4:07 ä¸‹åˆ */public interface CacheObjectMapper extends JpaRepository&lt;CacheObject,String&gt; &#123; CacheObject getByCacheKey(String cacheKey); @Modifying @Transactional void deleteCacheObjectByCacheKey(String cacheKey);&#125;package com.yiyi.cache.cache.entity;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.SneakyThrows;import org.springframework.stereotype.Service;import org.springframework.transaction.annotation.Transactional;import javax.annotation.Resource;import java.time.LocalDateTime;/** * @author wuxuan.chai * @date 2020/6/4 4:08 ä¸‹åˆ */@Servicepublic class CacheObjectService &#123; @Resource private CacheObjectMapper cacheObjectMapper; public String getValue(String key)&#123; CacheObject cacheObject = cacheObjectMapper.getByCacheKey(key); if (cacheObject == null)&#123; return null; &#125; return cacheObject.getCacheValue(); &#125; @SneakyThrows @Transactional(rollbackFor = Exception.class) public void putValue(String key, String value) &#123; CacheObject oldCacheObject = cacheObjectMapper.getByCacheKey(key); if (oldCacheObject != null)&#123; cacheObjectMapper.delete(oldCacheObject); &#125; CacheObject cacheObject = new CacheObject(); cacheObject.setCacheKey(key); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(value); cacheObject.setCacheValue(json); cacheObject.setCreateDate(LocalDateTime.now()); cacheObjectMapper.save(cacheObject); &#125; public void evict(String key) &#123; cacheObjectMapper.deleteCacheObjectByCacheKey(key); &#125; @Transactional public void clear() &#123; cacheObjectMapper.deleteAll(); &#125;&#125; 4.3ã€Spring Cacheçš„æ‹“å±•4.3.1ã€å®šä¹‰CacheManager12345678910111213141516171819202122232425262728293031323334353637package com.yiyi.cache.cache.manager;import org.springframework.cache.Cache;import org.springframework.cache.CacheManager;import java.util.Collection;import java.util.concurrent.ConcurrentHashMap;import java.util.concurrent.ConcurrentMap;/** * @author wuxuan.chai * @date 2020/6/4 3:52 ä¸‹åˆ */public class CustomCacheManager implements CacheManager &#123; //å®šä¹‰å­˜å‚¨Cacheçš„å­˜å‚¨å™¨ï¼Œæ‰€æœ‰æ‹“å±•å¹¶ä¸”å®ä¾‹åŒ–çš„Cacheå¯¹è±¡éƒ½ä¼šå­˜åˆ°è¿™é‡Œé¢ private final static ConcurrentMap&lt;String,Cache&gt; cacheMap = new ConcurrentHashMap&lt;&gt;(); //é€šè¿‡åç§°ï¼Œè·å–Cacheå®ä¾‹åŒ–å¯¹è±¡ï¼Œæˆ‘ä»¬å®šä¹‰Cacheableçš„æ³¨è§£ç”¨åˆ°çš„CacheNameså±æ€§çš„å€¼ï¼Œæ‰€æ ‡æ³¨çš„åç§°è·å–Cacheå®ä¾‹å°±æ˜¯è¿™ä¸ªæ–¹æ³•æä¾›çš„ @Override public Cache getCache(String name) &#123; return cacheMap.get(name); &#125; //è·å–æ‰€æœ‰çš„cacheå®ä¾‹åŒ–å¯¹è±¡çš„åç§° @Override public Collection&lt;String&gt; getCacheNames() &#123; return cacheMap.keySet(); &#125; //åˆ›å»ºCacheå®ä¾‹ public void createCache(Cache cache)&#123; cacheMap.put(cache.getName(),cache); &#125;&#125; 4.3.2ã€å®šä¹‰Cache1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192package com.yiyi.cache.cache.manager;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.SerializerProvider;import com.yiyi.cache.cache.entity.CacheObjectService;import com.yiyi.cache.cache.serializer.CustomSerializerImpl;import lombok.SneakyThrows;import org.springframework.beans.BeansException;import org.springframework.cache.Cache;import org.springframework.cache.support.SimpleValueWrapper;import org.springframework.context.ApplicationContext;import org.springframework.context.ApplicationContextAware;import org.springframework.stereotype.Component;import java.util.concurrent.Callable;/** * @author wuxuan.chai * @date 2020/6/4 4:02 ä¸‹åˆ */@Componentpublic class MysqlCache implements Cache, ApplicationContextAware &#123; public final static String NAME = &quot;MYSQL&quot;; private ApplicationContext applicationContext; @Override public String getName() &#123; return NAME; &#125; @Override public Object getNativeCache() &#123; return this; &#125; @Override public ValueWrapper get(Object key) &#123; String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString()); return value != null ? new SimpleValueWrapper(fromStoreValue(value)) : null; &#125; @SneakyThrows @Override public &lt;T&gt; T get(Object key, Class&lt;T&gt; type) &#123; String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString()); return (T) fromStoreValue(value); &#125; @SneakyThrows @Override public &lt;T&gt; T get(Object key, Callable&lt;T&gt; valueLoader) &#123; String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString()); return (T) fromStoreValue(value); &#125; @Override public void put(Object key, Object value) &#123; String cacheValue = toStoreValue(value); applicationContext.getBean(CacheObjectService.class).putValue(key.toString(), cacheValue); &#125; @Override public void evict(Object key) &#123; applicationContext.getBean(CacheObjectService.class).evict(key.toString()); &#125; @Override public void clear() &#123; applicationContext.getBean(CacheObjectService.class).clear(); &#125; @Override public void setApplicationContext(ApplicationContext applicationContext) throws BeansException &#123; this.applicationContext = applicationContext; &#125; @SneakyThrows private String toStoreValue(Object value)&#123; CustomSerializerImpl customSerializer = new CustomSerializerImpl(); return customSerializer.serialize(value); &#125; @SneakyThrows private Object fromStoreValue(String value)&#123; CustomSerializerImpl customSerializer = new CustomSerializerImpl(); return customSerializer.deserialize(value); &#125;&#125; 4.3.3ã€é…ç½®Cache1234567891011121314151617181920212223242526272829303132package com.yiyi.cache.cache.config;import com.yiyi.cache.cache.manager.CustomCacheManager;import com.yiyi.cache.cache.manager.MysqlCache;import org.springframework.cache.CacheManager;import org.springframework.cache.concurrent.ConcurrentMapCache;import org.springframework.context.annotation.Bean;import org.springframework.context.annotation.Configuration;import javax.annotation.Resource;/** * @author wuxuan.chai * @date 2020/6/4 3:40 ä¸‹åˆ */@Configurationpublic class CacheConfig &#123; @Resource private MysqlCache mysqlCache; //å®šä¹‰äº†ä¸¤ä¸ªCacheï¼šä¸€ä¸ªè‡ªå·±å®ç°çš„MysqlCacheï¼ˆMysqlï¼‰ è¿˜æœ‰ä¸€ä¸ªå°±æ˜¯Spring Cacheé»˜è®¤å®ç°äº†çš„åŸºäºå¹¶å‘åŒ…ConcurrentMapå®ç°çš„çš„ConcurrentMapCache (LOCAL) @Bean public CacheManager cacheManager()&#123; CustomCacheManager customCacheManager = new CustomCacheManager(); customCacheManager.createCache(mysqlCache); ConcurrentMapCache local = new ConcurrentMapCache(&quot;LOCAL&quot;); customCacheManager.createCache(local); return customCacheManager; &#125;&#125; 4.4.4ã€Cacheçš„ä½¿ç”¨123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051package com.yiyi.cache.cache.service;import com.yiyi.cache.cache.entity.User;import com.yiyi.cache.cache.manager.MysqlCache;import org.springframework.cache.annotation.CacheEvict;import org.springframework.cache.annotation.Cacheable;import org.springframework.cache.annotation.Caching;import org.springframework.stereotype.Service;/** * @author wuxuan.chai * @date 2020/6/4 2:46 ä¸‹åˆ */@Servicepublic class CacheDemoService &#123; @Cacheable(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;) public String get(String name) &#123; return name; &#125; @Cacheable(cacheNames = MysqlCache.NAME, keyGenerator = &quot;customKeyGenerator&quot;) public User keyGenerator(String name, String value) &#123; User user = new User(); user.setUsername(name+value); return user; &#125; @Cacheable(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-getUser&#x27;+ args[0]&quot;) public User getUser(String name) &#123; User user = new User(); user.setUsername(name); return user; &#125; @Cacheable(cacheNames = &quot;LOCAL&quot;, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;) public String getLocalCache(String name) &#123; return name; &#125; @Caching(evict = &#123; @CacheEvict(cacheNames = &#123;MysqlCache.NAME&#125;, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;), @CacheEvict(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-getUser&#x27;+ args[0]&quot;) &#125;) public void clearCache(String name) &#123; &#125;&#125; æµ‹è¯•ç”¨ä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354import com.yiyi.cache.SpringCacheApplication;import com.yiyi.cache.cache.entity.User;import com.yiyi.cache.cache.service.CacheDemoService;import org.junit.jupiter.api.Test;import org.springframework.boot.test.context.SpringBootTest;import javax.annotation.Resource;/** * @author wuxuan.chai * @date 2020/6/4 2:49 ä¸‹åˆ */@SpringBootTest(classes = &#123;SpringCacheApplication.class&#125;)public class CacheDemoServiceTest &#123; @Resource private CacheDemoService cacheDemoService; @Test public void testGet()&#123; String name = &quot;1231231&quot;; String s = cacheDemoService.get(name); System.out.println(s); System.out.println(cacheDemoService.get(&quot;1231&quot;).equals(&quot;1231&quot;)); &#125; @Test public void testGetUser()&#123; String name = &quot;1231231&quot;; User user = cacheDemoService.getUser(name); System.out.println(user.getUsername().equals(name)); &#125; @Test public void testGetLocalCache()&#123; String name = &quot;1231231&quot;; String s = cacheDemoService.getLocalCache(name); System.out.println(s); System.out.println(cacheDemoService.getLocalCache(&quot;1231&quot;).equals(&quot;1231&quot;)); &#125; @Test public void testClearCache()&#123; cacheDemoService.clearCache(&quot;1231231&quot;); &#125; @Test public void testKeyGenerator()&#123; User wuxuan = cacheDemoService.keyGenerator(&quot;wuxuan&quot;, &quot;123456&quot;); System.out.println(wuxuan); &#125;&#125; äº”ã€æ€»ç»“&emsp;&emsp;é€šè¿‡é˜…è¯»Spring Cacheçš„æºç åï¼Œæ„Ÿè§‰æ”¶è·åˆ°äº†å¾ˆå¤šï¼Œé¦–å…ˆä»å¿ƒç†ä¸Šè®¤è¯†åˆ°ï¼Œæºç ä¹Ÿå¹¶æ²¡æœ‰é‚£ä¹ˆçš„éš¾ã€‚å…¶æ¬¡ï¼ŒSpring èƒ½å¤Ÿå—åˆ°å¹¿å¤§Javaå¼€å‘äººå‘˜çš„è¿½æ§ä¹Ÿå¹¶éå¶ç„¶ï¼ŒSpringçš„æºç ä»æ€è·¯ä¸Šä»¥åŠè®¾è®¡ä¸Šè¿˜æ˜¯éå¸¸çš„ä¼˜ç§€çš„ï¼Œä»ä¸­èƒ½å¤Ÿå­¦åˆ°å¾ˆå¤šã€‚ä»¥åå†æ¥å†å‰ï¼Œå¤šå¤šå°è¯•Discover Why è€Œä¸ Ask Whyã€‚","categories":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"}],"tags":[{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"}],"author":"wuxuan.chai"},{"title":"Macçš„VMä¸­è®¾ç½®è™šæ‹Ÿæœºé™æ€ip","slug":"Macçš„VMä¸­è®¾ç½®è™šæ‹Ÿæœºé™æ€ip","date":"2021-01-17T16:13:21.416Z","updated":"2021-02-22T01:45:00.023Z","comments":true,"path":"2021/01/18/Macçš„VMä¸­è®¾ç½®è™šæ‹Ÿæœºé™æ€ip/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Mac%E7%9A%84VM%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%9D%99%E6%80%81ip/","excerpt":"","text":"Macçš„VMä¸­è®¾ç½®è™šæ‹Ÿæœºé™æ€ipé—²æ¥æ— äº‹ï¼Œæƒ³å­¦ä¹ ä¸‹sparkç›¸å…³çš„çŸ¥è¯†ï¼Œäºæ˜¯éœ€è¦å‡ å°æœåŠ¡å™¨ï¼Œæ— å¥ˆå›Šä¸­ç¾æ¶©åŒåä¸€éƒ½ä¹°ä¸èµ·ä¸€å°æœåŠ¡å™¨ï¼Œåªèƒ½å€ŸåŠ©2015æ¬¾çš„mac proå¸®åŠ©è™šæ‹Ÿå‡ å°æœåŠ¡å™¨æ¥æš‚æ—¶ç”¨ç”¨ã€‚ å‡†å¤‡è¿‡ç¨‹FinalShell ä¸€æ¬¾å›½äº§çš„macä¸Šå¯ç”¨çš„shellå‘½ä»¤å·¥å…·VMware Fusion macä¸Šç”¨æ¥å®‰è£…è™šæ‹Ÿæœºçš„å·¥å…·centos7 çš„æœ€ç®€ç‰ˆé•œåƒ è®¾ç½®VMware Fusionç¬¬ä¸€æ­¥ï¼šä¿®æ”¹vmware é…ç½®ç½‘å¡çš„é…ç½®æ–‡ä»¶åªæ›´æ”¹Vnet8 çš„ç½‘å¡ 1234567891011121314151617181920$ vim /Library/Preferences/VMware\\ Fusion/networkingVERSION=1,0answer VNET_1_DHCP yesanswer VNET_1_DHCP_CFG_HASH EC13F23285B5086AFF5BDFFA85E8DE0338C2AF74answer VNET_1_HOSTONLY_NETMASK 255.255.255.0answer VNET_1_HOSTONLY_SUBNET 172.16.208.0answer VNET_1_VIRTUAL_ADAPTER yes#å…³é—­dhcpanswer VNET_8_DHCP noanswer VNET_8_DHCP_CFG_HASH 13FB4A1FC14575A20209A2C7C8C2E5EED98C6665# å­ç½‘æ©ç answer VNET_8_HOSTONLY_NETMASK 255.255.255.0#è®¾ç½®ipæ®µanswer VNET_8_HOSTONLY_SUBNET 192.168.100.0answer VNET_8_NAT yesanswer VNET_8_VIRTUAL_ADAPTER yes# vmnet8 çš„IPanswer VNET_8_VIRTUAL_ADAPTER_ADDR 192.168.100.1 ç¬¬äºŒæ­¥ï¼šè®¾ç½®ç½‘å…³1234567#é…ç½®nat.conf è¿™ä¸ªæ–‡ä»¶vim /Library/Preferences/VMware\\ Fusion/vmnet8/nat.conf #è®¾å®šnatç½‘ç®¡å’Œå­ç½‘# NAT gateway addressip = 192.168.100.2netmask = 255.255.255.0 ç¬¬ä¸‰æ­¥ï¼š é‡å¯vmnet8ç½‘å¡1234567# æŸ¥çœ‹ç½‘å¡çŠ¶æ€$ sudo /Applications/VMware\\ Fusion.app/Contents/Library/vmnet-cli --status # å…³é—­ç½‘å¡$ sudo /Applications/VMware\\ Fusion.app/Contents/Library/vmnet-cli --stop# å¯åŠ¨ç½‘å¡$ sudo /Applications/VMware\\ Fusion.app/Contents/Library/vmnet-cli --start ï½ï½ï½ï½ä¸­é—´çœå»åœ¨vmä¸­åˆ›å»ºcentosçš„è™šæ‹Ÿæœºæ­¥éª¤ï½ï½ï½ï½ ç¬¬å››æ­¥ï¼šè®¾ç½®centosç½‘å¡1ã€é…ç½®ç½‘å¡1234567891011121314151617181920212223242526272829 $ vi /etc/sysconfig/network-scripts/ifcfg-ens33 TYPE=EthernetPROXY_METHOD=noneBROWSER_ONLY=no# è®¾ç½®é™æ€çš„ipï¼Œè€Œä¸æ˜¯dhcpæ–¹å¼BOOTPROTO=staticDEFROUTE=yesIPV4_FAILURE_FATAL=noIPV6INIT=yesIPV6_AUTOCONF=yesIPV6_DEFROUTE=yesIPV6_FAILURE_FATAL=noIPV6_ADDR_GEN_MODE=stable-privacyNAME=ens33UUID=74ad3dd0-742d-422b-b165-6f0d0b6e2f6dDEVICE=ens33# è®¾ç½®ç½‘å¡å¼€æœºå¯åŠ¨ONBOOT=yes# è®¾ç½®å½“å‰centosçš„ipåœ°å€IPADDR=192.168.100.15# è®¾ç½®ç½‘å…³GATEWAY=192.168.100.2# è®¾ç½®å­ç½‘æ©ç NETMASK=255.255.255.0#è®¾ç½®dnsDNS1=119.29.29.29DNS2=182.254.116.116 2ã€é‡å¯centosç½‘å¡123456#é‡å¯ç½‘å¡systemctl restart network # æŸ¥çœ‹ç½‘å¡ip addr 2ã€æµ‹è¯•12345678910111213141516171819$ ip addr1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000 link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00 inet 127.0.0.1/8 scope host lo valid_lft forever preferred_lft forever inet6 ::1/128 scope host valid_lft forever preferred_lft forever2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000 link/ether 00:0c:29:dd:bc:55 brd ff:ff:ff:ff:ff:ff inet 192.168.100.15/24 brd 192.168.100.255 scope global noprefixroute ens33 valid_lft forever preferred_lft forever inet6 fe80::a3c4:b923:6d37:e7aa/64 scope link tentative noprefixroute dadfailed valid_lft forever preferred_lft forever inet6 fe80::3427:d5be:210e:dce2/64 scope link tentative noprefixroute dadfailed valid_lft forever preferred_lft forever inet6 fe80::3f6a:22ae:8bdd:e0ac/64 scope link noprefixroute valid_lft forever preferred_lft forever æµ‹è¯•å‘ç°ens33çš„ipåœ°å€å·²ç»å˜æˆäº†æˆ‘ä»¬è®¾ç½®çš„ipäº†. æµ‹è¯•è®¿é—®å¤–ç½‘ 1234567891011$ ping www.baidu.comPING www.a.shifen.com (180.101.49.12) 56(84) bytes of data.64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=1 ttl=128 time=17.9 ms64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=2 ttl=128 time=117 ms64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=4 ttl=128 time=26.7 ms^C--- www.a.shifen.com ping statistics ---4 packets transmitted, 3 received, 25% packet loss, time 3004msrtt min/avg/max/mdev = 17.996/54.184/117.813/45.134 ms å¤§å·¥å‘Šæˆï¼Œå¼€å§‹happyï¼ï¼ï¼","categories":[{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://cha1yi.github.io/dist/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"}],"tags":[{"name":"Mac","slug":"Mac","permalink":"https://cha1yi.github.io/dist/tags/Mac/"},{"name":"VM","slug":"VM","permalink":"https://cha1yi.github.io/dist/tags/VM/"}],"author":"wuxuan.chai"},{"title":"Apache SkyWalking å•æœºç‰ˆæµ‹è¯•","slug":"Apache SkyWalking å•æœºç‰ˆæµ‹è¯•","date":"2021-01-17T16:11:29.586Z","updated":"2021-01-18T02:21:54.194Z","comments":true,"path":"2021/01/18/Apache SkyWalking å•æœºç‰ˆæµ‹è¯•/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/Apache%20SkyWalking%20%E5%8D%95%E6%9C%BA%E7%89%88%E6%B5%8B%E8%AF%95/","excerpt":"","text":"Apache SkyWalking å•æœºç‰ˆæµ‹è¯•ä¸€ã€éƒ¨ç½²SkyWalkingå­¦ä¹ ä¹‹å‰ï¼Œæœ€å¥½å…ˆæµè§ˆä¸€ä¸‹SkyWalkingçš„è®¾è®¡åŸç†ï¼šåˆ†å¸ƒå¼è¿½è¸ª &amp; APM ç³»ç»Ÿ SkyWalking æºç åˆ†æ â€”â€” Collector å­˜å‚¨ Trace æ•°æ® 1ã€ä¸‹è½½SkyWalkingSkyWalkingå®˜æ–¹ä¸‹è½½åœ°å€ 2ã€è§£å‹tar.gzå¾—åˆ°ç±»ä¼¼çš„ç›®å½•ï¼š 3ã€å¯åŠ¨SkyWalkingSkyWalkingå¯åŠ¨åˆ†ä¸¤æ­¥è¿›è¡Œï¼šwebAppã€OapServer 1234567891011121314localhost:bin wuxuan.chai$ pwd/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/binlocalhost:bin wuxuan.chai$ ls -l-rwxr-xr-x 1 wuxuan.chai staff 1352 12 24 14:10 oapService.bat-rwxr-xr-x 1 wuxuan.chai staff 1599 12 24 14:10 oapService.sh-rwxr-xr-x 1 wuxuan.chai staff 1364 12 24 14:10 oapServiceInit.bat-rwxr-xr-x 1 wuxuan.chai staff 1597 12 24 14:10 oapServiceInit.sh-rwxr-xr-x 1 wuxuan.chai staff 1367 12 24 14:10 oapServiceNoInit.bat-rwxr-xr-x 1 wuxuan.chai staff 1616 12 24 14:10 oapServiceNoInit.sh-rwxr-xr-x 1 wuxuan.chai staff 941 12 24 14:10 startup.bat-rwxr-xr-x 1 wuxuan.chai staff 934 12 24 14:10 startup.sh-rwxr-xr-x 1 wuxuan.chai staff 1426 12 24 14:10 webappService.bat-rwxr-xr-x 1 wuxuan.chai staff 1630 12 24 14:10 webappService.shlocalhost:bin wuxuan.chai$ binç›®å½•é‡Œé¢åŒ…å«äº†ä¸‰ä¸ªéƒ¨åˆ†ï¼šoapæœåŠ¡ã€oapæœåŠ¡åˆå§‹åŒ–ã€webappService webappServiceæœåŠ¡çš„ä½œç”¨ï¼šæä¾›SkyWalkingçš„webæœåŠ¡ oapæœåŠ¡åˆå§‹åŒ–ï¼šåˆå§‹åŒ–oapæœåŠ¡æ‰€éœ€è¦çš„ç¯å¢ƒåˆå§‹åŒ–ï¼Œä¾‹å¦‚ï¼šDataStorageçš„åˆå§‹åŒ–,è¯»å–é…ç½®ä¸­å¿ƒé…ç½®ç­‰ oapæœåŠ¡ï¼šç›¸å½“äºç›‘æ§æ•°æ®çš„æ”¶é›†ï¼ˆcollecterï¼‰å’ŒæŒä¹…åŒ– å¦‚æœé…ç½®å®Œæˆï¼Œå¯ä»¥ç›´æ¥æ‰§è¡Œ sh startup.sh,å¯åŠ¨æ•´ä¸ªé¡¹ç›® 4ã€SkyWalkingç›¸å…³çš„é…ç½®4.1ã€oapæ”¶é›†æ•°æ®å­˜å‚¨ä½ç½®é…ç½®12345# æ‰“å¼€é…ç½®æ–‡ä»¶~ vim ./config/application.yml# æŸ¥çœ‹storageé…ç½®é¡¹çš„æ”¯æŒï¼ŒSkyWalkingæ”¯æŒå°†æ•°æ®è½åœ°åˆ°ï¼šelasticsearchã€elasticsearch7ã€h2# æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®å“åº”çš„é…ç½®ä¿¡æ¯ 4.2ã€è®¾ç½®é…ç½®ä¸­å¿ƒSkyWalkingæ”¯æŒçš„é…ç½®ä¸­å¿ƒæœ‰apolloã€nacosã€zookeeperã€etcdã€consul 123# æ‰“å¼€é…ç½®æ–‡ä»¶~ vim ./config/application.yml# æ ¹æ®å®é™…éœ€æ±‚è®¾ç½®å“åº”çš„é…ç½®ä¿¡æ¯ 4.3ã€æœåŠ¡ç«¯å£çš„è®¾ç½®1234# æ‰“å¼€é…ç½®æ–‡ä»¶~ vim ./webapp/webapp.yml# ä¿®æ”¹webç«¯å£ï¼Œserver.port=9090 é»˜è®¤ä¸º8080# cellectoræœåŠ¡çš„è°ƒç”¨åœ°å€ ä¿®æ”¹listOfServersï¼Œå¤šä¸ªæœåŠ¡ç”¨â€˜,â€™éš”å¼€ 4.4ã€Agentçš„é…ç½®1234567# æ‰“å¼€é…ç½®æ–‡ä»¶ï½ vim ./agent/config/agent.config# oapserviceçš„åç«¯æœåŠ¡ï¼Œç”¨äºåº”ç”¨è®¢é˜…ï¼ˆé»˜è®¤å€¼127.0.0.1:11800ï¼‰collector.backend_service=xxx# æ˜¯å¦è¿½è¸ªsqlçš„å‚æ•°plugin.mysql.trace_sql_parameters=true/false é…ç½®å®Œæˆè¿™äº›åŸºæœ¬é…ç½®ä¹‹åï¼Œå°±å¯ä»¥ç›´æ¥æ‰§è¡Œ sh startup.sh,å¯åŠ¨æ•´ä¸ªé¡¹ç›®äº† 5ã€å°†åº”ç”¨åŠ å…¥åˆ°SkyWalkingçš„ç›‘æ§ä»£ç†ä¸­5.1ã€springbooté¡¹ç›®springbootåº”ç”¨ï¼šå¯åŠ¨springbootçš„demoåº”ç”¨ï¼Œ 1234567891011#!/usr/bin/env sh# SkyWalking Agent é…ç½®export SW_AGENT_NAME=demo-application # é…ç½® Agent åå­—ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬ç›´æ¥ä½¿ç”¨ Spring Boot é¡¹ç›®çš„ `spring.application.name` ã€‚export SW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 # é…ç½® Collector åœ°å€ã€‚export SW_AGENT_SPAN_LIMIT=2000 # é…ç½®é“¾è·¯çš„æœ€å¤§ Span æ•°é‡ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é…ç½®ï¼Œé»˜è®¤ä¸º 300 ã€‚ä¸»è¦è€ƒè™‘ï¼Œæœ‰äº›æ–°ä¸Š SkyWalking Agent çš„é¡¹ç›®ï¼Œä»£ç å¯èƒ½æ¯”è¾ƒç³Ÿç³•ã€‚export JAVA_AGENT=-javaagent:/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar # SkyWalking Agent jar åœ°å€ã€‚# Jar å¯åŠ¨java -jar $JAVA_AGENT -jar lab-39-demo-2.2.2.RELEASE.jar æ‰§è¡Œå¯åŠ¨è„šæœ¬ï¼Œå³å¯åœ¨SkyWalkingçš„æ‹“æ‰‘å›¾ä¸­çœ‹åˆ°å¯¹åº”çš„æœåŠ¡ç›‘æ§ä¿¡æ¯ 5.2ã€ä¼ ç»Ÿçš„ssmé¡¹ç›®ï¼Œä½¿ç”¨tomcat/jettyç­‰å®¹å™¨å‘å¸ƒçš„å·¥ç¨‹éœ€è¦åœ¨å¯åŠ¨çš„å‚æ•°ä¸­åŠ å…¥ 1234-DSW_AGENT_NAME=xxx-DSW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800-DSW_AGENT_SPAN_LIMIT=2000-javaagent:/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar å¯åŠ¨tomcat/jettyï¼Œå³å¯ã€‚ æ•ˆæœå¦‚å›¾ï¼š","categories":[{"name":"é¡¹ç›®ç®¡ç†","slug":"é¡¹ç›®ç®¡ç†","permalink":"https://cha1yi.github.io/dist/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"}],"tags":[{"name":"SkyWalking","slug":"SkyWalking","permalink":"https://cha1yi.github.io/dist/tags/SkyWalking/"},{"name":"ç³»ç»Ÿç›‘æ§","slug":"ç³»ç»Ÿç›‘æ§","permalink":"https://cha1yi.github.io/dist/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"}],"author":"wuxuan.chai"},{"title":"Mavenå¸¸ç”¨å‘½ä»¤","slug":"mavenç›¸å…³å‘½ä»¤","date":"2021-01-17T16:10:41.139Z","updated":"2021-06-05T14:56:50.427Z","comments":true,"path":"2021/01/18/mavenç›¸å…³å‘½ä»¤/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/maven%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/","excerpt":"","text":"mavenå¸¸ç”¨å‘½ä»¤ä¸€ã€ä¸Šä¼ åŒ…åˆ°mavenä¸­å¤®ä»“åº“å‘½ä»¤ï¼š 1mvn deploy:deploy-file -DgroupId=com.aliyun -DartifactId=taobao-sdk-java-auto -Dversion=202011-release -Dpackaging=jar -Dfile=/Users/wuxuan.chai/Downloads/dingtalk-sdk-java/taobao-sdk-java-auto_1479188381469-20201126.jar -Durl=http://ci.yunat.com:8091/nexus/content/repositories/thirdparty/ -DrepositoryId=nexus å‚æ•°è§£é‡Š:deploy:deploy-fileï¼šå‘å¸ƒï¼Œå‘å¸ƒæ–‡ä»¶åˆ°è¿œç¨‹ï¼Œå’Œinstallçš„åŒºåˆ«åœ¨äºï¼Œinstallçš„æ„æ€æ˜¯å°†jarå®‰è£…åˆ°æœ¬åœ°mavenä»“åº“groupIdã€artifactIdã€versionï¼šè¡¨ç¤ºmavençš„åæ ‡fileï¼šå‘å¸ƒçš„æ–‡ä»¶çš„æœ¬åœ°åœ°å€urlï¼šè¿œç¨‹ä»“åº“çš„åœ°å€repositoryIdï¼šæœ¬åœ°mavené…ç½®æ–‡ä»¶çš„ä»“åº“idï¼Œé…ç½®è¿™ä¸ªçš„è¯ä»–ä¼šå»æ‰¾é…ç½®æ–‡ä»¶ä¸­çš„å¯¹åº”ä»“åº“çš„è®¿é—®é‰´æƒæ‰€éœ€çš„è´¦æˆ·å’Œå¯†ç ","categories":[{"name":"å¼€å‘æ€»ç»“","slug":"å¼€å‘æ€»ç»“","permalink":"https://cha1yi.github.io/dist/categories/%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"maven","slug":"maven","permalink":"https://cha1yi.github.io/dist/tags/maven/"}],"author":"wuxuan.chai"},{"title":"é¡¹ç›®ç‰ˆæœ¬ç®¡ç†çš„æœ€ä½³å®è·µ","slug":"é¡¹ç›®ç‰ˆæœ¬ç®¡ç†çš„æœ€ä½³å®è·µ","date":"2021-01-17T16:06:38.488Z","updated":"2021-06-05T14:57:20.277Z","comments":true,"path":"2021/01/18/é¡¹ç›®ç‰ˆæœ¬ç®¡ç†çš„æœ€ä½³å®è·µ/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/18/%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/","excerpt":"","text":"é¡¹ç›®ç‰ˆæœ¬ç®¡ç†çš„æœ€ä½³å®è·µä¸€ã€Gitè®¾ç½®1ã€æ·»åŠ å…¬é’¥ 1234567891011121314151617æ‰“å¼€ git bash (mac ä¸‹ç›´æ¥æ‰“å¼€ç»ˆç«¯å³å¯)#: ssh-keygen -t rsa -C &quot;é‚®ç®±&quot;#: cat ~/.ssh/id_rsa.pubä¼šç”Ÿæˆï¼šä»¥ssh-rsa å¼€å¤´çš„å­—ç¬¦ä¸²ï¼Œå¤åˆ¶ï¼Œè´´åˆ°gitå…¬é’¥ç®¡ç†é‡Œé¢æµ‹è¯•æ˜¯å¦å¯ä»¥é€šè¿‡å…¬é’¥ï¼Œå…å¯†æ‹‰å–ä¸Šä¼ ä»£ç #: ssh -T git@gitee.com ï¼ˆæˆ‘è¿™é‡Œç”¨çš„giteeï¼Œå¯¹åº”çš„åŸŸåè¯·è‡ªè¡Œåˆ‡æ¢ï¼‰æˆåŠŸï¼šHi æŸ´æ¢§ç‚« (DeployKey)! You&#x27;ve successfully authenticated, but GITEE.COM does not provide shell access.Note: Perhaps the current use is DeployKey.Note: DeployKey only supports pull/fetch operationså¤±è´¥ï¼šThe authenticity of host &#x27;gitlab.com (172.65.251.78)&#x27; can&#x27;t be established.ECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw. äºŒã€é¡¹ç›®ç‰ˆæœ¬åœ¨webå¼€å‘çš„è¿‡ç¨‹ä¸­ï¼Œmaven é™¤äº†ä½œä¸ºé¡¹ç›®çš„ä¾èµ–ç®¡ç†ä¹‹å¤–ï¼Œè¿˜å¤„ç†ç€é¡¹ç›®çš„ç‰ˆæœ¬æ§åˆ¶ 1ã€maven çš„å¤šé¡¹ç›®çš„æ ‡å‡†ç»“æ„1.1ã€å¦‚ä½•ç»„ç»‡é¡¹ç›®123456789101112131415161718[MavenMultiProject] â”œâ”€â”€ module-1 â”‚ â”œâ”€â”€ pom.xml â”‚ â””â”€â”€ src â”œâ”€â”€ module-2 â”‚ â”œâ”€â”€ pom.xml â”‚ â””â”€â”€ src â”œâ”€â”€ module-3 â”‚ â”œâ”€â”€ pom.xml â”‚ â”œâ”€â”€ module-3-1 â”‚ â”œâ”€â”€ pom.xml â”‚ â””â”€â”€ src â”‚ â”œâ”€â”€ module-3-2 â”‚ â”œâ”€â”€ pom.xml â”‚ â””â”€â”€ src â”œâ”€â”€ pom.xml â”œâ”€â”€ README.en.md â”œâ”€â”€ README.md å…¶ä¸­å­æ¨¡å—ä¹Ÿå¯ä»¥æœ‰å…¶å­æ¨¡å— 1.2ã€POMæ–‡ä»¶ä¸­çš„å†…å®¹1.2.1ã€parent pom.xmlçˆ¶æ¨¡å—çš„pomæ–‡ä»¶ä¸€èˆ¬å­˜æ”¾å…¬ç”¨çš„ä¿¡æ¯ï¼Œä»¥åŠå®šä¹‰æ ‡å‡†ï¼Œæ‰“åŒ…çš„æ ¼å¼ï¼špom é™¤äº†ä¸Šè¿°çš„ä¿¡æ¯ï¼Œä¸€èˆ¬ä¸è¦å¼•å…¥å…¶ä»–çš„å…ƒç´ ï¼Œå› ä¸ºä¸€æ—¦å¼•å…¥ï¼Œå­æ¨¡å—å°±ä¼šç»§æ‰¿è¿™äº›ä¾èµ–ï¼Œå¯¼è‡´å­æ¨¡å—çš„ä¾èµ–è¢«æ±¡æŸ“ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758&lt;!-- å±æ€§å®šä¹‰--&gt;&lt;properties&gt; &lt;java.version&gt;1.8&lt;/java.version&gt; ....&lt;/properties&gt;&lt;!-- ä»“åº“çš„å®šä¹‰ --&gt;&lt;distributionManagement&gt; &lt;repository&gt; &lt;id&gt;local nexus&lt;/id&gt; &lt;name&gt;local nexus&lt;/name&gt; &lt;url&gt;http://localhost:8081/repository/maven-releases/&lt;/url&gt; &lt;/repository&gt; &lt;snapshotRepository&gt; &lt;id&gt;local nexus&lt;/id&gt; &lt;name&gt;local nexus&lt;/name&gt; &lt;url&gt;http://localhost:8081/repository/maven-snapshots/&lt;/url&gt; &lt;/snapshotRepository&gt;&lt;/distributionManagement&gt;&lt;!-- è½¯ä»¶é…ç½®ç®¡ç†ï¼ˆé¡¹ç›®gitåœ°å€ä¿¡æ¯ï¼‰å¦‚æœgitéœ€è¦æƒé™ï¼Œåˆ™éœ€è¦åŠ å…¥å…¬é’¥ï¼Œå…å¯†è®¿é—®--&gt;&lt;scm&gt; &lt;connection&gt; scm:git:https://gitee.com/wuxuanchai_admin/m-v.git &lt;/connection&gt; &lt;developerConnection&gt; scm:git:https://gitee.com/wuxuanchai_admin/m-v.git &lt;/developerConnection&gt; &lt;url&gt; https://gitee.com/liang.liang/version-mangement-best-practices &lt;/url&gt; &lt;tag&gt;HEAD&lt;/tag&gt;&lt;/scm&gt;&lt;!--å¼€å‘è€…--&gt;&lt;developers&gt; &lt;developer&gt; &lt;name&gt;wuxuan.chai&lt;/name&gt; &lt;email&gt;wuxuan.chai@gmail.com&lt;/email&gt; &lt;organizationUrl&gt;www.shuyun.com&lt;/organizationUrl&gt; &lt;/developer&gt;&lt;/developers&gt;&lt;!--æ¨¡å—å®šä¹‰--&gt;&lt;moudles&gt; &lt;moudle&gt;../moudle1&lt;/moudle&gt;&lt;/moudles&gt;&lt;build&gt; &lt;!--æ’ä»¶å®šä¹‰--&gt; &lt;pluginManagement&gt; &lt;/pluginManagement&gt;&lt;/build&gt;&lt;!--ä¾èµ–å®šä¹‰--&gt;&lt;dependencyManagement&gt;&lt;/dependencyManagement&gt; pomæ–‡ä»¶ä¸­å¯è¢«ç»§æ‰¿çš„å…ƒç´ ï¼š å¯ç»§æ‰¿çš„POMå…ƒç´ å¦‚ä¸‹ï¼š groupIdï¼šé¡¹ç›®ç»„IDï¼Œé¡¹ç›®åæ ‡çš„æ ¸å¿ƒå…ƒç´  versionï¼šé¡¹ç›®ç‰ˆæœ¬ï¼Œé¡¹ç›®åæ ‡çš„æ ¸å¿ƒå› ç´  descriptionï¼šé¡¹ç›®çš„æè¿°ä¿¡æ¯ organizationï¼šé¡¹ç›®çš„ç»„ç»‡ä¿¡æ¯ inceptionYearï¼šé¡¹ç›®çš„åˆ›å§‹å¹´ä»½ urlï¼šé¡¹ç›®çš„URLåœ°å€ developersï¼šé¡¹ç›®çš„å¼€å‘è€…ä¿¡æ¯ contributorsï¼šé¡¹ç›®çš„è´¡çŒ®è€…ä¿¡æ¯ distributionManagementï¼šé¡¹ç›®çš„éƒ¨ç½²é…ç½® issueManagementï¼šé¡¹ç›®çš„ç¼ºé™·è·Ÿè¸ªç³»ç»Ÿä¿¡æ¯ ciManagementï¼šé¡¹ç›®çš„æŒç»­é›†æˆç³»ç»Ÿä¿¡æ¯ scmï¼šé¡¹ç›®çš„ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿè¥¿æºª malilingListsï¼šé¡¹ç›®çš„é‚®ä»¶åˆ—è¡¨ä¿¡æ¯ propertiesï¼šè‡ªå®šä¹‰çš„Mavenå±æ€§ dependenciesï¼šé¡¹ç›®çš„ä¾èµ–é…ç½® dependencyManagementï¼šé¡¹ç›®çš„ä¾èµ–ç®¡ç†é…ç½® repositoriesï¼šé¡¹ç›®çš„ä»“åº“é…ç½® buildï¼šåŒ…æ‹¬é¡¹ç›®çš„æºç ç›®å½•é…ç½®ã€è¾“å‡ºç›®å½•é…ç½®ã€æ’ä»¶é…ç½®ã€æ’ä»¶ç®¡ç†é…ç½®ç­‰ reportingï¼šåŒ…æ‹¬é¡¹ç›®çš„æŠ¥å‘Šè¾“å‡ºç›®å½•é…ç½®ã€æŠ¥å‘Šæ’ä»¶é…ç½®ç­‰ 1.2.2ã€å­æ¨¡å—å­æ¨¡å—æ˜¯å…·ä½“ä¾èµ–çš„é…ç½®ï¼Œä¸€èˆ¬ä»¥jaråŒ…çš„æ ¼å¼æä¾›æœåŠ¡ï¼ˆä½¿ç”¨springbootåï¼ŒwaråŒ…æ ¼å¼ä¼šè¢«æ‰“æˆjarï¼‰ åœ¨å­æ¨¡å—ä¸­ï¼Œæ‰€æœ‰çš„versionéƒ½ä¸åº”è¯¥å­˜åœ¨ï¼Œè¦æ”¾åœ¨parent.pom ä¸­è¿›è¡Œç»Ÿä¸€ç®¡ç† æ¨¡å—æœ¬èº«ï¼šversion ç»§æ‰¿çˆ¶æ¨¡å—çš„versoin æ‰€æœ‰ä¾èµ–versionï¼Œåœ¨çˆ¶æ¨¡å—çš„dependencyManagement å…ƒç´ ä¸­è¿›è¡Œå®šä¹‰ 12345678910111213141516171819&lt;!-- çˆ¶æ¨¡å—çš„åæ ‡--&gt;&lt;parent&gt; &lt;/parent&gt;&lt;!-- å½“å‰æ¨¡å—çš„åæ ‡ï¼Œä¸éœ€è¦å†™ç‰ˆæœ¬ä¿¡æ¯ï¼Œä¼šç»§æ‰¿çˆ¶æ¨¡å—çš„ç‰ˆæœ¬å·--&gt;&lt;artifactId&gt;com.example&lt;/artifactId&gt;&lt;name&gt;demo&lt;/name&gt;&lt;!-- æ¨¡å—æè¿°--&gt;&lt;description&gt;xxx&lt;/description&gt;&lt;!-- æ¨¡å—ä¾èµ–åˆ—è¡¨--&gt;&lt;dependencies&gt;&lt;/dependencies&gt;&lt;!-- æ¨¡å—çš„æ„å»ºæ‰€éœ€è¦çš„æ’ä»¶--&gt;&lt;build&gt;&lt;/build&gt; 1.3ã€è¯­ä¹‰åŒ–çš„ç‰ˆæœ¬å·ï¼ˆSemantic Versioningï¼‰1.3.1ã€ç‰ˆæœ¬å·çš„æ ¼å¼ç‰ˆæœ¬å·çš„æ ¼å¼ï¼š ä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å· ç‰ˆæœ¬å·çš„é€’å¢çš„è§„åˆ™ï¼š 1ã€ä¸»ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†ä¸å…¼å®¹çš„APIä¿®æ”¹ 2ã€æ¬¡ç‰ˆæœ¬å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„åŠŸèƒ½æ€§æ–°å¢ 3ã€ä¿®è®¢å·ï¼šå½“ä½ åšäº†å‘ä¸‹å…¼å®¹çš„é—®é¢˜ä¿®æ­£ å…ˆè¡Œç‰ˆæœ¬å·åŠç‰ˆæœ¬ç¼–è¯‘å…ƒæ•°æ®å¯ä»¥åŠ åˆ°â€œä¸»ç‰ˆæœ¬å·.æ¬¡ç‰ˆæœ¬å·.ä¿®è®¢å·â€çš„åé¢ï¼Œä½œä¸ºå»¶ä¼¸ã€‚ ä¹Ÿå°±æ˜¯è¯´å¯ä»¥æ”¯æŒè¿™ç§ç‰ˆæœ¬å·ï¼š 4.7.5.202005 4 ä¸»ç‰ˆæœ¬å· 7 æ¬¡ç‰ˆæœ¬å· 5 ä¿®è®¢å· 202005 ç¼–è¯‘å…ƒæ•°æ®-ç¼–è¯‘æ—¥æœŸ å…¶ä»–çš„è¯­ä¹‰æè¿°ï¼š Alphaï¼šå†…æµ‹ç‰ˆ Betaï¼šå…¬æµ‹ç‰ˆ Gammaï¼šæ¯”è¾ƒæˆç†Ÿçš„æµ‹è¯•ç‰ˆï¼Œä¸å³å°†å‘è¡Œçš„æ­£å¼ç‰ˆç›¸å·®æ— å‡  RCï¼šæ˜¯ Release Candidate çš„ç¼©å†™ï¼Œæ„æ€æ˜¯å‘å¸ƒå€’è®¡æ—¶ï¼Œå€™é€‰ç‰ˆæœ¬ Stableï¼šç¨³å®šç‰ˆ 1.4ã€ç‰ˆæœ¬æ€§è´¨ï¼š Snapshot ä¸Release1.4.1ã€æ¦‚å¿µSnapshotï¼šå¿«ç…§ï¼Œä»–æ˜¯ä¸€ä¸ªä¸ç¨³å®šçš„ç‰ˆæœ¬ï¼Œå¤„äºå¼€å‘ä¸­çš„ï¼Œç»å¸¸å˜åŒ–çš„ç‰ˆæœ¬ Releaseï¼šå‘è¡Œç‰ˆï¼ŒåŠŸèƒ½ç¨³å®šçš„ç‰ˆæœ¬ï¼Œå°†åœæ­¢ä»£ç çš„æ›´æ–°ï¼Œç”¨äºå‘è¡Œåˆ°ç”Ÿäº§ç¯å¢ƒ 1.4.2ã€ç†æƒ³çš„æµç¨‹æ—¥å¸¸çš„å¼€å‘åŸºäºSnapshotçš„ç‰ˆæœ¬è¿›è¡Œå¼€å‘ï¼Œsnapshotç‰ˆæœ¬ä¼šæœ‰ä¸€äº›ç‰¹æ€§ æ‰§è¡Œ mvn complie æ—¶ä¼šå»ä»“åº“ä¸­å°è¯•æ‹‰æœ€æ–°æ‰“åŒ…ï¼Œå› ä¸ºä»–å¯ä»¥è¢«å¤šæ¬¡æ„å»ºï¼Œä½¿ç”¨æ—¶å¿…é¡»ä¿è¯æœ€æ–° å¯ä»¥è¢«é‡å¤æ„å»º ç‰ˆæœ¬å‘å¸ƒåœ¨å‘å¸ƒç‰ˆæœ¬çš„æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦åšä»¥ä¸‹çš„å‡ ä»¶äº‹ï¼š 1ã€åˆ›å»ºTagåˆ†æ”¯ï¼Œtag/vç‰ˆæœ¬å·ï¼ˆä¾‹å¦‚ï¼štag/v0.0.1ï¼‰ 2ã€åœ¨ä»“åº“ä¸­æ„å»ºå‘å¸ƒåŒ…ï¼ˆrelease çš„jarï¼‰ 3ã€åˆ›å»ºæ–°çš„å¼€å‘åˆ†æ”¯ï¼Œå‡çº§æœ¬åœ°pomæ–‡ä»¶ç‰ˆæœ¬ï¼Œæ ¹æ®å®é™…çš„éœ€æ±‚æå‡ç‰ˆæœ¬å· å¦‚æœhotfixå‘å¸ƒï¼Œåˆ™ï¼šx.y.z -&gt; x.y.z+1 ä¾‹å¦‚ï¼š4.7.5 &gt; 4.7.6 æ¬¡ç‰ˆæœ¬å‘å¸ƒï¼Œ åˆ™ï¼š x.y.z -&gt; x.y+1.0 ä¾‹å¦‚ï¼š4.7.5 &gt; 4.8.0 å¤§ç‰ˆæœ¬æ›´æ–°ï¼Œåˆ™ï¼šx.y.z -&gt; x+1.0.0 ä¾‹å¦‚ï¼š4.7.5 &gt; 5.0.0 4ã€éhotfixç‰ˆæœ¬å‘å¸ƒï¼Œè¿˜éœ€è¦åˆ›å»ºhotfixåˆ†æ”¯ï¼Œç”¨äºä»¥åä¿®å¤ ç°æœ‰çš„é¡¹ç›®å¦‚ä½•åšï¼Ÿæ’ä»¶ç®¡ç†ï¼šmaven-release-plugin æ’ä»¶åœ°å€ï¼šhttp://maven.apache.org/maven-release/maven-release-plugin/ parent pomé…ç½®æ–‡ä»¶é…ç½®ï¼š 1234567891011121314151617181920212223242526272829&lt;scm&gt; &lt;!-- gité¡¹ç›®åœ°å€å¯ä»¥ç”¨SSH ä¹Ÿå¯ä»¥ç”¨ HTTPSçš„--&gt; &lt;connection&gt;scm:git:https://gitee.com/wuxuanchai_admin/m-v.git&lt;/connection&gt; &lt;!-- #gité¡¹ç›®åœ°å€å¯ä»¥ç”¨SSH ä¹Ÿå¯ä»¥ç”¨ HTTPSçš„--&gt; &lt;developerConnection&gt;scm:git:https://gitee.com/wuxuanchai_admin/m-v.git&lt;/developerConnection&gt; &lt;!-- #gité¡¹ç›®æµè§ˆå™¨é‡Œçš„åœ°å€--&gt; &lt;url&gt;https://gitee.com/liang.liang/version-mangement-best-practices&lt;/url&gt; &lt;tag&gt;HEAD&lt;/tag&gt;&lt;/scm&gt;&lt;build&gt; &lt;plugins&gt; &lt;plugin&gt; &lt;groupId&gt;org.apache.maven.plugins&lt;/groupId&gt; &lt;artifactId&gt;maven-release-plugin&lt;/artifactId&gt; &lt;configuration&gt; &lt;!-- tagåˆ†æ”¯çš„åç§°ï¼Œproject.versionåªåŒ…å«ç‰ˆæœ¬ï¼Œä¸åŒ…å«SNAPSHOTåç¼€ --&gt; &lt;tagNameFormat&gt;v@&#123;project.version&#125;&lt;/tagNameFormat&gt; &lt;!-- å‡çº§å­æ¨¡å— --&gt; &lt;autoVersionSubmodules&gt;true&lt;/autoVersionSubmodules&gt; &lt;!-- è·³è¿‡å•å…ƒæµ‹è¯• --&gt; &lt;arguments&gt;-DskipTests&lt;/arguments&gt; &lt;!-- æ‰§è¡Œç›®æ ‡ï¼Œæ­¤å¥å¯çœ --&gt; &lt;goals&gt;-f pom.xml deploy&lt;/goals&gt; &lt;/configuration&gt; &lt;/plugin&gt; &lt;/plugins&gt;&lt;/build&gt; å¦‚ä½•ä½¿ç”¨ï¼Ÿï¼Ÿ1) release:branchï¼ˆåˆ›å»ºåˆ†æ”¯ ï¼‰åˆ›å»ºçš„åˆ†æ”¯æ˜¯ç”¨äºhotfixä¿®å¤çš„åŸºç¡€åˆ†æ”¯ï¼Œåœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºæ¬¡è¦ç‰ˆæœ¬æ˜¯ï¼Œè¦ä¸€å¹¶åˆ›å»ºï¼Œä»¥åçš„ä¿®æ”¹éƒ½åŸºäºæ­¤åˆ†æ”¯ï¼Œåç»­å¦‚æœæœ‰éœ€è¦çš„hotfixæ¥ä¿®å¤é—®é¢˜ï¼Œåˆ™åŸºäºæ­¤åˆ†æ”¯åˆ›å»ºä¸€ä¸ªæ–°çš„åˆ†æ”¯hotfix-xxxï¼Œç„¶åæäº¤ä»£ç åï¼Œå°†releaseä¸€ä¸ªhotfixçš„ç‰ˆæœ¬ï¼šx.y.z+1(zè¡¨ç¤ºå½“å‰çš„ä¿®è®¢å·) å‘½ä»¤ï¼š 1mvn release:branch -DbranchName=0.2.x -DupdateBranchVersions=true -DupdateWorkingCopyVersions=false å‘½ä»¤å«ä¹‰ï¼š -DbranchName=0.2.xï¼šåˆ›å»ºä¸€ä¸ªå« 0.2.x çš„åˆ†æ”¯ -DupdateBranchVersions=true ï¼šåˆ†æ”¯ä¼šå‡çº§ç‰ˆæœ¬å·ï¼Œå¦‚æœå½“å‰çš„ç‰ˆæœ¬å·ä¸º0.0.1-snapshotï¼Œåˆ™æ–°çš„åˆ†æ”¯ç‰ˆæœ¬å·ä¸ºï¼š 0.0.2-snapshot DupdateWorkingCopyVersions=false å½“å‰å·¥ä½œç©ºé—´çš„pomæ–‡ä»¶ä¸åšæ›´æ”¹ï¼Œæ–¹ä¾¿åé¢çš„releaseæ“ä½œ 2) release:prepare(é¢„å¤„ç†ï¼Œå‡çº§pom-version)é¢„å¤„ç†é˜¶æ®µï¼Œreleaseæ’ä»¶ä¼šï¼š æ‰§è¡Œä¸€æ¬¡æ‰“åŒ…è¿‡ç¨‹ åœ¨gitä»“åº“é‡Œé¢åˆ›å»ºå¥½Tagåˆ†æ”¯ å‡çº§pomæ–‡ä»¶ç‰ˆæœ¬ï¼Œå¹¶æäº¤åˆ°æœ¬åœ°ä»“åº“ï¼ˆæ­¤å¤„ä¸ä¼šæ›´æ”¹è¿œç¨‹ä»“åº“çš„åˆ†æ”¯ï¼‰ 1mvn release:prepare åœ¨é»˜è®¤çš„æƒ…å†µä¸‹ï¼Œä»–æ˜¯ä¸€ä¸ªäº¤äº’å¼çš„å‘½ä»¤ï¼Œæœ‰å¦‚ä¸‹é—®é¢˜éœ€è¦ç¡®è®¤ï¼š 1234567What is the release version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.15: :What is SCM release tag or label for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) v0.1.15: :What is the new development version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.16-SNAPSHOT: :&#x2F;&#x2F;è¦å‘å¸ƒçš„ç‰ˆæœ¬æ˜¯å“ªä¸€ä¸ªï¼Ÿé»˜è®¤å½“å‰ç‰ˆæœ¬&#x2F;&#x2F;è¦æ‰“çš„tagå«ä»€ä¹ˆï¼Ÿç°åœ¨çš„æ ·å­ &#x2F;&#x2F;åˆ›å»ºä¸€ä¸ªæ–°çš„å¼€å‘ç‰ˆæœ¬å—ï¼Ÿé»˜è®¤å½“å‰ç‰ˆæœ¬+1 ä¿®è®¢ï¼ˆæ­¤å¤„æˆ‘ä»¬å¯ä»¥æ‰‹å·¥æ”¹æˆ å­ç‰ˆæœ¬å·æ›´æ–°ï¼‰ æ‰§è¡Œäº† release:prepareå‘½ä»¤åï¼Œåœ¨gitä»“åº“ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªå«ï¼šv0.1.15çš„tagè¢«åˆ›å»ºï¼Œè¿™æ“ä½œæ˜¯å¯ä»¥å›æ»šçš„ï¼Œæ’ä»¶åœ¨é¡¹ç›®é‡Œé¢åˆ›å»ºäº†ä¸€ä¸ªï¼Œpom.xml.releaseBackupçš„æ–‡ä»¶ï¼Œç”¨äºå›æ»špom.xmlï¼ŒåŒæ—¶è¿˜ä¼šç”Ÿæˆï¼šrelease.properties é‡Œé¢ä¼šè®°å½•releaseç‰ˆæœ¬çš„å±æ€§ 3) release:rollback(å›æ»š)Release:prepare é˜¶æ®µéƒ½æ˜¯è¿›è¡Œäº†æœ¬åœ°çš„æäº¤ï¼Œå› æ­¤å¯ä»¥è¿›è¡Œå›æ»šï¼Œä½†tagåˆ†æ”¯å¿…é¡»æ‰‹å·¥åˆ é™¤ï¼Œæ’ä»¶ä¸èƒ½å¸®ä½ åˆ é™¤å·²ç»åˆ›å»ºå¥½çš„æœ¬åœ°Tag é™¤æ­¤ä¹‹å¤–ï¼Œå¯ä»¥è¿˜è¡Œå‘å¸ƒé¢„è§ˆï¼š 1mvn release:prepare -DdryRun=true å¹²è·‘ä¼šç”Ÿæˆé¢„è§ˆæ–‡ä»¶ï¼š pom.xml.nextpom.xml.releaseBackuppom.xml.tagrelease.properties ä½†æ˜¯ä¸ä¼šæäº¤ã€‚ 4) release:perform (æ‰§è¡Œ)æ‰§è¡Œå‘½ä»¤ï¼Œä¼šåœ¨releaseä»“åº“é‡Œé¢æ„å»ºå‘å¸ƒåŒ… å¯èƒ½ç¢°åˆ°çš„é—®é¢˜ release:rollbackä¸ä¼šå›æ»šgitçš„tagï¼Œéœ€è¦æ‰‹åŠ¨åˆ é™¤tag mavené…ç½®çš„ä¼˜å…ˆçº§(ideaä¸‹) pom.xml&gt;.m2/setting.xml&gt;setting.xml pom.xml å‘ç”Ÿæ”¹å˜ï¼Œæ— æ³•æ‰§è¡Œrelease:prepare ç§æœçš„è®¾ç½®å’Œmavençš„é…ç½®æ–‡ä»¶å¦‚æœé…ç½®ä¸æ­£ç¡®ï¼Œæ— æ³•æ‰§è¡Œå‘½ä»¤ æ•ˆæœç§æœä¸­releaseçš„jarï¼š ç§æœä¸­çš„snapshotçš„jarï¼š gitä¸­çš„tagï¼šå‘å¸ƒreleaseååˆ›å»ºçš„tagåˆ†æ”¯","categories":[{"name":"å¼€å‘æ€»ç»“","slug":"å¼€å‘æ€»ç»“","permalink":"https://cha1yi.github.io/dist/categories/%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"}],"tags":[{"name":"maven","slug":"maven","permalink":"https://cha1yi.github.io/dist/tags/maven/"}],"author":"wuxuan.chai"},{"title":"Arthasè¯Šæ–­ç¥å™¨","slug":"Arthasè¯Šæ–­ç¥å™¨","date":"2021-01-17T15:59:56.357Z","updated":"2021-06-05T14:56:50.433Z","comments":true,"path":"2021/01/17/Arthasè¯Šæ–­ç¥å™¨/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/17/Arthas%E8%AF%8A%E6%96%AD%E7%A5%9E%E5%99%A8/","excerpt":"","text":"ä¸€ã€å¿«é€Ÿå…¥é—¨1.1ã€Arthasç®€ä»‹Arthas æ˜¯Alibabaå¼€æºçš„Javaè¯Šæ–­å·¥å…·ã€‚å¯ä»¥å®‰è£…åœ¨ç³»ç»Ÿæ‰€åœ¨æœåŠ¡å™¨ï¼Œä¹Ÿå¯ä»¥è¿œç¨‹è¯Šæ–­å…¶ä»–æœåŠ¡å™¨çš„æœåŠ¡ã€‚å¯ä»¥å¸®åŠ©å¼€å‘äººå‘˜æˆ–è€…è¿ç»´äººå‘˜æŸ¥æ‰¾é—®é¢˜ï¼Œåˆ†ææ€§èƒ½ï¼Œbugè¿½è¸ªã€‚ 1.2ã€Arthasçš„å¿«é€Ÿå…¥é—¨ä¸‹è½½åœ°å€ï¼š 1wget https://alibaba.github.io/arthas/arthas-boot.jar åº”ç”¨ç¨‹åºï¼šå¯ä»¥è‡ªå·±å¯ä¸€ä¸ªjavaæœåŠ¡ 1.3ã€å¯åŠ¨Arthas1java -jar arthas-boot.jar æ‰§è¡Œarthasç¨‹åºçš„ç”¨æˆ·è¦å’Œåº”ç”¨ç¨‹åºçš„æ‰§è¡Œç”¨æˆ·ä¸ºç›¸åŒçš„æƒé™ã€‚æ¯”å¦‚ï¼šåº”ç”¨ç¨‹åºä½¿ç”¨adminç”¨æˆ·æ¥æ‰§è¡Œï¼Œé‚£ä¹ˆarthasçš„å¯åŠ¨ï¼šsudo su admin &amp;&amp; java -jar arthas-boot.jar æˆ–è€… sudo -u admin -EH java -jar arthas-boot.jarjava -jar arthas-boot.jar -h æ‰“å°æ›´å¤šçš„ä¿¡æ¯ å¼€å§‹å¯åŠ¨ï¼š 123456789101112localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar [INFO] arthas-boot version: 3.3.3[INFO] Process 84742 already using port 3658[INFO] Process 84742 already using port 8563[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.* [1]: 84742 com.yiyi.Application [2]: 84898 arthas-boot.jar [3]: 1572 kafka.Kafka [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher [6]: 83691 [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36 å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡wuxuan.chaiç”¨æˆ·å¯åŠ¨äº†7ä¸ªjavaè¿›ç¨‹ï¼ˆpidï¼‰ï¼š 1234567* [1]: 84742 com.yiyi.Application [2]: 84898 arthas-boot.jar [3]: 1572 kafka.Kafka [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher [6]: 83691 [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36 é€‰æ‹©åº”ç”¨çš„javaè¿›ç¨‹ï¼šè¿™é‡Œæˆ‘ä»¬é€‰æ‹©æˆ‘ä»¬çš„æµ‹è¯•appï¼Œ1è¾“å…¥1ï¼Œå†å›è½¦/enterï¼Œarthasä¼šattachåˆ°ç›®æ ‡è¿›ç¨‹ï¼š 123456789101112131415161718192021222324252627282930313233localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar [INFO] arthas-boot version: 3.3.3[INFO] Process 84742 already using port 3658[INFO] Process 84742 already using port 8563[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.* [1]: 84742 com.yiyi.Application [2]: 84898 arthas-boot.jar [3]: 1572 kafka.Kafka [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher [6]: 83691 [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer361[INFO] arthas home: /Users/wuxuan.chai/.arthas/lib/3.3.6/arthas[INFO] The target process already listen port 3658, skip attach.[INFO] arthas-client connect 127.0.0.1 3658 ,---. ,------. ,--------.,--. ,--. ,---. ,---. / O \\ | .--. &#x27;&#x27;--. .--&#x27;| &#x27;--&#x27; | / O \\ &#x27; .-&#x27; | .-. || &#x27;--&#x27;.&#x27; | | | .--. || .-. |`. `-. | | | || |\\ \\ | | | | | || | | |.-&#x27; | `--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27; `--&#x27; `--&#x27; `--&#x27;`--&#x27; `--&#x27;`-----&#x27; wiki https://alibaba.github.io/arthas tutorials https://alibaba.github.io/arthas/arthas-tutorials version 3.3.6 pid 84742 time 2020-07-06 10:46:47 [arthas@84742]$ 1.4ã€Arthasçš„åŸºæœ¬æ“ä½œArthasçš„å…¥é—¨åŸºæœ¬æ“ä½œï¼šDashboard/thread/jad/watchï¼Œæ¥æŸ¥çœ‹ä¸€äº›æœ€åŸºæœ¬çš„æŒ‡æ ‡ä¿¡æ¯ï¼Œæ¯”å¦‚ï¼Œèµ„æºå ç”¨ï¼Œçº¿ç¨‹ï¼Œç±»ä¿¡æ¯ï¼Œæ–¹æ³•æ‰§è¡Œä¿¡æ¯ã€‚ 1.4.1ã€æŸ¥çœ‹Dashboard123456789101112131415161718192021222324252627282930313233[arthas@84742]$ dashboard ID NAME GROUP PRIORITY STATE %CPU TIME INTERRUPTED DAEMON 149 Timer-for-arthas-dashboard-3bf90e35- system 10 RUNNABLE 51 0:0 false true 113 Catalina-utility-1 main 1 TIMED_WAITI 14 0:0 false false 116 http-nio-7070-BlockPoller main 5 RUNNABLE 14 0:0 false true 127 http-nio-7070-ClientPoller main 5 RUNNABLE 13 0:0 false true 114 Catalina-utility-2 main 1 WAITING 5 0:0 false false 131 Attach Listener system 9 RUNNABLE 0 0:0 false true 130 DestroyJavaVM main 5 RUNNABLE 0 0:1 false false 3 Finalizer system 8 WAITING 0 0:0 false true 2 Reference Handler system 10 WAITING 0 0:0 false true 4 Signal Dispatcher system 9 RUNNABLE 0 0:0 false true 136 arthas-shell-server system 9 TIMED_WAITI 0 0:0 false true 137 arthas-shell-server system 9 TIMED_WAITI 0 0:0 false true 133 arthas-timer system 9 WAITING 0 0:0 false true 141 as-command-execute-daemon system 10 TIMED_WAITI 0 0:0 false true 115 container-0 main 5 TIMED_WAITI 0 0:0 false false Memory used total max usage GC heap 169M 370M 3641M 4.66% gc.ps_scavenge.count 4 ps_eden_space 140M 183M 1344M 10.46% gc.ps_scavenge.time(ms) 37 ps_survivor_space 0K 10752K 10752K 0.00% gc.ps_marksweep.count 2 ps_old_gen 29M 176M 2731M 1.07% gc.ps_marksweep.time(ms) 118 nonheap 53M 57M -1 92.98% code_cache 5M 7M 240M 2.17% metaspace 42M 44M -1 95.78% Runtime os.name Mac OS X os.version 10.14.6 java.version 1.8.0_241 java.home /Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre systemload.average 3.25 processors 8 uptime ä¸ŠåŠéƒ¨åˆ†æ˜¯ç¨‹åºçš„çº¿ç¨‹ä¿¡æ¯ï¼Œä¸­é—´æ˜¯å†…å­˜ä½¿ç”¨æƒ…å†µï¼Œè¿™é‡Œå¯ä»¥æŸ¥çœ‹gcçš„æ¬¡æ•°ï¼Œä¸‹é¢æ˜¯å½“å‰ç¨‹åºè¿è¡Œçš„ç¯å¢ƒä¿¡æ¯ 1.4.2ã€threadå‘½ä»¤æŸ¥çœ‹è¿›ç¨‹1234567[arthas@84742]$ thread 115 &quot;container-0&quot; Id=115 TIMED_WAITING at java.lang.Thread.sleep(Native Method) at org.apache.catalina.core.StandardServer.await(StandardServer.java:570) at org.springframework.boot.web.embedded.tomcat.TomcatWebServer$1.run(TomcatWebServer.java:197)Affect(row-cnt:0) cost in 1 ms. æŸ¥çœ‹çº¿ç¨‹çš„å…·ä½“ä¿¡æ¯ï¼Œè°ƒç”¨å¯¹è±¡ï¼ŒçŠ¶æ€ç­‰ã€‚ã€‚ã€‚ 1.4.3ã€jadåç¼–è¯‘classç±»é€šè¿‡jadåç¼–è¯‘springbootçš„å¯åŠ¨ç±»ï¼š 12345678910111213141516171819202122232425262728[arthas@84742]$ jad com.yiyi.ApplicationClassLoader: +-sun.misc.Launcher$AppClassLoader@4e25154f +-sun.misc.Launcher$ExtClassLoader@2ef1e4fa Location: /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/ /* * Decompiled with CFR. */package com.yiyi;import org.springframework.boot.SpringApplication;import org.springframework.boot.autoconfigure.SpringBootApplication;import org.springframework.context.annotation.ComponentScan;@SpringBootApplication@ComponentScan(value=&#123;&quot;com.yiyi&quot;&#125;)public class Application &#123; public static void main(String[] args) &#123; SpringApplication.run(Application.class, args); &#125;&#125;Affect(row-cnt:2) cost in 181 ms.[arthas@84742]$ 1.4.4ã€watchæŸ¥çœ‹å‡½æ•°çš„è¿”å›å€¼é€šè¿‡watchå‘½ä»¤æŸ¥çœ‹æ–¹æ³•çš„è¿”å›å€¼ï¼ŒæŸ¥çœ‹è·å–å¾®ä¿¡çš„accessTokençš„æ–¹æ³•è¿”å›å€¼ï¼š 1234[arthas@84742]$ watch com.yiyi.api.WeixinSupportApi getAccessToken Press Q or Ctrl+C to abort.Affect(class count: 1 , method count: 1) cost in 38 ms, listenerId: 3 æ‰§è¡Œå‘½ä»¤åï¼ŒArthasä¼šç›‘å¬è¯¥æ–¹æ³•çš„æ‰§è¡Œï¼Œæ¯æ¬¡è°ƒç”¨ï¼Œéƒ½ä¼šå°†æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥,ä¾‹å¦‚ï¼š 12345ts=2020-07-06 11:26:17; [cost=3.13107ms] result=@ArrayList[ @Object[][isEmpty=false;size=2], @WeixinSupportApi[com.yiyi.api.WeixinSupportApi@14cb7037], @String[i9c7LCIqY8cJuneYN9C9q4kN-FZoo7YZFVxEpgT3ugMmeX1KJ5HuVgSLK5IkJW7JF_adbkmjGrGdu9aw9XFhrMBLBMC9eFm82ICpst1-UVGujAvdUMcPRkUNcgb7I7MmxHk2ZVIpZzLKxf-3zw1-oE-wfhETKjRrjRhoP7z7g9UD4OS-cctNJBUJk8XfcE2cW_S2GUuj-tm2vyvVNK9oDQ],] äºŒã€è¿›é˜¶ä½¿ç”¨2.1ã€åŸºç¡€å‘½ä»¤2.1.1ã€æ‰€æœ‰å‘½ä»¤çš„é›†åˆ NAME DESCRIPTION help å±•ç¤ºArthaså¸®åŠ© keymap å±•ç¤ºæ‰€æœ‰æŒ‡å®šçš„è¿æ¥çš„å¯ç”¨çš„å¿«æ·é”® sc æœç´¢æ‰€æœ‰è¢«jvmåŠ è½½ç±» sm æœç´¢æ‰€æœ‰è¢«jvmåŠ è½½çš„ç±»çš„æ–¹æ³• classloader å±•ç¤ºç±»åŠ è½½å™¨çš„ä¿¡æ¯ jad ç±»åç¼–è¯‘ getstatic å±•ç¤ºä¸€ä¸ªç±»çš„é™æ€çš„å±æ€§å­—æ®µ monitor ç›‘æ§æ–¹æ³•æ‰§è¡Œçš„æ•°æ®ï¼Œä¾‹å¦‚ï¼šåˆè®¡/æˆåŠŸ/å¤±è´¥çš„æ•°å€¼ï¼Œå®æ—¶å¹³å‡å€¼å¤±è´¥æ¯”ç‡ç­‰ stack å±•ç¤ºæŒ‡å®šç±»å’Œæ–¹æ³•çš„è°ƒç”¨æ ˆä¿¡æ¯ thread å±•ç¤ºçº¿ç¨‹ä¿¡æ¯å’Œè°ƒç”¨æ ˆ trace æŒ‡å®šæ–¹æ³•è°ƒç”¨æ ˆçš„æ‰§è¡Œæ—¶é—´ watch å±•ç¤ºæŒ‡å®šæ–¹æ³•çš„è°ƒç”¨è¿‡ç¨‹ä¸­ï¼Œè¾“å…¥/è¾“å‡ºçš„å‚æ•°ï¼Œç»“æœè¿”å›å€¼ï¼Œå¼‚å¸¸æŠ›å‡ºç­‰ tt æ—¶é—´éš§é“ jvm å±•ç¤ºç›®æ ‡jvmçš„ä¿¡æ¯ perfcounter å±•ç¤ºæ€§èƒ½è®¡æ•°å™¨çš„ä¿¡æ¯ ognl æ‰§è¡Œognlè¡¨è¾¾å¼ mc å†…å­˜ç¼–è¯‘å™¨ï¼Œå°†javaæ–‡ä»¶åœ¨å†…å­˜ä¸­ç¼–è¯‘æˆå­—èŠ‚ç å’Œå†…å­˜ä¸­çš„ç±»æ–‡ä»¶ redefine é‡æ–°å®šä¹‰ç±»ï¼Œå‚è€ƒInstrumentation#redefineClasses(ClassDefinitionâ€¦) dashboard é¢„è§ˆç›®æ ‡jvmçš„çº¿ç¨‹ï¼Œgcï¼Œç¯å¢ƒå˜é‡ï¼Œtomcatä¿¡æ¯ dump ä»jvmä¸­è½¬å­˜ç±»çš„å­—èŠ‚ç  heapdump å †è½¬å­˜ options æŸ¥çœ‹å’Œæ›´æ”¹å„ç§Arthasé€‰é¡¹ cls æ¸…ç†å±å¹• reset é‡ç½®æ‰€æœ‰çš„å¢å¼ºç±» version å±•ç¤ºArthasç‰ˆæœ¬ session å±•ç¤ºå½“å‰ä¼šè¯çš„ä¿¡æ¯ sysprop å±•ç¤ºï¼Œä¿®æ”¹ç³»ç»Ÿçš„é…ç½® sysenv å±•ç¤ºç³»ç»Ÿç¯å¢ƒå˜é‡ vmoption å±•ç¤ºä¿®æ”¹vmè¯Šæ–­é€‰é¡¹ logger æ‰“å°æ—¥å¿—ä¿¡æ¯ï¼Œä¿®æ”¹æ—¥å¿—çº§åˆ« history å±•ç¤ºå†å²å‘½ä»¤ cat è¿æ¥å¹¶æ‰“å°æ–‡ä»¶å†…å®¹ï¼Œç±»ä¼¼linuxçš„catå‘½ä»¤ echo å°†å‚æ•°å†™å…¥æ ‡å‡†è¾“å‡º pwd è¿”å›å·¥ä½œç›®å½•åç§° mbean æ˜¾ç¤ºmbeanä¿¡æ¯ grep ç”¨äºç®¡é“çš„grepå‘½ä»¤ tee ç®¡é“çš„teeå‘½ä»¤ profiler å¼‚æ­¥åˆ†æå·¥å…·https://github.com/jvm-profiling-tools/async-profiler stop åœæ­¢/å…³é—­ArthasæœåŠ¡å™¨å¹¶é€€å‡ºæ§åˆ¶å° 2.1.2ã€redefineå‘½ä»¤ï¼Œæ›¿æ¢æŒ‡å®šæºclassæ–‡ä»¶redefineåçš„åŸæ¥çš„ç±»ä¸èƒ½æ¢å¤ï¼Œredefineä¹Ÿæœ‰å¯èƒ½å¤±è´¥ï¼ˆæ¯”å¦‚æ–°å¢äº†fieldï¼‰ï¼Œresetå‘½ä»¤å¯¹redefineæ— æ•ˆï¼Œå¦‚æœæƒ³é‡ç½®ï¼Œéœ€è¦redefineåŸå§‹çš„å­—èŠ‚ç ã€‚ä¸å…è®¸æ–°å¢åŠ field/methodã€‚æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œæ²¡æœ‰é€€å‡ºä¸èƒ½ç”Ÿæ•ˆã€‚ ç¤ºä¾‹ï¼Œæ›¿æ¢æ¥å£çš„è¿”å›å€¼ï¼š 123456789@RestController@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)@Slf4jpublic class WeixinSupportApi &#123; @GetMapping(&quot;/test/&quot;) public String test() &#123; return &quot;è¿™æ˜¯æ­£ç‰Œçš„æ¥å£ç»“æœ&quot;; &#125;&#125; è¯·æ±‚æ¥å£ä¼šè¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ï¼šâ€œè¿™æ˜¯æ­£ç‰Œçš„æ¥å£ç»“æœâ€ã€‚æ¥ä¸‹æ¥é€šè¿‡arthasçš„redifineå‘½ä»¤æ›¿æ¢æˆæ¥å£è¿”å›æˆä¸€ä¸ªï¼šâ€œhelloâ€ 1234567891011121314@RestController@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)@Slf4jpublic class WeixinSupportApi &#123; @GetMapping(&quot;/test/&quot;) public String test() &#123; return &quot;hello&quot;; &#125;&#125;``` æ–¹å¼ä¸€ã€ å°†ä¸Šè¿°çš„javaæ–‡ä»¶ç¼–è¯‘æˆclassæ–‡ä»¶,ä¸Šä¼ åˆ°æœåŠ¡å™¨ï¼Œä½¿ç”¨redefineå‘½ä»¤,å¼€å§‹æ›¿æ¢ï¼š```shellredefine weixin/WeixinSupportApi.class æ–¹å¼äºŒã€ 12345678910111213//é€šè¿‡jadå°†class æ–‡ä»¶ç¼–è¯‘æˆjavaæ–‡ä»¶jad --source-only com.yiyi.api.WeixinSupportApi &gt; weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java//é€šè¿‡vimå¯¹æ–‡ä»¶è¿›è¡Œç¼–è¾‘ï¼Œå®ç°æˆ‘ä»¬æƒ³è¦çš„ä¸€ä¸ªé€»è¾‘vim weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java//é€šè¿‡mc å†…å­˜ç¼–è¯‘ï¼Œå°†ä¸Šé¢çš„javaæ–‡ä»¶ç¼–è¯‘æˆclass ä»£ç mc weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java -d weixin-&gt;è¾“å‡ºç¼–è¯‘åçš„class æ–‡ä»¶åœ°å€ï¼šMemory compiler output:/Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.classAffect(row-cnt:1) cost in 1467 ms.//redefine æ›¿æ¢å†…å­˜ä¸­çš„classæ–‡ä»¶ä¸ºåˆšæ‰ç¼–è¯‘çš„class æ–‡ä»¶redefine /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.classå³å¯å®ç°å¯¹æºclass çš„ç¼–è¾‘ï¼Œå¹¶ä¸”è¿›è¡Œçƒ­éƒ¨ç½²ã€‚ã€‚ 2.1.3ã€headdumpå‘½ä»¤dump java heapï¼Œç±»ä¼¼jmapå‘½ä»¤çš„heap dumpåŠŸèƒ½ 123456//dumpåˆ°æŒ‡å®šçš„æ–‡ä»¶heapdump ./dump.hprof//åªdump liveå¯¹è±¡heapdump --live ./dump.hprof//dumpåˆ°ä¸´æ—¶æ–‡ä»¶heapdump 2.1.4ã€classloaderçš„å‘½ä»¤12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091929394//æŒ‰ç±»åŠ è½½ç±»å‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯[arthas@89977]$ classloader name numberOfInstances loadedCountTotal sun.misc.Launcher$AppClassLoader 1 4440 BootstrapClassLoader 1 2932 com.taobao.arthas.agent.ArthasClassloader 1 2095 lombok.launch.ShadowClassLoader 1 242 sun.reflect.DelegatingClassLoader 77 77 sun.misc.Launcher$ExtClassLoader 1 4 javax.management.remote.rmi.NoCallStackClassLoader 2 2 sun.reflect.misc.MethodUtil 1 1 Affect(row-cnt:8) cost in 5 ms.//æŒ‰ç±»åŠ è½½å®ä¾‹æŸ¥çœ‹ç»Ÿè®¡ä¿¡æ¯[arthas@89977]$ classloader -l name loadedCount hash parent BootstrapClassLoader 2932 null null com.taobao.arthas.agent.ArthasClassloader@3c708a1d 2095 3c708a1d sun.misc.Launcher$ExtClassLoader@770c2e6b javax.management.remote.rmi.NoCallStackClassLoader@1060b431 1 1060b431 null javax.management.remote.rmi.NoCallStackClassLoader@63440df3 1 63440df3 null lombok.launch.ShadowClassLoader@1756d9eb 242 1756d9eb sun.misc.Launcher$AppClassLoader@18b4aac2 sun.misc.Launcher$AppClassLoader@18b4aac2 4440 18b4aac2 sun.misc.Launcher$ExtClassLoader@770c2e6b sun.misc.Launcher$ExtClassLoader@770c2e6b 4 770c2e6b null sun.reflect.misc.MethodUtil@2c109df9 1 2c109df9 sun.misc.Launcher$AppClassLoader@18b4aac2 Affect(row-cnt:8) cost in 5 ms.// æŸ¥çœ‹classloaderçš„ç»§æ‰¿æ ‘[arthas@89977]$ classloader -t+-BootstrapClassLoader +-javax.management.remote.rmi.NoCallStackClassLoader@1060b431 +-javax.management.remote.rmi.NoCallStackClassLoader@63440df3 +-sun.misc.Launcher$ExtClassLoader@770c2e6b +-com.taobao.arthas.agent.ArthasClassloader@3c708a1d +-sun.misc.Launcher$AppClassLoader@18b4aac2 +-lombok.launch.ShadowClassLoader@1756d9eb +-sun.reflect.misc.MethodUtil@2c109df9 Affect(row-cnt:8) cost in 5 ms.//æŸ¥çœ‹URLClassloaderçš„å®é™…urls[arthas@89977]$ classloader -c 770c2e6bfile:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunec.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/nashorn.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/cldrdata.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jfxrt.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/dnsns.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/localedata.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jaccess.jar file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/zipfs.jar file:/System/Library/Java/Extensions/MRJToolkit.jar Affect(row-cnt:84) cost in 5 ms.//å°è¯•æŸ¥æ‰¾ç±»çš„classæ–‡ä»¶[arthas@89977]$ classloader -c 770c2e6b -r java/lang/String.class jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/rt.jar!/java/lang/String.class Affect(row-cnt:1) cost in 4 ms.//ä½¿ç”¨classloaderåŠ è½½ç±»[arthas@89977]$ classloader -c 2c109df9 --load com.yiyi.api.WeixinSupportApiload class success. class-info com.yiyi.api.WeixinSupportApi code-source /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/ name com.yiyi.api.WeixinSupportApi isInterface false isAnnotation false isEnum false isAnonymousClass false isArray false isLocalClass false isMemberClass false isPrimitive false isSynthetic false simple-name WeixinSupportApi modifier public annotation org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping interfaces super-class +-java.lang.Object class-loader +-sun.misc.Launcher$AppClassLoader@18b4aac2 +-sun.misc.Launcher$ExtClassLoader@770c2e6b classLoaderHash 18b4aac2 //ä½¿ç”¨classloaderå»æŸ¥æ‰¾resource[arthas@89977]$ classloader -c 2c109df9 -r META-INF/MANIFEST.MF jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar!/META-INF/MANIFEST.MF jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF jar:file:/System/Library/Java/Extensions/MRJToolkit.jar!/META-INF/MANIFEST.MF jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/charsets.jar!/META-INF/MANIFEST.MF jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/deploy.jar!/META-INF/MANIFEST.MF jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF 2.1.4ã€getstaticè·å–ç±»ä¸­çš„é™æ€å±æ€§1234[arthas@89977]$ getstatic com.yiyi.api.WeixinSupportApi CORP_IDfield: CORP_ID@String[ww91156f2c9067a7ba]Affect(row-cnt:1) cost in 4 ms. å¦‚æœå¯¹è±¡æ˜¯ä¸€ä¸ªå¤æ‚çš„å¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨OGNLè¡¨è¾¾å¼è¿›è¡Œéå†,è¿‡æ»¤ 2.1.5ã€ttå‘½ä»¤ï¼Œè®°å½•è°ƒç”¨è®°å½•æ–¹æ³•æ‰§è¡Œè®°å½•çš„éš§é“ï¼Œè®°å½•æŒ‡å®šæ–¹æ³•æ¯æ¬¡è°ƒç”¨çš„å…¥å‚å’Œè¿”å›çš„ä¿¡æ¯ï¼Œå¹¶èƒ½å¯¹è¿™äº›ä¸åŒæ—¶é—´ä¸‹çš„è°ƒç”¨è¿›è¡Œè§‚æµ‹ã€‚ ttçš„è°ƒç”¨æ–¹å¼ï¼š|é€‰é¡¹|æè¿°||-|-||-d,â€“delete|åˆ é™¤ç´¢å¼•æŒ‡å®šçš„æ—¶é—´ç‰‡æ®µ||â€“delete-all|åˆ é™¤æ‰€æœ‰çš„æ—¶é—´ç‰‡æ®µ||-x,â€“expand value|å±•å¼€å¯¹è±¡çº§åˆ«(é»˜è®¤ä¸º1)||-h,â€“help|å‘½ä»¤ä½¿ç”¨æŒ‡å—||-i,â€“index value|å±•ç¤ºæŒ‡å®šçš„æ—¶é—´ç‰‡æ®µçš„ç›¸ä¿¡ä¿¡æ¯||-n,â€“limits value|æ‰§è¡Œæ—¶é—´é˜ˆå€¼||-l,â€“list|å±•ç¤ºæ‰€æœ‰çš„æ—¶é—´ç‰‡æ®µçš„ä¿¡æ¯||â€“listenerId value|æŒ‡å®šç›‘å¬id||-p,â€“play|é‡æ”¾ç”±ç´¢å¼•æŒ‡å®šçš„æ—¶é—´ç‰‡æ®µ||-E,â€“regex|å¯ç”¨æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…(é»˜è®¤æƒ…å†µä¸‹ä¸ºé€šé…ç¬¦åŒ¹é…)||â€“replay-interval value|é€‰é¡¹rå¤§äº1çš„ttçš„å›æ”¾é—´éš”||â€“replay-times value|æ‰§è¡Œttæ—¶çš„æ¬¡æ•°||-s,â€“search-express value|æœç´¢è¡¨è¾¾å¼ï¼Œç”¨ognlè¡¨è¾¾å¼æœç´¢æ—¶é—´ç‰‡æ®µã€‚|||adviceçš„ç»“æ„ç±»ä¼¼æ¡ä»¶å¼è¡¨è¾¾||-M,â€“sizeLimit value|ç»“æœçš„å­—èŠ‚ä¸Šé™(é»˜è®¤ä¸º1010241024)||-t,â€“time-tunnel|åœ¨æ—¶é—´ç‰‡æ®µå†…è®°å½•æ–¹æ³•è°ƒç”¨||-w,â€“watch-express value&gt;|è§‚çœ‹ognlexpressçš„æ—¶é—´ç‰‡æ®µ||class-pattern|æ¨¡å¼åŒ¹é…çš„è·¯å¾„å’Œç±»å||method-pattern|æ¨¡å¼åŒ¹é…æ³•||condition-express|ognlé£æ ¼çš„æ¡ä»¶è¡¨è¾¾å¼| 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849//è®°å½•è°ƒç”¨[arthas@89977]$ tt -t com.yiyi.api.WeixinSupportApi test Press Q or Ctrl+C to abort.Affect(class count: 1 , method count: 1) cost in 129 ms, listenerId: 1 INDEX TIMESTAMP COST(ms) IS-RET IS-EXP OBJECT CLASS METHOD -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1000 2020-07-06 17:21:20 0.531715 true false 0x437d2cf WeixinSupportApi test 1001 2020-07-06 17:21:24 0.026004 true false 0x437d2cf WeixinSupportApi test 1002 2020-07-06 17:21:27 0.027567 true false 0x437d2cf WeixinSupportApi test 1003 2020-07-06 17:21:28 0.064779 true false 0x437d2cf WeixinSupportApi test //å±•ç¤ºæ—¶é—´ç‰‡åˆ—è¡¨[arthas@89977]$ tt -l INDEX TIMESTAMP COST(ms) IS-RET IS-EXP OBJECT CLASS METHOD -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1000 2020-07-06 17:21:20 0.531715 true false 0x437d2cf WeixinSupportApi test 1001 2020-07-06 17:21:24 0.026004 true false 0x437d2cf WeixinSupportApi test 1002 2020-07-06 17:21:27 0.027567 true false 0x437d2cf WeixinSupportApi test 1003 2020-07-06 17:21:28 0.064779 true false 0x437d2cf WeixinSupportApi test Affect(row-cnt:4) cost in 1 ms.//å±•ç¤ºæ—¶é—´ç‰‡çš„å…·ä½“ä¿¡æ¯[arthas@89977]$ tt -i 1000 INDEX 1000 GMT-CREATE 2020-07-06 17:21:20 COST(ms) 0.531715 OBJECT 0x437d2cf CLASS com.yiyi.api.WeixinSupportApi METHOD test IS-RETURN true IS-EXCEPTION false RETURN-OBJ @String[hello] Affect(row-cnt:1) cost in 1 ms.//é‡æ–°è°ƒç”¨ç´¢å¼•ä¸º1000çš„è°ƒç”¨[arthas@89977]$ tt -i 1000 -p RE-INDEX 1000 GMT-REPLAY 2020-07-06 17:22:10 OBJECT 0x437d2cf CLASS com.yiyi.api.WeixinSupportApi METHOD test IS-RETURN true IS-EXCEPTION false COST(ms) 0.260785 RETURN-OBJ @String[hello] Time fragment[1000] successfully replayed 1 times.[arthas@89977]$ è¡¨æ ¼å­—æ®µ å­—æ®µè§£é‡Š INDEX æ—¶é—´ç‰‡æ®µè®°å½•ç¼–å·ï¼Œæ¯ä¸€ä¸ªç¼–å·ä»£è¡¨ç€ä¸€æ¬¡è°ƒç”¨ï¼Œåç»­ttè¿˜æœ‰å¾ˆå¤šå‘½ä»¤éƒ½æ˜¯åŸºäºæ­¤ç¼–å·æŒ‡å®šè®°å½•æ“ä½œï¼Œéå¸¸é‡è¦ã€‚ TIMESTAMP æ–¹æ³•æ‰§è¡Œçš„æœ¬æœºæ—¶é—´ï¼Œè®°å½•äº†è¿™ä¸ªæ—¶é—´ç‰‡æ®µæ‰€å‘ç”Ÿçš„æœ¬æœºæ—¶é—´ COST(ms) æ–¹æ³•æ‰§è¡Œçš„è€—æ—¶ IS-RET æ–¹æ³•æ˜¯å¦ä»¥æ­£å¸¸è¿”å›çš„å½¢å¼ç»“æŸ IS-EXP æ–¹æ³•æ˜¯å¦ä»¥æŠ›å¼‚å¸¸çš„å½¢å¼ç»“æŸ OBJECT æ‰§è¡Œå¯¹è±¡çš„hashCode()ï¼Œæ³¨æ„ï¼Œæ›¾ç»æœ‰äººè¯¯è®¤ä¸ºæ˜¯å¯¹è±¡åœ¨JVMä¸­çš„å†…å­˜åœ°å€ï¼Œä½†å¾ˆé—æ†¾ä»–ä¸æ˜¯ã€‚ä½†ä»–èƒ½å¸®åŠ©ä½ ç®€å•çš„æ ‡è®°å½“å‰æ‰§è¡Œæ–¹æ³•çš„ç±»å®ä½“ CLASS æ‰§è¡Œçš„ç±»å METHOD æ‰§è¡Œçš„æ–¹æ³•å ä½¿ç”¨OGNLè¡¨è¾¾å¼ï¼Œå¯¹è°ƒç”¨å‚æ•°è¿›è¡Œè¿‡æ»¤ç›‘å¬ã€‚ 12345678910111213141516171819202122232425262728[arthas@89977]$ tt -t com.yiyi.api.WeixinSupportApi sendMessage &#x27;params[0].text.content==&quot;test&quot;&#x27;Press Q or Ctrl+C to abort.Affect(class count: 1 , method count: 1) cost in 72 ms, listenerId: 5 INDEX TIMESTAMP COST(ms) IS-RET IS-EXP OBJECT CLASS METHOD -------------------------------------------------------------------------------------------------------------------------------------------------------------------- 1004 2020-07-06 17:33:42 354.578854 true false 0x437d2cf WeixinSupportApi sendMessage [arthas@89977]$ tt -i 1004 INDEX 1004 GMT-CREATE 2020-07-06 17:33:42 COST(ms) 354.578854 OBJECT 0x437d2cf CLASS com.yiyi.api.WeixinSupportApi METHOD sendMessage IS-RETURN true IS-EXCEPTION false PARAMETERS[0] @SendMessageVO[ touser=@String[Feng], msgtype=@String[text], agentid=@Integer[1000036], text=@Text[com.yiyi.model.SendMessageVO$Text@504511d7], safe=@Integer[0], ] RETURN-OBJ @WeixinResponse[ errcode=@Integer[0], errmsg=@String[ok], invaliduser=@String[], ] Affect(row-cnt:1) cost in 1 ms. 2.1.6ã€ä½¿ç”¨scæŸ¥çœ‹jvmå·²åŠ è½½çš„ç±»ä¿¡æ¯12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182838485868788899091//æ¨¡ç³ŠåŒ¹é…ï¼ŒæŸ¥çœ‹æŸä¸ªåŒ…ä¸‹é¢çš„ç±»åŠ è½½ä¿¡æ¯[arthas@89977]$ sc com.yiyi.*com.yiyi.Applicationcom.yiyi.Application$$EnhancerBySpringCGLIB$$7f85004ecom.yiyi.WebConfigcom.yiyi.WebConfig$$EnhancerBySpringCGLIB$$bf76c934com.yiyi.api.WeixinSupportApicom.yiyi.api.WeixinSupportApi$$Lambda$451/966754950com.yiyi.api.WeixinSupportApi$$Lambda$467/1545239474com.yiyi.api.WeixinSupportApi$$Lambda$468/1304820993com.yiyi.model.AccessTokenVocom.yiyi.model.SendMessageVOcom.yiyi.model.SendMessageVO$Textcom.yiyi.model.WeixinResponseAffect(row-cnt:12) cost in 15 ms.//æŒ‡å®šç±»çš„è¯¦ç»†ä¿¡æ¯[arthas@89977]$ sc -d com.yiyi.api.WeixinSupportApi class-info com.yiyi.api.WeixinSupportApi code-source /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/ name com.yiyi.api.WeixinSupportApi isInterface false isAnnotation false isEnum false isAnonymousClass false isArray false isLocalClass false isMemberClass false isPrimitive false isSynthetic false simple-name WeixinSupportApi modifier public annotation org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping interfaces super-class +-java.lang.Object class-loader +-sun.misc.Launcher$AppClassLoader@18b4aac2 +-sun.misc.Launcher$ExtClassLoader@770c2e6b classLoaderHash 18b4aac2 Affect(row-cnt:1) cost in 8 ms.// æŒ‡å®šç±»çš„åŠ è½½ä¿¡æ¯ä»¥åŠå±æ€§å­—æ®µçš„ä¿¡æ¯[arthas@89977]$ sc -d -f com.yiyi.api.WeixinSupportApi class-info com.yiyi.api.WeixinSupportApi code-source /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/ name com.yiyi.api.WeixinSupportApi isInterface false isAnnotation false isEnum false isAnonymousClass false isArray false isLocalClass false isMemberClass false isPrimitive false isSynthetic false simple-name WeixinSupportApi modifier public annotation org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping interfaces super-class +-java.lang.Object class-loader +-sun.misc.Launcher$AppClassLoader@18b4aac2 +-sun.misc.Launcher$ExtClassLoader@770c2e6b classLoaderHash 18b4aac2 fields name log type org.slf4j.Logger modifier final,private,static value Logger[com.yiyi.api.WeixinSupportApi] name response type javax.servlet.http.HttpServletResponse modifier private annotation javax.annotation.Resource name CORP_ID type java.lang.String modifier final,private,static value ww91156f2c9067a7ba name APP_SECRET type java.lang.String modifier final,private,static value r5ifq9RFqtsL34sdWXmrzMytY7KYksz5cAimzoH1jeg name ACCESS_TOKEN_CACHE type com.google.common.cache.Cache modifier final,private,static value com.google.common.cache.LocalCache$LocalManualCache@39373908 Affect(row-cnt:1) cost in 10 ms. 2.1.7ã€mcï¼Œå†…å­˜ç¼–è¯‘Memory Compiler/å†…å­˜ç¼–è¯‘å™¨ï¼Œç¼–è¯‘.java ç”Ÿæˆ.classæ–‡ä»¶ 1mc /tmp/Test.java å¯ä»¥é€šè¿‡-cæŒ‡å®šclassloaderï¼š 1mc -c 327a647b /tmp/Test.java å¯ä»¥é€šè¿‡-dæŒ‡å®šè¾“å‡ºçš„classæ–‡ä»¶çš„ç›®å½• 1mc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java ç¼–è¯‘æˆçš„.classæ–‡ä»¶åï¼Œå¯ä»¥ç»“åˆredefineå‘½ä»¤å®ç°çƒ­æ›´æ–°ä»£ç  æ³¨æ„ï¼Œmcå‘½ä»¤æœ‰å¯èƒ½å¤±è´¥ã€‚å¦‚æœç¼–è¯‘å¤±è´¥å¯ä»¥åœ¨æœ¬åœ°ç¼–è¯‘å¥½.classæ–‡ä»¶ï¼Œå†ä¸Šä¼ åˆ°æœåŠ¡å™¨ã€‚ 2.1.8ã€æŸ¥çœ‹æ–¹æ³•çš„stack12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849[arthas@89977]$ stack com.yiyi.api.WeixinSupportApi getAccessToken Press Q or Ctrl+C to abort.Affect(class count: 1 , method count: 1) cost in 43 ms, listenerId: 8ts=2020-07-06 17:50:49;thread_name=http-nio-7070-exec-2;id=83;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@2fc07784 @com.yiyi.api.WeixinSupportApi.getAccessToken() at com.yiyi.api.WeixinSupportApi.sendMessage(WeixinSupportApi.java:68) at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2) at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) at java.lang.reflect.Method.invoke(Method.java:498) at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190) at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138) at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879) at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793) at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87) at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040) at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943) at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006) at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909) at javax.servlet.http.HttpServlet.service(HttpServlet.java:660) at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883) at javax.servlet.http.HttpServlet.service(HttpServlet.java:741) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201) at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119) at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193) at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166) at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202) at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96) at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541) at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139) at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92) at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74) at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343) at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373) at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65) at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868) at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590) at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49) at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149) at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624) at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61) at java.lang.Thread.run(Thread.java:748) ä¹Ÿå¯ä»¥ä½¿ç”¨OGNLè¡¨è¾¾å¼ï¼Œå¯¹è¯·æ±‚å‚æ•°è¿›è¡Œè¿‡æ»¤ï¼Œæˆ–è€…ä½¿ç”¨æ‰§è¡Œæ—¶é—´è¿›è¡Œè¿‡æ»¤ 2.2.1ã€Springbooté›†æˆarthaså¼•å…¥arthasçš„ä¾èµ– 12345678910&lt;properties&gt; &lt;arthas.version&gt;3.3.6&lt;/arthas.version&gt;&lt;/properties&gt;&lt;dependencies&gt; &lt;dependency&gt; &lt;groupId&gt;com.taobao.arthas&lt;/groupId&gt; &lt;artifactId&gt;arthas-spring-boot-starter&lt;/artifactId&gt; &lt;version&gt;$&#123;arthas.version&#125;&lt;/version&gt; &lt;/dependency&gt;&lt;/dependencies&gt; åº”ç”¨é…ç½®ï¼šapplication.properties 1234//æŒ‡å®šarthasçš„agentIdarthas.agentId=weixin//arthas tunnel server çš„websocketçš„åœ°å€arthas.tunnel-server=ws://localhost:7777/ws é‡å¯åº”ç”¨ 2.2.2ã€é€šè¿‡æµè§ˆå™¨è¿æ¥arthasç¬¬ä¸€æ­¥ï¼šä¸‹è½½arthas tunnel serverwget https://github.com/alibaba/arthas/releases/download/arthas-all-3.3.6/arthas-tunnel-server-3.3.6.jarç¬¬äºŒæ­¥ï¼šå¯åŠ¨arthas tunnel server 1java -jar arthas-tunnel-server.jar -server.port=8888 å¯åŠ¨å¹¶æŒ‡å®šwebçš„ç«¯å£ è¿™ä¸ªæœåŠ¡æœ‰ä¸¤ä¸ªsocketè¿æ¥æ–¹å¼ï¼Œä¸€ä¸ªæ­£å¸¸çš„httpï¼Œç”¨çš„ç«¯å£æ˜¯æˆ‘ä»¬æŒ‡å®šçš„8888ï¼Œè¿˜æœ‰ä¸€ä¸ªå°±æ˜¯ä¾›æ˜¾ç¤ºæœåŠ¡å™¨çš„å‘½ä»¤è¡Œçš„websocketè¿æ¥ï¼Œç«¯å£7777ç¬¬ä¸‰æ­¥ï¼šè®¿é—®arthas tunnel server ï¼Œæˆ‘æ˜¯æœ¬æœºæµ‹è¯•ï¼Œæ‰€ä»¥å°±æ˜¯localhost:8888,å¦‚å›¾ï¼š è¿æ¥æŒ‡å®šçš„åº”ç”¨ï¼š é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿æ¥åœ°å€ä¸ºæœ¬åœ°ï¼Œwebsocketçš„ç«¯å£ä¸º7777 ä¸‰ã€æ€»ç»“Arthasè´µä¸ºjavaåº”ç”¨è¯Šæ–­ç¥å™¨ï¼Œå¯¹äºåº”ç”¨çš„èµ„æºå ç”¨ï¼Œæ€§èƒ½åˆ†æï¼Œjvmç›‘æ§éƒ½æœ‰å¾ˆå¤§çš„æ”¯æŒå¸®åŠ©ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨æ’æŸ¥çº¿ä¸Šé—®é¢˜æ—¶ï¼Œå¯ä»¥ç›‘å¬å¯¹åº”çš„æ–¹æ³•çš„è°ƒç”¨ï¼Œä»¥åŠåŠ¨æ€ä¿®æ”¹classç±»ï¼Œå¾ˆæ¹¿ï¼Œå¾ˆæ–¹ä¾¿ã€‚è€Œä¸”Arthaså¯¹dockerçš„javaè¿›ç¨‹ï¼Œä»¥åŠk8séƒ½æœ‰å¾ˆå¥½çš„æ”¯æŒï¼Œåç»­ç”¨åˆ°çš„æ—¶å€™åœ¨åšå­¦ä¹ ã€‚","categories":[{"name":"é¡¹ç›®ç®¡ç†","slug":"é¡¹ç›®ç®¡ç†","permalink":"https://cha1yi.github.io/dist/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"}],"tags":[{"name":"Arthas","slug":"Arthas","permalink":"https://cha1yi.github.io/dist/tags/Arthas/"}],"author":"wuxuan.chai"},{"title":"é€šè¿‡Jacksonç©è½¬Json","slug":"é€šè¿‡Jacksonç©è½¬Json","date":"2021-01-17T15:46:42.338Z","updated":"2021-06-05T14:57:20.287Z","comments":true,"path":"2021/01/17/é€šè¿‡Jacksonç©è½¬Json/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/17/%E9%80%9A%E8%BF%87Jackson%E7%8E%A9%E8%BD%ACJson/","excerpt":"","text":"ä¸€ã€Jackson æ³¨è§£ç¤ºä¾‹1.1ã€ç®€ä»‹åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†æ·±å…¥æ¢è®¨Jacksonæ³¨è§£ã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨ç°æœ‰çš„æ³¨è§£ï¼Œå¦‚ä½•åˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ï¼Œæœ€å-å¦‚ä½•ç¦ç”¨å®ƒä»¬ã€‚ 1.2ã€maven ä¾èµ–é¦–å…ˆï¼Œå°†jackson-databindä¾èµ–é¡¹æ·»åŠ åˆ°pom.xmlï¼š 1234567891011&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.core&lt;/groupId&gt; &lt;artifactId&gt;jackson-databind&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt;&lt;!-- æˆ–è€… --&gt;&lt;dependency&gt; &lt;groupId&gt;com.fasterxml.jackson.dataformat&lt;/groupId&gt; &lt;artifactId&gt;jackson-dataformat-xml&lt;/artifactId&gt; &lt;version&gt;2.9.8&lt;/version&gt;&lt;/dependency&gt; æ­¤ä¾èµ–é¡¹è¿˜å°†åœ¨ç±»è·¯å¾„ä¸­å¯ä¼ é€’åœ°æ·»åŠ ä»¥ä¸‹åº“ï¼š jackson-annotations-2.9.8.jar jackson-core-2.9.8.jar jackson-databind-2.9.8.jar 1.3ã€Jacksonåºåˆ—åŒ–æ³¨è§£é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹åºåˆ—åŒ–æ³¨è§£ã€‚ 1.3.1ã€@JsonAnyGetter{@JsonAnyGetter } æ³¨è§£å…è®¸çµæ´»åœ°ä½¿ç”¨Mapå­—æ®µä½œä¸ºæ ‡å‡†å±æ€§ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹â€“ ExtendableBeanå®ä½“å…·æœ‰nameå±æ€§å’Œä¸€ç»„ä»¥é”®/å€¼å¯¹å½¢å¼çš„å¯æ‰©å±•å±æ€§,æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯ç”¨ä¸ºfalseçš„å¯é€‰å‚æ•°æ¥ç¦ç”¨@JsonAnyGetter()ã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼ŒMapå°†è½¬æ¢ä¸ºJSONï¼Œå¹¶åœ¨åºåˆ—åŒ–åæ˜¾ç¤ºåœ¨propertieså˜é‡ä¸‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonAnyGetter;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.databind.ObjectMapper;import com.google.common.collect.Maps;import lombok.Getter;import lombok.NoArgsConstructor;import lombok.Setter;import java.util.Map;/** * @author wuxuan.chai * @date 2020/6/8 9:44 ä¸Šåˆ */@Getter@Setter@NoArgsConstructorpublic class ExtendableBean &#123; private String name; private Map&lt;String,Object&gt; properties; private Map&lt;String,Object&gt; properties1; public String getName() &#123; return name; &#125; @JsonAnyGetter(enabled = false) public Map&lt;String, Object&gt; getProperties() &#123; return properties; &#125; @JsonAnyGetter public Map&lt;String,Object&gt; getProperties1()&#123; return properties1; &#125; public static void main(String[] args) throws JsonProcessingException &#123; ExtendableBean extendableBean = new ExtendableBean(); extendableBean.setName(&quot;wuxuan&quot;); Map&lt;String, Object&gt; map = Maps.newHashMap(); map.put(&quot;age&quot;,11); map.put(&quot;sex&quot;,&quot;male&quot;); extendableBean.setProperties(map); Map&lt;String, Object&gt; map1 = Maps.newHashMap(); map1.put(&quot;work&quot;,&quot;java pg&quot;); map1.put(&quot;no&quot;,1); extendableBean.setProperties1(map1); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(extendableBean); System.out.println(json); // result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;properties&quot;:&#123;&quot;sex&quot;:&quot;male&quot;,&quot;age&quot;:11&#125;,&quot;no&quot;:1,&quot;work&quot;:&quot;java pg&quot;&#125; &#125;&#125; 1.3.1ã€@JsonGetter@JsonGetteræ³¨è§£æ˜¯@JsonPropertyæ³¨è§£çš„æ›¿ä»£æ–¹æ³•å°†æ–¹æ³•æ ‡è®°ä¸ºgetteræ–¹æ³•ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†æ–¹æ³•getTheName() æŒ‡å®šä¸ºMyBeanentityçš„nameå±æ€§çš„getteræ–¹æ³•ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonGetter;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.NoArgsConstructor;import lombok.Setter;import javax.naming.Name;/** * @author wuxuan.chai * @date 2020/6/8 10:06 ä¸Šåˆ */@Setter@NoArgsConstructorpublic class MyBean &#123; private int id; private String name; @JsonGetter(&quot;name&quot;) public String getTheName()&#123; return this.name; &#125; public int getId()&#123; return this.id; &#125; public static void main(String[] args) throws JsonProcessingException &#123; MyBean myBean = new MyBean(); myBean.setId(1); myBean.setName(&quot;wuxuan&quot;); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(myBean); System.out.println(json); //result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125; &#125;&#125; 1.3.3ã€@JsonPropertyOrderæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonPropertyOrderæ‰¹æ³¨æŒ‡å®šåºåˆ—åŒ–å±æ€§çš„é¡ºåºã€‚è®©æˆ‘ä»¬ä¸ºMyBeanå®ä½“çš„å±æ€§è®¾ç½®è‡ªå®šä¹‰é¡ºåºï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonGetter;import com.fasterxml.jackson.annotation.JsonPropertyOrder;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.NoArgsConstructor;import lombok.Setter;import javax.naming.Name;/** * @author wuxuan.chai * @date 2020/6/8 10:06 ä¸Šåˆ */@Setter@NoArgsConstructor@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)public class MyBean &#123; private int id; private String name; @JsonGetter(&quot;name&quot;) public String getTheName()&#123; return this.name; &#125; public int getId()&#123; return this.id; &#125; public static void main(String[] args) throws JsonProcessingException &#123; MyBean myBean = new MyBean(); myBean.setId(1); myBean.setName(&quot;wuxuan&quot;); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(myBean); System.out.println(json); //result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1&#125; &#125;&#125; æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨@JsonPropertyOrderï¼ˆalphabetic = trueï¼‰æŒ‰å­—æ¯é¡ºåºå¯¹å±æ€§è¿›è¡Œæ’åºã€‚ åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œåºåˆ—åŒ–çš„è¾“å‡ºå°†æ˜¯ï¼š 1&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125; 1.3.4ã€@JsonRawValue@JsonRawValueæ‰¹æ³¨å¯ä»¥æŒ‡ç¤ºJacksonå®Œå…¨æŒ‰åŸæ ·åºåˆ—åŒ–å±æ€§ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JsonRawValueåµŒå…¥ä¸€äº›è‡ªå®šä¹‰JSONä½œä¸ºå®ä½“çš„å€¼ï¼š 123456789101112131415161718192021222324252627282930313233package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonRawValue;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 10:15 ä¸Šåˆ */@Getter@Setterpublic class RawBean &#123; public String name; @JsonRawValue(false) public String json; @SneakyThrows public static void main(String[] args) &#123; RawBean rawBean = new RawBean(); rawBean.setName(&quot;wuxuan&quot;); rawBean.setJson(&quot;&#123;\\&quot;raw\\&quot;:false&#125;&quot;); String json = new ObjectMapper().writeValueAsString(rawBean); System.out.println(json); //@JsonRawValue result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&#123;&quot;raw&quot;:false&#125;&#125; //@JsonRawValue(false) result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&quot;&#123;\\&quot;raw\\&quot;:false&#125;&quot;&#125; &#125;&#125; æˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨å¯é€‰çš„å¸ƒå°”å‚æ•°å€¼æ¥å®šä¹‰æ­¤æ³¨è§£æ˜¯å¦å¤„äºæ´»åŠ¨çŠ¶æ€ã€‚ 1.3.5ã€@JsonValue@JsonValueè¡¨ç¤ºåº“å°†ç”¨äºåºåˆ—åŒ–æ•´ä¸ªå®ä¾‹çš„å•ä¸ªæ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæšä¸¾ä¸­ï¼Œæˆ‘ä»¬ç”¨@JsonValueæ³¨è§£getNameï¼Œä»¥ä¾¿ä»»ä½•è¿™æ ·çš„å®ä½“éƒ½é€šè¿‡å…¶åç§°åºåˆ—åŒ–ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonValue;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.AllArgsConstructor;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 10:23 ä¸Šåˆ */@AllArgsConstructorpublic enum TypeEnumWithValue &#123; /** * æµ‹è¯•æšä¸¾åºåˆ—åŒ– */ TYPE1(1, &quot;wuxuan&quot;), TYPE2(2, &quot;yiyi&quot;); private final Integer id; private final String name; public Integer getId()&#123; return id; &#125; @JsonValue public String getName()&#123; return name; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = new ObjectMapper().writeValueAsString(TYPE1); System.out.println(json); //result: &quot;wuxuan&quot; &#125;&#125; 1.3.6ã€@JsonRootNameå¦‚æœå¯ç”¨äº†åŒ…è£…ï¼Œåˆ™ä½¿ç”¨@JsonRootNameæ‰¹æ³¨æŒ‡å®šè¦ä½¿ç”¨çš„æ ¹åŒ…è£…çš„åç§°ã€‚åŒ…è£…æ„å‘³ç€ä¸è¦å°†ç”¨æˆ·åºåˆ—åŒ–ä¸ºä»¥ä¸‹å†…å®¹ï¼š 1234&#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;wuxuan&quot;&#125; è€Œæ˜¯åºåˆ—åŒ–ä¸ºï¼š 123456&#123; &quot;user&quot;: &#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;wuxuan&quot; &#125;&#125; å› æ­¤ï¼Œè®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç¤ºä¾‹â€“æˆ‘ä»¬å°†ä½¿ç”¨@JsonRootNameæ‰¹æ³¨æŒ‡ç¤ºæ­¤æ½œåœ¨åŒ…è£…å®ä½“çš„åç§°ï¼š 1234567891011121314151617181920212223242526272829303132333435package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonRootName;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.SerializationFeature;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 10:30 ä¸Šåˆ */@JsonRootName(&quot;user&quot;)@Getter@Setterpublic class UserWithRoot &#123; private Integer id; private String name; @SneakyThrows public static void main(String[] args) &#123; UserWithRoot userWithRoot = new UserWithRoot(); userWithRoot.setId(1); userWithRoot.setName(&quot;wuxuan&quot;); ObjectMapper objectMapper = new ObjectMapper(); objectMapper.enable(SerializationFeature.WRAP_ROOT_VALUE); String json = objectMapper.writeValueAsString(userWithRoot); System.out.println(json); //result: &#123;&quot;user&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;&#125; &#125;&#125; é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŒ…è£…å™¨çš„åç§°å°†ä¸ºç±»â€“ UserWithRootã€‚ é€šè¿‡ä½¿ç”¨æ³¨è§£ï¼Œæˆ‘ä»¬å¾—åˆ°äº†çœ‹ä¸Šå»æ›´å¹²å‡€çš„ç”¨æˆ·ï¼š 123456&#123; &quot;user&quot;: &#123; &quot;id&quot;: 1, &quot;name&quot;: &quot;wuxuan&quot; &#125;&#125; ä»Jackson 2.4å¼€å§‹ï¼Œæ–°çš„å¯é€‰å‚æ•°åç§°ç©ºé—´å¯ç”¨äºXMLä¹‹ç±»çš„æ•°æ®æ ¼å¼ã€‚ å¦‚æœæ·»åŠ å®ƒï¼Œå®ƒå°†æˆä¸ºæ ‡å‡†åç§°çš„ä¸€éƒ¨åˆ†ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940package com.yiyi.entity;import com.fasterxml.jackson.annotation.JsonRootName;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.SerializationFeature;import com.fasterxml.jackson.dataformat.xml.XmlMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 10:30 ä¸Šåˆ */@JsonRootName(value = &quot;user&quot;,namespace = &quot;users&quot;)@Getter@Setterpublic class UserWithRoot &#123; private Integer id; private String name; @SneakyThrows public static void main(String[] args) &#123; UserWithRoot userWithRoot = new UserWithRoot(); userWithRoot.setId(1); userWithRoot.setName(&quot;wuxuan&quot;); XmlMapper xmlMapper = new XmlMapper(); xmlMapper.enable(SerializationFeature.WRAP_ROOT_VALUE); String xml = xmlMapper.writeValueAsString(userWithRoot); System.out.println(xml);// result:// &lt;user xmlns=&quot;users&quot;&gt;// &lt;id xmlns=&quot;&quot;&gt;1&lt;/id&gt;// &lt;name xmlns=&quot;&quot;&gt;wuxuan&lt;/name&gt;// &lt;/user&gt; &#125;&#125; åºåˆ—åŒ–çš„xmlMapperç»“æœä¸ºï¼š 1234&lt;user xmlns=&quot;users&quot;&gt; &lt;id xmlns=&quot;&quot;&gt;1&lt;/id&gt; &lt;name xmlns=&quot;&quot;&gt;wuxuan&lt;/name&gt;&lt;/user&gt; 1.3.6ã€@JsonSerialize@JsonSerializeè¡¨ç¤ºåœ¨ç¼–ç»„å®ä½“æ—¶è¦ä½¿ç”¨çš„è‡ªå®šä¹‰åºåˆ—åŒ–ç¨‹åºã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªç®€å•çš„ä¾‹å­ã€‚ æˆ‘ä»¬å°†ä½¿ç”¨@JsonSerializeé€šè¿‡CustomDateSerializeråºåˆ—åŒ–eventDateå±æ€§ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.yiyi.entity;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.annotation.JsonSerialize;import com.yiyi.annotation.support.CustomDateSerializer;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;import java.text.SimpleDateFormat;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 10:45 ä¸Šåˆ */@Getter@Setterpublic class Event &#123; public String name; @JsonSerialize(using = CustomDateSerializer.class) public Date eventDate; @SneakyThrows public static void main(String[] args) &#123; SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;dd-MM-yyy hh:mm:ss&quot;); Event event = new Event(); event.setName(&quot;wuxuan coming&quot;); Date eventDate = new Date(); event.setEventDate(eventDate); System.out.println(simpleDateFormat.format(eventDate)); String json = new ObjectMapper().writeValueAsString(event); System.out.println(json); //result: 08-06-2020 10:54:12 //result: &#123;&quot;name&quot;:&quot;wuxuan coming&quot;,&quot;eventDate&quot;:&quot;08-06-2020 10:52:37&quot;&#125; &#125;&#125; 1.4ã€Jackson ååºåˆ—åŒ–çš„æ³¨è§£æ¥ä¸‹æ¥ï¼Œå¼€å§‹æ¢ç´¢Jacksonçš„ååºåˆ—åŒ–çš„æ³¨è§£ 1.4.1ã€@JsonCreatoræˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonCreatoræ‰¹æ³¨æ¥è°ƒæ•´ååºåˆ—åŒ–ä¸­ä½¿ç”¨çš„æ„é€ å‡½æ•°/å·¥å‚ã€‚ å½“æˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–æŸäº›ä¸æˆ‘ä»¬éœ€è¦è·å–çš„ç›®æ ‡å®ä½“ä¸å®Œå…¨åŒ¹é…çš„JSONæ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ã€‚çœ‹ä¸‹é¢çš„ä¾‹å­ï¼Œæˆ‘ä»¬éœ€è¦ååºåˆ—åŒ–è¿™ä¸ªjsonï¼š 1234&#123; &quot;id&quot;: 1, &quot;the name&quot;: &quot;wuxuan&quot;&#125; ä½†æ˜¯ï¼Œæˆ‘ä»¬çš„ç›®æ ‡å®ä½“ä¸­æ²¡æœ‰TheNameå­—æ®µ-åªæœ‰ä¸€ä¸ªnameå­—æ®µã€‚ ç°åœ¨ï¼Œæˆ‘ä»¬ä¸æƒ³æ›´æ”¹å®ä½“æœ¬èº«-æˆ‘ä»¬åªéœ€è¦å¯¹è§£ç»„è¿‡ç¨‹è¿›è¡Œæ›´å¤šæ§åˆ¶-é€šè¿‡ä½¿ç”¨@JsonCreatoræ³¨è§£æ„é€ å‡½æ•°å¹¶åŒæ—¶ä½¿ç”¨@JsonPropertyæ³¨è§£ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.annotation.JsonProperty;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 11:04 ä¸Šåˆ */@Getter@Setter@ToStringpublic class BeanWithCreator &#123; private int id; private String name; public BeanWithCreator(@JsonProperty(&quot;id&quot;) int id,@JsonProperty(&quot;the name&quot;) String name) &#123; this.id = id; this.name = name; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot;\\&quot;id\\&quot;: 1,\\n&quot; + &quot;\\&quot;the name\\&quot;: \\&quot;wuxuan\\&quot;\\n&quot; + &quot;&#125;&quot;; BeanWithCreator value = new ObjectMapper().readerFor(BeanWithCreator.class).readValue(json); System.out.println(value.toString()); //result: BeanWithCreator(id=1, name=wuxuan) &#125;&#125; 1.4.2. @JacksonInject@JacksonInjectæŒ‡ç¤ºå±æ€§å°†ä»æ³¨å…¥è€Œä¸æ˜¯ä»JSONæ•°æ®è·å–å…¶å€¼ã€‚ 1234567891011121314151617181920212223242526272829303132package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.annotation.JacksonInject;import com.fasterxml.jackson.databind.InjectableValues;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 11:15 ä¸Šåˆ */@Getter@Setterpublic class BeanWithInject &#123; @JacksonInject private int id; private String name; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\&quot;name\\&quot;: \\&quot;wuxuan\\&quot;&#125;&quot;; InjectableValues.Std std = new InjectableValues.Std().addValue(int.class, 1); BeanWithInject beanWithInject = new ObjectMapper().reader(std).forType(BeanWithInject.class).readValue(json); System.out.println(beanWithInject.id == 1); //result: true &#125;&#125; 1.4.3. @JsonAnySetter@JsonAnySetterä½¿æˆ‘ä»¬å¯ä»¥çµæ´»åœ°ä½¿ç”¨Mapä½œä¸ºæ ‡å‡†å±æ€§ã€‚ ååºåˆ—åŒ–æ—¶ï¼ŒJSONçš„å±æ€§å°†è¢«ç®€å•åœ°æ·»åŠ åˆ°Mapä¸­ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„â€“æˆ‘ä»¬å°†ä½¿ç”¨@JsonAnySetterååºåˆ—åŒ–å®ä½“ExtendableBeanï¼Œå°†ä¸‹åˆ—çš„jsonååºåˆ—åŒ–ï¼š 12345&#123; &quot;name&quot;:&quot;My bean&quot;, &quot;attr2&quot;:&quot;val2&quot;, &quot;attr1&quot;:&quot;val1&quot;&#125; å¦‚ä½•ä½¿ç”¨@JsonAnySetteræ³¨è§£ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.annotation.JsonAnySetter;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;import lombok.ToString;import java.util.HashMap;import java.util.Map;/** * @author wuxuan.chai * @date 2020/6/8 11:21 ä¸Šåˆ */@Getter@Setter@ToStringpublic class ExtendableBean &#123; private String name; private Map&lt;String,Object&gt; properties = new HashMap&lt;&gt;(); @JsonAnySetter public void setProperties(String key,String value)&#123; properties.put(key,value); &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;name\\&quot;:\\&quot;My bean\\&quot;,\\n&quot; + &quot; \\&quot;attr2\\&quot;:\\&quot;val2\\&quot;,\\n&quot; + &quot; \\&quot;attr1\\&quot;:\\&quot;val1\\&quot;\\n&quot; + &quot;&#125;&quot;; ExtendableBean extendableBean = new ObjectMapper().readerFor(ExtendableBean.class).readValue(json); System.out.println(extendableBean.toString()); //result: ExtendableBean(name=My bean, properties=&#123;attr2=val2, attr1=val1&#125;) &#125;&#125; 1.4.4. @JsonSetter@JsonSetteræ˜¯@JsonPropertyçš„æ›¿ä»£æ–¹æ³•â€“â€“å°†æ–¹æ³•æ ‡è®°ä¸ºè®¾ç½®æ–¹æ³•ã€‚å½“æˆ‘ä»¬éœ€è¦è¯»å–ä¸€äº›JSONæ•°æ®ä½†ç›®æ ‡å®ä½“ç±»ä¸æ•°æ®ä¸å®Œå…¨åŒ¹é…æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦è°ƒæ•´è¿‡ç¨‹ä»¥ä½¿å…¶é€‚åˆã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬å°†åœ¨MyBeanentityä¸­å°†setTheName()æ–¹æ³•æŒ‡å®šä¸ºnameå±æ€§çš„è®¾ç½®æ–¹æ³•ï¼š 1234567891011121314151617181920212223242526272829303132333435package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.annotation.JsonSetter;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 11:36 ä¸Šåˆ */@Getterpublic class MyBean &#123; @Setter private int id; private String theName; @JsonSetter(&quot;name&quot;) public void setTheName(String name)&#123; this.theName = name; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;id\\&quot;: 1,\\n&quot; + &quot; \\&quot;name\\&quot;: \\&quot;wuxuan\\&quot;\\n&quot; + &quot;&#125;&quot;; MyBean myBean = new ObjectMapper().readerFor(MyBean.class).readValue(json); System.out.println(myBean.getTheName().equals(&quot;wuxuan&quot;)); &#125;&#125; 1.4.5. @JsonDeserialize@JsonDeserializeæŒ‡ç¤ºä½¿ç”¨è‡ªå®šä¹‰è§£ä¸²å™¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹æ•ˆæœå¦‚ä½•â€“æˆ‘ä»¬å°†ä½¿ç”¨@JsonDeserializeé€šè¿‡CustomDateDeserializerååºåˆ—åŒ–eventDateå±æ€§ï¼š 12345678910111213141516171819202122232425262728293031323334353637package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.annotation.JsonDeserialize;import com.yiyi.annotation.support.CustomDateDeserializer;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;import java.text.SimpleDateFormat;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 11:41 ä¸Šåˆ */@Getter@Setterpublic class Event &#123; private String name; @JsonDeserialize(using = CustomDateDeserializer.class) private Date eventDate; @SneakyThrows public static void main(String[] args) &#123; SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;dd-MM-yyy hh:mm:ss&quot;); Date parse = simpleDateFormat.parse(&quot;08-06-2020 10:52:37&quot;); String json = &quot;&#123;\\&quot;name\\&quot;:\\&quot;wuxuan coming\\&quot;,\\&quot;eventDate\\&quot;:\\&quot;08-06-2020 10:52:37\\&quot;&#125;&quot;; Event event = new ObjectMapper().readerFor(Event.class) .readValue(json); System.out.println(parse.equals(event.eventDate)); //result: true &#125;&#125; 1.4.6. @JsonAlias@JsonAliasåœ¨ååºåˆ—åŒ–æœŸé—´ä¸ºå±æ€§å®šä¹‰ä¸€ä¸ªæˆ–å¤šä¸ªå¤‡ç”¨åç§°ã€‚ è®©æˆ‘ä»¬ç”¨ä¸€ä¸ªç®€å•çš„ä¾‹å­æ¥çœ‹çœ‹è¿™ä¸ªæ³¨è§£æ˜¯å¦‚ä½•å·¥ä½œçš„ï¼š 12345678910111213141516171819202122232425262728293031323334package com.yiyi.annotation.deseizlize;import com.fasterxml.jackson.annotation.JsonAlias;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 11:52 ä¸Šåˆ */@Getter@Setterpublic class AliasBean &#123; @JsonAlias(&#123;&quot;f_name&quot;,&quot;fName&quot;&#125;) private String firstName; private String secondName; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;f_name\\&quot;: \\&quot;chai\\&quot;,\\n&quot; + &quot; \\&quot;secondName\\&quot;: \\&quot;wuxuan\\&quot;\\n&quot; + &quot;&#125;&quot;; AliasBean aliasBean= new ObjectMapper().readerFor(AliasBean.class).readValue(json); System.out.println(aliasBean.getFirstName().equals(&quot;chai&quot;)); //result: true &#125;&#125; 1.5ã€Jacksonå¤šæ€ç±»å‹å¤„ç†æ³¨è§£æ¥ä¸‹æ¥â€“è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹Jacksonçš„å¤šæ€ç±»å‹å¤„ç†æ³¨è§£ï¼š @JsonTypeInfo - æŒ‡ç¤ºè¦åœ¨åºåˆ—åŒ–ä¸­åŒ…å«å“ªäº›ç±»å‹ä¿¡æ¯çš„è¯¦ç»†ä¿¡æ¯ @JsonSubTypes - æŒ‡ç¤ºå¸¦æ³¨è§£ç±»å‹çš„å­ç±»å‹ @JsonTypeName - å®šä¹‰ç”¨äºæ³¨è§£ç±»çš„é€»è¾‘ç±»å‹åç§°è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªæ›´å¤æ‚çš„ç¤ºä¾‹ï¼Œå¹¶ä½¿ç”¨å…¨éƒ¨ä¸‰ä¸ª@ JsonTypeInfoï¼Œ@ JsonSubTypeså’Œ@JsonTypeNameæ¥åºåˆ—åŒ–/ååºåˆ—åŒ–å®ä½“Zooï¼š 123456789101112131415161718192021222324252627282930package com.yiyi.annotation.polymorphic;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 12:54 ä¸‹åˆ */@Getter@Setterpublic class Zoo &#123; public Animal animal; @SneakyThrows public static void main(String[] args) &#123; Dog dog = new Dog(); dog.setName(&quot;wangwang&quot;); dog.setBackVolume(2.0); Zoo zoo = new Zoo(); zoo.setAnimal(dog); String json = new ObjectMapper().writeValueAsString(zoo); System.out.println(json); //result: &#123;&quot;animal&quot;:&#123;&quot;type&quot;:&quot;dog&quot;,&quot;name&quot;:&quot;wangwang&quot;,&quot;backVolume&quot;:2.0&#125;&#125; &#125;&#125; 12345678910111213141516171819package com.yiyi.annotation.polymorphic;import com.fasterxml.jackson.annotation.JsonSubTypes;import com.fasterxml.jackson.annotation.JsonTypeInfo;import lombok.Getter;import lombok.Setter;/** * @author wuxuan.chai * @date 2020/6/8 12:54 ä¸‹åˆ */@Getter@Setter@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = &quot;type&quot;)@JsonSubTypes(&#123;@JsonSubTypes.Type(value = Dog.class, name = &quot;dog&quot;), @JsonSubTypes.Type(value = Cat.class, name = &quot;cat&quot;)&#125;)public class Animal &#123; private String name;&#125; 1234567891011121314151617package com.yiyi.annotation.polymorphic;import com.fasterxml.jackson.annotation.JsonTypeName;import lombok.Getter;import lombok.Setter;/** * @author wuxuan.chai * @date 2020/6/8 12:54 ä¸‹åˆ */@Getter@Setter@JsonTypeName(&quot;dog&quot;)public class Dog extends Animal &#123; public double backVolume;&#125; 1234567891011121314151617package com.yiyi.annotation.polymorphic;import com.fasterxml.jackson.annotation.JsonTypeName;import lombok.Getter;import lombok.Setter;/** * @author wuxuan.chai * @date 2020/6/8 12:56 ä¸‹åˆ */@Getter@Setter@JsonTypeName(&quot;cat&quot;)public class Cat extends Animal&#123; private boolean likesCream; private int lives;&#125; ç°åœ¨æµ‹è¯•ååºåˆ—åŒ–ï¼š 12345678&#123; &quot;animal&quot;: &#123; &quot;type&quot;:&quot;dog&quot;, &quot;name&quot;:&quot;wangwang&quot;, &quot;backVolume&quot;:2.0 &#125;&#125; 1234567891011121314151617181920212223242526272829package com.yiyi.annotation.polymorphic;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 12:54 ä¸‹åˆ */@Getter@Setter@ToStringpublic class Zoo &#123; public Animal animal; @SneakyThrows public static void main(String[] args) &#123; String dJson = &quot;&#123;\\&quot;animal\\&quot;:&#123;\\&quot;type\\&quot;:\\&quot;dog\\&quot;,\\&quot;name\\&quot;:\\&quot;wangwang\\&quot;,\\&quot;backVolume\\&quot;:2.0&#125;&#125;&quot;; Zoo zoo1 = new ObjectMapper().readerFor(Zoo.class).readValue(dJson); System.out.println(zoo1); //result: Zoo(animal=Dog(backVolume=2.0)) &#125;&#125; 1.6ã€Jacksonä¸€èˆ¬çš„æ³¨è§£æ¥ä¸‹æ¥ï¼Œä¸€èµ·è®¨è®ºä¸€äº›jacksonçš„ä¸€èˆ¬æ³¨è§£ 1.6.1ã€@JsonPropertyæˆ‘ä»¬å¯ä»¥æ·»åŠ @JsonPropertyæ³¨è§£å»è¡¨ç¤ºåœ¨jsonä¸­çš„å±æ€§åç§°ï¼Œåœ¨å¤„ç†éæ ‡å‡†çš„getterå’Œsetteræ—¶ï¼Œè®©æˆ‘ä»¬ä½¿ç”¨@JsonPropertyå¯¹å±æ€§åç§°è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonProperty;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Getter;import lombok.Setter;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 1:47 ä¸‹åˆ */public class MyBean &#123; @Getter @Setter private Integer id; private String theName; @JsonProperty(&quot;name&quot;) public void setTheName(String name) &#123; this.theName = name; &#125; @JsonProperty(&quot;name&quot;) public String getTheName() &#123; return theName; &#125; @SneakyThrows public static void main(String[] args) &#123; MyBean myBean = new MyBean(); myBean.setId(1); myBean.setTheName(&quot;wuxuan&quot;); String json = new ObjectMapper().writeValueAsString(myBean); System.out.println(json); MyBean myBean1 = new ObjectMapper().readerFor(MyBean.class).readValue(json); System.out.println(myBean1.theName.equals(myBean.theName)); //reasult: //&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125; //true &#125;&#125; 1.6.2ã€@JsonFormat@JsonFormatæ‰¹æ³¨æŒ‡å®šåºåˆ—åŒ–æ—¥æœŸ/æ—¶é—´å€¼æ—¶çš„æ ¼å¼ã€‚åœ¨ä¸‹é¢çš„ç¤ºä¾‹ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨@JsonFormatæ¥æ§åˆ¶å±æ€§eventDateçš„æ ¼å¼ï¼š 1234567891011121314151617181920212223242526272829303132333435package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonFormat;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.*;import java.text.SimpleDateFormat;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 1:53 ä¸‹åˆ */@Getter@Setter@AllArgsConstructor@NoArgsConstructorpublic class Event &#123; private String name; @JsonFormat(shape = JsonFormat.Shape.STRING,pattern = &quot;dd-MM-yyyy hh:mm:ss&quot;) private Date eventDate; @SneakyThrows public static void main(String[] args) &#123; Date date = new Date(); SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;dd-MM-yyyy hh:mm:ss&quot;); String format = simpleDateFormat.format(date); Event event = new Event(&quot;wuxuan comming&quot;, date); String json = new ObjectMapper().writeValueAsString(event); assert json.contains(format); &#125;&#125; 1.6.3ã€@JsonUnWrapped@JsonUnwrappedå®šä¹‰åº”å±•å¼€/å±•å¹³çš„å€¼åºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼› æˆ‘ä»¬å°†ä½¿ç”¨æ³¨è§£è§£å¼€å±æ€§åç§°ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonUnwrapped;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 2:01 ä¸‹åˆ */@Datapublic class UnwappedUser &#123; private int id; @JsonUnwrapped(prefix = &quot;n_&quot;,suffix = &quot;_o&quot;,enabled = true) private Name name; @Data public static class Name&#123; private String firstName; private String lastName; &#125; @SneakyThrows public static void main(String[] args) &#123; Name name = new Name(); name.setFirstName(&quot;chai&quot;); name.setLastName(&quot;wuxuan&quot;); UnwappedUser unwappedUser = new UnwappedUser(); unwappedUser.setName(name); String json = new ObjectMapper().writeValueAsString(unwappedUser); System.out.println(json); //result: &#123;&quot;id&quot;:0,&quot;n_firstName_o&quot;:&quot;chai&quot;,&quot;n_lastName_o&quot;:&quot;wuxuan&quot;&#125; &#125;&#125; 1.6.4ã€@JsonView@JsonViewæŒ‡ç¤ºå°†åœ¨å…¶ä¸­åŒ…å«å±æ€§ä»¥è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–çš„Viewã€‚ä¸€ä¸ªç¤ºä¾‹å°†ç¡®åˆ‡æ˜¾ç¤ºå…¶å·¥ä½œåŸç†-æˆ‘ä»¬å°†ä½¿ç”¨@JsonViewåºåˆ—åŒ–Itemå®ä½“çš„å®ä¾‹ã€‚ è®©æˆ‘ä»¬ä»è§†å›¾å¼€å§‹ï¼š 123456789101112131415161718192021222324252627282930package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonView;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.AllArgsConstructor;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 2:08 ä¸‹åˆ */@Data@AllArgsConstructorpublic class Item &#123; @JsonView(Views.Public.class) private Integer id; @JsonView(Views.Public.class) private String itemName; @JsonView(Views.internal.class) private String ownerName; @SneakyThrows public static void main(String[] args) &#123; Item item = new Item(1, &quot;wuxuan&quot;, &quot;wuxuan111&quot;); String json = new ObjectMapper().writerWithView(Views.Public.class).writeValueAsString(item); System.out.println(json); &#125;&#125; 1.6.5. @JsonManagedReference, @JsonBackReference@JsonManagedReferenceå’Œ@JsonBackReferenceæ³¨è§£å¯ä»¥å¤„ç†çˆ¶/å­å…³ç³»å¹¶è§£å†³å¾ªç¯ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­â€“æˆ‘ä»¬ä½¿ç”¨@JsonManagedReferenceå’Œ@JsonBackReferenceåºåˆ—åŒ–æˆ‘ä»¬çš„ItemWithRefentityï¼š 123456789101112131415161718192021222324252627282930313233343536373839package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonManagedReference;import com.fasterxml.jackson.databind.ObjectMapper;import com.google.common.collect.Lists;import lombok.AllArgsConstructor;import lombok.Data;import lombok.SneakyThrows;import java.util.List;/** * @author wuxuan.chai * @date 2020/6/8 2:18 ä¸‹åˆ */@Data@AllArgsConstructorpublic class ItemWithRef &#123; private int id; private String itemName; @JsonManagedReference public UserWithRef owner; @SneakyThrows public static void main(String[] args) &#123; UserWithRef userWithRef = new UserWithRef(1,&quot;wuxuan&quot;,null); ItemWithRef itemWithRef = new ItemWithRef(1, &quot;wwww&quot;, null); List&lt;ItemWithRef&gt; itemWithRefs = Lists.newArrayList(); itemWithRefs.add(itemWithRef); userWithRef.setUserItems(itemWithRefs); String json = new ObjectMapper().writeValueAsString(userWithRef); System.out.println(json); //result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125; &#125;&#125; 123456789101112131415161718192021222324252627282930313233package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonBackReference;import com.google.common.collect.Lists;import lombok.AllArgsConstructor;import lombok.Data;import java.util.List;/** * @author wuxuan.chai * @date 2020/6/8 2:19 ä¸‹åˆ */@Data@AllArgsConstructorpublic class UserWithRef &#123; public int id; private String name; @JsonBackReference public List&lt;ItemWithRef&gt; userItems; public List&lt;ItemWithRef&gt; addItem(ItemWithRef itemWithRef) &#123; if (userItems == null)&#123; userItems = Lists.newArrayList(); userItems.add(itemWithRef); return userItems; &#125; userItems.add(itemWithRef); return userItems; &#125;&#125; å¤„ç†å¾ªç¯è°ƒç”¨çš„åœºæ™¯ 1.6.6. @JsonIdentityInfo@JsonIdentityInfoæŒ‡ç¤ºåœ¨å¯¹å€¼è¿›è¡Œåºåˆ—åŒ–/ååºåˆ—åŒ–æ—¶åº”ä½¿ç”¨å¯¹è±¡æ ‡è¯†ï¼Œä¾‹å¦‚ï¼Œä»¥å¤„ç†æ— é™é€’å½’ç±»å‹çš„é—®é¢˜ã€‚åœ¨ä»¥ä¸‹ç¤ºä¾‹ä¸­â€“æˆ‘ä»¬æœ‰ä¸€ä¸ªItemWithIdentityå®ä½“ï¼Œå®ƒä¸UserWithIdentityå®ä½“å…·æœ‰åŒå‘å…³ç³»ï¼š 1234567891011121314151617181920212223242526272829303132333435363738package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonIdentityInfo;import com.fasterxml.jackson.annotation.ObjectIdGenerators;import com.google.common.collect.Lists;import lombok.Data;import java.util.List;/** * @author wuxuan.chai * @date 2020/6/8 2:30 ä¸‹åˆ */@Data@JsonIdentityInfo( generator= ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)public class UserWithIdentity &#123; private Integer id; private String name; private List&lt;ItemWithIdentity&gt; userItems; public UserWithIdentity(Integer id, String name) &#123; this.id = id; this.name = name; &#125; public void addItem(ItemWithIdentity item) &#123; if (userItems == null)&#123; userItems = Lists.newArrayList(); userItems.add(item); return; &#125; userItems.add(item); &#125;&#125; 1234567891011121314151617181920212223242526272829303132333435363738394041package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonIdentityInfo;import com.fasterxml.jackson.annotation.ObjectIdGenerators;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 2:29 ä¸‹åˆ */@JsonIdentityInfo( generator = ObjectIdGenerators.PropertyGenerator.class, property = &quot;id&quot;)@Datapublic class ItemWithIdentity &#123; private Integer id; private String itemName; private UserWithIdentity owner; public ItemWithIdentity(Integer id, String itemName, UserWithIdentity owner) &#123; this.id = id; this.itemName = itemName; this.owner = owner; &#125; @SneakyThrows public static void main(String[] args) &#123; UserWithIdentity user = new UserWithIdentity(1, &quot;John&quot;); ItemWithIdentity item = new ItemWithIdentity(2, &quot;book&quot;, user); user.addItem(item); String json = new ObjectMapper().writeValueAsString(item); System.out.println(json); //result: &#123;&quot;id&quot;:2,&quot;itemName&quot;:&quot;book&quot;,&quot;owner&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;John&quot;,&quot;userItems&quot;:[2]&#125;&#125; &#125;&#125; 1.6.7. @JsonFilter@JsonFilteræ‰¹æ³¨æŒ‡å®šåœ¨åºåˆ—åŒ–æœŸé—´ä½¿ç”¨çš„è¿‡æ»¤å™¨ã€‚è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ï¼› é¦–å…ˆï¼Œæˆ‘ä»¬å®šä¹‰å®ä½“ï¼Œç„¶åæŒ‡å‘è¿‡æ»¤å™¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package com.yiyi.annotation.generate;import com.fasterxml.jackson.annotation.JsonFilter;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;import com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 2:47 ä¸‹åˆ */@JsonFilter(&quot;myFilter&quot;)@Datapublic class BeanWithFilter &#123; private Integer id; private String name; public BeanWithFilter(Integer id, String name) &#123; this.id = id; this.name = name; &#125; @SneakyThrows public static void main(String[] args) &#123; BeanWithFilter beanWithFilter = new BeanWithFilter(1, &quot;Wuxuuan&quot;); String json = new ObjectMapper() .writer(new SimpleFilterProvider() .addFilter(&quot;myFilter&quot;, SimpleBeanPropertyFilter.filterOutAllExcept(&quot;name&quot;))) .writeValueAsString(beanWithFilter); System.out.println(json); //result: &#123;&quot;name&quot;:&quot;Wuxuuan&quot;&#125; &#125;&#125; 1.7ã€è‡ªå®šä¹‰Jacksonæ³¨è§£æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ä¸€èµ·å­¦ä¹ å¦‚ä½•åˆ›å»ºä¸€ä¸ªJacksonè‡ªå®šä¹‰æ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JacksonAnnotationsInsideæ³¨è§£ï¼š 123456789101112131415161718192021222324package com.yiyi.annotation.customAnnotation;import com.fasterxml.jackson.annotation.JacksonAnnotationsInside;import com.fasterxml.jackson.annotation.JsonInclude;import com.fasterxml.jackson.annotation.JsonPropertyOrder;import java.lang.annotation.Retention;import java.lang.annotation.RetentionPolicy;/** * @author wuxuan.chai * @date 2020/6/8 2:54 ä¸‹åˆ * * è¿è¡Œæ—¶æ³¨è§£ * jsonåŒ…å«éç©º * jsonæ’åº */@Retention(RetentionPolicy.RUNTIME)@JacksonAnnotationsInside@JsonInclude(JsonInclude.Include.NON_NULL)@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;,&quot;datteCreated&quot;&#125;)public @interface CustomAnnotation &#123;&#125; 1234567891011121314151617181920212223242526272829303132333435package com.yiyi.annotation.customAnnotation;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 2:56 ä¸‹åˆ */@CustomAnnotation@Datapublic class BeanWithCustomAnnotation &#123; private Integer id; private String name; private Date dateCreated; public BeanWithCustomAnnotation(Integer id, String name, Date dateCreated) &#123; this.id = id; this.name = name; this.dateCreated = dateCreated; &#125; @SneakyThrows public static void main(String[] args) &#123; BeanWithCustomAnnotation bean = new BeanWithCustomAnnotation(1, &quot;wuxuan&quot;, new Date()); String json = new ObjectMapper().writeValueAsString(bean); System.out.println(json); //resultï¼š&#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1,&quot;dateCreated&quot;:1591599545147&#125; &#125;&#125; 1.8ã€Jackson æ··å…¥æ³¨è§£æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•ä½¿ç”¨Jacksonçš„æ··å…¥æ³¨è§£ï¼Œè®©æˆ‘ä»¬ç”¨æ··å…¥æ³¨è§£ä¸¾ä¸ªä¾‹å­ - å¿½ç•¥Userç±»ä¸­çš„å±æ€§ï¼š 12345678910111213package com.yiyi.annotation.mixln;import lombok.Data;/** * @author wuxuan.chai * @date 2020/6/8 3:05 ä¸‹åˆ */@Datapublic class User &#123; private String sex;&#125; 123456789101112package com.yiyi.annotation.mixln;import com.fasterxml.jackson.annotation.JsonIgnoreType;/** * @author wuxuan.chai * @date 2020/6/8 3:06 ä¸‹åˆ */@JsonIgnoreTypepublic class MyMixinForIgnoreType &#123;&#125; 12345678910111213141516171819202122232425262728293031323334353637package com.yiyi.annotation.mixln;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 3:04 ä¸‹åˆ */@Datapublic class Item &#123; private Integer id; private String itemName; private User owner; public Item(Integer id, String itemName, User owner) &#123; this.id = id; this.itemName = itemName; this.owner = owner; &#125; @SneakyThrows public static void main(String[] args) &#123; Item item = new Item(1, &quot;ccc&quot;, null); String json = new ObjectMapper().writeValueAsString(item); //æ£€æŸ¥æ˜¯å¦åºåˆ—åŒ–äº†Userç±»å‹ assert json.contains(&quot;owner&quot;); ObjectMapper objectMapper = new ObjectMapper().addMixIn(User.class, MyMixinForIgnoreType.class); String json1 = objectMapper.writeValueAsString(item); //æ£€æŸ¥æ˜¯å¦å¿½ç•¥äº†Userç±»å‹ assert !json1.contains(&quot;owner&quot;); &#125;&#125; 1.9ã€ç¦ç”¨ Jackson æ³¨è§£æœ€åï¼Œæˆ‘ä»¬ä¸€èµ·çœ‹çœ‹å¦‚ä½•ç¦ç”¨æ‰€æœ‰çš„jacksonæ³¨è§£ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¦ç”¨MapperFeature.USE_ANNOTATIONSæ¥å®ç°æ­¤ç›®çš„ï¼Œå¦‚ä»¥ä¸‹ç¤ºä¾‹æ‰€ç¤ºï¼š 12345678910111213141516171819202122232425262728293031323334353637package com.yiyi.annotation.disabledJson;import com.fasterxml.jackson.annotation.JsonInclude;import com.fasterxml.jackson.annotation.JsonPropertyOrder;import com.fasterxml.jackson.databind.MapperFeature;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 3:13 ä¸‹åˆ */@Data@JsonInclude(JsonInclude.Include.NON_NULL)@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)public class MyBean &#123; private String id; private String name; public MyBean(String id, String name) &#123; this.id = id; this.name = name; &#125; @SneakyThrows public static void main(String[] args) &#123; MyBean wuxuan = new MyBean(&quot;1&quot;, &quot;wuxuan&quot;); String json = new ObjectMapper().disable(MapperFeature.USE_ANNOTATIONS).writeValueAsString(wuxuan); System.out.println(json); //æœŸæœ›ï¼Œéç©ºæ ¡éªŒå’Œæ’åºæ³¨è§£éƒ½å¤±æ•ˆ //resultï¼š&#123;&quot;id&quot;:&quot;1&quot;,&quot;name&quot;:&quot;wuxuan&quot;&#125; &#125;&#125; äºŒã€Jackson ObjectMapper çš„ç®€ä»‹2.1ã€ç®€ä»‹æœ¬ç« ç€é‡äºç†è§£Jackson ObjectMapperç±»ï¼Œä»¥åŠå¦‚ä½•å°†Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONä»¥åŠå¦‚ä½•å°†JSONå­—ç¬¦ä¸²ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚ 2.2ã€ä½¿ç”¨ObjectMapperè¯»å’Œå†™è®©æˆ‘ä»¬ä»åŸºæœ¬çš„è¯»å†™æ“ä½œå¼€å§‹ã€‚ObjectMapperçš„ç®€å•readValue APIæ˜¯ä¸€ä¸ªå¾ˆå¥½çš„å…¥å£ç‚¹ã€‚ æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®ƒæ¥å°†JSONå†…å®¹è§£ææˆ–ååºåˆ—åŒ–ä¸ºJavaå¯¹è±¡ã€‚åŒæ ·ï¼Œåœ¨ç¼–å†™æ–¹é¢ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨writeValue APIå°†ä»»ä½•Javaå¯¹è±¡åºåˆ—åŒ–ä¸ºJSONè¾“å‡ºã€‚åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å¸¦æœ‰ä¸¤ä¸ªå­—æ®µçš„Carç±»ä½œä¸ºå¯¹è±¡è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–ï¼š 1234567891011121314package com.yiyi.objectMapper.using;import lombok.Data;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Datapublic class Car &#123; private String color; private String type;&#125; 2.2.1ã€Javaå¯¹è±¡åºåˆ—åŒ–æˆjsonè®©æˆ‘ä»¬ä¸€èµ·å­¦ä¹ ç¬¬ä¸€ä¸ªåºåˆ—åŒ–ä¾‹å­ï¼Œç”¨ObjectMapperç±»çš„writeValueå°†javaè½¬æ¢æˆjson 1234567891011121314151617181920212223242526272829package com.yiyi.objectMapper.using;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import java.io.File;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Datapublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; @SneakyThrows public static void main(String[] args) &#123; Car car = new Car(&quot;red&quot;, &quot;BMW&quot;); new ObjectMapper().writeValue(new File(&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;),car); &#125;&#125; è¿è¡Œç»“æœï¼š 1234ç”Ÿæˆä¸€ä¸ªCar.jsonæ–‡ä»¶å†…å®¹ï¼š&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125; ObjectMapperç±»çš„writeValueAsStringå’ŒwriteValueAsBytesæ–¹æ³•ä»Javaå¯¹è±¡ç”ŸæˆJSONï¼Œå¹¶ä»¥å­—ç¬¦ä¸²æˆ–å­—èŠ‚æ•°ç»„å½¢å¼è¿”å›ç”Ÿæˆçš„JSONï¼š 12345678910111213141516171819202122232425262728293031323334package com.yiyi.objectMapper.using;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import java.io.File;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Datapublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; @SneakyThrows public static void main(String[] args) &#123; Car car = new Car(&quot;red&quot;, &quot;BMW&quot;); String json = new ObjectMapper().writeValueAsString(car); System.out.println(json); byte[] bytes = new ObjectMapper().writeValueAsBytes(car); String bytesStr = new String(bytes); System.out.println(json.equals(bytesStr)); &#125;&#125; è¿è¡Œç»“æœï¼š 12&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125;true 2.2.2ã€Jsonè½¬æ¢æˆJavaå¯¹è±¡ä»¥ä¸‹æ˜¯ä½¿ç”¨ObjectMapperç±»å°†JSONå­—ç¬¦ä¸²è½¬æ¢ä¸ºJavaå¯¹è±¡çš„ç®€å•ç¤ºä¾‹ï¼š 1&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125; readValueï¼ˆï¼‰å‡½æ•°è¿˜æ¥å—å…¶ä»–å½¢å¼çš„è¾“å…¥ï¼Œä¾‹å¦‚åŒ…å«JSONå­—ç¬¦ä¸²çš„æ–‡ä»¶ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.objectMapper.using;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import java.io.File;import java.net.URL;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Data@EqualsAndHashCodepublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; public Car()&#123; &#125; @SneakyThrows public static void main(String[] args) &#123; Car car = new Car(&quot;red&quot;, &quot;BMW&quot;); String json = &quot;&#123;\\&quot;color\\&quot;:\\&quot;red\\&quot;,\\&quot;type\\&quot;:\\&quot;BMW\\&quot;&#125;&quot;; Car car1 = new ObjectMapper().readValue(json, Car.class); System.out.println(car1.equals(car)); Car car2 = new ObjectMapper().readValue(new File(&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;), Car.class); System.out.println(car2.equals(car)); //resultï¼š // true // true &#125;&#125; 2.2.3ã€Jsonè½¬æ¢æˆJacksonçš„JsonèŠ‚ç‚¹å¦å¤–ï¼Œå¯ä»¥å°†JSONè§£æä¸ºJsonNodeå¯¹è±¡ï¼Œå¹¶ç”¨äºä»ç‰¹å®šèŠ‚ç‚¹æ£€ç´¢æ•°æ®ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142package com.yiyi.objectMapper.using;import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import java.io.File;import java.net.URL;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Data@EqualsAndHashCodepublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; public Car()&#123; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\&quot;color\\&quot;:\\&quot;red\\&quot;,\\&quot;type\\&quot;:\\&quot;BMW\\&quot;&#125;&quot;; JsonNode jsonNode = new ObjectMapper().readTree(json); String type = jsonNode.get(&quot;type&quot;).asText(); System.out.println(type.equals(&quot;BMW&quot;)); //result: true &#125;&#125; 2.2.4ã€ä»Jsonæ•°ç»„å­—ç¬¦ä¸²ä¸­åˆ›å»ºJavaé›†åˆæˆ‘ä»¬å¯ä»¥ä½¿ç”¨TypeReferenceå°†æ•°ç»„å½¢å¼çš„JSONè§£æä¸ºJavaå¯¹è±¡åˆ—è¡¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152package com.yiyi.objectMapper.using;import com.fasterxml.jackson.core.type.TypeReference;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;import java.util.List;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Data@EqualsAndHashCode@ToStringpublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; public Car()&#123; &#125; @SneakyThrows public static void main(String[] args) &#123; String jsonArray = &quot;[\\n&quot; + &quot; &#123;\\n&quot; + &quot; \\&quot;color\\&quot;: \\&quot;Red\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;BMW\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; &#123;\\n&quot; + &quot; \\&quot;color\\&quot;: \\&quot;Black\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;audi\\&quot;\\n&quot; + &quot; &#125;\\n&quot; + &quot;]&quot;; List&lt;Car&gt; cars = new ObjectMapper().readValue(jsonArray, new TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;); System.out.println(cars); //result: [Car(color=Red, type=BMW), Car(color=Black, type=audi)] &#125;&#125; 2.2.5ã€ä»jsonä¸­åˆ›å»ºJava MapåŒæ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†JSONè§£æä¸ºJava Mapï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.objectMapper.using;import com.fasterxml.jackson.core.type.TypeReference;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;import java.util.List;import java.util.Map;/** * @author wuxuan.chai * @date 2020/6/8 3:23 ä¸‹åˆ */@Data@EqualsAndHashCode@ToStringpublic class Car &#123; private String color; private String type; public Car(String color, String type) &#123; this.color = color; this.type = type; &#125; public Car()&#123; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;color\\&quot;: \\&quot;Red\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;BMW\\&quot;\\n&quot; + &quot;&#125;&quot;; Map&lt;String, String&gt; javaMap = new ObjectMapper().readValue(json, new TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;&#125;); System.out.println(javaMap); //result: &#123;color=Red, type=BMW&#125; &#125;&#125; ä¸‰ã€é«˜çº§åŠŸèƒ½Jacksonåº“çš„æœ€å¤§ä¼˜åŠ¿ä¹‹ä¸€æ˜¯é«˜åº¦å¯å®šåˆ¶çš„åºåˆ—åŒ–å’Œååºåˆ—åŒ–è¿‡ç¨‹ã€‚åœ¨æœ¬éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬å°†ä»‹ç»ä¸€äº›é«˜çº§åŠŸèƒ½ï¼Œå…¶ä¸­è¾“å…¥æˆ–è¾“å‡ºJSONå“åº”å¯èƒ½ä¸åŒäºç”Ÿæˆæˆ–ä½¿ç”¨å“åº”çš„å¯¹è±¡ã€‚ 3.1ã€ é…ç½® Serialization / Deserialization åŠŸèƒ½åœ¨å°†JSONå¯¹è±¡è½¬æ¢ä¸ºJavaç±»æ—¶ï¼Œå¦‚æœJSONå­—ç¬¦ä¸²å…·æœ‰ä¸€äº›æ–°å­—æ®µï¼Œåˆ™é»˜è®¤è¿‡ç¨‹å°†å¯¼è‡´å¼‚å¸¸ï¼š 12345&#123; &quot;color&quot;: &quot;Red&quot;, &quot;type&quot;: &quot;BMW&quot;, &quot;year&quot;: &quot;2020&quot;&#125; ä¸Šé¢ç¤ºä¾‹ä¸­çš„é»˜è®¤è§£æè¿‡ç¨‹ä¸­ï¼Œé’ˆå¯¹Carç±»çš„Javaå¯¹è±¡çš„JSONå­—ç¬¦ä¸²å°†å¯¼è‡´UnrecognizedPropertyExceptionå¼‚å¸¸ã€‚é€šè¿‡configureæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ‰©å±•é»˜è®¤è¿‡ç¨‹ä»¥å¿½ç•¥æ–°å­—æ®µï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041package com.yiyi.advanced;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 3:59 ä¸‹åˆ */@Data@ToString@EqualsAndHashCodepublic class Car &#123; private String type; private String color; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;color\\&quot;: \\&quot;Red\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;BMW\\&quot;,\\n&quot; + &quot; \\&quot;year\\&quot;: \\&quot;2020\\&quot;\\n&quot; + &quot; &#125;&quot;; // ä¹Ÿå¯ä»¥è¿™ä¹ˆå†™ï¼š new ObjectMapper().configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false); ObjectMapper objectMapper = new ObjectMapper().disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); Car car = objectMapper.readValue(json, Car.class); System.out.println(car); JsonNode jsonNode = objectMapper.readTree(json); String year = jsonNode.get(&quot;year&quot;).asText(); System.out.println(year); &#125;&#125; å¯¹äºDeserializationFeatureæšä¸¾ä¸­ä¸­çš„è®¾ç½®çš„æè¿°ï¼š é…ç½® é»˜è®¤å€¼ ä½œç”¨æè¿° USE_BIG_DECIMAL_FOR_FLOATS false å¦‚æœåªæœ‰é€šç”¨ç±»å‹æè¿°ï¼ˆObjectæˆ–Numberæˆ–æœªç±»å‹åŒ–çš„java.util.Mapæˆ–java.util.Collectionä¸Šä¸‹æ–‡ä¸­ï¼‰å¯ç”¨ï¼Œæ­¤åŠŸèƒ½ç¡®å®šæ˜¯å¦å°†JSONæµ®ç‚¹æ•°ååºåˆ—åŒ–ä¸ºjava.math.BigDecimalsã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™å°†è¿™äº›å€¼ååºåˆ—åŒ–ä¸ºjava.math.BigDecimals;ã€‚ å¦‚æœç¦ç”¨ï¼Œå°†ååºåˆ—åŒ–ä¸ºDoublesã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤åŠŸèƒ½ä¸ºç¦ç”¨çŠ¶æ€ï¼Œè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œâ€œæœªç±»å‹åŒ–â€çš„æµ®ç‚¹æ•°å°†ååºåˆ—åŒ–ä¸ºDoublesï¼ˆå‡ºäºæ€§èƒ½è€ƒè™‘ï¼Œé€‰æ‹©-BigDecimalsæ…¢äºDoublesï¼‰ã€‚ USE_BIG_INTEGER_FOR_INTS false ç¡®å®šæ˜¯å¦å°†JSONæ•´æ•°ï¼ˆéæµ®ç‚¹æ•°ï¼‰æ•°å­—ååºåˆ—åŒ–ä¸ºjava.math.BigIntegersçš„åŠŸèƒ½ï¼ˆå¦‚æœåªæœ‰é€šç”¨ç±»å‹æè¿°ï¼ˆObjectæˆ–Numberæˆ–åœ¨æ— ç±»å‹çš„java.util.Mapæˆ–java.util.Collectionä¸Šä¸‹æ–‡ä¸­ï¼‰ ï¼‰å¯ç”¨ã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™å°†è¿™äº›å€¼ååºåˆ—åŒ–ä¸ºjava.math.BigIntegers;ã€‚ å¦‚æœç¦ç”¨ï¼Œåˆ™å°†ååºåˆ—åŒ–ä¸ºâ€œæœ€å°â€å¯ç”¨ç±»å‹ï¼Œæ ¹æ®ç±»å‹çš„æ•°ç›®ï¼Œå¯ä»¥æ˜¯Integerï¼ŒLongæˆ–java.math.BigIntegerã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ­¤åŠŸèƒ½æ˜¯ç¦ç”¨çš„ï¼Œè¿™æ„å‘³ç€é»˜è®¤æƒ…å†µä¸‹ï¼Œå°†ä½¿ç”¨æœ€ç´§å‡‘çš„æ•´æ•°ç±»å‹å¯¹â€œæœªç±»å‹åŒ–â€çš„æ•´æ•°è¿›è¡Œååºåˆ—åŒ–ï¼Œä»¥ä¼˜åŒ–æ•ˆç‡ã€‚ USE_LONG_FOR_INTS false å½“ç›®æ ‡ç±»å‹è¢«æ¾æ•£åœ°é”®å…¥ä¸ºObjectæˆ–Numberï¼ˆæˆ–åœ¨å…¶ä¸­ï¼‰æ—¶ï¼Œç”¨äºç¡®å®šå¦‚ä½•ç»‘å®šâ€œå°â€ JSONæ•´æ•°ï¼ˆéæµ®ç‚¹æ•°ï¼‰ï¼ˆé€‚åˆ32ä½æœ‰ç¬¦å·æ•´æ•°ï¼ˆintï¼‰ï¼‰çš„åŠŸèƒ½ æœªç±»å‹åŒ–çš„java.util.Mapæˆ–java.util.Collectionä¸Šä¸‹æ–‡ï¼‰ã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™è¿™äº›å€¼å°†ååºåˆ—åŒ–ä¸ºLongï¼› å¦‚æœç¦ç”¨ï¼Œå®ƒä»¬å°†ååºåˆ—åŒ–ä¸ºâ€œæœ€å°â€å¯ç”¨ç±»å‹ï¼Œæ•´æ•°ã€‚ æ­¤å¤–ï¼Œå¦‚æœå¯ç”¨äº†è¯¥é€‰é¡¹ï¼Œåˆ™å°è¯•ç»‘å®šä¸é€‚åˆLongçš„å€¼å°†å¼•å‘com.fasterxml.jackson.core.JsonProcessingExceptionã€‚æ³¨æ„ï¼šå¦‚æœå¯ç”¨USE_BIG_INTEGER_FOR_INTSï¼Œå®ƒå°†ä¼˜å…ˆäºæ­¤è®¾ç½®ï¼Œå¹¶å¼ºåˆ¶å¯¹æ‰€æœ‰æ•´æ•°å€¼ä½¿ç”¨java.math.BigIntegerã€‚è¯¥åŠŸèƒ½é»˜è®¤æƒ…å†µä¸‹å¤„äºç¦ç”¨çŠ¶æ€ï¼Œè¿™æ„å‘³ç€å¦‚æœå€¼åˆé€‚ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†ä½¿ç”¨Integerååºåˆ—åŒ–â€œæ— ç±»å‹â€æ•´æ•°ã€‚ USE_JAVA_ARRAY_FOR_JSON_ARRAY false ç»‘å®šâ€œæ— ç±»å‹â€å¯¹è±¡ï¼ˆæ ‡ç§°ç±»å‹ä¸ºjava.lang.Objectçš„å¯¹è±¡ï¼‰æ—¶ç¡®å®šJSONæ•°ç»„æ˜¯æ˜ å°„åˆ°Object[]è¿˜æ˜¯Listçš„åŠŸèƒ½ã€‚ å¦‚æœä¸ºtrueï¼Œåˆ™ç»‘å®šä¸ºObject[]; å¦‚æœä¸ºfalseï¼Œåˆ™ä¸ºListã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠŸèƒ½æ˜¯ç¦ç”¨çš„ï¼Œè¿™æ„å‘³ç€JSONæ•°ç»„ç»‘å®šä¸ºjava.util.Listsã€‚ FAIL_ON_UNKNOWN_PROPERTIES true ç¡®å®šé‡åˆ°æœªçŸ¥å±æ€§ï¼ˆä¸æ˜ å°„åˆ°å±æ€§ï¼Œå¹¶ä¸”æ²¡æœ‰â€œä»»ä½•setterâ€æˆ–å¤„ç†ç¨‹åºçš„å¤„ç†ç¨‹åºï¼‰çš„åŠŸèƒ½æ˜¯å¦ä¼šå¯¼è‡´å¤±è´¥ï¼ˆé€šè¿‡æŠ›å‡ºJsonMappingExceptionï¼‰ã€‚ ä»…åœ¨å°è¯•äº†å…¶ä»–æ‰€æœ‰ç”¨äºæœªçŸ¥å±æ€§çš„å¤„ç†æ–¹æ³•å¹¶ä¸”è¯¥å±æ€§ä¿æŒæœªå¤„ç†çŠ¶æ€åï¼Œæ­¤è®¾ç½®æ‰ç”Ÿæ•ˆã€‚ é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ï¼ˆè¿™æ„å‘³ç€å¦‚æœé‡åˆ°æœªçŸ¥å±æ€§ï¼Œå°†æŠ›å‡ºJsonMappingExceptionï¼‰ã€‚ FAIL_ON_NULL_FOR_PRIMITIVES false ååºåˆ—åŒ–ä¸ºJavaåŸºæœ¬ç±»å‹ï¼ˆå¦‚â€œ intâ€æˆ–â€œ doubleâ€ï¼‰æ—¶ï¼Œç¡®å®šæ˜¯å¦é‡åˆ°JSON nullçš„é”™è¯¯çš„åŠŸèƒ½ã€‚ å¦‚æœæ˜¯ï¼Œåˆ™æŠ›å‡ºJsonProcessingExceptionæ¥è¡¨æ˜è¿™ä¸€ç‚¹ã€‚ å¦‚æœä¸æ˜¯ï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼ˆ0è¡¨ç¤ºâ€œ intâ€ï¼Œ0.0è¡¨ç¤ºdoubleï¼Œä¸JVMä½¿ç”¨çš„é»˜è®¤å€¼ç›¸åŒï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ FAIL_ON_NUMBERS_FOR_ENUMS false ç¡®å®šJSONæ•´æ•°æ˜¯å¦æ˜¯ç”¨äºååºåˆ—åŒ–Javaæšä¸¾å€¼çš„æœ‰æ•ˆå€¼çš„åŠŸèƒ½ã€‚ å¦‚æœè®¾ç½®ä¸ºâ€œ falseâ€ï¼Œåˆ™æ•°å­—æ˜¯å¯æ¥å—çš„ï¼Œå¹¶ç”¨äºæ˜ å°„åˆ°åŒ¹é…æšä¸¾å€¼çš„ordinalï¼ˆï¼‰ï¼› å¦‚æœä¸ºâ€œ trueâ€ï¼Œåˆ™ä¸å…è®¸æ•°å­—ï¼Œå¹¶ä¸”å°†å¼•å‘JsonMappingExceptionã€‚ å¦‚æœæ‹…å¿ƒå¯èƒ½ä¼šå‘ç”Ÿä»æ•´æ•°å€¼åˆ°æšä¸¾çš„æ„å¤–æ˜ å°„ï¼ˆå¹¶ä¸”æšä¸¾å§‹ç»ˆåºåˆ—åŒ–ä¸ºJSONå­—ç¬¦ä¸²çš„æƒ…å†µï¼‰ï¼Œé‚£ä¹ˆåè€…çš„è¡Œä¸ºå°±å¾ˆæœ‰æ„ä¹‰ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ FAIL_ON_INVALID_SUBTYPE true ç¡®å®šæ— æ³•æ‰¾åˆ°ï¼ˆä¸¢å¤±ï¼‰æˆ–è§£å†³ï¼ˆä¸¢å¤±ï¼‰ç±»åç§°ï¼ˆä¾‹å¦‚ï¼Œæ— æ•ˆçš„ç±»åï¼Œä¸å¯æ˜ å°„çš„idï¼‰çš„å¤šæ€å€¼çš„ç±»å‹ï¼ˆä¾‹å¦‚ï¼Œç”±com.fasterxml.jackson.annotation.JsonTypeInfoæŒ‡ç¤ºï¼‰æ—¶å‘ç”Ÿçš„æƒ…å†µçš„åŠŸèƒ½ï¼› å¦‚æœå¯ç”¨ï¼Œåˆ™å¼•å‘å¼‚å¸¸ï¼› å¦‚æœä¸ºfalseï¼Œåˆ™ä½¿ç”¨nullå€¼ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨åŠŸèƒ½ï¼Œä»¥ä¾¿å› ç¼ºå°‘ç±»å‹ä¿¡æ¯æˆ–æ— æ•ˆç±»å‹ä¿¡æ¯è€Œå¼•å‘å¼‚å¸¸ã€‚ FAIL_ON_READING_DUP_TREE_KEY false è¯¥åŠŸèƒ½ç¡®å®šåœ¨å°†JSONå†…å®¹è¯»å…¥æ ‘ï¼ˆcom.fasterxml.jackson.core.TreeNodeï¼‰å¹¶é‡åˆ°é‡å¤é”®ï¼ˆå·²ä¸ºJSONå¯¹è±¡çœ‹åˆ°çš„å±æ€§åç§°ï¼‰æ—¶å‘ç”Ÿä»€ä¹ˆæƒ…å†µã€‚ å¦‚æœå¯ç”¨ï¼Œå°†æŠ›å‡ºJsonMappingExceptionï¼› å¦‚æœç¦ç”¨ï¼Œåˆ™ä¸ä¼šå¼•å‘å¼‚å¸¸ï¼Œå¹¶ä¸”æ–°çš„ï¼ˆè¾ƒæ–°çš„ï¼‰å€¼å°†è¦†ç›–è¾ƒæ—©çš„å€¼ã€‚è¯·æ³¨æ„ï¼Œæ­¤å±æ€§ä¸ä¼šå½±å“æ•°æ®ç»‘å®šçš„å…¶ä»–æ–¹é¢ã€‚ ä¹Ÿå°±æ˜¯è¯´ï¼Œä¸å¯¹POJOå±æ€§æˆ–java.util.Mapé”®è¿›è¡Œæ£€æµ‹ã€‚ å¯ä»¥æ·»åŠ æ–°åŠŸèƒ½æ¥æ§åˆ¶å…¶ä»–æƒ…å†µã€‚é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠŸèƒ½æ˜¯ç¦ç”¨çš„ï¼Œå› æ­¤ä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚ FAIL_ON_IGNORED_PROPERTIES false ç¡®å®šåœ¨è¾“å…¥ä¸­é‡åˆ°æ˜¾å¼æ ‡è®°ä¸ºå¯å¿½ç•¥çš„å±æ€§æ—¶å°†å‘ç”Ÿä»€ä¹ˆçš„åŠŸèƒ½ï¼šå¦‚æœå¯ç”¨äº†åŠŸèƒ½ï¼Œåˆ™æŠ›å‡ºJsonMappingExceptionï¼› å¦‚æœä¸ºfalseï¼Œåˆ™é»˜é»˜åœ°è·³è¿‡å±æ€§ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠŸèƒ½æ˜¯ç¦ç”¨çš„ï¼Œå› æ­¤ä¸ä¼šå¼•å‘å¼‚å¸¸ã€‚ FAIL_ON_UNRESOLVED_OBJECT_IDS true ç¡®å®šé‡åˆ°çš„å¯¹è±¡IDå¼•ç”¨ä¸å¼•ç”¨å…·æœ‰è¯¥IDçš„å®é™…å¯¹è±¡ï¼ˆâ€œæœªè§£å†³çš„å¯¹è±¡IDâ€ï¼‰çš„æƒ…å†µæ—¶å‘ç”Ÿçš„åŠŸèƒ½ï¼šæŠ›å‡ºå¼‚å¸¸ï¼ˆtrueï¼‰ï¼Œæˆ–è€…ä½¿ç”¨ç©ºå¯¹è±¡ä»£æ›¿ï¼ˆfalseï¼‰ ã€‚ è¯·æ³¨æ„ï¼Œå¦‚æœå°†å…¶è®¾ç½®ä¸ºfalseï¼Œåˆ™ä¸ä¼šè¿›è¡Œè¿›ä¸€æ­¥å¤„ç†ï¼› å…·ä½“æ¥è¯´ï¼Œå¦‚æœå¼•ç”¨æ˜¯é€šè¿‡setteræ–¹æ³•å®šä¹‰çš„ï¼Œåˆ™ä¸ä¼šè°ƒç”¨è¯¥æ–¹æ³•ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ååºåˆ—åŒ–ç»“æŸæ—¶ï¼ŒæœªçŸ¥çš„å¯¹è±¡IDå°†å¯¼è‡´å¼•å‘å¼‚å¸¸ã€‚ FAIL_ON_MISSING_CREATOR_PROPERTIES false è¯¥åŠŸèƒ½ç¡®å®šä¸€ä¸ªæˆ–å¤šä¸ªåˆ›å»ºè€…å±æ€§ï¼ˆç»‘å®šåˆ°åˆ›å»ºè€…æ–¹æ³•ï¼ˆæ„é€ å‡½æ•°æˆ–é™æ€å·¥å‚æ–¹æ³•ï¼‰çš„å‚æ•°çš„å±æ€§ï¼‰ç¼ºå°‘è¦ä»å†…å®¹ç»‘å®šåˆ°çš„å€¼æ—¶å‘ç”Ÿçš„æƒ…å†µã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™æ­¤ç±»ç¼ºå°‘çš„å€¼ä¼šå¯¼è‡´æŠ›å‡ºJsonMappingExceptionå¹¶é™„å¸¦ç¬¬ä¸€ä¸ªï¼ˆæŒ‰ç´¢å¼•ï¼‰ç¼ºå°‘çš„å±æ€§çš„ä¿¡æ¯ã€‚ å¦‚æœç¦ç”¨ï¼Œå¹¶ä¸”æœªå°†å±æ€§æ ‡è®°ä¸ºå¿…éœ€ï¼Œåˆ™ç¼ºå°‘çš„Creatorå±æ€§å°†ç”±ååºåˆ—åŒ–å™¨ä¸ºå‚æ•°ç±»å‹æä¾›çš„ç©ºå€¼å¡«å……ï¼ˆé€šå¸¸å¯¹äºObjectç±»å‹ä¸ºnullï¼Œå¯¹äºåŸºå…ƒä¸ºé»˜è®¤å€¼ï¼›ä½†å¯é€šè¿‡è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨é‡æ–°å®šä¹‰ï¼‰ã€‚æ³¨æ„ï¼Œå…·æœ‰å¯æ³¨å°„çš„å€¼ç®—ä½œâ€œä¸ä¸¢å¤±â€ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åŠŸèƒ½ä¸ºç¦ç”¨çŠ¶æ€ï¼Œå› æ­¤é™¤éç¼ºå°‘å°†åˆ›å»ºè€…å±æ€§å€¼æ˜ç¡®æ ‡è®°ä¸ºâ€œå¿…éœ€â€çš„å±æ€§ï¼Œå¦åˆ™ä¸ä¼šå¼•å‘ä»»ä½•å¼‚å¸¸ã€‚ FAIL_ON_NULL_CREATOR_PROPERTIES false è¯¥åŠŸèƒ½å¯ç¡®å®šå¦‚æœå°†ä¸€ä¸ªæˆ–å¤šä¸ªCreatorå±æ€§ï¼ˆç»‘å®šåˆ°Creatoræ–¹æ³•ï¼ˆæ„é€ æ–¹æ³•æˆ–é™æ€å·¥å‚æ–¹æ³•ï¼‰çš„å‚æ•°çš„å±æ€§ï¼‰ç»‘å®šåˆ°nullå€¼ï¼ˆæ¥è‡ªJSONæˆ–ä½œä¸ºé»˜è®¤å€¼ï¼‰æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆã€‚ å¦‚æœè¦é¿å…ä»£ç åº“ä¸­ä¸ºnullï¼Œåˆ™è¿™å¾ˆæœ‰ç”¨ï¼Œå¦‚æœå¯¹éå¼ºåˆ¶æ€§å­—æ®µä½¿ç”¨Javaæˆ–Scalaå¯é€‰å‚æ•°ï¼Œåˆ™è¿™ç‰¹åˆ«æœ‰ç”¨ã€‚ é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åŠŸèƒ½ä¸ºç¦ç”¨çŠ¶æ€ï¼Œå› æ­¤é™¤éç¼ºå°‘å°†åˆ›å»ºè€…å±æ€§å€¼æ˜ç¡®æ ‡è®°ä¸ºâ€œå¿…éœ€â€çš„å±æ€§ï¼Œå¦åˆ™ä¸ä¼šå¼•å‘ä»»ä½•å¼‚å¸¸ã€‚ FAIL_ON_MISSING_EXTERNAL_TYPE_ID_PROPERTY true è¯¥åŠŸèƒ½ç¡®å®šç¼ºå°‘ä½¿ç”¨com.fasterxml.jackson.annotation.JsonTypeInfo.As.EXTERNAL_PROPERTYæ³¨è§£çš„å±æ€§ä½†ç”¨çš„å…³è”ç±»å‹IDæ—¶å‘ç”Ÿçš„æƒ…å†µã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™æ€»æ˜¯åœ¨ç¼ºå°‘å±æ€§å€¼æ—¶ï¼ˆå¦‚æœç±»å‹IDç¡®å®å­˜åœ¨ï¼‰æŠ›å‡ºJsonMappingExceptionï¼› å¦‚æœç¦ç”¨ï¼Œåˆ™ä»…åœ¨å°†å±æ€§æ ‡è®°ä¸ºâ€œå¿…éœ€â€æ—¶æŠ›å‡ºå¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ç¼ºå°‘å­ç±»å‹å±æ€§æ—¶å¼•å‘å¼‚å¸¸ã€‚ FAIL_ON_TRAILING_TOKENS false ç»‘å®šæ ¹å€¼åç¡®å®šæ•°æ®ç»‘å®šè¡Œä¸ºçš„åŠŸèƒ½ã€‚ å¦‚æœå¯ç”¨äº†åŠŸèƒ½ï¼Œåˆ™å†æ¬¡è°ƒç”¨com.fasterxml.jackson.core.JsonParser.nextTokenä»¥ç¡®ä¿æ‰¾ä¸åˆ°æ›´å¤šä»¤ç‰Œï¼ˆå¦‚æœæ‰¾åˆ°äº†æ›´å¤šä»¤ç‰Œï¼Œåˆ™æŠ›å‡ºcom.fasterxml.jackson.databind.exc.MismatchedInputException ï¼‰; å¦‚æœç¦ç”¨ï¼Œåˆ™ä¸è¿›è¡Œè¿›ä¸€æ­¥æ£€æŸ¥ã€‚è¯¥åŠŸèƒ½ä¹Ÿå¯ä»¥ç§°ä¸ºREAD_FULL_STREAMï¼Œå› ä¸ºå®ƒå¯ä»¥æœ‰æ•ˆåœ°éªŒè¯è¾“å…¥æµä»…åŒ…å«ç»‘å®šå®Œæ•´å€¼æ‰€éœ€çš„æ•°æ®ï¼Œè€Œä»…åŒ…å«å…¶ä»–å†…å®¹ï¼ˆå¯èƒ½çš„å¯å¿½ç•¥ç©ºæ ¼æˆ–æ³¨è§£ï¼Œå¦‚æœæ•°æ®æ ¼å¼æ”¯æŒï¼Œåˆ™é™¤å¤–ï¼‰ã€‚ç”±äºå‘åå…¼å®¹çš„åŸå› ï¼Œé»˜è®¤æƒ…å†µä¸‹åŠŸèƒ½æ˜¯ç¦ç”¨çš„ï¼ˆå› æ­¤ä¸æ£€æŸ¥å¯èƒ½çš„å°¾éšä»¤ç‰Œï¼‰ã€‚ WRAP_EXCEPTIONS true ç¡®å®šæ°å…‹é€Šä»£ç æ˜¯å¦åº”æ•è·å¹¶åŒ…è£…å¼‚å¸¸ï¼ˆä½†ç»ä¸è¦å‡ºé”™ï¼ï¼‰ä»¥æ·»åŠ æœ‰å…³é—®é¢˜ä½ç½®ï¼ˆåœ¨è¾“å…¥èŒƒå›´å†…ï¼‰çš„é™„åŠ ä¿¡æ¯çš„åŠŸèƒ½ã€‚ å¦‚æœå¯ç”¨ï¼Œå¤§å¤šæ•°å¼‚å¸¸å°†è¢«æ•è·å¹¶é‡æ–°æŠ›å‡ºï¼ˆç‰¹åˆ«æ˜¯java.io.IOExceptionså¯ä»¥æŒ‰åŸæ ·ä¼ é€’ï¼Œå› ä¸ºå®ƒä»¬è¢«å£°æ˜ä¸ºå¯æŠ›å‡ºï¼‰ã€‚ è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå°†æ£€æŸ¥å¹¶å£°æ˜æ‰€æœ‰å¼‚å¸¸ï¼Œå› æ­¤æœ‰æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ ä½†æ˜¯ï¼Œæœ‰æ—¶è°ƒç”¨åº”ç”¨ç¨‹åºå¯èƒ½åªå¸Œæœ›æŒ‰åŸæ ·ä¼ é€’â€œåŸå§‹â€æœªç»æ£€æŸ¥çš„å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚ ACCEPT_SINGLE_VALUE_AS_ARRAY false ç¡®å®šå¼ºåˆ¶å°†éæ•°ç»„ï¼ˆJSONï¼‰å€¼å¼ºåˆ¶ç”¨äºJavaé›†åˆï¼ˆæ•°ç»„ï¼Œjava.util.Collectionï¼‰ç±»å‹çš„åŠŸèƒ½ã€‚ å¦‚æœå¯ç”¨ï¼Œé›†åˆååºåˆ—åŒ–å™¨å°†å°è¯•å¤„ç†éæ•°ç»„å€¼ï¼Œå°±åƒå®ƒä»¬å¯¹JSONæ•°ç»„å…·æœ‰â€œéšå¼â€ä¸€æ ·ã€‚ æ­¤åŠŸèƒ½æ—¨åœ¨å‡ºäºå…¼å®¹æ€§/äº’æ“ä½œæ€§åŸå› è€Œä½¿ç”¨ï¼Œä»¥ä¸åœ¨æ•°ç»„ä¸­åªæœ‰å•ä¸ªå…ƒç´ çš„æƒ…å†µä¸‹å¿½ç•¥JSONæ•°ç»„çš„ç¨‹åºåŒ…ï¼ˆä¾‹å¦‚XMLåˆ°JSONè½¬æ¢å™¨ï¼‰ä¸€èµ·ä½¿ç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ UNWRAP_SINGLE_VALUE_ARRAYS false ç¡®å®šå°†å•ä¸ªå€¼æ•°ç»„ï¼ˆåœ¨JSONä¸­ï¼‰çš„å€¼å¼ºåˆ¶è½¬æ¢ä¸ºç›¸åº”å€¼ç±»å‹æ˜¯å¦å¯æ¥å—çš„åŠŸèƒ½ã€‚ è¿™åŸºæœ¬ä¸Šä¸ACCEPT_SINGLE_VALUE_AS_ARRAYåŠŸèƒ½ç›¸åã€‚ å¦‚æœåœ¨æ•°ç»„ä¸­æ‰¾åˆ°å¤šä¸ªå€¼ï¼Œåˆ™æŠ›å‡ºJsonMappingExceptionã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨åŠŸèƒ½ UNWRAP_ROOT_VALUE false å…è®¸â€œè§£åŒ…â€æ ¹çº§JSONå€¼ä»¥åŒ¹é…ç”¨äºåºåˆ—åŒ–çš„SerializationFeature.WRAP_ROOT_VALUEçš„è®¾ç½®ã€‚ å°†éªŒè¯æ ¹JSONå€¼æ˜¯ä¸€ä¸ªJSONå¯¹è±¡ï¼Œå¹¶ä¸”å®ƒå…·æœ‰å…·æœ‰é¢„æœŸæ ¹åçš„å•ä¸ªå±æ€§ã€‚ å¦‚æœä¸æ˜¯ï¼Œåˆ™æŠ›å‡ºJsonMappingExceptionã€‚ å¦åˆ™ï¼ŒåŒ…è£…å±æ€§çš„å€¼å°†è¢«ååºåˆ—åŒ–ï¼Œå°±å¥½åƒå®ƒæ˜¯æ ¹å€¼ä¸€æ ·ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ ACCEPT_EMPTY_STRING_AS_NULL_OBJECT false å¯ä»¥å¯ç”¨æ­¤åŠŸèƒ½ä»¥å…è®¸å°†POJOå’Œå…¶ä»–ç»“æ„åŒ–å€¼ï¼ˆjava.util.Mapsï¼Œjava.util.Collectionsï¼‰çš„JSONç©ºå­—ç¬¦ä¸²å€¼ï¼ˆâ€œâ€ï¼‰ç»‘å®šä¸ºâ€œ nullâ€ã€‚ å¦‚æœç¦ç”¨ï¼Œåˆ™åªèƒ½ä»JSONnullæˆ–JSONå¯¹è±¡ç»‘å®šæ ‡å‡†POJOï¼ˆæ ‡å‡†å«ä¹‰æ˜¯æœªå®šä¹‰ä»»ä½•è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨æˆ–æ„é€ å‡½æ•°ï¼›è¿™ä¸¤ç§éƒ½å¯ä»¥æ·»åŠ å¯¹å…¶ä»–ç§ç±»JSONå€¼çš„æ”¯æŒï¼‰ï¼› å¦‚æœå¯ç”¨ï¼Œåˆ™å¯ä»¥å°†ç©ºJSONå­—ç¬¦ä¸²ç­‰æ•ˆä¸ºJSON nullã€‚æ³¨æ„ï¼šè¿™ä¸é€‚ç”¨äºæ ‡é‡å€¼ï¼Œä¾‹å¦‚å¸ƒå°”å€¼å’Œæ•°å­—ï¼› æ˜¯å¦å¯ä»¥å¼ºåˆ¶ä½¿ç”¨å®ƒä»¬å–å†³äºMapperFeature.ALLOW_COERCION_OF_SCALARSã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ ACCEPT_EMPTY_ARRAY_AS_NULL_OBJECT false å¯ä»¥å¯ç”¨æ­¤åŠŸèƒ½ï¼Œä»¥å…è®¸å°†ç©ºJSONæ•°ç»„å€¼ï¼ˆå³[]ï¼‰ç»‘å®šä¸ºPOOLï¼ˆä»¥åŠ2.9ï¼Œè¿˜åŒ…å«å…¶ä»–å€¼ï¼‰ä¸ºâ€œ nullâ€ã€‚ å¦‚æœç¦ç”¨ï¼Œåˆ™åªèƒ½ä»JSONnullæˆ–JSONå¯¹è±¡ç»‘å®šæ ‡å‡†POJOï¼ˆæ ‡å‡†å«ä¹‰æ˜¯æœªå®šä¹‰ä»»ä½•è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨æˆ–æ„é€ å‡½æ•°ï¼›è¿™ä¸¤ç§éƒ½å¯ä»¥æ·»åŠ å¯¹å…¶ä»–ç§ç±»JSONå€¼çš„æ”¯æŒï¼‰ï¼› å¦‚æœå¯ç”¨ï¼Œåˆ™å°†ä½¿ç”¨ç©ºJSONæ•°ç»„ç­‰æ•ˆäºJSON nullã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ ACCEPT_FLOAT_AS_INT true ç¡®å®šæ˜¯å¦å¼ºåˆ¶è½¬æ¢ä¸ºä»JSONæµ®ç‚¹æ•°ï¼ˆä»»ä½•å¸¦å‘½ä»¤ï¼ˆ.ï¼‰æˆ–æŒ‡æ•°éƒ¨åˆ†ï¼ˆe /E&#39;ï¼‰ï¼‰åˆ°æœŸæœ›çš„æ•´æ•°ï¼ˆintï¼Œlongï¼Œjava.lang .integerï¼Œjava.lang.Longï¼Œjava.math.BigDecimalæ˜¯å¦å…è®¸ã€‚ å¦‚æœå¯ç”¨ï¼Œå¼ºåˆ¶å°†æˆªæ–­å€¼ï¼› å¦‚æœç¦ç”¨ï¼Œå°†æŠ›å‡ºJsonMappingExceptionã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚ READ_ENUMS_USING_TO_STRING false ç¡®å®šç”¨äºEnumå€¼çš„æ ‡å‡†ååºåˆ—åŒ–æœºåˆ¶çš„åŠŸèƒ½ï¼šå¦‚æœå¯ç”¨ï¼Œåˆ™å‡å®šEnumså·²ä½¿ç”¨Enum.toStringï¼ˆï¼‰çš„è¿”å›å€¼è¿›è¡Œäº†åºåˆ—åŒ–ï¼› å¦‚æœç¦ç”¨ï¼Œåˆ™å‡å®šå·²ä½¿ç”¨Enum.nameï¼ˆï¼‰çš„è¿”å›å€¼ã€‚æ³¨æ„ï¼šæ­¤åŠŸèƒ½é€šå¸¸åº”ä¸SerializationFeature.WRITE_ENUMS_USING_TO_STRINGå…·æœ‰ç›¸åŒçš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ READ_UNKNOWN_ENUM_VALUES_AS_NULL false å…è®¸å°†æœªçŸ¥çš„Enumå€¼è§£æä¸ºç©ºå€¼çš„åŠŸèƒ½ã€‚ å¦‚æœç¦ç”¨ï¼ŒæœªçŸ¥çš„Enumå€¼å°†å¼•å‘å¼‚å¸¸ã€‚è¯·æ³¨æ„ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œè¿™åŸºæœ¬ä¸Šä¼šå¿½ç•¥æœªçŸ¥çš„Enumå€¼ï¼› è¿™æ˜¯java.util.EnumMapçš„é”®çš„é”®å’Œjava.util.EnumSetçš„å€¼çš„ï¼ˆå› ä¸ºåœ¨è¿™äº›æƒ…å†µä¸‹ä¸æ¥å—nullï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE false è¯¥åŠŸèƒ½å…è®¸å¿½ç•¥æœªçŸ¥çš„Enumå€¼ï¼Œå¹¶é€šè¿‡@JsonEnumDefaultValueæ‰¹æ³¨æŒ‡å®šé¢„å®šä¹‰å€¼ã€‚ å¦‚æœç¦ç”¨ï¼ŒæœªçŸ¥çš„Enumå€¼å°†å¼•å‘å¼‚å¸¸ã€‚ å¦‚æœå¯ç”¨ï¼Œä½†æœªæŒ‡å®šé¢„å®šä¹‰çš„é»˜è®¤Enumå€¼ï¼Œåˆ™ä¹Ÿä¼šå¼•å‘å¼‚å¸¸ã€‚ é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚ READ_DATE_TIMESTAMPS_AS_NANOSECONDS true å½“ä¸”ä»…å½“æ•°æ®ç±»å‹æ”¯æŒè¿™ç§åˆ†è¾¨ç‡æ—¶ï¼Œæ­¤åŠŸèƒ½å¯æ§åˆ¶æ˜¯å¦åº”ä½¿ç”¨ï¼ˆå¯ç”¨ï¼‰æˆ–ä¸ä½¿ç”¨ï¼ˆç¦ç”¨ï¼‰çº³ç§’çº§æ—¶é—´æˆ³å†™å…¥æ•°å­—æ—¶é—´æˆ³å€¼ã€‚ åªæœ‰è¾ƒæ–°çš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚Java8æ—¥æœŸ/æ—¶é—´ï¼‰æ‰æ”¯æŒè¿™ç§åˆ†è¾¨ç‡-è¾ƒæ—§çš„ç±»å‹ï¼ˆJava8ä¹‹å‰çš„java.util.Dateç­‰ï¼‰å’ŒJodaåˆ™ä¸æ”¯æŒ-å¹¶ä¸”æ­¤è®¾ç½®å¯¹æ­¤ç±»ç±»å‹æ— æ•ˆã€‚å¦‚æœç¦ç”¨ï¼Œåˆ™å‡å®šä¸ºæ ‡å‡†æ¯«ç§’æ—¶é—´æˆ³ã€‚ è¿™ä¸SerializationFeature.WRITE_DATE_TIMESTAMPS_AS_NANOSECONDSç›¸å¯¹åº”ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ï¼Œä»¥æ”¯æŒæœ€å‡†ç¡®çš„æ—¶é—´å€¼ã€‚ ADJUST_DATES_TO_CONTEXT_TIME_ZONE true è¯¥åŠŸèƒ½æŒ‡å®šä¸Šä¸‹æ–‡æä¾›çš„java.util.TimeZoneï¼ˆDeserializationContext.getTimeZoneï¼ˆï¼‰æ˜¯å¦åº”ç”¨äºåœ¨ååºåˆ—åŒ–æ—¶è°ƒæ•´æ—¥æœŸ/æ—¶é—´å€¼ï¼Œå³ä½¿å€¼æœ¬èº«åŒ…å«æ—¶åŒºä¿¡æ¯ä¹Ÿæ˜¯å¦‚æ­¤ã€‚ å¦‚æœç¦ç”¨ï¼Œåˆ™ä»…å½“å€¼æœ¬èº«ä¸åŒ…å«ä»»ä½•TimeZoneä¿¡æ¯æ—¶æ‰ä½¿ç”¨å®ƒã€‚è¯·æ³¨æ„ï¼Œç¡®åˆ‡çš„è¡Œä¸ºå–å†³äºæ‰€è®¨è®ºçš„æ—¥æœŸ/æ—¶é—´ç±»å‹ã€‚ ç‰¹åˆ«æ˜¯JDKç±»å‹çš„java.util.Dateæ²¡æœ‰å†…ç½®æ—¶åŒºä¿¡æ¯ï¼Œå› æ­¤æ­¤è®¾ç½®æ— æ•ˆã€‚ æ­¤å¤–ï¼Œå°½ç®¡java.util.Calendarç¡®å®å…·æœ‰æ­¤ä¿¡æ¯ï¼Œä½†æ˜¯åŸºæœ¬JDK java.text.SimpleDateFormatæ— æ³•ä¿ç•™å·²è§£æçš„åŒºåŸŸä¿¡æ¯ï¼Œå› æ­¤ï¼Œæ— è®ºæ­¤è®¾ç½®å¦‚ä½•ï¼Œjava.util.Calendarå§‹ç»ˆå°†è·å¾—ä¸Šä¸‹æ–‡æ—¶åŒºè°ƒæ•´ã€‚è€ƒè™‘åˆ°ä¸Šè¿°å› ç´ ï¼Œåªæœ‰Jodaå’ŒJava 8æ—¥æœŸ/æ–‡å­—æ•°æ®ç±»å‹çš„æ‰©å±•æ¨¡å—æ‰æ”¯æŒæ­¤åŠŸèƒ½ã€‚ EAGER_DESERIALIZER_FETCH true å†³å®šObjectReaderæ˜¯å¦åº”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹çƒ­åˆ‡è·å–å¿…è¦çš„JsonDeserializerçš„åŠŸèƒ½ã€‚ å¦‚æœå¤šæ¬¡ä½¿ç”¨ç±»ä¼¼é…ç½®çš„ObjectReaderå®ä¾‹ï¼Œåˆ™å¯ä»¥æé«˜æ€§èƒ½ã€‚ å¹¶ä¸”ä¸ä¼šå¯¹ä¸€æ¬¡æ€§ä½¿ç”¨æ¡ˆä¾‹äº§ç”Ÿé‡å¤§å½±å“ã€‚è¯·æ³¨æ„ï¼Œé€šå¸¸ä¸éœ€è¦ç¦ç”¨æ­¤åŠŸèƒ½ï¼šä»…åœ¨å­˜åœ¨å®é™…å¯å¯Ÿè§‰é—®é¢˜çš„æƒ…å†µä¸‹è€ƒè™‘ã€‚ é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚ å¯¹äºSerializationFeatureæšä¸¾ä¸­çš„è®¾ç½®è¿›è¡Œæè¿°ï¼š |é…ç½®|é»˜è®¤å€¼|ä½œç”¨æè¿°||-|-||WRAP_ROOT_VALUE|false|å¯ä»¥å¯ç”¨ä»¥ä½¿æ ¹å€¼ï¼ˆé€šå¸¸ä¸ºJSONå¯¹è±¡ï¼Œä½†å¯ä»¥æ˜¯ä»»ä½•ç±»å‹ï¼‰åŒ…è£…åœ¨å•ä¸ªå±æ€§JSONå¯¹è±¡ä¸­çš„åŠŸèƒ½ï¼Œå…¶ä¸­é”®ä¸ºâ€œæ ¹åâ€ï¼Œç”±æ³¨é‡Šå†…çœè€…ç¡®å®šï¼ˆå¯¹äºä½¿ç”¨@XmlRootElementçš„JAXBå°¤å…¶å¦‚æ­¤ï¼‰ .nameï¼‰æˆ–åå¤‡å¹¿å‘Šï¼ˆéåˆæ ¼çš„ç±»åï¼‰ã€‚ åŠŸèƒ½ä¸»è¦æ˜¯ä¸ºäº†ä¸JAXBå…¼å®¹ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||INDENT_OUTPUT|false|è¯¥åŠŸèƒ½å…è®¸ä½¿ç”¨ä¸ºObjectMapperï¼ˆä»¥åŠä»mapperåˆ›å»ºçš„ObjectWritersï¼‰é…ç½®çš„é»˜è®¤æ¼‚äº®æ‰“å°æœºä¸ºåŸºç¡€ç”Ÿæˆå™¨å¯ç”¨ï¼ˆæˆ–ç¦ç”¨ï¼‰ç¼©è¿›ã€‚è¯·æ³¨æ„ï¼Œä»…å½“æœªä¸ºç”Ÿæˆå™¨æˆ–ObjectWriteré…ç½®æ˜¾å¼com.fasterxml.jackson.core.PrettyPrinteræ—¶ï¼Œæ‰ä½¿ç”¨é»˜è®¤çš„æ¼‚äº®æ‰“å°æœºã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||FAIL_ON_EMPTY_BEANS|true|è¯¥åŠŸèƒ½ç”¨äºç¡®å®šåœ¨æ‰¾ä¸åˆ°ç±»å‹çš„è®¿é—®å™¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µï¼ˆå¹¶ä¸”æ²¡æœ‰æ³¨é‡ŠæŒ‡ç¤ºå®ƒæ‰“ç®—è¢«åºåˆ—åŒ–ï¼‰ã€‚ å¦‚æœå¯ç”¨ï¼ˆé»˜è®¤ï¼‰ï¼Œåˆ™å°†å¼•å‘å¼‚å¸¸ä»¥æŒ‡ç¤ºè¿™äº›ç±»å‹ä¸ºä¸å¯åºåˆ—åŒ–çš„ç±»å‹ï¼› å¦‚æœç¦ç”¨ï¼Œå®ƒä»¬å°†è¢«åºåˆ—åŒ–ä¸ºç©ºå¯¹è±¡ï¼Œå³æ²¡æœ‰ä»»ä½•å±æ€§ã€‚è¯·æ³¨æ„ï¼Œæ­¤åŠŸèƒ½ä»…å¯¹é‚£äº›æ²¡æœ‰ä»»ä½•å¯è¯†åˆ«æ³¨é‡Šçš„â€œç©ºâ€ beanï¼ˆä¾‹å¦‚ï¼Œ@JsonSerializeï¼‰èµ·ä½œç”¨çš„ç©ºç±»å‹ï¼šå…·æœ‰æ³¨é‡Šçš„é‚£äº›ä¸ä¼šå¯¼è‡´æŠ›å‡ºå¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||FAIL_ON_SELF_REFERENCES|true|å†³å®šPOJOæ£€æµ‹åˆ°ç›´æ¥è‡ªæˆ‘å¼•ç”¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µçš„åŠŸèƒ½ï¼ˆå¹¶ä¸”æœªå¯ç”¨å¯¹è±¡IDå¤„ç†ï¼‰ï¼šæŠ›å‡ºJsonMappingExceptionï¼ˆå¦‚æœä¸ºtrueï¼‰ï¼Œæˆ–è€…é€šå¸¸å¯¹å¼•ç”¨è¿›è¡Œå¤„ç†ï¼ˆfalseï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨åŠŸèƒ½||WRAP_EXCEPTIONS|true|ç¡®å®šJacksonä»£ç æ˜¯å¦åº”æ•è·å¹¶åŒ…è£…å¼‚å¸¸ï¼ˆä½†ç»ä¸è¦å‡ºé”™ï¼ï¼‰ä»¥æ·»åŠ æœ‰å…³é—®é¢˜ä½ç½®ï¼ˆåœ¨è¾“å…¥èŒƒå›´å†…ï¼‰çš„é™„åŠ ä¿¡æ¯çš„åŠŸèƒ½ã€‚ å¦‚æœå¯ç”¨ï¼Œå¤§å¤šæ•°å¼‚å¸¸å°†è¢«æ•è·å¹¶é‡æ–°æŠ›å‡ºï¼ˆç‰¹åˆ«æ˜¯java.io.IOExceptionså¯ä»¥æŒ‰åŸæ ·ä¼ é€’ï¼Œå› ä¸ºå®ƒä»¬è¢«å£°æ˜ä¸ºå¯æŠ›å‡ºï¼‰ã€‚ è¿™å¾ˆæ–¹ä¾¿ï¼Œå› ä¸ºå°†æ£€æŸ¥å¹¶å£°æ˜æ‰€æœ‰å¼‚å¸¸ï¼Œå› æ­¤æœ‰æ›´å¤šä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚ ä½†æ˜¯ï¼Œæœ‰æ—¶è°ƒç”¨åº”ç”¨ç¨‹åºå¯èƒ½åªå¸Œæœ›æŒ‰åŸæ ·ä¼ é€’â€œåŸå§‹â€æœªç»æ£€æŸ¥çš„å¼‚å¸¸ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||FAIL_ON_UNWRAPPED_TYPE_IDENTIFIERS|true|ç¡®å®šé€šå¸¸å…·æœ‰JacksonåŒ…å«çš„ç±»å‹ä¿¡æ¯çš„å¯¹è±¡ä¸com.fasterxml.jackson.annotation.JsonUnwrappedç»“åˆä½¿ç”¨æ—¶å‘ç”Ÿçš„åŠŸèƒ½ã€‚ åœ¨é»˜è®¤ï¼ˆå¯ç”¨ï¼‰çŠ¶æ€ä¸‹ï¼Œå½“å±•å¼€çš„å¯¹è±¡å…·æœ‰ç±»å‹ä¿¡æ¯æ—¶ï¼Œå°†å¼•å‘é”™è¯¯ã€‚ ç¦ç”¨æ—¶ï¼Œå°†è§£åŒ…è¯¥å¯¹è±¡ï¼Œå¹¶ä¸¢å¼ƒç±»å‹ä¿¡æ¯ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_SELF_REFERENCES_AS_NULL|false|å†³å®šPOJOæ£€æµ‹åˆ°ç›´æ¥è‡ªå¼•ç”¨æ—¶ä¼šå‘ç”Ÿä»€ä¹ˆæƒ…å†µçš„åŠŸèƒ½ï¼ˆå¹¶ä¸”æœªå¯ç”¨å¯¹è±¡IDå¤„ç†ï¼‰ï¼šå¦‚æœå¯ç”¨ï¼Œåˆ™å°†è¯¥å¼•ç”¨å†™ä¸ºnullï¼› å¦‚æœç¦ç”¨ï¼Œåˆ™ä½¿ç”¨é»˜è®¤è¡Œä¸ºï¼ˆå®ƒå°†å°è¯•åºåˆ—åŒ–ï¼Œé€šå¸¸ä¼šå¯¼è‡´å¼‚å¸¸ï¼‰ã€‚ ä½†æ˜¯ï¼Œå¦‚æœå¯ç”¨äº†FAIL_ON_SELF_REFERENCESã€‚ æ­¤å±æ€§å°†è¢«å¿½ç•¥ã€‚||CLOSE_CLOSEABLE|false|ç”¨äºç¡®å®šæ˜¯å¦åœ¨åºåˆ—åŒ–åè°ƒç”¨å®ç°java.io.Closeableçš„åºåˆ—åŒ–æ ¹çº§å¯¹è±¡çš„closeæ–¹æ³•ï¼ˆè°ƒç”¨äº†ObjectMapperçš„writeValueï¼ˆï¼‰ï¼ˆæˆ–ç­‰æ•ˆæ–¹æ³•ï¼‰çš„å¯¹è±¡ï¼‰çš„åŠŸèƒ½ã€‚ å¦‚æœå¯ç”¨ï¼Œåˆ™åœ¨åºåˆ—åŒ–å®Œæˆåï¼ˆæ— è®ºæˆåŠŸè¿˜æ˜¯ç”±äºæŠ›å‡ºå¼‚å¸¸è€Œæ˜¾ç¤ºçš„é”™è¯¯ï¼‰å°†è°ƒç”¨closeï¼ˆï¼‰ã€‚ æ‚¨å¯ä»¥å°†å…¶è§†ä¸ºæŸç§â€œæœ€ç»ˆâ€å¤„ç†ã€‚æ³¨æ„ï¼šä»…å½±å“æ ¹å¯¹è±¡çš„è¡Œä¸ºï¼Œè€Œä¸å½±å“ä»æ ¹å¯¹è±¡å¯è®¿é—®çš„å…¶ä»–å¯¹è±¡ã€‚ æ¢å¥è¯è¯´ï¼Œæ¯ä¸ªâ€œ writeValueâ€è°ƒç”¨å°†åªè¿›è¡Œä¸€æ¬¡è°ƒç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||FLUSH_AFTER_WRITE_VALUE|true|ç¡®å®šæ˜¯å¦ä»¥JsonGeneratorä½œä¸ºå‚æ•°çš„writeValueï¼ˆï¼‰æ–¹æ³•å®Œæˆåæ˜¯å¦è°ƒç”¨JsonGenerator.flushï¼ˆï¼‰çš„åŠŸèƒ½ï¼ˆå³ä¸å½±å“ä½¿ç”¨å…¶ä»–ç›®æ ‡çš„æ–¹æ³•ï¼‰; ObjectWriterä¸­çš„æ–¹æ³•ç›¸åŒã€‚ è¿™é€šå¸¸æ˜¯æœ‰é“ç†çš„ï¼› ä½†æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ä¸åº”è¯¥å¼ºåˆ¶æ‰§è¡Œåˆ·æ–°ï¼šä¾‹å¦‚ï¼Œåœ¨åº•å±‚æµè¿›è¡Œå‹ç¼©æ—¶ï¼Œå¹¶ä¸”flushï¼ˆï¼‰å¯¼è‡´åˆ·æ–°äº†å‹ç¼©çŠ¶æ€ï¼ˆæŸäº›å‹ç¼©ç¼–è§£ç å™¨ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_DATES_AS_TIMESTAMPS|true|ç¡®å®šæ˜¯å¦å°†Dateï¼ˆå’Œæ—¥æœŸ/æ—¶é—´ï¼‰å€¼ï¼ˆä»¥åŠåŸºäºDateçš„ä¸œè¥¿ï¼Œå¦‚java.util.Calendarsï¼‰åºåˆ—åŒ–ä¸ºæ•°å­—æ—¶é—´æˆ³è®°ï¼ˆtrueï¼›é»˜è®¤å€¼ï¼‰æˆ–å…¶ä»–å€¼ï¼ˆé€šå¸¸æ˜¯æ–‡æœ¬è¡¨ç¤ºå½¢å¼ï¼‰çš„åŠŸèƒ½ã€‚å¦‚æœä½¿ç”¨æ–‡æœ¬è¡¨ç¤ºï¼Œåˆ™å®é™…æ ¼å¼å–å†³äºé…ç½®è®¾ç½®ï¼ŒåŒ…æ‹¬@JsonFormatæ‰¹æ³¨çš„æŒ‰å±æ€§ä½¿ç”¨ï¼Œå…¨å±€é…ç½®çš„java.text.DateFormatã€‚å¯¹äºâ€œç»å…¸â€ JDKæ—¥æœŸç±»å‹ï¼ˆjava.util.Dateï¼Œjava.util.Calendarï¼‰ï¼Œé»˜è®¤æ ¼å¼ç”±com.fasterxml.jackson.databind.util.StdDateFormatæä¾›ï¼Œå¹¶ä¸”å¯¹åº”äºæ ¼å¼å­—ç¬¦ä¸²â€œ yyyy-MM-ddâ€ â€˜Tâ€™HHï¼šmmï¼šss.SSSXâ€ï¼ˆæœ‰å…³å­—ç¬¦ä¸²æ ¼å¼çš„è¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§java.text.DateFormatï¼‰ã€‚æ­¤åŠŸèƒ½æ˜¯å¦å½±å“å…¶ä»–ä¸æ—¥æœŸç›¸å…³çš„ç±»å‹çš„å¤„ç†å–å†³äºè¿™äº›ç±»å‹çš„å¤„ç†ç¨‹åºï¼Œå°½ç®¡ç†æƒ³æƒ…å†µä¸‹ï¼Œä»–ä»¬åº”è¯¥ä½¿ç”¨æ­¤åŠŸèƒ½æ³¨æ„ï¼šä½¿ç”¨WRITE_DATE_KEYS_AS_TIMESTAMPSä»£æ›¿æ­¤åŠŸèƒ½æ¥æ§åˆ¶java.util.Mapå¯†é’¥æ˜¯å¦åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨åŠŸèƒ½ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹å°†æ—¥æœŸ/æ—¶é—´åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³ã€‚||WRITE_DATE_KEYS_AS_TIMESTAMPS|false|ç¡®å®šæ˜¯å¦å°†ç”¨ä½œjava.util.Mapé”®çš„java.util.Datesï¼ˆå’Œå­ç±»å‹ï¼‰åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³çš„åŠŸèƒ½ï¼ˆå¦‚æœæ²¡æœ‰ï¼Œåˆ™åºåˆ—åŒ–ä¸ºæ–‡æœ¬å€¼ï¼‰ã€‚é»˜è®¤å€¼ä¸ºâ€œ falseâ€ï¼Œè¡¨ç¤ºå°†æ—¥æœŸå€¼æ˜ å°„é”®åºåˆ—åŒ–ä¸ºæ–‡æœ¬ï¼ˆISO-8601ï¼‰å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_DATES_WITH_ZONE_ID|false|ç”¨äºç¡®å®šæ—¥æœŸ/æ—¥æœŸæ—¶é—´å€¼æ˜¯å¦åº”è¯¥åºåˆ—åŒ–çš„åŠŸèƒ½ï¼Œä»¥ä¾¿åœ¨ç±»å‹æœ¬èº«åŒ…å«æ—¶åŒºä¿¡æ¯çš„æƒ…å†µä¸‹ï¼Œå®ƒä»¬åŒ…æ‹¬æ—¶åŒºidã€‚ åŒ…å«æ­¤ä¿¡æ¯å¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜ï¼Œå› ä¸ºISO-8601è§„èŒƒæœªå®šä¹‰åŒ…å«æ­¤ç±»ä¿¡æ¯çš„æ ¼å¼ã€‚å¦‚æœå¯ç”¨ï¼Œåˆ™åº”ä½¿ç”¨Java 8 DateTimeFormatterï¼ƒISO_ZONED_DATE_TIMEå®šä¹‰æ‰€æŒ‡å®šçš„æ ¼å¼æ¥åŒ…å«æ—¶åŒºIDï¼ˆä¾‹å¦‚ï¼Œâ€œ 2011-12-03T10ï¼š15ï¼š30 + 01ï¼š00 [æ¬§æ´²/å·´é»]â€ï¼‰ã€‚æ³¨æ„ï¼šå¦‚æœæ—¥æœŸ/æ—¶é—´å€¼è¢«åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³ï¼Œåˆ™è¯¥è®¾ç½®ä¸ç›¸å…³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¯¥åŠŸèƒ½å¤„äºç¦ç”¨çŠ¶æ€ï¼Œå› æ­¤ä¸åŒ…å«åŒºåŸŸIDã€‚ ç›¸åï¼Œæ—¶åŒºåç§»é‡ç”¨äºISO-8601å…¼å®¹æ€§ï¼ˆå¦‚æœå€¼ä¸­åŒ…å«ä»»ä½•æ—¶åŒºä¿¡æ¯ï¼‰ã€‚||WRITE_DURATIONS_AS_TIMESTAMPS|true|é»˜è®¤æƒ…å†µä¸‹ï¼Œç”¨äºç¡®å®šè¡¨ç¤ºæ—¶é—´æ®µï¼ˆæŒç»­æ—¶é—´ï¼Œæ—¶é—´æ®µï¼ŒèŒƒå›´ï¼‰çš„æ—¶é—´å€¼æ˜¯å¦è¦ä½¿ç”¨æ•°å­—ï¼ˆtrueï¼‰æˆ–æ–‡æœ¬ï¼ˆfalseï¼‰è¡¨ç¤ºåºåˆ—åŒ–çš„åŠŸèƒ½ã€‚ è¯·æ³¨æ„ï¼Œæ ¹æ®ç±»å‹çš„ä¸åŒï¼Œæ•°å­—è¡¨ç¤ºå¯èƒ½è¡¨ç¤ºç®€å•æ•°å­—æˆ–æ•°å­—æ•°ç»„ã€‚æ³¨æ„ï¼šä½¿ç”¨WRITE_DATE_KEYS_AS_TIMESTAMPSæ¥æ§åˆ¶java.util.Mapå¯†é’¥æ˜¯å¦åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ï¼Œå› æ­¤é»˜è®¤æƒ…å†µä¸‹å°†å‘¨æœŸ/æŒç»­æ—¶é—´åºåˆ—åŒ–ä¸ºæ—¶é—´æˆ³ã€‚||WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS|false|ç¡®å®šchar []ç±»å‹å¦‚ä½•åºåˆ—åŒ–çš„åŠŸèƒ½ï¼šå¯ç”¨åï¼Œå°†åºåˆ—åŒ–ä¸ºæ˜¾å¼JSONæ•°ç»„ï¼ˆä»¥å•å­—ç¬¦å­—ç¬¦ä¸²ä½œä¸ºå€¼ï¼‰ï¼› ç¦ç”¨æ—¶ï¼Œé»˜è®¤æƒ…å†µä¸‹å°†å…¶åºåˆ—åŒ–ä¸ºå­—ç¬¦ä¸²ï¼ˆæ›´ä¸ºç´§å‡‘ï¼‰ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_ENUMS_USING_TO_STRING|false|ç¡®å®šç”¨äºEnumå€¼çš„æ ‡å‡†åºåˆ—åŒ–æœºåˆ¶çš„åŠŸèƒ½ï¼šå¦‚æœå¯ç”¨ï¼Œåˆ™ä½¿ç”¨Enum.toStringï¼ˆï¼‰çš„è¿”å›å€¼ï¼› å¦‚æœç¦ç”¨ï¼Œåˆ™ä½¿ç”¨Enum.nameï¼ˆï¼‰çš„è¿”å›å€¼ã€‚æ³¨æ„ï¼šæ­¤åŠŸèƒ½é€šå¸¸åº”ä¸DeserializationFeature.READ_ENUMS_USING_TO_STRINGå…·æœ‰ç›¸åŒçš„å€¼ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_ENUMS_USING_INDEX|false|ç¡®å®šJava Enumå€¼æ˜¯åºåˆ—åŒ–ä¸ºæ•°å­—ï¼ˆtrueï¼‰è¿˜æ˜¯æ–‡æœ¬å€¼ï¼ˆfalseï¼‰çš„åŠŸèƒ½ã€‚ å¦‚æœä½¿ç”¨æ–‡æœ¬å€¼ï¼Œåˆ™è¿˜å°†è€ƒè™‘å…¶ä»–è®¾ç½®ã€‚ å¦‚æœå¯ç”¨æ­¤åŠŸèƒ½ï¼Œåˆ™Enum.ordinalï¼ˆï¼‰çš„è¿”å›å€¼ï¼ˆæ•´æ•°ï¼‰å°†ç”¨ä½œåºåˆ—åŒ–ã€‚è¯·æ³¨æ„ï¼Œæ­¤åŠŸèƒ½çš„ä¼˜å…ˆçº§é«˜äºWRITE_ENUMS_USING_TO_STRINGï¼Œåªæœ‰å°†æ­¤åŠŸèƒ½è®¾ç½®ä¸ºfalseæ—¶ï¼Œæ‰è€ƒè™‘æ­¤åŠŸèƒ½ã€‚è¯·æ³¨æ„ï¼Œä»2.10å¼€å§‹ï¼Œè¿™ä¸é€‚ç”¨äºä½œä¸ºjava.util.Mapå€¼çš„é”®ç¼–å†™çš„æšä¸¾ï¼Œè¯¥æšä¸¾å…·æœ‰å•ç‹¬çš„è®¾ç½®WRITE_ENUM_KEYS_USING_INDEXã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_ENUM_KEYS_USING_INDEX|false|ç¡®å®šæ˜¯å¦å°†ç”¨ä½œjava.util.Mapå¯†é’¥çš„{link Enum}åºåˆ—åŒ–ä¸ºä½¿ç”¨Enum.ordinalï¼ˆï¼‰çš„åŠŸèƒ½ã€‚ ä¸å°†æšä¸¾å†™å…¥å¸¸è§„å€¼æ—¶ä½¿ç”¨çš„WRITE_ENUMS_USING_INDEXç›¸ä¼¼ã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_NULL_MAP_VALUES|true|ç¡®å®šæ˜¯å¦è¦å¯¹å…·æœ‰ç©ºå€¼çš„Mapæ¡ç›®è¿›è¡Œåºåˆ—åŒ–ï¼ˆtrueï¼‰æˆ–ä¸è¿›è¡Œåºåˆ—åŒ–ï¼ˆfalseï¼‰çš„åŠŸèƒ½ã€‚æ³¨æ„ï¼šä¸å…¶ä»–SerializationFeaturesä¸åŒï¼Œæ­¤åŠŸèƒ½ä¸èƒ½åœ¨æ¯æ¬¡è°ƒç”¨çš„åŸºç¡€ä¸ŠåŠ¨æ€æ›´æ”¹ï¼Œå› ä¸ºåœ¨æ„é€ åºåˆ—åŒ–ç¨‹åºå’Œå±æ€§å¤„ç†ç¨‹åºæ—¶ä¼šè€ƒè™‘å…¶ä½œç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_EMPTY_JSON_ARRAYS|true|ç¡®å®šæ˜¯å¦å°†å®¹å™¨å±æ€§ï¼ˆå…·æœ‰å£°æ˜çš„Collectionæˆ–æ•°ç»„å€¼çš„POJOå±æ€§ï¼›å³ï¼Œäº§ç”ŸJSONæ•°ç»„çš„äº‹ç‰©ï¼‰ä¸ºç©ºï¼ˆæ²¡æœ‰å…ƒç´ ï¼‰çš„å±æ€§ï¼Œå°†è¢«åºåˆ—åŒ–ä¸ºç©ºJSONæ•°ç»„ï¼ˆtrueï¼‰ï¼Œè¿˜æ˜¯ä»è¾“å‡ºä¸­å–æ¶ˆæ˜¾ç¤ºï¼ˆfalseï¼‰ ã€‚è¯·æ³¨æ„ï¼Œè¿™ä¸ä¼šæ›´æ”¹java.util.Mapsæˆ–â€œç±»ä¼¼é›†åˆâ€ç±»å‹çš„è¡Œä¸ºã€‚æ³¨æ„ï¼šä¸å…¶ä»–SerializationFeaturesä¸åŒï¼Œæ­¤åŠŸèƒ½ä¸èƒ½åœ¨æ¯æ¬¡è°ƒç”¨çš„åŸºç¡€ä¸ŠåŠ¨æ€æ›´æ”¹ï¼Œå› ä¸ºåœ¨æ„é€ åºåˆ—åŒ–ç¨‹åºå’Œå±æ€§å¤„ç†ç¨‹åºæ—¶ä¼šè€ƒè™‘å…¶ä½œç”¨ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED|false|ä¸ºäº’æ“ä½œæ€§è€Œæ·»åŠ çš„åŠŸèƒ½ï¼Œä»¥ä¸æ‰€è°“çš„â€œ BadgerFishâ€çº¦å®šå…¼å®¹ã€‚ åŠŸèƒ½ç¡®å®šå¯¹å•ä¸ªå…ƒç´ java.util.Collectionså’Œæ•°ç»„çš„å¤„ç†ï¼šå¦‚æœå¯ç”¨ï¼Œåˆ™ä»…åŒ…å«ä¸€ä¸ªå…ƒç´ çš„java.util.Collectionså’Œæ•°ç»„å°†è¢«åºåˆ—åŒ–ï¼Œå°±å¥½åƒè¯¥å…ƒç´ æœ¬èº«å·²è¢«åºåˆ—åŒ–ä¸€æ ·ã€‚å¯ç”¨åï¼Œå¸¦æœ‰æ•°ç»„çš„POJOé€šå¸¸å¦‚ä¸‹æ‰€ç¤ºï¼š{â€œ arrayPropertyâ€ï¼š[1]}è€Œæ˜¯åºåˆ—åŒ–ä¸º{â€œ arrayPropertyâ€ï¼š1}è¯·æ³¨æ„ï¼Œæ­¤åŠŸèƒ½ä¸DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAYç›¸å¯¹ï¼ˆå³ï¼Œé€šå¸¸ä¸¤è€…éƒ½å¯ç”¨ï¼Œæˆ–ä¸¤è€…éƒ½ä¸å¯ç”¨ï¼‰ã€‚||WRITE_BIGDECIMAL_AS_PLAIN|false|ç¡®å®šæ˜¯å¦ä½¿ç”¨java.math.BigDecimal.toPlainStringï¼ˆï¼‰åºåˆ—åŒ–java.math.BigDecimalæ¡ç›®çš„åŠŸèƒ½ï¼Œä»¥é˜²æ­¢ä½¿ç”¨ç§‘å­¦è®¡æ•°æ³•å†™å…¥å€¼ã€‚æ³¨æ„ï¼šç”±äºæ­¤åŠŸèƒ½é€šå¸¸éœ€è¦ä½¿ç”¨com.fasterxml.jackson.core.JsonGenerator.writeNumberï¼ˆStringï¼‰ï¼Œå› æ­¤å¯èƒ½ä¼šå¯¼è‡´å…¼å®¹æ€§é—®é¢˜ï¼Œå› ä¸ºå¹¶éæ‰€æœ‰com.fasterxml.jackson.core.JsonGeneratorå®ç°éƒ½æ”¯æŒè¿™ç§è¾“å‡ºæ¨¡å¼ï¼šé€šå¸¸ä»…æ–‡æœ¬ åŸºäºæ ¼å¼çš„æ ¼å¼æ”¯æŒå®ƒã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS|true|æ§åˆ¶æ˜¯å¦ä½¿ç”¨çº³ç§’çº§æ—¶é—´æˆ³å†™å…¥æ•°å­—æ—¶é—´æˆ³å€¼ï¼ˆå¯ç”¨ï¼‰ï¼ˆç¦ç”¨ï¼‰çš„åŠŸèƒ½ï¼› å½“ä¸”ä»…å½“æ•°æ®ç±»å‹æ”¯æŒè¿™ç§åˆ†è¾¨ç‡æ—¶ã€‚ åªæœ‰è¾ƒæ–°çš„æ•°æ®ç±»å‹ï¼ˆä¾‹å¦‚Java8æ—¥æœŸ/æ—¶é—´ï¼‰æ‰æ”¯æŒè¿™ç§åˆ†è¾¨ç‡-è¾ƒæ—§çš„ç±»å‹ï¼ˆJava8ä¹‹å‰çš„java.util.Dateç­‰ï¼‰å’ŒJodaåˆ™ä¸æ”¯æŒ-å¹¶ä¸”æ­¤è®¾ç½®å¯¹æ­¤ç±»ç±»å‹æ— æ•ˆã€‚å¦‚æœç¦ç”¨ï¼Œåˆ™å‡å®šä¸ºæ ‡å‡†æ¯«ç§’æ—¶é—´æˆ³ã€‚ è¿™ä¸DeserializationFeature.READ_DATE_TIMESTAMPS_AS_NANOSECONDSå¯¹åº”ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ï¼Œä»¥æ”¯æŒæœ€å‡†ç¡®çš„æ—¶é—´å€¼ã€‚||ORDER_MAP_ENTRIES_BY_KEYS|false|ç¡®å®šæ˜¯å¦åœ¨åºåˆ—åŒ–ä¹‹å‰é¦–å…ˆæŒ‰é”®å¯¹java.util.Mapæ¡ç›®è¿›è¡Œæ’åºçš„åŠŸèƒ½ï¼šå¦‚æœå¯ç”¨ï¼Œåˆ™åœ¨å¿…è¦æ—¶æ‰§è¡Œé™„åŠ çš„æ’åºæ­¥éª¤ï¼ˆå¯¹äºjava.util.SortedMapsä¸å¿…è¦ï¼‰ï¼Œå¦‚æœç¦ç”¨ï¼Œåˆ™æ— éœ€è¿›è¡Œå…¶ä»–æ’åºã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ã€‚||EAGER_SERIALIZER_FETCH|true|å†³å®šObjectWriteræ˜¯å¦åº”åœ¨å¯èƒ½çš„æƒ…å†µä¸‹çƒ­åˆ‡è·å–å¿…è¦çš„JsonSerializerçš„åŠŸèƒ½ã€‚ å¦‚æœå¤šæ¬¡ä½¿ç”¨ç±»ä¼¼é…ç½®çš„ObjectWriterå®ä¾‹ï¼Œåˆ™å¯ä»¥æé«˜æ€§èƒ½ã€‚ å¹¶ä¸”ä¸ä¼šå¯¹ä¸€æ¬¡æ€§ä½¿ç”¨æ¡ˆä¾‹äº§ç”Ÿé‡å¤§å½±å“ã€‚è¯·æ³¨æ„ï¼Œé€šå¸¸ä¸éœ€è¦ç¦ç”¨æ­¤åŠŸèƒ½ï¼šä»…åœ¨å­˜åœ¨å®é™…å¯å¯Ÿè§‰é—®é¢˜çš„æƒ…å†µä¸‹è€ƒè™‘ã€‚é»˜è®¤æƒ…å†µä¸‹å¯ç”¨æ­¤åŠŸèƒ½ã€‚||USE_EQUALITY_FOR_OBJECT_ID|false|ç¡®å®šæ˜¯å¦ä½¿ç”¨å¯¹è±¡çš„çœŸå®JVMçº§åˆ«æ ‡è¯†ï¼ˆfalseï¼‰æ¯”è¾ƒå¯¹è±¡æ ‡è¯†çš„åŠŸèƒ½ï¼› æˆ–equalsï¼ˆï¼‰æ–¹æ³•ã€‚ å½“ä½¿ç”¨ORMåº“ï¼ˆä¾‹å¦‚Hibernateï¼‰å¤„ç†æ•°æ®åº“ç»‘å®šçš„å¯¹è±¡æ—¶ï¼ŒåæœŸæœ‰æ—¶ä¼šå¾ˆæœ‰ç”¨ã€‚ æ³¨æ„å¯¹è±¡æœ¬èº«æ˜¯å®é™…æ¯”è¾ƒçš„ï¼Œä¸æ˜¯å¯¹è±¡IDã€‚ æ­¤åŠŸèƒ½çš„å‘½åæœ‰äº›ä»¤äººå›°æƒ‘ï¼Œå› æ­¤é‡è¦çš„æ˜¯ï¼Œè¦ä¸ºå…¶ä¿ç•™èº«ä»½çš„å¯¹è±¡åœ¨idä¹‹ä¸Šå’Œä¹‹å¤–éƒ½è¢«è®¤ä¸ºæ˜¯ç›¸ç­‰çš„ï¼ˆæ— è®ºå¦‚ä½•ï¼Œå®ƒä»¬æ€»æ˜¯ä½¿ç”¨ç›¸ç­‰æ€§è¿›è¡Œæ¯”è¾ƒï¼‰ã€‚æ³¨æ„ï¼šç”±äºå®ç°åŠŸèƒ½çš„æ–¹å¼ï¼Œéå¸¸é‡è¦çš„æ˜¯ï¼Œé™¤äº†è¦†ç›–Object.equalsä»¥ä½¿å¯¹è±¡åŒ¹é…ï¼ˆè¢«è§†ä¸ºâ€œç›¸åŒâ€ï¼‰ä¹‹å¤–ï¼Œè¿˜å¿…é¡»ç¡®ä¿Object.hashCodeï¼ˆï¼‰è¢«è¦†ç›–ä»¥äº§ç”Ÿ ç›¸ç­‰å®ä¾‹çš„å€¼å®Œå…¨ç›¸åŒã€‚é»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ­¤åŠŸèƒ½ï¼› è¡¨ç¤ºä½¿ç”¨ä¸¥æ ¼çš„èº«ä»½ï¼Œè€Œä¸æ˜¯equalsï¼ˆï¼‰| 3.2ã€åˆ›å»ºè‡ªå®šä¹‰çš„åºåˆ—åŒ–/ååºåˆ—åŒ–å™¨ObjectMapperç±»çš„å¦ä¸€ä¸ªåŸºæœ¬åŠŸèƒ½æ˜¯èƒ½å¤Ÿæ³¨å†Œè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨ã€‚ åœ¨è¾“å…¥æˆ–è¾“å‡ºJSONå“åº”çš„ç»“æ„ä¸åŒä¸”å¿…é¡»å¯¹å…¶è¿›è¡Œåºåˆ—åŒ–æˆ–ååºåˆ—åŒ–çš„Javaç±»çš„ç»“æ„æ—¶ï¼Œè‡ªå®šä¹‰åºåˆ—åŒ–å™¨å’Œååºåˆ—åŒ–å™¨éå¸¸æœ‰ç”¨ã€‚ä»¥ä¸‹æ˜¯è‡ªå®šä¹‰JSONåºåˆ—åŒ–ç¨‹åºçš„ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829package com.yiyi.advanced;import com.fasterxml.jackson.core.JsonGenerator;import com.fasterxml.jackson.databind.SerializerProvider;import com.fasterxml.jackson.databind.ser.std.StdSerializer;import java.io.IOException;/** * @author wuxuan.chai * @date 2020/6/8 4:49 ä¸‹åˆ */public class CustomCarSerializer extends StdSerializer&lt;Car&gt; &#123; protected CustomCarSerializer(Class&lt;Car&gt; t) &#123; super(t); &#125; public CustomCarSerializer() &#123; this(null); &#125; @Override public void serialize(Car car, JsonGenerator gen, SerializerProvider provider) throws IOException &#123; gen.writeStartObject(); gen.writeStringField(&quot;car_brand&quot;, car.getType()); gen.writeEndObject(); &#125;&#125; æ­¤è‡ªå®šä¹‰åºåˆ—åŒ–å™¨å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243package com.yiyi.advanced;import com.fasterxml.jackson.core.Version;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.module.SimpleModule;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 3:59 ä¸‹åˆ */@Data@ToString@EqualsAndHashCodepublic class Car &#123; private String type; private String color; public Car(String type, String color) &#123; this.type = type; this.color = color; &#125; @SneakyThrows public static void main(String[] args) &#123; Car car = new Car(&quot;BMW&quot;, &quot;Red&quot;); String json = new ObjectMapper() .registerModule( new SimpleModule( &quot;CustomCarSerializer&quot;, new Version(1, 0, 0, null, null, null) ).addSerializer(Car.class, new CustomCarSerializer())) .writeValueAsString(car); System.out.println(json); //result:&#123;&quot;car_brand&quot;:&quot;BMW&quot;&#125; &#125;&#125; è¿™æ˜¯è‡ªå®šä¹‰JSONååºåˆ—åŒ–çš„ç¤ºä¾‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738package com.yiyi.advanced;import com.fasterxml.jackson.core.JsonParser;import com.fasterxml.jackson.core.JsonProcessingException;import com.fasterxml.jackson.core.ObjectCodec;import com.fasterxml.jackson.core.TreeNode;import com.fasterxml.jackson.databind.DeserializationContext;import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.deser.std.StdDeserializer;import java.io.IOException;/** * @author wuxuan.chai * @date 2020/6/8 4:59 ä¸‹åˆ */public class CustomCarDeserializer extends StdDeserializer&lt;Car&gt; &#123; protected CustomCarDeserializer(Class&lt;?&gt; vc) &#123; super(vc); &#125; public CustomCarDeserializer()&#123; this(null); &#125; @Override public Car deserialize(JsonParser p, DeserializationContext ctxt) throws IOException, JsonProcessingException &#123; Car car = new Car(); ObjectCodec codec = p.getCodec(); JsonNode treeNode = codec.readTree(p); JsonNode colorNode = treeNode.get(&quot;color&quot;); String color = colorNode.asText(); car.setColor(color); return car; &#125;&#125; æ­¤è‡ªå®šä¹‰ååºåˆ—åŒ–å™¨å¯ä»¥è¿™æ ·è°ƒç”¨ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.advanced;import com.fasterxml.jackson.core.Version;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.module.SimpleModule;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 3:59 ä¸‹åˆ */@Data@ToString@EqualsAndHashCodepublic class Car &#123; private String type; private String color; public Car(String type, String color) &#123; this.type = type; this.color = color; &#125; public Car() &#123; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;color\\&quot;: \\&quot;Red\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;: \\&quot;BMW\\&quot;&quot;+ &quot; &#125;&quot;; Car car = new ObjectMapper() .registerModule( new SimpleModule( &quot;CustomCarDeserializer&quot;, new Version(1, 0, 0, null, null, null) ).addDeserializer(Car.class, new CustomCarDeserializer())) .readValue(json, Car.class); System.out.println(car); //result: Car(type=null, color=Red) &#125;&#125; 3.3ã€Date æ ¼å¼åŒ–çš„å¤„ç†æ–¹å¼java.util.Dateçš„é»˜è®¤åºåˆ—åŒ–äº§ç”Ÿä¸€ä¸ªæ•°å­—ï¼Œå³çºªå…ƒæ—¶é—´æˆ³ï¼ˆè‡ª1970å¹´1æœˆ1æ—¥èµ·ï¼Œä»¥UTCä¸ºå•ä½çš„æ¯«ç§’æ•°ï¼‰ã€‚ ä½†è¿™ä¸æ˜¯äººç±»å¯è¯»çš„ï¼Œå¹¶ä¸”éœ€è¦è¿›ä¸€æ­¥è½¬æ¢ä»¥äººç±»å¯è¯»çš„æ ¼å¼æ˜¾ç¤ºã€‚ è®©æˆ‘ä»¬ä½¿ç”¨datePurchasedå±æ€§å°†åˆ°ç›®å‰ä¸ºæ­¢ä½¿ç”¨çš„Carå®ä¾‹åŒ…è£…åœ¨Requestç±»ä¸­ï¼š 12345678910111213141516package com.yiyi.advanced;import lombok.Data;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 5:12 ä¸‹åˆ */@Datapublic class Request &#123; private Car car; private Date createDate;&#125; æ§åˆ¶æ—¥æœŸçš„å­—ç¬¦ä¸²æ ¼å¼ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸ºä¾‹å¦‚ yyyy-MM-dd HH:mm a zï¼Œè¯·è€ƒè™‘ä»¥ä¸‹ä»£ç æ®µï¼š 12345678910111213141516171819202122232425262728293031323334353637383940package com.yiyi.advanced;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import java.text.SimpleDateFormat;import java.util.Date;/** * @author wuxuan.chai * @date 2020/6/8 5:12 ä¸‹åˆ */@Datapublic class Request &#123; private Car car; private Date createDate; public Request() &#123; &#125; public Request(Car car, Date createDate) &#123; this.car = car; this.createDate = createDate; &#125; @SneakyThrows public static void main(StrinDeserializationFeatureg[] args) &#123; Car car = new Car(&quot;BMW&quot;, &quot;Red&quot;); Request request = new Request(car,new Date()); SimpleDateFormat simpleDateFormat = new SimpleDateFormat(&quot;yyyy-MM-dd HH:mm a z&quot;); ObjectMapper objectMapper = new ObjectMapper().setDateFormat(simpleDateFormat); String json = objectMapper.writeValueAsString(request); System.out.println(json); //result: &#123;&quot;car&quot;:&#123;&quot;type&quot;:&quot;BMW&quot;,&quot;color&quot;:&quot;Red&quot;&#125;,&quot;createDate&quot;:&quot;2020-06-08 17:16 ä¸‹åˆ CST&quot;&#125; &#125;&#125; æ›´å¤šçš„æ—¶é—´æ ¼å¼åŒ–çš„æ–¹å¼å‚è€ƒï¼šæ·±å…¥å­¦ä¹ æ—¥æœŸæ ¼å¼åŒ– 3.4ã€é›†åˆçš„å¤„ç†æ–¹å¼DeserializationFeatureç±»æä¾›çš„å¦ä¸€ä¸ªå°è€Œæœ‰ç”¨çš„åŠŸèƒ½æ˜¯èƒ½å¤Ÿæ ¹æ®JSONæ•°ç»„å“åº”ç”Ÿæˆæ‰€éœ€ç±»å‹çš„é›†åˆçš„åŠŸèƒ½ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ç»“æœç”Ÿæˆä¸ºæ•°ç»„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950package com.yiyi.advanced;import com.fasterxml.jackson.core.Version;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.module.SimpleModule;import lombok.Data;import lombok.EqualsAndHashCode;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 3:59 ä¸‹åˆ */@Data@ToString@EqualsAndHashCodepublic class Car &#123; private String type; private String color; public Car(String type, String color) &#123; this.type = type; this.color = color; &#125; public Car() &#123; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;[\\n&quot; + &quot; &#123;\\n&quot; + &quot; \\&quot;color\\&quot;:\\&quot;Red\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;:\\&quot;BMW\\&quot;\\n&quot; + &quot; &#125;,\\n&quot; + &quot; &#123;\\n&quot; + &quot; \\&quot;color\\&quot;:\\&quot;Black\\&quot;,\\n&quot; + &quot; \\&quot;type\\&quot;:\\&quot;audi\\&quot;\\n&quot; + &quot; &#125;\\n&quot; + &quot;]&quot;; //ä¹Ÿå¯ä»¥å†™æˆï¼š objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, true); ObjectMapper objectMapper = new ObjectMapper().enable(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY); Car[] cars = objectMapper.readValue(json, Car[].class); List&lt;Car&gt; carList = objectMapper.readValue(json,new TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;); &#125;&#125; å››ã€Jacksonåºåˆ—åŒ–æ˜¯å¿½ç•¥å±æ€§4.1ã€ç®€ä»‹æœ¬ç« å°†å±•ç¤ºåœ¨ä½¿ç”¨Jackson 2.xå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºJSONæ—¶å¦‚ä½•å¿½ç•¥æŸäº›å­—æ®µã€‚å½“Jacksoné»˜è®¤å€¼è¿˜ä¸å¤Ÿï¼Œå¹¶ä¸”æˆ‘ä»¬éœ€è¦ç²¾ç¡®æ§åˆ¶è¦åºåˆ—åŒ–ä¸ºJSONçš„å†…å®¹æ—¶ï¼Œè¿™éå¸¸æœ‰ç”¨-å¹¶ä¸”æœ‰å‡ ç§æ–¹æ³•å¯ä»¥å¿½ç•¥å±æ€§ã€‚ 4.2ã€åœ¨ç±»çº§åˆ«ä¸Šå¿½ç•¥å­—æ®µæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonIgnorePropertiesæ‰¹æ³¨å¹¶æŒ‰åç§°æŒ‡å®šå­—æ®µï¼Œä»è€Œåœ¨ç±»çº§åˆ«å¿½ç•¥ç‰¹å®šå­—æ®µï¼š 123456789101112131415161718192021222324252627282930313233package com.yiyi.ignoreField;import com.fasterxml.jackson.annotation.JsonIgnoreProperties;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 5:32 ä¸‹åˆ */@Data@JsonIgnoreProperties(&#123;&quot;intValue&quot;&#125;)public class MyDto &#123; private String stringValue; private int intValue; private Boolean booleanValue; public MyDto(String stringValue, int intValue, Boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDto myDto = new MyDto(&quot;wuxuan&quot;, 12, false); String json = new ObjectMapper().writeValueAsString(myDto); System.out.println(json); //result: &#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;booleanValue&quot;:false&#125; &#125;&#125; è¦æ¯«æ— ä¾‹å¤–åœ°å¿½ç•¥JSONè¾“å…¥ä¸­çš„ä»»ä½•æœªçŸ¥å±æ€§ï¼Œæˆ‘ä»¬å¯ä»¥è®¾ç½®@JsonIgnorePropertiesæ‰¹æ³¨çš„ignoreUnknown = trueã€‚ 4.3ã€åœ¨å­—æ®µçº§åˆ«ä¸Šå¿½ç•¥å­—æ®µæˆ‘ä»¬ä¹Ÿå¯ä»¥ç›´æ¥é€šè¿‡@JsonIgnoreæ‰¹æ³¨ç›´æ¥å¿½ç•¥è¯¥å­—æ®µï¼š 1234567891011121314151617181920212223242526272829303132333435package com.yiyi.ignoreField;import com.fasterxml.jackson.annotation.JsonIgnore;import com.fasterxml.jackson.annotation.JsonIgnoreProperties;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 5:32 ä¸‹åˆ */@Datapublic class MyDto &#123; private String stringValue; private int intValue; @JsonIgnore private Boolean booleanValue; public MyDto(String stringValue, int intValue, Boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDto myDto = new MyDto(&quot;wuxuan&quot;, 12, false); String json = new ObjectMapper().writeValueAsString(myDto); System.out.println(json); //resultï¼š&#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;intValue&quot;:12&#125; &#125;&#125; 4.4ã€é€šè¿‡ç±»å‹å¿½ç•¥æ‰€æœ‰å­—æ®µæœ€åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨@JsonIgnoreTypeæ‰¹æ³¨å¿½ç•¥æŒ‡å®šç±»å‹çš„æ‰€æœ‰å­—æ®µã€‚ å¦‚æœæˆ‘ä»¬æ§åˆ¶ç±»å‹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ç›´æ¥æ³¨è§£ç±»ï¼š 12345678910111213141516171819202122232425262728293031package com.yiyi.ignoreField;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 5:42 ä¸‹åˆ */@Datapublic class SomeType &#123; private String type; private MyDto myDto; public SomeType(String type, MyDto myDto) &#123; this.type = type; this.myDto = myDto; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDto wuxuan = new MyDto(&quot;wuxuan&quot;, 1, false); SomeType type = new SomeType(&quot;www&quot;, wuxuan); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writeValueAsString(type); System.out.println(json); //result:&#123;&quot;type&quot;:&quot;www&quot;&#125; &#125;&#125; ä½†æ˜¯ï¼Œæˆ‘ä»¬å¸¸å¸¸æ— æ³•æ§åˆ¶ç±»æœ¬èº«ï¼› åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å……åˆ†åˆ©ç”¨Jacksonçš„æ··å…¥æ³¨è§£ã€‚é¦–å…ˆï¼Œæˆ‘ä»¬ä¸ºè¦å¿½ç•¥çš„ç±»å‹å®šä¹‰ä¸€ä¸ªMixInï¼Œç„¶åä½¿ç”¨@JsonIgnoreTypeå¯¹å…¶è¿›è¡Œæ³¨è§£ï¼š 123456789101112package com.yiyi.ignoreField;import com.fasterxml.jackson.annotation.JsonIgnoreType;/** * @author wuxuan.chai * @date 2020/6/8 5:47 ä¸‹åˆ */@JsonIgnoreTypepublic class MyMixinForIgnoreType &#123;&#125; ç„¶åï¼Œæˆ‘ä»¬åœ¨ç¼–ç»„æœŸé—´æ³¨å†Œè¯¥mixinæ¥æ›¿æ¢ï¼ˆå¹¶å¿½ç•¥ï¼‰æ‰€æœ‰String[]ç±»å‹ï¼š 123456789101112package com.yiyi.ignoreField;import com.fasterxml.jackson.annotation.JsonIgnoreType;/** * @author wuxuan.chai * @date 2020/6/8 5:47 ä¸‹åˆ */@JsonIgnoreTypepublic class MyMixinForIgnoreType &#123;&#125; 123456789101112131415161718192021222324252627282930313233package com.yiyi.ignoreField;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 5:57 ä¸‹åˆ */@Datapublic class MyDtoWithSpecialField &#123; private String[] stringValue; private int intValue; private boolean booleanValue; public MyDtoWithSpecialField(String[] stringValue, int intValue, boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDtoWithSpecialField myDtoWithSpecialField = new MyDtoWithSpecialField(new String[]&#123;&quot;1&quot;, &quot;2&quot;&#125;, 1, false); ObjectMapper objectMapper = new ObjectMapper().addMixIn(String[].class, MyMixinForIgnoreType.class); String json = objectMapper.writeValueAsString(myDtoWithSpecialField); System.out.println(json); //result: &#123;&quot;intValue&quot;:1,&quot;booleanValue&quot;:false&#125; &#125;&#125; 4.5ã€é€šè¿‡è¿‡æ»¤å™¨å¿½ç•¥å­—æ®µæœ€åï¼Œæˆ‘ä»¬è¿˜å¯ä»¥ä½¿ç”¨è¿‡æ»¤å™¨æ¥å¿½ç•¥Jacksonä¸­çš„ç‰¹å®šå­—æ®µã€‚ é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åœ¨Javaå¯¹è±¡ä¸Šå®šä¹‰è¿‡æ»¤å™¨,å»é™¤æ‰nameå±æ€§ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package com.yiyi.ignoreField;import com.fasterxml.jackson.annotation.JsonFilter;import com.fasterxml.jackson.databind.ObjectMapper;import com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;import com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 6:03 ä¸‹åˆ */@JsonFilter(&quot;myFilter&quot;)@Datapublic class MyDtoFilter &#123; private String type; private String name; public MyDtoFilter(String type, String name) &#123; this.type = type; this.name = name; &#125; public MyDtoFilter() &#123; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDtoFilter myDtoFilter = new MyDtoFilter(&quot;BMW&quot;, &quot;x5&quot;); SimpleBeanPropertyFilter filter = SimpleBeanPropertyFilter.serializeAllExcept(&quot;name&quot;); SimpleFilterProvider myFilter = new SimpleFilterProvider().addFilter(&quot;myFilter&quot;, filter); ObjectMapper objectMapper = new ObjectMapper(); String json = objectMapper.writer(myFilter).writeValueAsString(myDtoFilter); System.out.println(json); //result:&#123;&quot;type&quot;:&quot;BMW&quot;&#125; &#125;&#125; äº”ã€åœ¨Jacksonä¸­å¿½ç•¥å€¼ä¸ºNULLçš„å­—æ®µ5.1ã€ç®€ä»‹æœ¬å¿«é€Ÿç« èŠ‚å°†ä»‹ç»å¦‚ä½•åœ¨åºåˆ—åŒ–Javaç±»æ—¶è®¾ç½®Jacksonä»¥å¿½ç•¥ç©ºå­—æ®µã€‚ 5.2ã€åœ¨ç±»ä¸Šå¿½ç•¥NULLå­—æ®µ12@JsonInclude(Include.NON_NULL)public class MyDto &#123; ... &#125; æˆ–è€…-æ›´ç»†ç²’åº¦ä¸Šè®²-åœ¨å­—æ®µçº§çº§ï¼š 12345public class MyDto&#123; @JsonInclude(Include.NON_NULL) private String value; private int number;&#125; 4.3. å…¨å±€å¿½ç•¥NULLçš„å­—æ®µJacksonè¿˜å…è®¸åœ¨ObjectMapperä¸Šå…¨å±€é…ç½®æ­¤è¡Œä¸ºï¼š 12345678public class MyDtoTest&#123; @Test public void testNullField() &#123; ObjectMapper mapper = new ObjectMapper().setSerializationInclusion(Include.NON_NULL); ... &#125; &#125; å¿½ç•¥ç©ºå­—æ®µæ˜¯ä¸€ç§å¸¸è§çš„Jacksoné…ç½®ï¼Œå› ä¸ºé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦æ›´å¥½åœ°æ§åˆ¶JSONè¾“å‡ºã€‚ æœ¬ç« è¯´æ˜å¦‚ä½•å¯¹ç±»è¿›è¡Œæ­¤æ“ä½œã€‚ ä½†æ˜¯ï¼Œè¿˜æœ‰æ›´é«˜çº§çš„ç”¨ä¾‹ï¼Œä¾‹å¦‚åœ¨åºåˆ—åŒ–Mapæ—¶å¿½ç•¥ç©ºå€¼ã€‚ å…­ã€Jacksonæ›´æ”¹å­—æ®µçš„åç§°6.1ã€ç®€ä»‹æœ¬å¿«é€Ÿç« èŠ‚è¯´æ˜äº†å¦‚ä½•æ›´æ”¹å­—æ®µåç§°ä»¥åœ¨åºåˆ—åŒ–æ—¶æ˜ å°„åˆ°å¦ä¸€ä¸ªJSONå±æ€§ã€‚ 6.2ã€æ›´æ”¹è¦åºåˆ—åŒ–çš„å­—æ®µåç§°ä»¥MyDtoç±»ä¸ºä¾‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839package com.yiyi.changeFieldName;import com.fasterxml.jackson.annotation.JsonProperty;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 6:18 ä¸‹åˆ */@Datapublic class MyDto &#123; private String value; private String name; public MyDto(String value, String name) &#123; this.value = value; this.name = name; &#125; public MyDto() &#123; &#125; @JsonProperty(&quot;value_fact&quot;) public String getValue()&#123; return value; &#125; @SneakyThrows public static void main(String[] args) &#123; MyDto myDto = new MyDto(&quot;sfsd&quot;, &quot;www&quot;); String json = new ObjectMapper().writeValueAsString(myDto); System.out.println(json); //result: &#123;&quot;name&quot;:&quot;www&quot;,&quot;value_fact&quot;:&quot;sfsd&quot;&#125; &#125;&#125; ä¸ƒã€Jacksonç”¨æœªçŸ¥å±æ€§ååºåˆ—åŒ–JSON7.1ã€ç®€ä»‹åœ¨æœ¬ç« ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶Jackson 2.xçš„è§£ç»„è¿‡ç¨‹ï¼Œç‰¹åˆ«æ˜¯å¦‚ä½•å¤„ç†å…·æœ‰æœªçŸ¥å±æ€§çš„JSONå†…å®¹ã€‚ 7.2ã€ä½¿ç”¨å…¶ä»–/æœªçŸ¥å­—æ®µååºåˆ—åŒ–JSONJSONè¾“å…¥æœ‰å„ç§å½¢æ€å’Œå¤§å°-åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶æ˜ å°„åˆ°å…·æœ‰ä¸€å®šæ•°é‡å­—æ®µçš„é¢„å®šä¹‰Javaå¯¹è±¡ã€‚ ç›®æ ‡æ˜¯ç®€å•åœ°å¿½ç•¥æ‰€æœ‰æ— æ³•æ˜ å°„åˆ°ç°æœ‰Javaå­—æ®µçš„JSONå±æ€§ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦å°†JSONè§£ç»„åˆ°ä»¥ä¸‹Javaå®ä½“ï¼š 123456789101112131415161718192021222324package com.yiyi.unmarshall;import lombok.Data;/** * @author wuxuan.chai * @date 2020/6/8 6:25 ä¸‹åˆ */@Datapublic class MyDto &#123; private String stringValue; private int intValue; private boolean booleanValue; public MyDto() &#123; &#125; public MyDto(String stringValue, int intValue, boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125;&#125; 7.3ã€æœªçŸ¥å­—æ®µä¸Šçš„UnrecognizedPropertyExceptionå°è¯•å°†å…·æœ‰æœªçŸ¥å±æ€§çš„JSONååºåˆ—åŒ–åˆ°æ­¤ç®€å•Javaå®ä½“å°†å¯¼è‡´com.fasterxml.jackson.databind.exc.UnrecognizedPropertyExceptionï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647package com.yiyi.unmarshall;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;/** * @author wuxuan.chai * @date 2020/6/8 6:25 ä¸‹åˆ */@Datapublic class MyDto &#123; private String stringValue; private int intValue; private boolean booleanValue; public MyDto() &#123; &#125; public MyDto(String stringValue, int intValue, boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;stringValue\\&quot;: \\&quot;wuxuan\\&quot;,\\n&quot; + &quot; \\&quot;intValue\\&quot;: 1,\\n&quot; + &quot; \\&quot;booleanValue111\\&quot;: false\\n&quot; + &quot;&#125;&quot;; ObjectMapper objectMapper = new ObjectMapper(); MyDto myDto = objectMapper.readValue(json, MyDto.class); //throw UnrecognizedPropertyException å¼‚å¸¸ /** * Unrecognized field &quot;booleanValue111&quot; (class com.yiyi.unmarshall.MyDto), not marked as ignorable (3 known properties: &quot;stringValue&quot;, &quot;booleanValue&quot;, &quot;intValue&quot;]) * at [Source: (String)&quot;&#123; * &quot;stringValue&quot;: &quot;wuxuan&quot;, * &quot;intValue&quot;: 1, * &quot;booleanValue111&quot;: false * &#125;&quot;; line: 4, column: 29] (through reference chain: com.yiyi.unmarshall.MyDto[&quot;booleanValue111&quot;]) */ &#125;&#125; 7.4ã€é€šè¿‡è®¾ç½®ObjectMapperå¤„ç†æœªçŸ¥å­—æ®µçš„å¼‚å¸¸ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥é…ç½®å®Œæ•´çš„ObjectMapperä»¥å¿½ç•¥JSONä¸­çš„æœªçŸ¥å±æ€§ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849package com.yiyi.unmarshall;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 6:25 ä¸‹åˆ */@Data@ToStringpublic class MyDto &#123; private String stringValue; private int intValue; private boolean booleanValue; public MyDto() &#123; &#125; public MyDto(String stringValue, int intValue, boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;stringValue\\&quot;: \\&quot;wuxuan\\&quot;,\\n&quot; + &quot; \\&quot;intValue\\&quot;: 1,\\n&quot; + &quot; \\&quot;booleanValue111\\&quot;: true\\n&quot; + &quot;&#125;&quot;; ObjectMapper objectMapper = new ObjectMapper(); //ä¹Ÿå¯ä»¥å†™æˆï¼šobjectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false); objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES); MyDto myDto = objectMapper.readValue(json, MyDto.class); System.out.println(myDto); //result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false) // booleanValue=false æ˜¯å¯¹è±¡çš„å±æ€§çš„é»˜è®¤å€¼ï¼Œå› ä¸ºbooleanValue æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¸æ˜¯åŒ…è£…ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºfalse &#125;&#125; 7.5ã€é€šè¿‡ç±»ä¸Šæ³¨è§£å¤„ç†æœªçŸ¥å­—æ®µæˆ‘ä»¬è¿˜å¯ä»¥å°†å•ä¸ªç±»æ ‡è®°ä¸ºæ¥å—æœªçŸ¥å­—æ®µï¼Œè€Œä¸æ˜¯æ•´ä¸ªJacksonå¯¹è±¡æ˜ å°„å™¨ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748package com.yiyi.unmarshall;import com.fasterxml.jackson.annotation.JsonIgnoreProperties;import com.fasterxml.jackson.databind.DeserializationFeature;import com.fasterxml.jackson.databind.ObjectMapper;import lombok.Data;import lombok.SneakyThrows;import lombok.ToString;/** * @author wuxuan.chai * @date 2020/6/8 6:25 ä¸‹åˆ */@Data@ToString@JsonIgnoreProperties(ignoreUnknown = true)public class MyDto &#123; private String stringValue; private int intValue; private boolean booleanValue; public MyDto() &#123; &#125; public MyDto(String stringValue, int intValue, boolean booleanValue) &#123; this.stringValue = stringValue; this.intValue = intValue; this.booleanValue = booleanValue; &#125; @SneakyThrows public static void main(String[] args) &#123; String json = &quot;&#123;\\n&quot; + &quot; \\&quot;stringValue\\&quot;: \\&quot;wuxuan\\&quot;,\\n&quot; + &quot; \\&quot;intValue\\&quot;: 1,\\n&quot; + &quot; \\&quot;booleanValue111\\&quot;: true\\n&quot; + &quot;&#125;&quot;; ObjectMapper objectMapper = new ObjectMapper(); MyDto myDto = objectMapper.readValue(json, MyDto.class); System.out.println(myDto); //result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false) // booleanValue=false æ˜¯å¯¹è±¡çš„å±æ€§çš„é»˜è®¤å€¼ï¼Œå› ä¸ºbooleanValue æ˜¯åŸºæœ¬ç±»å‹ï¼Œä¸æ˜¯åŒ…è£…ç±»å‹ï¼Œé»˜è®¤å€¼ä¸ºfalse &#125;&#125; å…«ã€æ€»ç»“åˆæ¬¡ç³»ç»Ÿçš„å­¦ä¹ Jacksonçš„ä½¿ç”¨æ–¹å¼ï¼Œæ„Ÿå—åˆ°äº†Jacksonç‰¹åˆ«çµæ´»ï¼Œå®šåˆ¶åŒ–å¼ºçš„ç‰¹ç‚¹ï¼Œé’ˆå¯¹äºæ—¥å¸¸çš„ä¸šåŠ¡éœ€æ±‚ï¼Œå·²ç»è¶³å¤Ÿäº†ã€‚æ›´è®©äººæƒŠè®¶çš„æ˜¯è‡ªå®šä¹‰çš„Jacksonæ³¨è§£ï¼Œæ›´æ˜¯è®©Jacksonå¦‚è™æ·»ç¿¼ã€‚","categories":[{"name":"è¯¦ç»†æ•™ç¨‹","slug":"è¯¦ç»†æ•™ç¨‹","permalink":"https://cha1yi.github.io/dist/categories/%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/"}],"tags":[{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/tags/Java/"}],"author":"wuxuan.chai"},{"title":"SQLè¯­å¥æ¦‚å¿µç®€å•æ•´ç†","slug":"SQLè¯­å¥æ¦‚å¿µç®€å•æ•´ç†","date":"2021-01-17T15:44:30.693Z","updated":"2021-06-05T14:56:50.444Z","comments":true,"path":"2021/01/17/SQLè¯­å¥æ¦‚å¿µç®€å•æ•´ç†/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/17/SQL%E8%AF%AD%E5%8F%A5%E6%A6%82%E5%BF%B5%E7%AE%80%E5%8D%95%E6%95%B4%E7%90%86/","excerpt":"","text":"ä¸€ã€SQLè¯­è¨€å…±åˆ†ä¸ºå››å¤§ç±» æ•°æ®æŸ¥è¯¢è¯­è¨€DQL æ•°æ®æ“çºµè¯­è¨€DML æ•°æ®å®šä¹‰è¯­è¨€DDL æ•°æ®æ§åˆ¶è¯­è¨€DCLã€‚ äºŒã€ç®€è¦æè¿°è¿™å››ç±»1ã€æ•°æ®æŸ¥è¯¢è¯­è¨€DQLæ•°æ®æŸ¥è¯¢è¯­è¨€DQLåŸºæœ¬ç»“æ„æ˜¯ç”±SELECTå­å¥ï¼ŒFROMå­å¥ï¼ŒWHEREå­å¥ç»„æˆçš„æŸ¥è¯¢å—ï¼šSELECT &lt;å­—æ®µåè¡¨&gt;FROM &lt;è¡¨æˆ–è§†å›¾å&gt;WHERE &lt;æŸ¥è¯¢æ¡ä»¶&gt; 2ã€æ•°æ®æ“çºµè¯­è¨€DMLæ•°æ®æ“çºµè¯­è¨€DMLä¸»è¦æœ‰ä¸‰ç§å½¢å¼ï¼š æ’å…¥ï¼šINSERT æ›´æ–°ï¼šUPDATE åˆ é™¤ï¼šDELETEï¼ˆåˆ é™¤è¡¨ä¸­çš„æ•°æ®ä¸åˆ é™¤è¡¨ç»“æ„ï¼Œå¯ä»¥å›æ»šï¼‰ 3ã€æ•°æ®å®šä¹‰è¯­è¨€DDL CREATEï¼šåˆ›å»º ALTERï¼šä¿®æ”¹è¡¨ç»“æ„ RENAMEï¼šä¿®æ”¹è¡¨åæˆ–åˆ—å DROPï¼šåˆ é™¤è¡¨ä¸­çš„æ•°æ®å’Œç»“æ„ï¼Œåˆ é™¤åä¸èƒ½å›æ»š TRUNCATEï¼šåˆ é™¤è¡¨ä¸­çš„æ•°æ®ä¸åˆ é™¤è¡¨ç»“æ„ï¼Œåˆ é™¤åä¸èƒ½å›æ»šï¼Œæ•ˆç‡æ¯”DELETEé«˜ 4ã€æ•°æ®æ§åˆ¶è¯­è¨€DCL GRANTï¼šæˆæƒ REVOKE ï¼šå›æ”¶æƒé™ è¿˜æœ‰äº‹åŠ¡æ§åˆ¶è¯­å¥TCLï¼š SAVEPOINTï¼šä¿å­˜ç‚¹ ROLLBACKï¼šå›é€€åˆ°æŸç‚¹ COMMITï¼šæäº¤äº‹åŠ¡","categories":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"}],"tags":[{"name":"SQL","slug":"SQL","permalink":"https://cha1yi.github.io/dist/tags/SQL/"}],"author":"wuxuan.chai"},{"title":"è®¾è®¡æ¨¡å¼ä¹‹----å·¥å‚æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼ä¹‹----å·¥å‚æ¨¡å¼","date":"2021-01-17T15:37:18.288Z","updated":"2021-06-05T14:57:20.281Z","comments":true,"path":"2021/01/17/è®¾è®¡æ¨¡å¼ä¹‹----å·¥å‚æ¨¡å¼/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/17/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B----%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/","excerpt":"","text":"è®¾è®¡æ¨¡å¼ä¹‹â€”-å·¥å‚æ¨¡å¼å·¥å‚æ¨¡å¼ï¼ˆFactory Patternï¼‰æ˜¯javaä¸­æœ€å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ä¹‹ä¸€ï¼Œè¿™ç§ç±»å‹è®¾è®¡æ¨¡å¼å±äºåˆ›å»ºå‹æ¨¡å¼ï¼Œå®ƒæä¾›äº†ä¸€ç§åˆ›å»ºå¯¹è±¡çš„æœ€ä½³æ–¹å¼ã€‚åœ¨å·¥å‚æ¨¡å¼ä¸­ï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºå¯¹è±¡æ˜¯ä¸ä¼šå¯¹å®¢æˆ·æš´éœ²åˆ›å»ºé€»è¾‘ï¼Œå¹¶ä¸”æ˜¯é€šè¿‡ä½¿ç”¨ä¸€ä¸ªå…±åŒçš„æ¥å£ï¼Œä»¥æ­¤æ¥è¾¾åˆ°è§£è€¦çš„ç›®çš„ã€‚ ä¸‹é¢çš„ä¾‹å­ä»¥é€ è½¦ä¸ºä¾‹æ¥è¯´æ˜ä¸‰ç§æ¨¡å¼ã€‚ åˆ†ç±»1ã€ç®€å•å·¥å‚æ¨¡å¼ (Simple Factory)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748public abstract class Car &#123;&#125;public enum CarType &#123; BMW, AUDI, DAZHONG;&#125;public class BmwCar extends Car&#123; public BmwCar()&#123; System.out.println(&quot;è¿™æ˜¯å®é©¬è½¦&quot;); &#125;&#125;public class AudiCar extends Car&#123; public AudiCar()&#123; System.out.println(&quot;è¿™æ˜¯å¥¥è¿ªè½¦&quot;); &#125;&#125;public class DaZhongCar extends Car &#123; public DaZhongCar() &#123; System.out.println(&quot;è¿™æ˜¯å¤§ä¼—è½¦&quot;); &#125;&#125;public class CarFactory &#123; /** * é™æ€å·¥å‚æ–¹æ³• * * @param carType è½¦çš„ç±»å‹ * @return è½¦çš„å¯¹è±¡ */ public static Car createCar(CarType carType) &#123; switch (carType) &#123; case BMW: return new BmwCar(); case AUDI: return new AudiCar(); case DAZHONG: return new DaZhongCar(); default: return null; &#125; &#125; public static void main(String[] args) &#123; CarFactory.createCar(CarType.AUDI); &#125;&#125; è¾“å‡ºï¼š 123è¿™æ˜¯å¥¥è¿ªè½¦Process finished with exit code 0 è¿™ç§å·¥å‚æ¨¡å¼ï¼Œå·²ç»å®Œæˆäº†æˆ‘ä»¬å·¥å‚æ¨¡å¼çš„åŸºæœ¬çš„éœ€æ±‚ï¼Œåˆ›å»ºå¯¹è±¡å’Œè§£è€¦ç¼ºç‚¹ï¼š1ã€ç”¨æˆ·è°ƒç”¨éœ€è¦çŸ¥é“è‡ªå·±è¦åˆ›å»ºçš„å¯¹è±¡åœ¨å·¥å‚ä¸­çš„ç±»å‹2ã€æ‹“å±•å¾ˆéº»çƒ¦ï¼Œå¦‚æœæ–°å¢ä¸€ä¸ªäº§å“ï¼Œéœ€è¦åœ¨äº§å“çš„å…·ä½“åˆ›å»ºå¯¹è±¡çš„å®ç°ï¼Œè¿˜éœ€ä½¿å·¥å‚æ”¯æŒåˆ›å»ºè¿™ç§äº§å“ï¼Œè¿™æ˜¾ç„¶æ˜¯è¿èƒŒå¼€é—­åŸåˆ™çš„ 2ã€å·¥å‚æ–¹æ³•æ¨¡å¼ï¼ˆFactory Methodï¼‰123456789101112131415161718192021222324252627282930313233public interface Factory &#123; /** * ç”Ÿäº§è½¦çš„æ–¹æ³• * @return è½¦çš„å¯¹è±¡ */ Car createCar();&#125;public class AudiFactory implements Factory&#123; @Override public Car createCar() &#123; return new AudiCar(); &#125;&#125;public class BmwFactory implements Factory&#123; @Override public Car createCar() &#123; return new BmwCar(); &#125;&#125;public class DaZhongFactory implements Factory&#123; @Override public Car createCar() &#123; return new DaZhongCar(); &#125;&#125;//å®¢æˆ·ä½¿ç”¨public class ConsumerTest &#123; public static void main(String[] args) &#123; final BmwFactory bmwFactory = new BmwFactory(); bmwFactory.createCar(); &#125;&#125; è¾“å‡ºï¼š 123è¿™æ˜¯å®é©¬è½¦Process finished with exit code 0 å·¥å‚æ–¹æ³•æ¨¡å¼ç»„æˆï¼š 1)æŠ½è±¡å·¥å‚è§’è‰²ï¼š è¿™æ˜¯å·¥å‚æ–¹æ³•æ¨¡å¼çš„æ ¸å¿ƒï¼Œå®ƒä¸åº”ç”¨ç¨‹åºæ— å…³ã€‚æ˜¯å…·ä½“å·¥å‚è§’è‰²å¿…é¡»å®ç°çš„æ¥å£æˆ–è€…å¿…é¡»ç»§æ‰¿çš„çˆ¶ç±»ã€‚åœ¨javaä¸­å®ƒç”±æŠ½è±¡ç±»æˆ–è€…æ¥å£æ¥å®ç°ã€‚ 2)å…·ä½“å·¥å‚è§’è‰²ï¼šå®ƒå«æœ‰å’Œå…·ä½“ä¸šåŠ¡é€»è¾‘æœ‰å…³çš„ä»£ç ã€‚ç”±åº”ç”¨ç¨‹åºè°ƒç”¨ä»¥åˆ›å»ºå¯¹åº”çš„å…·ä½“äº§å“çš„å¯¹è±¡ã€‚ 3)æŠ½è±¡äº§å“è§’è‰²ï¼šå®ƒæ˜¯å…·ä½“äº§å“ç»§æ‰¿çš„çˆ¶ç±»æˆ–è€…æ˜¯å®ç°çš„æ¥å£ã€‚åœ¨javaä¸­ä¸€èˆ¬æœ‰æŠ½è±¡ç±»æˆ–è€…æ¥å£æ¥å®ç°ã€‚ 4)å…·ä½“äº§å“è§’è‰²ï¼šå…·ä½“å·¥å‚è§’è‰²æ‰€åˆ›å»ºçš„å¯¹è±¡å°±æ˜¯æ­¤è§’è‰²çš„å®ä¾‹ã€‚åœ¨javaä¸­ç”±å…·ä½“çš„ç±»æ¥å®ç°ã€‚ æ–¹æ³•å·¥å‚æ¨¡å¼å’Œç®€å•å·¥å‚æ¨¡å¼æœ€å¤§çš„ä¸åŒï¼Œå°±æ˜¯å°†å®ç°äº¤ç»™äº†å…·ä½“çš„å·¥å‚ï¼Œæ ¸å¿ƒå·¥å‚åªæä¾›äº§å“çº¿ï¼Œå…·ä½“çš„å®ç°å·¥å‚åªéœ€è¦å»å®ç°å¯¹åº”çš„éœ€æ±‚å³å¯ã€‚å¦‚æœæ–°å¢äº§ï¼Œåªéœ€è¦å»å®ç°å¯¹åº”çš„äº§å“å·¥å‚å³å¯ï¼Œæ˜¾ç„¶è¿™ç§æ–¹å¼æ˜¯ç¬¦åˆå¼€é—­åŸåˆ™çš„ 3ã€æŠ½è±¡å·¥å‚æ¨¡å¼ (Abstract Factory)ä¸ªäººè§‰å¾—æŠ½è±¡å·¥å‚æ¨¡å¼å’Œå·¥å‚æ–¹æ³•æ¨¡å¼åŒºåˆ«ä¸æ˜¯å¾ˆå¤§ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061public interface Factory &#123; /** * ç”Ÿäº§è½¦çš„æ–¹æ³• * * @return è½¦çš„å¯¹è±¡ */ Car createCar(); /** * è·å–ä»·é’± * * @return ä»·é’± */ double pricing();&#125;public class AudiFactory implements Factory &#123; @Override public Car createCar() &#123; return new AudiCar(); &#125; @Override public double pricing() &#123; System.out.println(&quot;å®šä»·ï¼š20_0000&quot;); return 20_0000; &#125;&#125;public class BmwFactory implements Factory &#123; @Override public Car createCar() &#123; return new BmwCar(); &#125; @Override public double pricing() &#123; System.out.println(&quot;å®šä»·ï¼š25_0000&quot;); return 25_0000; &#125;&#125;public class DaZhongFactory implements Factory &#123; @Override public Car createCar() &#123; return new DaZhongCar(); &#125; @Override public double pricing() &#123; System.out.println(&quot;å®šä»·ï¼š18_0000&quot;); return 18_0000; &#125;&#125;//å®¢æˆ·ä½¿ç”¨public class ConsumerTest &#123; public static void main(String[] args) &#123; final BmwFactory bmwFactory = new BmwFactory(); bmwFactory.createCar(); bmwFactory.pricing(); &#125;&#125; æ€»ç»“ï¼šæ— è®ºæ˜¯ç®€å•å·¥å‚æ¨¡å¼ï¼Œå·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œè¿˜æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œä»–ä»¬éƒ½å±äºå·¥å‚æ¨¡å¼ï¼Œåœ¨å½¢å¼å’Œç‰¹ç‚¹ä¸Šä¹Ÿæ˜¯æä¸ºç›¸ä¼¼çš„ï¼Œä»–ä»¬çš„æœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸ºäº†è§£è€¦ã€‚åœ¨ä½¿ç”¨æ—¶ï¼Œæˆ‘ä»¬ä¸å¿…å»åœ¨æ„è¿™ä¸ªæ¨¡å¼åˆ°åº•å·¥å‚æ–¹æ³•æ¨¡å¼è¿˜æ˜¯æŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œå› ä¸ºä»–ä»¬ä¹‹é—´çš„æ¼”å˜å¸¸å¸¸æ˜¯ä»¤äººç¢ç£¨ä¸é€çš„ã€‚ç»å¸¸ä½ ä¼šå‘ç°ï¼Œæ˜æ˜ä½¿ç”¨çš„å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œå½“æ–°éœ€æ±‚æ¥ä¸´ï¼Œç¨åŠ ä¿®æ”¹ï¼ŒåŠ å…¥äº†ä¸€ä¸ªæ–°æ–¹æ³•åï¼Œç”±äºç±»ä¸­çš„äº§å“æ„æˆäº†ä¸åŒç­‰çº§ç»“æ„ä¸­çš„äº§å“æ—ï¼Œå®ƒå°±å˜æˆæŠ½è±¡å·¥å‚æ¨¡å¼äº†ï¼›è€Œå¯¹äºæŠ½è±¡å·¥å‚æ¨¡å¼ï¼Œå½“å‡å°‘ä¸€ä¸ªæ–¹æ³•ä½¿çš„æä¾›çš„äº§å“ä¸å†æ„æˆäº§å“æ—ä¹‹åï¼Œå®ƒå°±æ¼”å˜æˆäº†å·¥å‚æ–¹æ³•æ¨¡å¼ã€‚æ‰€ä»¥ï¼Œåœ¨ä½¿ç”¨å·¥å‚æ¨¡å¼æ—¶ï¼Œåªéœ€è¦å…³å¿ƒé™ä½è€¦åˆåº¦çš„ç›®çš„æ˜¯å¦è¾¾åˆ°äº†ã€‚","categories":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://cha1yi.github.io/dist/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"tags":[{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://cha1yi.github.io/dist/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"}],"author":"wuxuan.chai"},{"title":"DOã€DTOã€BOã€VOã€POJOçš„å®šä¹‰","slug":"DOã€DTOã€BOã€VOã€POJOçš„å®šä¹‰","date":"2021-01-17T15:33:00.411Z","updated":"2021-06-05T14:56:50.443Z","comments":true,"path":"2021/01/17/DOã€DTOã€BOã€VOã€POJOçš„å®šä¹‰/","link":"","permalink":"https://cha1yi.github.io/dist/2021/01/17/DO%E3%80%81DTO%E3%80%81BO%E3%80%81VO%E3%80%81POJO%E7%9A%84%E5%AE%9A%E4%B9%89/","excerpt":"","text":"DOã€DTOã€BOã€VOã€POJOçš„å®šä¹‰åˆ†å±‚é¢†åŸŸæ¨¡å‹è§„çº¦DOï¼ˆ Data Objectï¼‰ï¼šä¸æ•°æ®åº“è¡¨ç»“æ„ä¸€ä¸€å¯¹åº”ï¼Œé€šè¿‡DAOå±‚å‘ä¸Šä¼ è¾“æ•°æ®æºå¯¹è±¡ã€‚DTOï¼ˆ Data Transfer Objectï¼‰ï¼šæ•°æ®ä¼ è¾“å¯¹è±¡ï¼ŒServiceæˆ–Managerå‘å¤–ä¼ è¾“çš„å¯¹è±¡ã€‚BOï¼ˆ Business Objectï¼‰ï¼šä¸šåŠ¡å¯¹è±¡ã€‚ ç”±Serviceå±‚è¾“å‡ºçš„å°è£…ä¸šåŠ¡é€»è¾‘çš„å¯¹è±¡ã€‚AOï¼ˆ Application Objectï¼‰ï¼šåº”ç”¨å¯¹è±¡ã€‚ åœ¨Webå±‚ä¸Serviceå±‚ä¹‹é—´æŠ½è±¡çš„å¤ç”¨å¯¹è±¡æ¨¡å‹ï¼Œæä¸ºè´´è¿‘å±•ç¤ºå±‚ï¼Œå¤ç”¨åº¦ä¸é«˜ã€‚VOï¼ˆ View Objectï¼‰ï¼šæ˜¾ç¤ºå±‚å¯¹è±¡ï¼Œé€šå¸¸æ˜¯Webå‘æ¨¡æ¿æ¸²æŸ“å¼•æ“å±‚ä¼ è¾“çš„å¯¹è±¡ã€‚POJOï¼ˆ Plain Ordinary Java Objectï¼‰ï¼šåœ¨æœ¬æ‰‹å†Œä¸­ï¼Œ POJOä¸“æŒ‡åªæœ‰setter/getter/toStringçš„ç®€å•ç±»ï¼ŒåŒ…æ‹¬DO/DTO/BO/VOç­‰ã€‚Queryï¼šæ•°æ®æŸ¥è¯¢å¯¹è±¡ï¼Œå„å±‚æ¥æ”¶ä¸Šå±‚çš„æŸ¥è¯¢è¯·æ±‚ã€‚ æ³¨æ„è¶…è¿‡2ä¸ªå‚æ•°çš„æŸ¥è¯¢å°è£…ï¼Œç¦æ­¢ä½¿ç”¨Mapç±»æ¥ä¼ è¾“ã€‚ é¢†åŸŸæ¨¡å‹å‘½åè§„çº¦æ•°æ®å¯¹è±¡ï¼šxxxDOï¼Œxxxå³ä¸ºæ•°æ®è¡¨åã€‚æ•°æ®ä¼ è¾“å¯¹è±¡ï¼šxxxDTOï¼Œxxxä¸ºä¸šåŠ¡é¢†åŸŸç›¸å…³çš„åç§°ã€‚å±•ç¤ºå¯¹è±¡ï¼šxxxVOï¼Œxxxä¸€èˆ¬ä¸ºç½‘é¡µåç§°ã€‚POJO: ä¸“æŒ‡åªæœ‰ setter / getter / toStringçš„ç®€å•ç±»ï¼ŒåŒ…æ‹¬DO/DTO/BO/VOç­‰,ç¦æ­¢å‘½åæˆ xxxPOJO","categories":[{"name":"ä»£ç è§„èŒƒ","slug":"ä»£ç è§„èŒƒ","permalink":"https://cha1yi.github.io/dist/categories/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"}],"tags":[{"name":"ä»£ç è§„èŒƒ","slug":"ä»£ç è§„èŒƒ","permalink":"https://cha1yi.github.io/dist/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"}],"author":"wuxuan.chai"}],"categories":[{"name":"å·¥ä½œæ•´ç†","slug":"å·¥ä½œæ•´ç†","permalink":"https://cha1yi.github.io/dist/categories/%E5%B7%A5%E4%BD%9C%E6%95%B4%E7%90%86/"},{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"å¼€å‘æ€»ç»“","slug":"å¼€å‘æ€»ç»“","permalink":"https://cha1yi.github.io/dist/categories/%E5%BC%80%E5%8F%91%E6%80%BB%E7%BB%93/"},{"name":"æ“ä½œç³»ç»Ÿ","slug":"æ“ä½œç³»ç»Ÿ","permalink":"https://cha1yi.github.io/dist/categories/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/"},{"name":"æ•°æ®å¤„ç†ç»„ä»¶","slug":"æ•°æ®å¤„ç†ç»„ä»¶","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/categories/Java/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://cha1yi.github.io/dist/categories/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/categories/Spring/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/categories/%E7%AE%97%E6%B3%95/"},{"name":"Docker","slug":"Docker","permalink":"https://cha1yi.github.io/dist/categories/Docker/"},{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"https://cha1yi.github.io/dist/categories/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"},{"name":"é¡¹ç›®ç®¡ç†","slug":"é¡¹ç›®ç®¡ç†","permalink":"https://cha1yi.github.io/dist/categories/%E9%A1%B9%E7%9B%AE%E7%AE%A1%E7%90%86/"},{"name":"è¯¦ç»†æ•™ç¨‹","slug":"è¯¦ç»†æ•™ç¨‹","permalink":"https://cha1yi.github.io/dist/categories/%E8%AF%A6%E7%BB%86%E6%95%99%E7%A8%8B/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://cha1yi.github.io/dist/categories/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"ä»£ç è§„èŒƒ","slug":"ä»£ç è§„èŒƒ","permalink":"https://cha1yi.github.io/dist/categories/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"}],"tags":[{"name":"æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"è¿ç»´","slug":"è¿ç»´","permalink":"https://cha1yi.github.io/dist/tags/%E8%BF%90%E7%BB%B4/"},{"name":"-æ•°æ®åº“","slug":"æ•°æ®åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%BA%93/"},{"name":"æ•°æ®å¤„ç†ç»„ä»¶","slug":"æ•°æ®å¤„ç†ç»„ä»¶","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E5%A4%84%E7%90%86%E7%BB%84%E4%BB%B6/"},{"name":"å¹¶å‘ç¼–ç¨‹","slug":"å¹¶å‘ç¼–ç¨‹","permalink":"https://cha1yi.github.io/dist/tags/%E5%B9%B6%E5%8F%91%E7%BC%96%E7%A8%8B/"},{"name":"å¾®æœåŠ¡","slug":"å¾®æœåŠ¡","permalink":"https://cha1yi.github.io/dist/tags/%E5%BE%AE%E6%9C%8D%E5%8A%A1/"},{"name":"Mac","slug":"Mac","permalink":"https://cha1yi.github.io/dist/tags/Mac/"},{"name":"è®¾è®¡æ¨¡å¼","slug":"è®¾è®¡æ¨¡å¼","permalink":"https://cha1yi.github.io/dist/tags/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"},{"name":"Spring","slug":"Spring","permalink":"https://cha1yi.github.io/dist/tags/Spring/"},{"name":"ç®—æ³•","slug":"ç®—æ³•","permalink":"https://cha1yi.github.io/dist/tags/%E7%AE%97%E6%B3%95/"},{"name":"SQL","slug":"SQL","permalink":"https://cha1yi.github.io/dist/tags/SQL/"},{"name":"docker","slug":"docker","permalink":"https://cha1yi.github.io/dist/tags/docker/"},{"name":"æ•°æ®ä»“åº“","slug":"æ•°æ®ä»“åº“","permalink":"https://cha1yi.github.io/dist/tags/%E6%95%B0%E6%8D%AE%E4%BB%93%E5%BA%93/"},{"name":"kafka","slug":"kafka","permalink":"https://cha1yi.github.io/dist/tags/kafka/"},{"name":"CentOS","slug":"CentOS","permalink":"https://cha1yi.github.io/dist/tags/CentOS/"},{"name":"äº‹ä»¶é©±åŠ¨","slug":"äº‹ä»¶é©±åŠ¨","permalink":"https://cha1yi.github.io/dist/tags/%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8/"},{"name":"VM","slug":"VM","permalink":"https://cha1yi.github.io/dist/tags/VM/"},{"name":"SkyWalking","slug":"SkyWalking","permalink":"https://cha1yi.github.io/dist/tags/SkyWalking/"},{"name":"ç³»ç»Ÿç›‘æ§","slug":"ç³»ç»Ÿç›‘æ§","permalink":"https://cha1yi.github.io/dist/tags/%E7%B3%BB%E7%BB%9F%E7%9B%91%E6%8E%A7/"},{"name":"maven","slug":"maven","permalink":"https://cha1yi.github.io/dist/tags/maven/"},{"name":"Arthas","slug":"Arthas","permalink":"https://cha1yi.github.io/dist/tags/Arthas/"},{"name":"Java","slug":"Java","permalink":"https://cha1yi.github.io/dist/tags/Java/"},{"name":"ä»£ç è§„èŒƒ","slug":"ä»£ç è§„èŒƒ","permalink":"https://cha1yi.github.io/dist/tags/%E4%BB%A3%E7%A0%81%E8%A7%84%E8%8C%83/"}]}