<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Spring的事务方式</title>
      <link href="/dist/2021/02/02/Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%96%B9%E5%BC%8F/"/>
      <url>/dist/2021/02/02/Spring%E7%9A%84%E4%BA%8B%E5%8A%A1%E6%96%B9%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring的事务管理方式"><a href="#Spring的事务管理方式" class="headerlink" title="Spring的事务管理方式"></a>Spring的事务管理方式</h2><p>1、编程式事务，在代码中硬编码。（不推荐使用）</p><p>2、声明式事务，在配置文件中配置。（推荐使用）</p><h3 id="声明式事务的种类："><a href="#声明式事务的种类：" class="headerlink" title="声明式事务的种类："></a>声明式事务的种类：</h3><p>1、基于xml的声明式的事务</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 事务管理器 --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;txManager&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>2、基于注解的声明式的事务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Tag <span class="title">add</span><span class="params">(Tag tag)</span> </span>&#123;</span><br><span class="line">   <span class="comment">//TODO 数据库持久化操作</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="Spring事务的隔离级别"><a href="#Spring事务的隔离级别" class="headerlink" title="Spring事务的隔离级别"></a>Spring事务的隔离级别</h2><p>查看了下，org.springframework.transaction.TransactionDefinition接口，这个接口定义了spring的事务的隔离属性</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.transaction;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义与Spring兼容的事务属性的接口。基于类似于EJB CMT属性的传播行为定义。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * 请注意，除非启动实际的新事务，否则不会应用隔离级别和超时设置。由于只有PROPAGATION_REQUIRED、PROPAGATION_REQUIRES_NEW和PROPAGATION_NESTED会导致这种情况，</span></span><br><span class="line"><span class="comment"> * 因此在其他情况下通常不需要指定这些设置。此外，请注意，并非所有事务管理器都支持这些高级特性，因此在给出非默认值时可能抛出相应的异常。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;</span></span><br><span class="line"><span class="comment"> * read-only标志适用于任何事务上下文，无论是由实际资源事务支持的事务还是在资源级别上进行非事务操作的事务。在后一种情况下，该标志将只应用于应用程序中的托管资源，例如Hibernate会话。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> PlatformTransactionManager#getTransaction(TransactionDefinition)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.transaction.support.DefaultTransactionDefinition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.transaction.interceptor.TransactionAttribute</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 08.05.2003</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">TransactionDefinition</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持当前事务;如果不存在，则创建一个新的。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 这通常是事务定义的默认设置，通常定义事务同步范围。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRED = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持当前事务;如果不存在，则以非事务方式执行。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 注意:对于具有事务同步的事务管理器，PROPAGATION_SUPPORTS与完全没有事务略有不同，因为它定义了同步可能适用的事务范围。</span></span><br><span class="line"><span class="comment">     * 因此，相同的资源(JDBC连接、Hibernate会话等)将在整个指定范围内共享。请注意，确切的行为取决于事务管理器的实际同步配置!</span></span><br><span class="line"><span class="comment">     * 一般情况下，请小心使用PROPAGATION_SUPPORTS!特别地，不要依赖于PROPAGATION_REQUIRED或PROPAGATION_REQUIRES_NEW在PROPAGATION_SUPPORTS范围内(这可能会导致运行时的同步冲突)。</span></span><br><span class="line"><span class="comment">     * 如果这种嵌套是不可避免的，请确保适当地配置事务管理器(通常切换到“在实际事务上同步”)。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.AbstractPlatformTransactionManager#setTransactionSynchronization</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.AbstractPlatformTransactionManager#SYNCHRONIZATION_ON_ACTUAL_TRANSACTION</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_SUPPORTS = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 支持当前事务;如果当前没有事务存在，则抛出异常。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 注意，PROPAGATION_MANDATORY范围内的事务同步将始终由周围的事务驱动。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_MANDATORY = <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 创建一个新事务，挂起当前事务(如果存在的话)。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 注意:实际的事务挂起并不会在所有事务管理器上开箱即用。这尤其适用于org.springframework.transaction.jta.JtaTransactionManager，</span></span><br><span class="line"><span class="comment">     * 它需要javax.transaction.TransactionManager可用(在标准Java EE中是特定于服务器的)。</span></span><br><span class="line"><span class="comment">     * PROPAGATION_REQUIRES_NEW作用域总是定义自己的事务同步。现有的同步将被挂起并适当恢复。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.jta.JtaTransactionManager#setTransactionManager</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_REQUIRES_NEW = <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不支持当前事务;而是总是以非事务的方式执行。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 注意:实际的事务挂起并不会在所有事务管理器上开箱即用。这尤其适用于org.springframework.transaction.jta.JtaTransactionManager，</span></span><br><span class="line"><span class="comment">     * 它需要javax.transaction.TransactionManager可用(在标准Java EE中是特定于服务器的)。</span></span><br><span class="line"><span class="comment">     * 注意，事务同步在PROPAGATION_NOT_SUPPORTED范围内不可用。现有的同步将被挂起并适当恢复。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.jta.JtaTransactionManager#setTransactionManager</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NOT_SUPPORTED = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 不支持当前事务;如果当前事务存在，则抛出异常。类似于同名的EJB事务属性。</span></span><br><span class="line"><span class="comment">     * 注意，事务同步在PROPAGATION_NEVER范围内不可用。</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NEVER = <span class="number">5</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 如果当前事务存在，则在嵌套事务中执行，否则行为类似于PROPAGATION_REQUIRED。EJB中没有类似的特性。</span></span><br><span class="line"><span class="comment">     * 注意:嵌套事务的实际创建只能在特定的事务管理器上工作。开箱即用，这只适用于JDBC org.springframework.jdbc.datasource。</span></span><br><span class="line"><span class="comment">     * 使用JDBC 3.0驱动程序时使用DataSourceTransactionManager。一些JTA提供者可能也支持嵌套事务。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.jdbc.datasource.DataSourceTransactionManager</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> PROPAGATION_NESTED = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用基础数据存储的默认隔离级别。</span></span><br><span class="line"><span class="comment">     * 所有其他级别都对应JDBC隔离级别。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.sql.Connection</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_DEFAULT = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指示可能发生脏读、不可重复读和幻像读。</span></span><br><span class="line"><span class="comment">     * 该级别允许一个事务修改的行在该行的任何更改提交之前被另一个事务读取(“脏读”)。</span></span><br><span class="line"><span class="comment">     * 如果任何更改被回滚，则第二个事务将检索无效的行。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.sql.Connection#TRANSACTION_READ_UNCOMMITTED</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_UNCOMMITTED = <span class="number">1</span>;  <span class="comment">// same as java.sql.Connection.TRANSACTION_READ_UNCOMMITTED;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指示阻止脏读;不可重复读取和幻像读取可能会发生。</span></span><br><span class="line"><span class="comment">     * 该级别仅禁止事务读取一行中未提交的更改。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.sql.Connection#TRANSACTION_READ_COMMITTED</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_READ_COMMITTED = <span class="number">2</span>;  <span class="comment">// same as java.sql.Connection.TRANSACTION_READ_COMMITTED;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指示防止脏读和不可重复读;幻读可能会发生。</span></span><br><span class="line"><span class="comment">     * 该级别禁止事务读取未提交更改的行，也禁止这样的情况:一个事务读取一行，第二个事务修改该行，第一个事务重新读取该行，第二次获取不同的值(“不可重复读取”)。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.sql.Connection#TRANSACTION_REPEATABLE_READ</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_REPEATABLE_READ = <span class="number">4</span>;  <span class="comment">// same as java.sql.Connection.TRANSACTION_REPEATABLE_READ;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指示防止脏读、不可重复读和幻像读。</span></span><br><span class="line"><span class="comment">     * 这个水平进一步包括ISOLATION_REPEATABLE_READ的禁令,禁止在一个事务中读取所有行,满足条件,第二个事务插入一行,满足条件,和第一个事务重新读取相同的条件下,获取额外的“幽灵”在第二行阅读。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> java.sql.Connection#TRANSACTION_SERIALIZABLE</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> ISOLATION_SERIALIZABLE = <span class="number">8</span>;  <span class="comment">// same as java.sql.Connection.TRANSACTION_SERIALIZABLE;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 使用基础事务系统的默认超时，如果不支持超时，则为none。</span></span><br><span class="line"><span class="comment">     * or none if timeouts are not supported.</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">int</span> TIMEOUT_DEFAULT = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回传播行为。</span></span><br><span class="line"><span class="comment">     * 必须返回该接口上定义的PROPAGATION_XXX常量之一。默认值是PROPAGATION_REQUIRED。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the propagation behavior</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #PROPAGATION_REQUIRED</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.TransactionSynchronizationManager#isActualTransactionActive()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">int</span> <span class="title">getPropagationBehavior</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> PROPAGATION_REQUIRED;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回隔离级别。</span></span><br><span class="line"><span class="comment">     * 必须返回该接口中定义的ISOLATION_XXX常量之一。这些常量被设计为匹配java.sql.Connection上相同常量的值。</span></span><br><span class="line"><span class="comment">     * 专门设计用于与PROPAGATION_REQUIRED或PROPAGATION_REQUIRES_NEW一起使用，因为它只适用于新启动的事务。</span></span><br><span class="line"><span class="comment">     * 如果您希望在参与具有不同隔离级别的现有事务时拒绝隔离级别声明，请考虑将事务管理器上的“validateExistingTransactions”标志切换为“true”。</span></span><br><span class="line"><span class="comment">     * 默认值为ISOLATION_DEFAULT。请注意，不支持自定义隔离级别的事务管理器在给出ISOLATION_DEFAULT以外的任何其他级别时将抛出异常。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the isolation level</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> #ISOLATION_DEFAULT</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.AbstractPlatformTransactionManager#setValidateExistingTransaction</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">int</span> <span class="title">getIsolationLevel</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ISOLATION_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回事务超时。</span></span><br><span class="line"><span class="comment">     * 必须返回秒数，或TIMEOUT_DEFAULT。</span></span><br><span class="line"><span class="comment">     * 专门设计用于与PROPAGATION_REQUIRED或PROPAGATION_REQUIRES_NEW一起使用，因为它只适用于新启动的事务。</span></span><br><span class="line"><span class="comment">     * 请注意，不支持超时的事务管理器在给出TIMEOUT_DEFAULT以外的任何超时时将抛出异常。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the transaction timeout</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">int</span> <span class="title">getTimeout</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> TIMEOUT_DEFAULT;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回是否优化为只读事务。</span></span><br><span class="line"><span class="comment">     * 只读标志适用于任何事务上下文，无论是由实际的资源事务(PROPAGATION_REQUIRED/ PROPAGATION_REQUIRES_NEW)支持，还是在资源级别上进行非事务操作(PROPAGATION_SUPPORTS)。</span></span><br><span class="line"><span class="comment">     * 在后一种情况下，该标志将只应用于应用程序中的托管资源，例如Hibernate会话。</span></span><br><span class="line"><span class="comment">     * 这只是作为实际事务子系统的提示;它不一定会导致写访问尝试失败。不能解释只读提示的事务管理器在请求只读事务时不会抛出异常。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.TransactionSynchronization#beforeCommit(boolean)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.TransactionSynchronizationManager#isCurrentTransactionReadOnly()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">isReadOnly</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回此事务的名称。可以为空。</span></span><br><span class="line"><span class="comment">     * 这将被用作事务监视器中显示的事务名称(如果适用的话，例如WebLogic的)。</span></span><br><span class="line"><span class="comment">     * 在Spring的声明性事务中，公开的名称将是完全限定的类名+ &quot;。+方法名(默认)。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> the name of this transaction (&#123;<span class="doctag">@code</span> null&#125; by default&#125;</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.interceptor.TransactionAspectSupport</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@see</span> org.springframework.transaction.support.TransactionSynchronizationManager#getCurrentTransactionName()</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Nullable</span></span><br><span class="line">    <span class="function"><span class="keyword">default</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// Static builder methods</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回一个不可修改的TransactionDefinition和默认值。</span></span><br><span class="line"><span class="comment">     * 出于定制的目的，可以使用可修改的org.springframework.transaction.support。DefaultTransactionDefinition代替。</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@since</span> 5.2</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">static</span> TransactionDefinition <span class="title">withDefaults</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> StaticTransactionDefinition.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结：</p><p>先简单的回顾下，脏读、幻读与不可重复读的基本概念</p><h4 id="脏读、幻读与不可重复读"><a href="#脏读、幻读与不可重复读" class="headerlink" title="脏读、幻读与不可重复读"></a>脏读、幻读与不可重复读</h4><p><strong>脏读</strong>：指一个事务中访问到了另外一个事务未提交的数据</p><table><thead><tr><th>会话1</th><th>会话2</th></tr></thead><tbody><tr><td>begin</td><td>begin</td></tr><tr><td></td><td>update table set age = 10 where id = 1</td></tr><tr><td>select age from table where Id = 1</td><td></td></tr><tr><td>commit</td><td>commit</td></tr></tbody></table><p>会话1和会话2，同时开启事务，在会话1执行查询之前，会话2对id为1的年龄做了修改，导致会话1在查询id为1的年龄为10，其实会话1期望拿到的是会话2更新前的值，如果会话2回滚事务，则会话1拿到的仍是10，这就是脏读</p><p><strong>幻读</strong>：一个事务读取2次，得到的记录条数不一致</p><table><thead><tr><th>会话1</th><th>会话2</th></tr></thead><tbody><tr><td>begin</td><td>begin</td></tr><tr><td>select age from table where Id &gt; 2</td><td></td></tr><tr><td></td><td>insert into table(id,age)values(5,10)</td></tr><tr><td></td><td>Commit</td></tr><tr><td>select age from table where Id &gt; 2</td><td></td></tr><tr><td>commit</td><td></td></tr></tbody></table><p>会话1事务过程中，会话2插入了一个值，导致两次查询的数据不一致</p><p><strong>不可重复读</strong>：一个事务读取同一条记录2次，得到的结果不一致</p><table><thead><tr><th>会话1</th><th>会话2</th></tr></thead><tbody><tr><td>begin</td><td>begin</td></tr><tr><td>select age from table where Id = 1</td><td></td></tr><tr><td></td><td>update table set age = 10 where id = 1</td></tr><tr><td></td><td>commit</td></tr><tr><td>select age from table where Id = 1</td><td></td></tr><tr><td>commit</td><td></td></tr></tbody></table><p>会话1事务过程中，会话2更新了一个值，导致两次查询的数据不一致</p><p>回到事务的总结：</p><table><thead><tr><th>隔离级别</th><th>描述</th></tr></thead><tbody><tr><td>ISOLATION_DEFAULT</td><td>使用基础数据存储的默认隔离级别。所有其他级别都对应JDBC隔离级别。Mysql 默认采用的 REPEATABLE_READ隔离级别 Oracle 默认采用的 READ_COMMITTED隔离级别.</td></tr><tr><td>ISOLATION_READ_UNCOMMITTED</td><td>指示可能发生脏读、不可重复读和幻像读。该级别允许一个事务修改的行在该行的任何更改提交之前被另一个事务读取(“脏读”)。如果任何更改被回滚，则第二个事务将检索无效的行。</td></tr><tr><td>ISOLATION_READ_COMMITTED</td><td>指示阻止脏读;不可重复读取和幻像读取可能会发生。该级别仅禁止事务读取一行中未提交的更改。</td></tr><tr><td>ISOLATION_REPEATABLE_READ</td><td>指示防止脏读和不可重复读;幻读可能会发生。该级别禁止事务读取未提交更改的行，也禁止这样的情况:一个事务读取一行，第二个事务修改该行，第一个事务重新读取该行，第二次获取不同的值(“不可重复读取”)。</td></tr><tr><td>ISOLATION_SERIALIZABLE</td><td>指示防止脏读、不可重复读和幻像读。这个水平进一步包括ISOLATION_REPEATABLE_READ的禁令,禁止在一个事务中读取所有行,满足条件,第二个事务插入一行,满足条件,和第一个事务重新读取相同的条件下,获取额外的“幽灵”在第二行阅读。</td></tr></tbody></table><table><thead><tr><th>事务传播行为</th><th>描述</th></tr></thead><tbody><tr><td>PROPAGATION_REQUIRED</td><td>支持当前事务;如果不存在，则创建一个新的。类似于同名的EJB事务属性。这通常是事务定义的默认设置，通常定义事务同步范围。</td></tr><tr><td>PROPAGATION_SUPPORTS</td><td>支持当前事务;如果不存在，则以非事务方式执行。类似于同名的EJB事务属性。 注意:对于具有事务同步的事务管理器，PROPAGATION_SUPPORTS与完全没有事务略有不同，因为它定义了同步可能适用的事务范围。 因此，相同的资源(JDBC连接、Hibernate会话等)将在整个指定范围内共享。请注意，确切的行为取决于事务管理器的实际同步配置! 一般情况下，请小心使用PROPAGATION_SUPPORTS!特别地，不要依赖于PROPAGATION_REQUIRED或PROPAGATION_REQUIRES_NEW在PROPAGATION_SUPPORTS范围内(这可能会导致运行时的同步冲突)。 如果这种嵌套是不可避免的，请确保适当地配置事务管理器(通常切换到“在实际事务上同步”)。</td></tr><tr><td>PROPAGATION_MANDATORY</td><td>支持当前事务;如果当前没有事务存在，则抛出异常。类似于同名的EJB事务属性。 注意，PROPAGATION_MANDATORY范围内的事务同步将始终由周围的事务驱动。</td></tr><tr><td>PROPAGATION_REQUIRES_NEW</td><td>不支持当前事务;创建一个新事务，挂起当前事务(如果存在的话)。类似于同名的EJB事务属性。 注意:实际的事务挂起并不会在所有事务管理器上开箱即用。这尤其适用于org.springframework.transaction.jta.JtaTransactionManager， 它需要javax.transaction.TransactionManager可用(在标准Java EE中是特定于服务器的)。 PROPAGATION_REQUIRES_NEW作用域总是定义自己的事务同步。现有的同步将被挂起并适当恢复</td></tr><tr><td>PROPAGATION_NOT_SUPPORTED</td><td>不支持当前事务;而是总是以非事务的方式执行。类似于同名的EJB事务属性。 注意:实际的事务挂起并不会在所有事务管理器上开箱即用。这尤其适用于org.springframework.transaction.jta.JtaTransactionManager， 它需要javax.transaction.TransactionManager可用(在标准Java EE中是特定于服务器的)。 注意，事务同步在PROPAGATION_NOT_SUPPORTED范围内不可用。现有的同步将被挂起并适当恢复。</td></tr><tr><td>PROPAGATION_NEVER</td><td>不支持当前事务;如果当前事务存在，则抛出异常。类似于同名的EJB事务属性。 注意，事务同步在PROPAGATION_NEVER范围内不可用</td></tr><tr><td>PROPAGATION_NESTED</td><td>如果当前事务存在，则在嵌套事务中执行，否则行为类似于PROPAGATION_REQUIRED。EJB中没有类似的特性。 注意:嵌套事务的实际创建只能在特定的事务管理器上工作。开箱即用，这只适用于JDBC org.springframework.jdbc.datasource。 使用JDBC 3.0驱动程序时使用DataSourceTransactionManager。一些JTA提供者可能也支持嵌套事务。</td></tr></tbody></table>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring的Bean的生命周期</title>
      <link href="/dist/2021/02/01/Spring%E7%9A%84Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/"/>
      <url>/dist/2021/02/01/Spring%E7%9A%84Bean%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F/</url>
      
        <content type="html"><![CDATA[<h2 id="Spring的Bean的生命周期"><a href="#Spring的Bean的生命周期" class="headerlink" title="Spring的Bean的生命周期"></a>Spring的Bean的生命周期</h2><h3 id="一、生命周期流程图"><a href="#一、生命周期流程图" class="headerlink" title="一、生命周期流程图"></a>一、生命周期流程图</h3><p>Spring bean 的完整生命周期从创建Spring容器开始，直到最终Spring 容器销毁Bean，这其中包含的一些了的关键点（<a href="http://www.cnblogs.com/zrtqsk/p/3735273.html">Spring Bean 的生命周期</a>）</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/20210201151643.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/20210201151643.png" srcset="data:image/png;base64,666"></p><p>在Spring的5.x版本中，通过BeanFactory的类注释，发现他对Spring Bean生命周期做了详细的描述：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.beans.factory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.ResolvableType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * The root interface for accessing a Spring bean container.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This is the basic client view of a bean container;</span></span><br><span class="line"><span class="comment"> * further interfaces such as &#123;<span class="doctag">@link</span> ListableBeanFactory&#125; and</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> org.springframework.beans.factory.config.ConfigurableBeanFactory&#125;</span></span><br><span class="line"><span class="comment"> * are available for specific purposes.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This interface is implemented by objects that hold a number of bean definitions,</span></span><br><span class="line"><span class="comment"> * each uniquely identified by a String name. Depending on the bean definition,</span></span><br><span class="line"><span class="comment"> * the factory will return either an independent instance of a contained object</span></span><br><span class="line"><span class="comment"> * (the Prototype design pattern), or a single shared instance (a superior</span></span><br><span class="line"><span class="comment"> * alternative to the Singleton design pattern, in which the instance is a</span></span><br><span class="line"><span class="comment"> * singleton in the scope of the factory). Which type of instance will be returned</span></span><br><span class="line"><span class="comment"> * depends on the bean factory configuration: the API is the same. Since Spring</span></span><br><span class="line"><span class="comment"> * 2.0, further scopes are available depending on the concrete application</span></span><br><span class="line"><span class="comment"> * context (e.g. &quot;request&quot; and &quot;session&quot; scopes in a web environment).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;The point of this approach is that the BeanFactory is a central registry</span></span><br><span class="line"><span class="comment"> * of application components, and centralizes configuration of application</span></span><br><span class="line"><span class="comment"> * components (no more do individual objects need to read properties files,</span></span><br><span class="line"><span class="comment"> * for example). See chapters 4 and 11 of &quot;Expert One-on-One J2EE Design and</span></span><br><span class="line"><span class="comment"> * Development&quot; for a discussion of the benefits of this approach.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note that it is generally better to rely on Dependency Injection</span></span><br><span class="line"><span class="comment"> * (&quot;push&quot; configuration) to configure application objects through setters</span></span><br><span class="line"><span class="comment"> * or constructors, rather than use any form of &quot;pull&quot; configuration like a</span></span><br><span class="line"><span class="comment"> * BeanFactory lookup. Spring&#x27;s Dependency Injection functionality is</span></span><br><span class="line"><span class="comment"> * implemented using this BeanFactory interface and its subinterfaces.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Normally a BeanFactory will load bean definitions stored in a configuration</span></span><br><span class="line"><span class="comment"> * source (such as an XML document), and use the &#123;<span class="doctag">@code</span> org.springframework.beans&#125;</span></span><br><span class="line"><span class="comment"> * package to configure the beans. However, an implementation could simply return</span></span><br><span class="line"><span class="comment"> * Java objects it creates as necessary directly in Java code. There are no</span></span><br><span class="line"><span class="comment"> * constraints on how the definitions could be stored: LDAP, RDBMS, XML,</span></span><br><span class="line"><span class="comment"> * properties file, etc. Implementations are encouraged to support references</span></span><br><span class="line"><span class="comment"> * amongst beans (Dependency Injection).</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;In contrast to the methods in &#123;<span class="doctag">@link</span> ListableBeanFactory&#125;, all of the</span></span><br><span class="line"><span class="comment"> * operations in this interface will also check parent factories if this is a</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@link</span> HierarchicalBeanFactory&#125;. If a bean is not found in this factory instance,</span></span><br><span class="line"><span class="comment"> * the immediate parent factory will be asked. Beans in this factory instance</span></span><br><span class="line"><span class="comment"> * are supposed to override beans of the same name in any parent factory.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Bean factory implementations should support the standard bean lifecycle interfaces</span></span><br><span class="line"><span class="comment"> * as far as possible. The full set of initialization methods and their standard order is:</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;BeanNameAware&#x27;s &#123;<span class="doctag">@code</span> setBeanName&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;BeanClassLoaderAware&#x27;s &#123;<span class="doctag">@code</span> setBeanClassLoader&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;BeanFactoryAware&#x27;s &#123;<span class="doctag">@code</span> setBeanFactory&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;EnvironmentAware&#x27;s &#123;<span class="doctag">@code</span> setEnvironment&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;EmbeddedValueResolverAware&#x27;s &#123;<span class="doctag">@code</span> setEmbeddedValueResolver&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;ResourceLoaderAware&#x27;s &#123;<span class="doctag">@code</span> setResourceLoader&#125;</span></span><br><span class="line"><span class="comment"> * (only applicable when running in an application context)</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;ApplicationEventPublisherAware&#x27;s &#123;<span class="doctag">@code</span> setApplicationEventPublisher&#125;</span></span><br><span class="line"><span class="comment"> * (only applicable when running in an application context)</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;MessageSourceAware&#x27;s &#123;<span class="doctag">@code</span> setMessageSource&#125;</span></span><br><span class="line"><span class="comment"> * (only applicable when running in an application context)</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;ApplicationContextAware&#x27;s &#123;<span class="doctag">@code</span> setApplicationContext&#125;</span></span><br><span class="line"><span class="comment"> * (only applicable when running in an application context)</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;ServletContextAware&#x27;s &#123;<span class="doctag">@code</span> setServletContext&#125;</span></span><br><span class="line"><span class="comment"> * (only applicable when running in a web application context)</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> postProcessBeforeInitialization&#125; methods of BeanPostProcessors</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;InitializingBean&#x27;s &#123;<span class="doctag">@code</span> afterPropertiesSet&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;a custom init-method definition</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> postProcessAfterInitialization&#125; methods of BeanPostProcessors</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;On shutdown of a bean factory, the following lifecycle methods apply:</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;&#123;<span class="doctag">@code</span> postProcessBeforeDestruction&#125; methods of DestructionAwareBeanPostProcessors</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;DisposableBean&#x27;s &#123;<span class="doctag">@code</span> destroy&#125;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;a custom destroy-method definition</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Rod Johnson</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Chris Beams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 13 April 2001</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> BeanNameAware#setBeanName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> BeanClassLoaderAware#setBeanClassLoader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> BeanFactoryAware#setBeanFactory</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.ResourceLoaderAware#setResourceLoader</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.ApplicationEventPublisherAware#setApplicationEventPublisher</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.MessageSourceAware#setMessageSource</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.context.ApplicationContextAware#setApplicationContext</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.web.context.ServletContextAware#setServletContext</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.beans.factory.config.BeanPostProcessor#postProcessBeforeInitialization</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> InitializingBean#afterPropertiesSet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.beans.factory.support.RootBeanDefinition#getInitMethodName</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.beans.factory.config.BeanPostProcessor#postProcessAfterInitialization</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> DisposableBean#destroy</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.beans.factory.support.RootBeanDefinition#getDestroyMethodName</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BeanFactory</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Used to dereference a &#123;<span class="doctag">@link</span> FactoryBean&#125; instance and distinguish it from</span></span><br><span class="line"><span class="comment"> * beans &lt;i&gt;created&lt;/i&gt; by the FactoryBean. For example, if the bean named</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> myJndiObject&#125; is a FactoryBean, getting &#123;<span class="doctag">@code</span> &amp;myJndiObject&#125;</span></span><br><span class="line"><span class="comment"> * will return the factory, not the instance returned by the factory.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String FACTORY_BEAN_PREFIX = <span class="string">&quot;&amp;&quot;</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return an instance, which may be shared or independent, of the specified bean.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method allows a Spring BeanFactory to be used as a replacement for the</span></span><br><span class="line"><span class="comment"> * Singleton or Prototype design pattern. Callers may retain references to</span></span><br><span class="line"><span class="comment"> * returned objects in the case of Singleton beans.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to retrieve</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an instance of the bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the specified name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException if the bean could not be obtained</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Object <span class="title">getBean</span><span class="params">(String name)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return an instance, which may be shared or independent, of the specified bean.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Behaves the same as &#123;<span class="doctag">@link</span> #getBean(String)&#125;, but provides a measure of type</span></span><br><span class="line"><span class="comment"> * safety by throwing a BeanNotOfRequiredTypeException if the bean is not of the</span></span><br><span class="line"><span class="comment"> * required type. This means that ClassCastException can&#x27;t be thrown on casting</span></span><br><span class="line"><span class="comment"> * the result correctly, as can happen with &#123;<span class="doctag">@link</span> #getBean(String)&#125;.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to retrieve</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an instance of the bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeanNotOfRequiredTypeException if the bean is not of the required type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException if the bean could not be created</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(String name, Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return an instance, which may be shared or independent, of the specified bean.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments,</span></span><br><span class="line"><span class="comment"> * overriding the specified default arguments (if any) in the bean definition.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to retrieve</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args arguments to use when creating a bean instance using explicit arguments</span></span><br><span class="line"><span class="comment"> * (only applied when creating a new instance as opposed to retrieving an existing one)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an instance of the bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeanDefinitionStoreException if arguments have been given but</span></span><br><span class="line"><span class="comment"> * the affected bean isn&#x27;t a prototype</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException if the bean could not be created</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Object <span class="title">getBean</span><span class="params">(String name, Object... args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the bean instance that uniquely matches the given object type, if any.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method goes into &#123;<span class="doctag">@link</span> ListableBeanFactory&#125; by-type lookup territory</span></span><br><span class="line"><span class="comment"> * but may also be translated into a conventional by-name lookup based on the name</span></span><br><span class="line"><span class="comment"> * of the given type. For more extensive retrieval operations across sets of beans,</span></span><br><span class="line"><span class="comment"> * use &#123;<span class="doctag">@link</span> ListableBeanFactory&#125; and/or &#123;<span class="doctag">@link</span> BeanFactoryUtils&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an instance of the single bean matching the required type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if no bean of the given type was found</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoUniqueBeanDefinitionException if more than one bean of the given type was found</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException if the bean could not be created</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ListableBeanFactory</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; requiredType)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return an instance, which may be shared or independent, of the specified bean.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Allows for specifying explicit constructor arguments / factory method arguments,</span></span><br><span class="line"><span class="comment"> * overriding the specified default arguments (if any) in the bean definition.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;This method goes into &#123;<span class="doctag">@link</span> ListableBeanFactory&#125; by-type lookup territory</span></span><br><span class="line"><span class="comment"> * but may also be translated into a conventional by-name lookup based on the name</span></span><br><span class="line"><span class="comment"> * of the given type. For more extensive retrieval operations across sets of beans,</span></span><br><span class="line"><span class="comment"> * use &#123;<span class="doctag">@link</span> ListableBeanFactory&#125; and/or &#123;<span class="doctag">@link</span> BeanFactoryUtils&#125;.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> args arguments to use when creating a bean instance using explicit arguments</span></span><br><span class="line"><span class="comment"> * (only applied when creating a new instance as opposed to retrieving an existing one)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an instance of the bean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no such bean definition</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeanDefinitionStoreException if arguments have been given but</span></span><br><span class="line"><span class="comment"> * the affected bean isn&#x27;t a prototype</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> BeansException if the bean could not be created</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">getBean</span><span class="params">(Class&lt;T&gt; requiredType, Object... args)</span> <span class="keyword">throws</span> BeansException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return a provider for the specified bean, allowing for lazy on-demand retrieval</span></span><br><span class="line"><span class="comment"> * of instances, including availability and uniqueness options.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requiredType type the bean must match; can be an interface or superclass</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a corresponding provider handle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 5.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBeanProvider(ResolvableType)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; <span class="function">ObjectProvider&lt;T&gt; <span class="title">getBeanProvider</span><span class="params">(Class&lt;T&gt; requiredType)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return a provider for the specified bean, allowing for lazy on-demand retrieval</span></span><br><span class="line"><span class="comment"> * of instances, including availability and uniqueness options.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> requiredType type the bean must match; can be a generic type declaration.</span></span><br><span class="line"><span class="comment"> * Note that collection types are not supported here, in contrast to reflective</span></span><br><span class="line"><span class="comment"> * injection points. For programmatically retrieving a list of beans matching a</span></span><br><span class="line"><span class="comment"> * specific type, specify the actual bean type as an argument here and subsequently</span></span><br><span class="line"><span class="comment"> * use &#123;<span class="doctag">@link</span> ObjectProvider#orderedStream()&#125; or its lazy streaming/iteration options.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> a corresponding provider handle</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 5.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ObjectProvider#iterator()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ObjectProvider#stream()</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> ObjectProvider#orderedStream()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">&lt;T&gt; <span class="function">ObjectProvider&lt;T&gt; <span class="title">getBeanProvider</span><span class="params">(ResolvableType requiredType)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Does this bean factory contain a bean definition or externally registered singleton</span></span><br><span class="line"><span class="comment"> * instance with the given name?</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If the given name is an alias, it will be translated back to the corresponding</span></span><br><span class="line"><span class="comment"> * canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If this factory is hierarchical, will ask any parent factory if the bean cannot</span></span><br><span class="line"><span class="comment"> * be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If a bean definition or singleton instance matching the given name is found,</span></span><br><span class="line"><span class="comment"> * this method will return &#123;<span class="doctag">@code</span> true&#125; whether the named bean definition is concrete</span></span><br><span class="line"><span class="comment"> * or abstract, lazy or eager, in scope or not. Therefore, note that a &#123;<span class="doctag">@code</span> true&#125;</span></span><br><span class="line"><span class="comment"> * return value from this method does not necessarily indicate that &#123;<span class="doctag">@link</span> #getBean&#125;</span></span><br><span class="line"><span class="comment"> * will be able to obtain an instance for the same name.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> whether a bean with the given name is present</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">containsBean</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Is this bean a shared singleton? That is, will &#123;<span class="doctag">@link</span> #getBean&#125; always</span></span><br><span class="line"><span class="comment"> * return the same instance?</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: This method returning &#123;<span class="doctag">@code</span> false&#125; does not clearly indicate</span></span><br><span class="line"><span class="comment"> * independent instances. It indicates non-singleton instances, which may correspond</span></span><br><span class="line"><span class="comment"> * to a scoped bean as well. Use the &#123;<span class="doctag">@link</span> #isPrototype&#125; operation to explicitly</span></span><br><span class="line"><span class="comment"> * check for independent instances.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> whether this bean corresponds to a singleton instance</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #isPrototype</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Is this bean a prototype? That is, will &#123;<span class="doctag">@link</span> #getBean&#125; always return</span></span><br><span class="line"><span class="comment"> * independent instances?</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Note: This method returning &#123;<span class="doctag">@code</span> false&#125; does not clearly indicate</span></span><br><span class="line"><span class="comment"> * a singleton object. It indicates non-independent instances, which may correspond</span></span><br><span class="line"><span class="comment"> * to a scoped bean as well. Use the &#123;<span class="doctag">@link</span> #isSingleton&#125; operation to explicitly</span></span><br><span class="line"><span class="comment"> * check for a shared singleton instance.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> whether this bean will always deliver independent instances</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.0.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #isSingleton</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isPrototype</span><span class="params">(String name)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Check whether the bean with the given name matches the specified type.</span></span><br><span class="line"><span class="comment"> * More specifically, check whether a &#123;<span class="doctag">@link</span> #getBean&#125; call for the given name</span></span><br><span class="line"><span class="comment"> * would return an object that is assignable to the specified target type.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> typeToMatch the type to match against (as a &#123;<span class="doctag">@code</span> ResolvableType&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the bean type matches,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> false&#125; if it doesn&#x27;t match or cannot be determined yet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isTypeMatch</span><span class="params">(String name, ResolvableType typeToMatch)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Check whether the bean with the given name matches the specified type.</span></span><br><span class="line"><span class="comment"> * More specifically, check whether a &#123;<span class="doctag">@link</span> #getBean&#125; call for the given name</span></span><br><span class="line"><span class="comment"> * would return an object that is assignable to the specified target type.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> typeToMatch the type to match against (as a &#123;<span class="doctag">@code</span> Class&#125;)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125; if the bean type matches,</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> false&#125; if it doesn&#x27;t match or cannot be determined yet</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 2.0.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getType</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">isTypeMatch</span><span class="params">(String name, Class&lt;?&gt; typeToMatch)</span> <span class="keyword">throws</span> NoSuchBeanDefinitionException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Determine the type of the bean with the given name. More specifically,</span></span><br><span class="line"><span class="comment"> * determine the type of object that &#123;<span class="doctag">@link</span> #getBean&#125; would return for the given name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For a &#123;<span class="doctag">@link</span> FactoryBean&#125;, return the type of object that the FactoryBean creates,</span></span><br><span class="line"><span class="comment"> * as exposed by &#123;<span class="doctag">@link</span> FactoryBean#getObjectType()&#125;. This may lead to the initialization</span></span><br><span class="line"><span class="comment"> * of a previously uninitialized &#123;<span class="doctag">@code</span> FactoryBean&#125; (see &#123;<span class="doctag">@link</span> #getType(String, boolean)&#125;).</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the type of the bean, or &#123;<span class="doctag">@code</span> null&#125; if not determinable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.1.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #isTypeMatch</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Class&lt;?&gt; getType(String name) <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Determine the type of the bean with the given name. More specifically,</span></span><br><span class="line"><span class="comment"> * determine the type of object that &#123;<span class="doctag">@link</span> #getBean&#125; would return for the given name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;For a &#123;<span class="doctag">@link</span> FactoryBean&#125;, return the type of object that the FactoryBean creates,</span></span><br><span class="line"><span class="comment"> * as exposed by &#123;<span class="doctag">@link</span> FactoryBean#getObjectType()&#125;. Depending on the</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> allowFactoryBeanInit&#125; flag, this may lead to the initialization of a previously</span></span><br><span class="line"><span class="comment"> * uninitialized &#123;<span class="doctag">@code</span> FactoryBean&#125; if no early type information is available.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Translates aliases back to the corresponding canonical bean name.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the name of the bean to query</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> allowFactoryBeanInit whether a &#123;<span class="doctag">@code</span> FactoryBean&#125; may get initialized</span></span><br><span class="line"><span class="comment"> * just for the purpose of determining its object type</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the type of the bean, or &#123;<span class="doctag">@code</span> null&#125; if not determinable</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> NoSuchBeanDefinitionException if there is no bean with the given name</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 5.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #isTypeMatch</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">Class&lt;?&gt; getType(String name, <span class="keyword">boolean</span> allowFactoryBeanInit) <span class="keyword">throws</span> NoSuchBeanDefinitionException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Return the aliases for the given bean name, if any.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;All of those aliases point to the same bean when used in a &#123;<span class="doctag">@link</span> #getBean&#125; call.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;If the given name is an alias, the corresponding original bean name</span></span><br><span class="line"><span class="comment"> * and other aliases (if any) will be returned, with the original bean name</span></span><br><span class="line"><span class="comment"> * being the first element in the array.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;Will ask the parent factory if the bean cannot be found in this factory instance.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name the bean name to check for aliases</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> the aliases, or an empty array if none</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #getBean</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String[] getAliases(String name);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>对BeanFactory的生命周期的内容如下：</p><blockquote><p>BeanFactory是访问SpringBean容器的入口。</p><p>这是SpringBean容器的基本客户端视图，其他的接口如ListableBeanFactory和ConfigurableBeanFactory是用于其他的特殊场景</p><p>这个接口是由包含许多bean定义的对象实现的，每个bean定义都由一个字符串名称唯一标识。根据bean定义，工厂将返回包含对象的独立实例(原型设计模式)，或者单个共享实例(单例设计模式的优越选择，在单例设计模式中，实例是工厂范围内的单例)。返回哪种类型的实例取决于bean工厂配置:API是相同的。自Spring 2.0以来，进一步的作用域取决于具体的应用程序上下文(例如。web环境中的“请求”和“会话”作用域)。</p><p>这种方法的要点是BeanFactory是应用程序组件的中心注册中心，并集中应用程序组件的配置(例如，单个对象不再需要读取属性文件)。有关这种方法的好处的讨论，请参阅“专家一对一J2EE设计和开发”的第4章和第11章。</p><p>请注意，依赖依赖注入(“推”配置)通过setter或构造函数来配置应用程序对象通常比使用任何形式的“拉”配置(如BeanFactory查找)更好。Spring的依赖项注入功能是使用这个BeanFactory接口及其子接口来实现的。</p><p>通常，BeanFactory将加载存储在配置源(如XML文档)中的bean定义，并使用org.springframework。配置bean的bean包。然而，实现可以直接在Java代码中返回它创建的必要Java对象。对于如何存储定义没有任何限制:LDAP、RDBMS、XML、属性文件等等。鼓励实现支持bean之间的引用(依赖注入)。</p><p>与ListableBeanFactory中的方法相比，如果这是一个层次结构的beanfactory，那么这个接口中的所有操作都将检查父工厂。如果在这个工厂实例中找不到bean，将询问直接的父工厂。这个工厂实例中的bean应该覆盖任何父工厂中同名的bean</p><p>Bean工厂实现应该尽可能支持标准的Bean生命周期接口。完整的初始化方法及其标准顺序是:</p><p>1、BeanNameAware的setBeanName<br>2、BeanClassLoaderAware的setBeanClassLoader<br>3、BeanFactoryAware的setBeanFactory<br>4、EnvironmentAware的setEnvironment<br>5、EmbeddedValueResolverAware的setEmbeddedValueResolver<br>6、ResourceLoaderAware的setResourceLoader(仅适用于在应用程序上下文中运行时)<br>7、ApplicationEventPublisherAware的setApplicationEventPublisher(仅适用于在应用程序上下文中运行时)<br>8、MessageSourceAware的setMessageSource(仅适用于在应用程序上下文中运行时)<br>9、ApplicationContextAware的setApplicationContext(仅适用于在应用程序上下文中运行时)<br>10、ServletContextAware的setServletContext(仅适用于运行在web应用程序的上下文)<br>11、BeanPostProcessors的postProcessBeforeInitialization方法<br>12、InitializingBean的afterPropertiesSet<br>13、自定义初始化方法定义<br>14、BeanPostProcessors的postProcessAfterInitialization方法</p><p>在关闭bean工厂时，应用以下生命周期方法:</p><p>1、DestructionAwareBeanPostProcessors的方法postProcessBeforeDestruction<br>2、DisposableBean的销毁<br>3、自定义的销毁方法定义</p></blockquote><p>通过代码观察bean的初始化流程：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.spring.bean.period;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.*;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/1 4:34 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> <span class="keyword">implements</span> <span class="title">BeanFactoryAware</span>, <span class="title">BeanNameAware</span>, <span class="title">InitializingBean</span>, <span class="title">DisposableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> BeanFactory beanFactory;</span><br><span class="line">    <span class="keyword">private</span> String beanName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String user;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【BeanFactoryAware接口】 调用setBeanFactory&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.beanFactory = beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【构造器】调用bean的构造器实例化&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setBeanName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【BeanNameAware接口】调用setBeanName&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.beanName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【DisposableBean接口】调用destroy&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【InitializingBean接口】调用afterPropertiesSet&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> BeanFactory <span class="title">getBeanFactory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beanFactory;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getBeanName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> beanName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setService</span><span class="params">(String service)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【属性注入】service&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.service = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUser</span><span class="params">(String user)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【属性注入】user&quot;</span>);</span><br><span class="line">        <span class="keyword">this</span>.user = user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myInit</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【init-method】调用&lt;bean&gt;的init-method属性指定的初始化方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">myDestory</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;【destory-method】调用&lt;bean&gt;的destory-method属性指定的初始化方法&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>配置bean的初始化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.spring.bean.period;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2021/2/2 10:29 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;myInit&quot;, destroyMethod = &quot;myDestory&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MyBean <span class="title">myBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setService(<span class="string">&quot;well done&quot;</span>);</span><br><span class="line">        myBean.setUser(<span class="string">&quot;jack&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> myBean;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>初始化容器，看打印的日志：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">  .   ____          _            __ _ _</span><br><span class="line"> &#x2F;\\ &#x2F; ___&#39;_ __ _ _(_)_ __  __ _ \ \ \ \</span><br><span class="line">( ( )\___ | &#39;_ | &#39;_| | &#39;_ \&#x2F; _&#96; | \ \ \ \</span><br><span class="line"> \\&#x2F;  ___)| |_)| | | | | || (_| |  ) ) ) )</span><br><span class="line">  &#39;  |____| .__|_| |_|_| |_\__, | &#x2F; &#x2F; &#x2F; &#x2F;</span><br><span class="line"> &#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|_|&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;|___&#x2F;&#x3D;&#x2F;_&#x2F;_&#x2F;_&#x2F;</span><br><span class="line"> :: Spring Boot ::        (v2.3.0.RELEASE)</span><br><span class="line"></span><br><span class="line">2021-02-02 11:20:54.928  INFO 10698 --- [           main] com.yidan.spring.bean.Application        : Starting Application on chaiwuxuandeMacBook-Pro.local with PID 10698 (&#x2F;Users&#x2F;wuxuan.chai&#x2F;Documents&#x2F;project&#x2F;springboot-learn&#x2F;Spring-bean&#x2F;target&#x2F;classes started by wuxuan.chai in &#x2F;Users&#x2F;wuxuan.chai&#x2F;Documents&#x2F;project&#x2F;springboot-learn)</span><br><span class="line">2021-02-02 11:20:54.932  INFO 10698 --- [           main] com.yidan.spring.bean.Application        : No active profile set, falling back to default profiles: default</span><br><span class="line">2021-02-02 11:20:56.030  INFO 10698 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat initialized with port(s): 1314 (http)</span><br><span class="line">2021-02-02 11:20:56.041  INFO 10698 --- [           main] o.apache.catalina.core.StandardService   : Starting service [Tomcat]</span><br><span class="line">2021-02-02 11:20:56.041  INFO 10698 --- [           main] org.apache.catalina.core.StandardEngine  : Starting Servlet engine: [Apache Tomcat&#x2F;9.0.35]</span><br><span class="line">2021-02-02 11:20:56.159  INFO 10698 --- [           main] o.a.c.c.C.[Tomcat].[localhost].[&#x2F;]       : Initializing Spring embedded WebApplicationContext</span><br><span class="line">2021-02-02 11:20:56.159  INFO 10698 --- [           main] o.s.web.context.ContextLoader            : Root WebApplicationContext: initialization completed in 1181 ms</span><br><span class="line">【构造器】调用bean的构造器实例化</span><br><span class="line">【属性注入】service</span><br><span class="line">【属性注入】user</span><br><span class="line">【BeanNameAware接口】调用setBeanName</span><br><span class="line">【BeanFactoryAware接口】 调用setBeanFactory</span><br><span class="line">【InitializingBean接口】调用afterPropertiesSet</span><br><span class="line">【init-method】调用&lt;bean&gt;的init-method属性指定的初始化方法</span><br><span class="line">2021-02-02 11:20:56.448  INFO 10698 --- [           main] o.s.s.concurrent.ThreadPoolTaskExecutor  : Initializing ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">2021-02-02 11:20:56.679  INFO 10698 --- [           main] o.s.b.w.embedded.tomcat.TomcatWebServer  : Tomcat started on port(s): 1314 (http) with context path &#39;&#39;</span><br><span class="line">2021-02-02 11:20:56.690  INFO 10698 --- [           main] com.yidan.spring.bean.Application        : Started Application in 2.127 seconds (JVM running for 2.751)</span><br><span class="line">Disconnected from the target VM, address: &#39;127.0.0.1:59808&#39;, transport: &#39;socket&#39;</span><br><span class="line">2021-02-02 11:20:58.684  INFO 10698 --- [extShutdownHook] o.s.s.concurrent.ThreadPoolTaskExecutor  : Shutting down ExecutorService &#39;applicationTaskExecutor&#39;</span><br><span class="line">【DisposableBean接口】调用destroy</span><br><span class="line">【destory-method】调用&lt;bean&gt;的destory-method属性指定的初始化方法</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>算法的时间与空间复杂度</title>
      <link href="/dist/2021/01/22/%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/"/>
      <url>/dist/2021/01/22/%E7%AE%97%E6%B3%95%E7%9A%84%E6%97%B6%E9%97%B4%E4%B8%8E%E7%A9%BA%E9%97%B4%E5%A4%8D%E6%9D%82%E5%BA%A6/</url>
      
        <content type="html"><![CDATA[<h1 id="算法的时间与空间复杂度"><a href="#算法的时间与空间复杂度" class="headerlink" title="算法的时间与空间复杂度"></a>算法的时间与空间复杂度</h1><p>在日常开发过程中，衡量算法的性能，一般都是通过时间复杂度和空间复杂度两个维度去比较，本文就是梳理一下我们是如何计算时间复杂度和空间复杂度的。        </p><h2 id="时间复杂度"><a href="#时间复杂度" class="headerlink" title="时间复杂度"></a>时间复杂度</h2><p>时间复杂度：指运行当前算法所消耗的时间，我们通常用【时间复杂度】来描述。</p><p>说到时间复杂度，我们第一时间想到的肯定是，算法从执行开始到执行结束所使用的时间。这么想固然是对的，但是仔细品，还是有弊端的。不同的机器运行相同的代码，时间会大不一样，取决于机器的CPU的执行运算的效率。如果机器相同，资源对等的情况下，我们考虑的可能就是代码层面的一些问题就会多一些，此时时间复杂度就是一个重要的评判标准。</p><p>一般时间复杂度分为：O(1)、O(n)、O(mlogn)、O(n<sup>m</sup>)</p><h3 id="O-1"><a href="#O-1" class="headerlink" title="O(1)"></a>O(1)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">o1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    i+=<span class="number">1</span>;</span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>O(1)的时间复杂度表示，无论代码执行多少行，只要没有循环结构，代码的时间复杂度都为O(1)。如上述代码，他执行的消耗时间和某个变量的增长是没有关系的，时间复杂度始终为O(1)。</p><h3 id="O-n"><a href="#O-n" class="headerlink" title="O(n)"></a>O(n)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">On</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> n = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        System.out.println(n);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>O(n)的时间复杂度表示，当n的变化为10时，循环会执行十次，即时间复杂度时随着n的变化而线性变化的。</p><h3 id="O-log-n"><a href="#O-log-n" class="headerlink" title="O(log n)"></a>O(log n)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logn</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> i = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">int</span> j = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (j &lt; i) &#123;</span><br><span class="line">        j *= <span class="number">2</span>; </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在上述例子中，每次循环中，j的值都会乘以2(可以认为n)，所以当循环m次后j的值就大于i了，循环就退出了，因此时间复杂度就为 log<sub>n</sub>m，所以复杂度一般简化为log n</p><h3 id="O-nm"><a href="#O-nm" class="headerlink" title="O(nm)"></a>O(n<sup>m</sup>)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i1 = <span class="number">0</span>; i1 &lt; n; i1++) &#123;</span><br><span class="line">        j = i;</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在上述中的例子中，嵌套了两层的n循环，他的时间复杂度就为O(n*n), 即为O(n<sup>2</sup>)，如果有m层嵌套，那么时间复杂度为O(n<sup>m</sup>)</p><p>如果上述例子中，如果嵌套的循环时间复杂度为O(m),那么整体时间复杂为O(n*m)。</p><h2 id="空间复杂度"><a href="#空间复杂度" class="headerlink" title="空间复杂度"></a>空间复杂度</h2><p>空间复杂度是对一个算法在运行的过程中占用存储空间的一个度量指标，同时反应占用空间的一个趋势。</p><p>空间复杂度比较常用的有，O(1),O(n),O(n<sup>2</sup>)</p><h3 id="O-1-1"><a href="#O-1-1" class="headerlink" title="O(1)"></a>O(1)</h3><p>如果程序运行所需的临时空间不随着某个变量的变化而变化，那么算法的空间复杂度为一个常量</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">int</span> j = <span class="number">1</span>;</span><br><span class="line">++ i;</span><br><span class="line">j ++;</span><br><span class="line"><span class="keyword">int</span> m = j + i;</span><br></pre></td></tr></table></figure><p>如上述的描述，执行所需的空间和i、j、m没有关系，所以他的空间复杂度为O(1)</p><h3 id="O-n-1"><a href="#O-n-1" class="headerlink" title="O(n)"></a>O(n)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">int[] a &#x3D; new int[n];</span><br><span class="line">for (int i &#x3D; 0; i &lt; n; i++) &#123;</span><br><span class="line">    a[i] &#x3D; i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述的例子中，数组a的空间和n的值成线性关系，即n有多大，数组就有多长，所以内存空间和n是成线性关系，所以空间复杂度为O(n)</p><h3 id="O-nm-1"><a href="#O-nm-1" class="headerlink" title="O(nm)"></a>O(n<sup>m</sup>)</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span>[] a = <span class="keyword">new</span> <span class="keyword">int</span>[n];</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> ii = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        a[i] = ii;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>上述例子中，双层循环中数组的长度和n、以及循环的嵌套层m数有关，所以内存空间和n、m的关系为n<sup>m</sup>,其空间复杂度为：O(n<sup>m</sup>)</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这里值是罗列基本的概念，具体的算法复杂度计算大致可以参考这个思路去推断。可能存在误解，后续学习再做改正。</p>]]></content>
      
      
      <categories>
          
          <category> 算法 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>GreenPlum的百分位数的实现</title>
      <link href="/dist/2021/01/20/GP%E7%9A%84%E7%99%BE%E5%88%86%E4%BD%8D%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/"/>
      <url>/dist/2021/01/20/GP%E7%9A%84%E7%99%BE%E5%88%86%E4%BD%8D%E6%95%B0%E7%9A%84%E5%AE%9E%E7%8E%B0/</url>
      
        <content type="html"><![CDATA[<h2 id="GreenPlum的百分位数的实现"><a href="#GreenPlum的百分位数的实现" class="headerlink" title="GreenPlum的百分位数的实现"></a>GreenPlum的百分位数的实现</h2><h3 id="一、计算公式"><a href="#一、计算公式" class="headerlink" title="一、计算公式"></a>一、计算公式</h3><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201209172349437.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201209172349437.png" srcset="data:image/png;base64,666" alt="百分数的计算逻辑"></p><h3 id="二、实现思路"><a href="#二、实现思路" class="headerlink" title="二、实现思路"></a>二、实现思路</h3><h4 id="计算百分位数"><a href="#计算百分位数" class="headerlink" title="计算百分位数"></a>计算百分位数</h4><p>1、确定数组</p><p>如下数组：</p><table><thead><tr><th>3710</th><th>3755</th><th>3850</th><th>3880</th><th>3880</th><th>3890</th><th>3920</th><th>3940</th><th>3950</th><th>4050</th><th>4130</th><th>4325</th></tr></thead><tbody><tr><td>1</td><td>2</td><td>3</td><td>4</td><td>5</td><td>6</td><td>7</td><td>8</td><td>9</td><td>10</td><td>11</td><td>12</td></tr></tbody></table><p>2、确定数组在有序序列中的位置</p><p>3、根据公式，计算百分位数所在的位置</p><p>$$<br>Lp = (n +1)p/100<br>$$<br>公式描述：</p><p>p表示百分数</p><p>n表示数组的长度</p><p>4、根据公式，计算百分数<br>$$<br>R= Array[Floor(Lp)] + (Lp-Floor(Lp))*(Array[Ceil(Lp)]-Array[Floor(Lp)])<br>$$<br>公式描述：</p><p>Array[N] 表示数组中位置位N的元素</p><p>Floor[N] 表示向零取整</p><p>Ceil[N] 表示背零取整</p><p>Lp 表示百分数所在的位置</p><h4 id="计算百分位"><a href="#计算百分位" class="headerlink" title="计算百分位"></a>计算百分位</h4><p>1、确定元素在数组中的位置（I）</p><p>2、数组的长度表示为，L<br>$$<br>R = 100I/（L+1）<br>$$</p><h3 id="三、PSql去实现这个逻辑"><a href="#三、PSql去实现这个逻辑" class="headerlink" title="三、PSql去实现这个逻辑"></a>三、PSql去实现这个逻辑</h3><h4 id="计算百分位数-1"><a href="#计算百分位数-1" class="headerlink" title="计算百分位数"></a>计算百分位数</h4><p>1、准备数据</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> &quot;persent_table&quot; (</span><br><span class="line">  &quot;keyword&quot; <span class="type">varchar</span>(<span class="number">255</span>) <span class="keyword">COLLATE</span> &quot;pg_catalog&quot;.&quot;default&quot;,</span><br><span class="line">  &quot;play_count&quot; float8</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">9.2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">7.5</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">7.5</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">22</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">50.1</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">6.2</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot; <span class="keyword">VALUES</span> (<span class="string">&#x27;lol&#x27;</span>, <span class="number">9.8</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">223.5</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">208.7</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">122.9</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">68.4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">49.6</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">47.3</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">43</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">42.4</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">41.6</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> &quot;persent_table&quot;(&quot;keyword&quot;, &quot;play_count&quot;) <span class="keyword">VALUES</span> (<span class="string">&#x27;英雄联盟手游&#x27;</span>, <span class="number">37</span>);</span><br></pre></td></tr></table></figure><p>2、确定数组和每一个数组的位置</p><p>将数据按照keyworld分组根据play_count的值从小到大排列</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span> </span><br><span class="line"><span class="built_in">ROW_NUMBER</span>() <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> t1.keyword <span class="keyword">ORDER</span> <span class="keyword">BY</span> t1.play_count <span class="keyword">ASC</span> ) <span class="keyword">AS</span> seq,</span><br><span class="line"><span class="operator">*</span> </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">persent_table t1</span><br></pre></td></tr></table></figure><p>结果：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210100333078.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210100333078.png" srcset="data:image/png;base64,666"></p><p>3、计算百分位数所在的位置，例子中使用50百分位</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">keyword,</span><br><span class="line"><span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> ) <span class="keyword">AS</span> number_index,</span><br><span class="line"><span class="built_in">FLOOR</span> (<span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> )) <span class="keyword">AS</span> min_value,</span><br><span class="line"><span class="built_in">CEIL</span> (<span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> )) <span class="keyword">AS</span> max_value </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">persent_table </span><br><span class="line"><span class="keyword">WHERE</span> play_count <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">keyword </span><br></pre></td></tr></table></figure><p>结果：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210100627294.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210100627294.png" srcset="data:image/png;base64,666"></p><p>结果字段解释：</p><p>number_index: 表示50百分位所对应的数值所在数组中的位置</p><p>min_value/max_value:表示50百分位所对应的数值所在的实际数组元素所在的区间</p><p>如：</p><p>keyword为”lol”所对应的play_count的数组中50百分位数位置为4</p><p>keyword为“英雄联盟手游“所对应的play_count的数组中50百分位数位置为5和6之间</p><p>4、根据公式，计算百分数</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">t3.keyword,</span><br><span class="line">(t2.number_index <span class="operator">-</span> <span class="built_in">FLOOR</span> ( t2.number_index )) <span class="operator">*</span> (<span class="built_in">MAX</span> ( t3.play_count ) <span class="operator">-</span> <span class="built_in">MIN</span> ( t3.play_count )) <span class="operator">+</span> <span class="built_in">MIN</span> ( t3.play_count ) <span class="keyword">AS</span> persent_val </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">( <span class="keyword">SELECT</span> <span class="built_in">ROW_NUMBER</span> () <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> t1.keyword <span class="keyword">ORDER</span> <span class="keyword">BY</span> t1.play_count <span class="keyword">ASC</span> ) <span class="keyword">AS</span> seq,<span class="operator">*</span> <span class="keyword">FROM</span> persent_table t1 ) t3</span><br><span class="line"><span class="keyword">INNER</span> <span class="keyword">JOIN</span> (</span><br><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">keyword,</span><br><span class="line"><span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> ) <span class="keyword">AS</span> number_index,</span><br><span class="line"><span class="built_in">FLOOR</span> (<span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> )) <span class="keyword">AS</span> min_value,</span><br><span class="line"><span class="built_in">CEIL</span> (<span class="number">0.5</span> <span class="operator">*</span> ( <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="operator">+</span> <span class="number">1</span> )) <span class="keyword">AS</span> max_value </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">persent_table </span><br><span class="line">  <span class="keyword">WHERE</span> play_count <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span></span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">keyword </span><br><span class="line">) t2 <span class="keyword">ON</span> t3.keyword <span class="operator">=</span> t2.keyword </span><br><span class="line"><span class="keyword">AND</span> ( seq <span class="operator">=</span> max_value <span class="keyword">OR</span> seq <span class="operator">=</span> min_value ) </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">t3.keyword,</span><br><span class="line">t2.number_index;</span><br></pre></td></tr></table></figure><p>结果：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210101204776.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210101204776.png" srcset="data:image/png;base64,666"></p><p>和步骤2中的数据对比：</p><p>lol的seq = 4的play_count = 9.2</p><p>英雄联盟手游 的  5&lt; seq &lt; 6 的play_count 值区间为：47.3 ～ 49.6  用公式验证 47.3 + 0.5*（49.6 - 47.3）= 48.45 </p><h4 id="计算百分位-1"><a href="#计算百分位-1" class="headerlink" title="计算百分位"></a>计算百分位</h4><p>1、求分组下的数组长度</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">keyword,</span><br><span class="line"><span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="keyword">AS</span> count_val </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">persent_table </span><br><span class="line"><span class="keyword">WHERE</span></span><br><span class="line">play_count <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span> </span><br><span class="line"><span class="keyword">GROUP</span> <span class="keyword">BY</span></span><br><span class="line">keyword</span><br></pre></td></tr></table></figure><p>结果：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210102037089.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210102037089.png" srcset="data:image/png;base64,666"></p><p>2、计算每个数组元素所在的位置的百分位</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">SELECT</span></span><br><span class="line">t1.keyword,</span><br><span class="line"><span class="number">100</span> <span class="operator">*</span> (<span class="built_in">ROW_NUMBER</span> () <span class="keyword">OVER</span> ( <span class="keyword">PARTITION</span> <span class="keyword">BY</span> t1.keyword <span class="keyword">ORDER</span> <span class="keyword">BY</span> t1.play_count <span class="keyword">DESC</span> )) <span class="operator">/</span> ( t2.count_val <span class="operator">+</span> <span class="number">1</span> ) <span class="keyword">AS</span> persent </span><br><span class="line"><span class="keyword">FROM</span></span><br><span class="line">persent_table t1</span><br><span class="line"><span class="keyword">LEFT</span> <span class="keyword">JOIN</span> ( <span class="keyword">SELECT</span> keyword, <span class="built_in">COUNT</span> ( <span class="number">1</span> ) <span class="keyword">AS</span> count_val <span class="keyword">FROM</span> persent_table <span class="keyword">WHERE</span> play_count <span class="keyword">IS</span> <span class="keyword">NOT</span> <span class="keyword">NULL</span>  <span class="keyword">GROUP</span> <span class="keyword">BY</span> keyword ) t2 <span class="keyword">ON</span> t1.keyword <span class="operator">=</span> t2.keyword</span><br></pre></td></tr></table></figure><p>结果：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210102210709.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20201210102210709.png" srcset="data:image/png;base64,666"></p><p>和计算百分位数进行对比：很明显发现lol的位置为4的百分位为50</p>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Java的位运算</title>
      <link href="/dist/2021/01/19/java%E7%9A%84%E4%BD%8D%E8%BF%90%E7%AE%97/"/>
      <url>/dist/2021/01/19/java%E7%9A%84%E4%BD%8D%E8%BF%90%E7%AE%97/</url>
      
        <content type="html"><![CDATA[<h1 id="Java的位运算"><a href="#Java的位运算" class="headerlink" title="Java的位运算"></a>Java的位运算</h1><h2 id="基础概念"><a href="#基础概念" class="headerlink" title="基础概念"></a>基础概念</h2><p>位：表示二进制位。是二进制计数系统中用来表示小于2的整数，一般用0或者1表示，是具有相等概率的两种状态的一种，二进制位的位数可以表示一个机器字的字长，一个二进制包含的信息量称之为1bit。</p><p>原码：二进制的定点表示法，即高位为符号位，’0’ 表示为正，’1’ 表示为负，其余位表示数值大小。</p><p>反码：正数的反码与其原码相同；负数的反码是对正数逐位取反，符号位保持为1。</p><p>补码：正数的补码与其原码相同，负数位的补码是在其反码的末位加1。</p><h3 id="Practice"><a href="#Practice" class="headerlink" title="Practice"></a>Practice</h3><p>为什么java中的int类型的值取值范围为：-2<sup>31</sup>  ~ 2<sup>31</sup>-1 ？     </p><blockquote><p>Integer占用4byte，1byte占用8bit：<br>最大的正数原码：01111111 11111111 11111111 11111111<br>最小的负数原码：10000000 00000000 00000000 00000000<br>计算机存使用的都是补码：<br>最大的正数的补码：<br>01111111 11111111 11111111 11111111    -&gt; 2<sup>31</sup>-1<br>最大的负数的补码：<br>11111111 11111111 11111111 11111111 +1 -&gt; -2<sup>31</sup>-1 + 1 = -2<sup>31</sup></p></blockquote><h3 id="原码、反码、补码的产生、以及应用"><a href="#原码、反码、补码的产生、以及应用" class="headerlink" title="原码、反码、补码的产生、以及应用"></a>原码、反码、补码的产生、以及应用</h3><p>在自然界中，我们计数一般都是从正数计数，比如、一棵树、两头牛、三只羊….不存在负一棵树、负两头牛、负三只羊…都是我们在生产生活中，加入了统计之后才引入了负的概念。       </p><p>在上面我们了解到，正数的原码、反码、补码都是相同的，而负数的反码是原码的取反，补码是反码+1。是不是觉得反码是针对负数设计的呢？哈哈。。      </p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/20210119224924.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/20210119224924.png" srcset="data:image/png;base64,666" alt="二进制进行加法计算"></p><p>在计算机中如何处理 -7 + 7 = 0的计算呢？ </p><blockquote><p>以4BIT的数为例，高位作为符号位：<br> 如果从原码的角度-&gt;<br> -7： 1111<br> 7：  0111<br> 如果拿原码做加法计算的话： 1 0110 高位舍去-&gt; 0110 = 6   结果很显然错了！<br> 如果从反码的角度-&gt;<br> -7:  1000<br> 7:   0111<br> 如果拿反码做加法计算的话： 1111 = -7   结果很显然也是错的！<br> 如果从补码的角度-&gt;<br> -7:  1001<br> 7:   0111<br> 如果拿补码做加法计算的话： 1 0000   丢到高位的符号位，结果为0  看结果就是这么巧合！！！<br> 综上，补码是做加减法最好的选择。</p></blockquote><p>说到现在，是不是觉得补码就是为了计算而设计的呢？哈哈。。。</p><h2 id="位运算"><a href="#位运算" class="headerlink" title="位运算"></a>位运算</h2><p>关于位运算，这里运用哲学上三个究极问题试图讲解清楚位运算究竟是何方神圣：什么是位运算？位运算的作用？位运算有什么优势？     </p><h3 id="什么是位运算？"><a href="#什么是位运算？" class="headerlink" title="什么是位运算？"></a>什么是位运算？</h3><p>程序中的所有数在计算机内存中都是以二进制的形式储存的。位运算就是直接对整数在内存中的二进制位进行操作。比如，and运算本来是一个逻辑运算符，但整数与整数之间也可以进行and运算。举个例子，6的二进制是110，11的二进制是1011，那么6 and 11的结果就是2，它是二进制对应位进行逻辑运算的结果（0表示False，1表示True，空位都当0处理）。<br>下表列出了位运算符的基本运算:<br>假设：两个4bit的数，高位表示符号位，A=3，B=7<br>bit(A)= 0011  bit(B)= 0111      </p><table><thead><tr><th>运算符</th><th>描述</th><th>例子</th></tr></thead><tbody><tr><td>按位与（&amp;）</td><td>如果相对应位都是1，则结果为1，否则为0</td><td>A&amp;B=3，即 0011</td></tr><tr><td>按位或（｜）</td><td>如果相对应位都是0，则结果为0，否则为1</td><td>A|B=7,   即 0111</td></tr><tr><td>按位异或（^）</td><td>如果相对应位值相同，则结果为0，否则为1</td><td>A^B= 4,  即 0100</td></tr><tr><td>按位取反（~）</td><td>按位取反运算符翻转操作数的每一位，即0变成1，1变成0</td><td>~A=-4, 即 1100</td></tr><tr><td>左移 （&lt;&lt;）</td><td>按位左移运算符。左操作数按位左移右操作数指定的位数</td><td>A&lt;&lt;2=-4, 即 1100</td></tr><tr><td>右移 （&gt;&gt;）</td><td>按位右移运算符。左操作数按位右移右操作数指定的位数</td><td>B&gt;&gt;2=1, 即0001</td></tr></tbody></table><h3 id="位运算的作用？"><a href="#位运算的作用？" class="headerlink" title="位运算的作用？"></a>位运算的作用？</h3><p>位运算其实在我们日常开发过程中经常会忽略掉，因为我们习惯了使用int或者long值进行计算，而忽略了底层的计算逻辑。找一个使用了位运算的代码研究下：copy自java.long.Integer的静态方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回一个int值，最多一个1位，位于指定int值的最高(&quot;最左&quot;)1位的位置。如果指定的值在其2的补码二进制表示中没有1位，也就是说，如果它等于0，则返回0。.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> i the value whose highest one bit is to be computed</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> an &#123;<span class="doctag">@code</span> int&#125; value with a single one-bit, in the position</span></span><br><span class="line"><span class="comment"> *     of the highest-order one-bit in the specified value, or zero if</span></span><br><span class="line"><span class="comment"> *     the specified value is itself equal to zero.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 1.5</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">highestOneBit</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// HD, Figure 3-1</span></span><br><span class="line">    i |= (i &gt;&gt;  <span class="number">1</span>);</span><br><span class="line">    i |= (i &gt;&gt;  <span class="number">2</span>);</span><br><span class="line">    i |= (i &gt;&gt;  <span class="number">4</span>);</span><br><span class="line">    i |= (i &gt;&gt;  <span class="number">8</span>);</span><br><span class="line">    i |= (i &gt;&gt; <span class="number">16</span>);</span><br><span class="line">    <span class="keyword">return</span> i - (i &gt;&gt;&gt; <span class="number">1</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>方法流程：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">int</span> <span class="title">highestOneBit</span><span class="params">(<span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//输入的i = 17  -&gt;  00000000 00000000 00000000 00010001</span></span><br><span class="line">    <span class="keyword">int</span> left = i &gt;&gt; <span class="number">1</span>; <span class="comment">// 00000000 00000000 00000000 00001000</span></span><br><span class="line">    i = i | left;   <span class="comment">//00000000 00000000 00000000 00011001   1 +8 +16 = 25</span></span><br><span class="line">    left = i &gt;&gt; <span class="number">2</span>; <span class="comment">//00000000 00000000 00000000 0000110</span></span><br><span class="line">    i = i | left; <span class="comment">//00000000 00000000 00000000 00011111  1+2+4+8+16 =31</span></span><br><span class="line">    left = i &gt;&gt; <span class="number">4</span>;<span class="comment">//00000000 00000000 00000000 00000001</span></span><br><span class="line">    i = i | left; <span class="comment">//00000000 00000000 00000000 00011111 31</span></span><br><span class="line">    left = i &gt;&gt; <span class="number">8</span>; <span class="comment">//00000000 00000000 00000000 00000000</span></span><br><span class="line">    i = i | left;  <span class="comment">// 00000000 00000000 00000000 00011111</span></span><br><span class="line">    left = i &gt;&gt; <span class="number">16</span>; <span class="comment">//00000000 00000000 00000000 00000000</span></span><br><span class="line">    i = i | left; <span class="comment">//00000000 00000000 00000000 00011111  1+2+4+8+16 = 31</span></span><br><span class="line">    <span class="keyword">final</span> <span class="keyword">int</span> i1 = i &gt;&gt;&gt; <span class="number">1</span>; <span class="comment">//00000000 00000000 00000000 00001111 1+2+4+8=15</span></span><br><span class="line">    <span class="keyword">return</span> i-i1; <span class="comment">// 31 -15 = 16</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>通过上述代码可以知道，这个过程其实就是一个求最高位的值，比如17的最高位是16，通过不断的右移做或运算，将17的除高位意外的其他位全部填为1，得到最终的i，然后通过i-i&gt;&gt;&gt;1得到高位的值</p><h3 id="位运算有什么优势？"><a href="#位运算有什么优势？" class="headerlink" title="位运算有什么优势？"></a>位运算有什么优势？</h3><p>通过上面的代码，可以看到位运算是很容易解决这种看似非常复杂的逻辑，另一方面如果从数据学计算的角度，我们可能需要引用其他的辅助参数和对象，去对其做计算可能会更加复杂。位运算是计算机的最容易读懂的计算逻辑，所以速度性能是最好的。</p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>计算机的位运算设计真的是博大精深，我深深受其计算逻辑所折服，通过对二进制位运算的学习，加深了对位运算的印象，可能存在一些错误的理解，欢迎指正，不甚感激。</p>]]></content>
      
      
      <categories>
          
          <category> Java </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 算法 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Docker相关命令</title>
      <link href="/dist/2021/01/18/Docker%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
      <url>/dist/2021/01/18/Docker%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="Docker访问mac宿主机器的ip"><a href="#Docker访问mac宿主机器的ip" class="headerlink" title="Docker访问mac宿主机器的ip"></a>Docker访问mac宿主机器的ip</h2><p>通过域名的访问：</p><figure class="highlight shell"><figcaption><span>script</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker.for.mac.host.internal</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> Docker </category>
          
      </categories>
      
      
        <tags>
            
            <tag> docker </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Presto从入门到放弃</title>
      <link href="/dist/2021/01/18/Presto%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/"/>
      <url>/dist/2021/01/18/Presto%E4%BB%8E%E5%85%A5%E9%97%A8%E5%88%B0%E6%94%BE%E5%BC%83/</url>
      
        <content type="html"><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="这是一个无效的密码。请检查后再试。" data-whm="这些解密的内容无法验证，但你仍然可以看一看。">  <script id="hbeData" type="hbeData" data-hmacdigest="b6e63146549c2a00252c3a3889e3a952cbe7683202e62131861953b957334dba">75a30dc0e3d3f019e95d95111134a912e88396269619864ae980f504635aa53cfddf6d3108ce997b7ada705ce69bef6e9d177ade28d6f17d9404a342ea79656ca89e11f557b9d5c8e064909e163669859f1f51352d11f6c97f535d042ce39333e8869c8479dfcb08f68ccd8eb43062a6ffc6012e02aff80e7d473b8256df60c5683df165205dd84028e1567ee576e456901467eb698a83d68bfad64c3e5e03a8f11694687f99fe933ebdae008d4940a9bbac096293fa8d61c2e56e52ae41d77aca377578d049640ab584e4f39b3577622a04214edf06294f72f7cf9a53fb7e8894d5fba5b72af1cfaea864fcf45de05d221b8d8ab06ff9ed81b5a5dd423df2c7b9fcc47b11ce6ad8f89430bacdfb20ef2ba4d26a03de62d423129c2a42f2628d12d31edb9bc4e0b6556f53fd1997f7e5e8c481c5b11ee218aceb89de111d0c2059d6034aee6440cf9f8eea260fc9b51837b7ceb13bae10b7e13888857391faad1c39fa9560bbb0d4e9479a4acf8bbf79588b37884655d90d554627624ae585aea9c4c66b6c31f38e55987567d01033fa5dd50dea4694c96de21f1f80a567c0e89f2d838eb97e5c855c0eb3c6c42dcc62d75a782201977ffb853e51e1a6ee4e2a9c2ac9417b639facd6049a343be9c25678371ea090f1cab87c8ed72399f86bbfe5309237b463101ebb74610d6dc3095e65ce748b9323551837b7225519ae346b00d23289b7131f410af0d4895864a06f828cbee26146491e96f398f3c84102fe512af874940a0b8b075d908e582c8311127dec68f75af179f0d8da57674185420af9c476f8074127c4c89a295fcc275d60a84e9c27be11970d1929bd6051e78d04431f4b5d7b13cbe74d7253570b70957b62f3c3440ab111d2d5f6a641594fb6c84664f69920958355f55916516f47be1f2fca56508f4d7ad06b27c8d7651de7dab846358adc76db894521dc494e3a30875398d23e80eda5c05205f573d190f447dffef8a38a33511b2da26a2d808a3d2ac4e291644261422cd9cde22f723bbbf0f53afdacc2ac789713fa70054ca2438e7530f4c35d57a72b075762bbf5bf61e6f3aa22aad176d2f37ae8f5e121d39cd6a367ff3b1bc6d878abca26623a1f5f1144e0a2851774f779e7f2fabffdcbc39793aafa1ce0d17f18b0ea5ff6863f8c77910406ee3d3d0286c92dbe87155bb559fb3f233d38fcf3929edefbb56d68c2ad380c9096344989b75619534722b6cf7eb00e89a036ed282e345cd434f836419f6867ac61eba0d02ccb9892f7ae232c0afa95fe584ae6077327c6725cb4a678d705d6ec83020e9f89ec20de64172075de2bf81b7ec2c00d1ffb836c7015e8e8a782e38de301ecfe63f69ce12949aae9616dd7453addea45c90283ad6edd1947b5cd8ecf1a2176a1e68fb64bda79dc19a447b0e8e5ff18f702dc0a5e73e879ae8afbc2a6380b215366e83edb42d4d9d0b7d357a4663f9dc478234fdf2eb01f79436e19b641940416b394e111a5abad35de55678562ce96051bfa670af76a5590e330b1ca60a3b504411a2cc327cc3073c0f7773b2ab94f934a04dd6249abf2224613ef147af56bec838d83d0ba20b81df29dbd80f6afe5138242a2b59985be92162aa3bd57f62840f5890d0fcd467ccb1ec77fded40365accedca33451389f2b2144f41b5453f30219b49479401b48acd8bf3cec58a18c875cd1bf073fb07178eefd814b99d60adb32f1bac24b05f5d29f34a8ece5e66365e4e6ea25d1a9134308bb5ec4a10425f786bd27e16673634a30e3f1452deaba332075751a3ae153a8af0d0331ac4219c4c666abe9612ce955735f4c0dd06a984843c5226134457f1ba5efff262aaf5f2b15b24db5e60ce48c35f49295d81a1b318a5edb48828d914d7052c85d01e970a89681adf1796a5de22572d1b4623465b93536b08e945c4945dce66d54318d5b50424016e2cd9a8238be29fc6c089268bad90eafca0d7db2653529b2f9c1d44864679c8167b73098f2312bffa58802cce34f3fe6613904810d10693ce72ed81b577ee4de8b0292f9c3c6b0aa9d2604fd9a2b9defad85c1c6c9458efbc2de51646c1234a7657b3a7303f2ba7c56d2be8df963e783320f878e381e7dc9e5dfc36b340645f32091eb626f6c8bf6b3becc089d8357e8e2caae66aa035188b9a4ebc31ba5d0ae5230bf576b6e1d92170e40cf2fe75bd41cd7a111deb07f6fa4e0b16585e56b7b8be6fd1d2cd6880eb41acd8e45250b01f5bf90505cf1f87552c8c2d9eb7f662473d7fb4d12a06dd100a15baab8b3da075d7b1d0d7fe6a6f8e219ffb12533071184dca054f9becfd26278ad85e28f59ef6eb47053ba6209023dd36eba1ccbaf0355321934eefccd026ae9cef3a027d6c0e0e28662cf7f8a8e7c6e1c7fefb5213296f932944e83353f3ace5b47829a108a1e5d51dac408a140b1c1fe888967d0c849e85e852729c3747d3e48e0d041fb0ee5c2d3c57bfc60eeb683d751d443efef03e2528122e326535127b441de35fd1c8d30be3039d87819f68e53e42680b61abb538ee2a03b431f06fb1726d917610d2a7d92551ba08283d79086ed5eac2b905192124dc1355045a605743e8f2faf1b4c6e815cd181cdea71c349f972df47137ffc88d195d866b35a26b8b52c269f3095789680db2d099916684a7fc8580e210de80e5708181790920548120ecf5f146204f6839e67c1a051fdf47b165e99e8d3e68232e1055b4b4bb126866997b8fee79a1b8f7cdb368a8c8d4889adf8ab0b00ec5fd144c82ebe9d58d4b0fce31eddbde1ca28f03bc8ca1bb89610fc465184054cacab611cef9c8e525d2089ecfbc4ec6fdc46ce0b363eda3b1ac1dc26555d04a61bfb2913f2334ac9ba4d12e8a9d09f69e3a2025dfdb63dbe1fe7e083f9960819f79551f6bc4fa8836add94969850835e990a3fddbe16e31023a8aedd1a7dcc28ffc03ee82b191463a4db263fffc31721c74e9eeac067bebdba0d536cd99217719abe267d8a2309b8f3b95f49e776054da7df63afe906f01b5003308667b1464e720c4ca69136537ad0713e0a667602c94d57d9feb802802480497ede05324f2a1d67bab990c847970052a1fceb1269a5e7f0174139b45abb775e5b78e93e47700323b3c419c22cc678bb0a78f068238b5a6d84d5d9a3f85588ca8ab58cf79e0840291d29dd0f946d6ddefcba66f31c23ac15fd42c8c9c3ec4b27ac58e0de0d63f2878cccd57062dffbb1fcafd51ab9bf227802c66c4165b9fbb3f82fa40de0f327230418fd041e79041e5bd84d5a8ef9ff20dd5d7c3ed5e16de7e2ee50693924cb8ce4e2bbbdd6ac6b0675e42a5637e2ccef94fdf27c69b217de34fd5da4999622da09ed20fffed41268dd3bb6c2e850564a5b338fb8bed064c92f728ae460a2eae62931e345ce46d802fd201b1c80a81d0eba77fa29b7f6794117a50aaf920df5272e79d7d5121ebb7a1e6c0ec6a5d37c1061d2524cc6f4893a62f930a46a1a0f25693e5ed9cc09db221dfb7d304b420ac2d8a6d380cc349e7ff0fd8341dabc6a231a329ecc7b095d37ac69d9eb2003fbcc759eee4ec3a9e4809f1945d81f4e1f826f96942930365e046576d35837e7d537d846b16962261f39ed7146c097791a699706925f5ebd0f9c41ced9e5007bc51400b1457cbad1e080a4481594668ee09acc8474c825a8c3f1c6bd495bc0b7f42526a5da9502c9a2c2dd0b62e31a337aebaab2442a06fb9b8668cc2c038ab8e3eb84d3a83d3b81b6cd2b2d73259e0ccfa169c151f7a05bccf287568a6280198d9c31cf771c3552e188cdb641396eb5c2b5db1b80c32b7776875155d2e5f72fa01b07dc29514dec2c63dc3dc4707d71e4bca226eb01e40b8525ad85e66ef88a7d6456887b5ca61b6b141baef1cb1da6626fb6711bd7cca60f683c932d0bb1120aebd1157bb5260643d6fa4a9fcc7cbceb6342f09e69c5ac004110fe25b14db75026e438317a6df191b67be468c53fa0a8ee663436f025406d97c08ce40f543a2645074a01c4a36d48a29a4737619788970d996fa239d10969a1a86f597fe5fb4a0eafa86408d251a6c49917214cf920db795f9da80c0a79d613d7abb01a73e84e917dba3887ab8319317985b3ec4177f4ae45c2d6742d699d5fa5631bda57dd0b488f29ad5e6a5f7a3d562b6eff27b308daf888f9929e8f83c34470fb906ae9115908e4e8b39cb285a5cbeac6a94fdd8d908603b4ca6fa0cb7dc9d806248ff93c521f23e0eec98a2597846162394ae36e9587abe472f91dcec4b3ce5826484daee4d8d266f5ddfcea66e8660a27f2d2305734a7a43e5ea480eaab19220aa0c199e5fcc53e61ee36b99521a98dfa5c2a61d4dd66bcd7ef0c88cfa888df9e13b128d17bd002d3b62470774d29992714a2d1422fe85d52fe956ba1d5911cfcad8f39d1f050f404ef83eeb6ae71e089364adc7df6545c3a7c4578feb2dcbe2dbfa1b5128832689639c82e744aa8dccc27ecade97c0fe5bc943c4322cf1b8ad510af809bfb9e00c45f3dad23014168296a3ee93cc109153dadd7f7d30d458e4ff69e7d106865c7a92becd4fcfffcfd56c874c976dedadefe4e9f701249cc5d5a7604752695bf14b9d710aac75bae408ce0a303bf8f2a32d58383260861672e59148799cd06d49d35aed0d09b7cc66e85d62455b50e55853efa00b7e7a8ea39fe2c54d07bfe60efd26f2d2558d0167edd532ac56bd725da490e8ad52e2f69064fca1e03f9440935a772a09edf4f482b976fb217b34e0a7974ce2f47535537e87075db1032d5703fd545c7b772d73c2b7dead2353209bdec663e7c1dd8174e6cdd21e74b01304dc77514f9377f84a0b5025ef9afcfd8fb0fa88aca095c29f582b60f7da07a1fed7cdcbabc80a5c751d8594f3d83b4b6f58b41c8f0307b228cc65bf72f592c6829da94a916a678bc2a45e795260aaeb1df1f284d825fdef3191f72183bfb3777bad8882750c50a08d74f585b603d50b943a26d5d5b041f37c577c3328f6221ce6ee2f9b40b8f2572790ea0db8425662def59557b59709c439b7e29d6ea9c38d89471aafa10e7eec3bfccce34eca7bb0117f46cb63c2e031b2b2fd7459aa68371b39893601f40d98aaf1255e0780b0caa34ca89c9e09ef18194118daad34850c4f9428bb9b48c9642c88e638d08f0fbf3c07a21627ace8a9ad1f3c96ebac465690ff7fe562caa8b06c6af8482c42df6229b6626a3e4b9998d189de6ae7e756598bb5811d3baab09bd80c082908411da6ddd82d5221feee3f6e4b5a72ff14a4c3c49b2abac4120934e3cfadfd83de544f1f10f6ae94e309b803b68800cc982c18153b4937a38156e493e7fee3522339803cf69fe15a65fcf4de2f478a41c8301ceb43c19d9a6c13add4747a1f7e6cfafeef4e1a5617b7432aa02b4acbb529decb4caac9c06e97c0fdd8251f0aef4ba2773a6069bbf15a77dec99a6bd90961ec38f85204de2fc1be73fe80f29b8433a8b8cafd0b272447536bf4d07abc324afe6c6071ad6461fb0ae50f0574bdac828326b362a7e430ee0119205d3fe1524145bc831647bf817498ab0232ff8bc2b7bf16371d405648b44b532d4fb8d7f95d9dccff005854656a8e0131f6eb4acafcd95db183a2d8d959406a40f6dcc50fd46ce8026243da7c4f9349aa65a10b606f13a057a7da8064606d0b9ad2f11e3fc37f29360e6c99df6e9159a73386b734ab238761dfc821baa9161734ae273dbfb6e52c5f02edcf7118366ec7573027ad7a0a3637b54533bca9bd6da3ea423dfed149a0cb8eeae2330ebda8bb96eaa3a244a27a326f1408a34dc70b5ae47755b83cd927ad691ee6e177f05259d5e97c9e75dcc16b18f834b4606e6dd53761bb2d9910cec72b1ac88dfaf4e1e020c744f3106fcc966079cf458431b3ab0bbf1985556b819100944bbba13714362511b9fa4a61b0e5e64354340abd75a80484c048b37035beb2e2c521741e8fe1567d9792699a7578c548dc9a6c370bdc38458d6e17ae7d1e19f5ddbec92473c799cbc9f3dc481687e72f34abf76253f7a578333463172b5d0dcef44ff5d2de0b5f57dbde706f112e35365c7e2bc6d204e40cb38f7bbd223cb900b3e69c2a56c7bf250e8a98a8a31200f8aa962f6b53ca9c6186ec47a9e6316fa5c2e7cc708a635fa632478a830f3930bd6343262160996f4436dd8238b2749f30b8ff37aaa2e74a08a2f7ca4504f4b7e9c42ab7b1a7216b26fd34fad1d71beed4c97a46e33f64e654eadc9807082677d5a88c129337f982e782314f4d5b1a8c85b4528aafeb6e2215f2f475188e38746ecafc64a0bb5592484ebc3c5d44f6f369aa69496616788a0c67785036d14a60fa5bd2793c33553378a0c7aa448cc2b1ee8ad78c7cf672f300e3e1a09a6a1159e5218a548cbb0f84245802fa2f57e8cd36417cbeac22f6932b68b5782c64c9e56039b50d1b832c15a730b5a89c0321e3890483a59401672b17fa1f28b0d75f5c80fde69c2e18408739fb3cd2fd5c20d6753a9c15d5a3bb32127a8bb13a32181b15ec1af9487ee3480a06dbbb2d826f6f5a6e011480d73434da5ac227a9c7645db7aad87d2d91132050012c943d93c47ab53d0090f94b89e360b89fc9116a8c38a3f280e7d357fd0e8cdf5d0c242e2c8eaa5670859526c87e09862d6da3f8a3f9040bc39d5467bf35bdfdd8ad1032bd2202aae66397e1d2356d69ad0074065ada9ce0e1f0d5baefcaa888fad50dc47a469faae38b42e08f58454fd36caff12331f09ffe0310db10423d48222a067e5ca7044f36ae53ca124a7ae537016a4090e057620f7d1bbdb891b37443f1ee6e6c620e24314feb684da5c99062b4161c27863b0220fcfd6efb3e87a5d85d9083827c98ab15c98ac80359c275e182c59aeac38d2ddc7a5f0f46de49c6c87d4b5fceb803496263d5f2f2988b53aa595da399f696435c4e05f3587bcd7207abbfae1fd650bb32668103749680e20d9030166538854669072603590cdb255a1180d53464eef2a24b485c69041346df7489041024e3f3b88e7f568c031ea1635502ce38b89f115b6aaf49863799863a8776189a5e956c244d76b1b1fc21106029d114c971d8399e311a25bdcde547d0e75fff42f7cec92c64206c7a7438c527dd6e8779178845bd48058c2b704cee151688db5f2d8f22a494637669570fb7247dec71e6f645b7fc59a6bddc5c309c5205a57e1a05a371f689ff27579943dd275b1b5fb1e80426e184373106b475ae231a04c6dde6fa35b12de9b74e546dcb63cd00633ead368e05415e4156271fd4b11ff4e7e0d483f800d605aab24f43daf0a19169e29d5d5961976ffe4133130c1f40706e9c43fd72665123ef526d71c03d6b1f0078d6eb68f6303d7656937a877bb7d2d8944d3676069e548eb54efee52e13a293747709d026b34cf41d553fdf6e2d3548134053b9efee6eabf7adb7c865a38621b8fcd23c1c7b5029d827ec082c9c79b8ab843b18bbadf66f8ca8a6876534c979ed009f19edf91c3a1aec7507af0500ee21d50890c2647b8ab41c56c70e781af02ba31169ceffa5dcace2f13a8c8ecca4e6322cbfc5a366846dd680bcf1abdc45e9d6788596627fbf30d246c76502b5ed1a647ff9d35b232b51e503873ba692f9e051f64e5d26d05fc6879165ebbb66d75375f2b5a811abbfc4585c3994df75f15c571ce5df13b1018b0c2d6caba94388071bc79cb72c036a5ff93610444c446e6101111a504562f6f4f8d17018ddf05fb244b200214591a13fa61bf3f11e4a651ed95690ec01cd8621e2b43e4eb7cedd07444e5170db8d0c971f5095513f89ad99204827d6e6b3ac79ce93d59a736783de18c348c1996973d07575cc23c00d038</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-xray">      <input class="hbe hbe-input-field hbe-input-field-xray" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-xray" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-xray">Hey, password is required here.</span>      </label>      <svg class="hbe hbe-graphic hbe-graphic-xray" width="300%" height="100%" viewBox="0 0 1200 60" preserveAspectRatio="none">        <path d="M0,56.5c0,0,298.666,0,399.333,0C448.336,56.5,513.994,46,597,46c77.327,0,135,10.5,200.999,10.5c95.996,0,402.001,0,402.001,0"></path>        <path d="M0,2.5c0,0,298.666,0,399.333,0C448.336,2.5,513.994,13,597,13c77.327,0,135-10.5,200.999-10.5c95.996,0,402.001,0,402.001,0"></path>      </svg>    </div>  </div></div><script src="/dist/lib/hbe.js"></script><link href="/dist/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      
      
      <categories>
          
          <category> 数据仓库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 数据仓库 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>记kafka启动失败</title>
      <link href="/dist/2021/01/18/kafka%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E8%A7%A3%E5%86%B3%E6%80%BB%E7%BB%93/"/>
      <url>/dist/2021/01/18/kafka%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E8%A7%A3%E5%86%B3%E6%80%BB%E7%BB%93/</url>
      
        <content type="html"><![CDATA[<h1 id="场景"><a href="#场景" class="headerlink" title="场景"></a>场景</h1><p>在项目开发中，需要使用到kafka，但是无论如何本地环境的kafka都无法启动，zookeeper状态是正常的，kafka就是起不来，导致项目的日志消费的任务一直阻塞。重新启动会发生异常：InconsistentClusterIdException。</p><h1 id="异常的信息"><a href="#异常的信息" class="headerlink" title="异常的信息"></a>异常的信息</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">ERROR Fatal error during KafkaServer startup. Prepare to shutdown (kafka.server.KafkaServer)</span><br><span class="line">kafka.common.InconsistentClusterIdException: The Cluster ID F-bhGf-3T1qgjuQ0c1wCRw doesn&#39;t match stored clusterId Some(FO2XIwDrSSiJSeWo4B80hQ) in meta.properties. The broker is trying to join the wrong cluster. Configured zookeeper.connect may be wrong.</span><br><span class="line">at kafka.server.KafkaServer.startup(KafkaServer.scala:223)</span><br><span class="line">at kafka.server.KafkaServerStartable.startup(KafkaServerStartable.scala:44)</span><br><span class="line">at kafka.Kafka$.main(Kafka.scala:82)</span><br><span class="line">at kafka.Kafka.main(Kafka.scala)</span><br><span class="line">    ....</span><br></pre></td></tr></table></figure><h1 id="原因分析及解决方案"><a href="#原因分析及解决方案" class="headerlink" title="原因分析及解决方案"></a>原因分析及解决方案</h1><p>kafka的配置日志路径，用来保存kafka的执行过程中的信息，如果kafka异常关闭，日志记录就会出现异常，会把当时的情况记录在meta.properties文件中，重启时，此文件会对启动产生影响。原因是，里面记录了borker 和cluster-id,导致的报错。</p><h2 id="解决方式"><a href="#解决方式" class="headerlink" title="解决方式"></a>解决方式</h2><ul><li>清空日志目录【日志不重要或可以容忍日志丢失】。</li><li>调整日志目录【需要修改配置】。</li><li>删除日志目录下的meta.properties文件。</li></ul>]]></content>
      
      
      <categories>
          
          <category> 项目管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> kafka </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>CentOS7常用命令</title>
      <link href="/dist/2021/01/18/CentOS7%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/"/>
      <url>/dist/2021/01/18/CentOS7%E5%B8%B8%E7%94%A8%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="CentOS7常用命令"><a href="#CentOS7常用命令" class="headerlink" title="CentOS7常用命令"></a>CentOS7常用命令</h2><h3 id="1、服务器之间copy文件"><a href="#1、服务器之间copy文件" class="headerlink" title="1、服务器之间copy文件"></a>1、服务器之间copy文件</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 将文件spark-3.0.1-bin-hadoop2.7.tgz copy到node1机器的/home/wuxuan/package/目录下</span></span><br><span class="line">$ scp spark-3.0.1-bin-hadoop2.7.tgz wuxuan@node1:/home/wuxuan/package/</span><br></pre></td></tr></table></figure><h3 id="2、防火墙相关操作"><a href="#2、防火墙相关操作" class="headerlink" title="2、防火墙相关操作"></a>2、防火墙相关操作</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查看防火墙状态</span></span><br><span class="line">$ firewall-cmd --state</span><br><span class="line"></span><br><span class="line"><span class="comment"># 关闭防火墙</span></span><br><span class="line">$ systemctl stop firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动防火墙</span></span><br><span class="line">$ systemctl start firewalld.service</span><br><span class="line"></span><br><span class="line"><span class="comment"># 重启网卡</span></span><br><span class="line">$ systemctl restart network.service</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="CentOS之间设置免密访问"><a href="#CentOS之间设置免密访问" class="headerlink" title="CentOS之间设置免密访问"></a>CentOS之间设置免密访问</h2><h3 id="一、准备阶段"><a href="#一、准备阶段" class="headerlink" title="一、准备阶段"></a>一、准备阶段</h3><p>准备两台机器：<br>192.168.100.11   node1<br>192.168.100.12   node2   </p><h3 id="二、设置hosts"><a href="#二、设置hosts" class="headerlink" title="二、设置hosts"></a>二、设置hosts</h3><p>在每台机器中设置hosts   </p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$ vim /etc/hosts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#添加hosts</span></span><br><span class="line">192.168.100.11   node1   </span><br><span class="line">192.168.100.12   node2   </span><br></pre></td></tr></table></figure><h3 id="三、每台机器设置hostname（主机名称）"><a href="#三、每台机器设置hostname（主机名称）" class="headerlink" title="三、每台机器设置hostname（主机名称）"></a>三、每台机器设置hostname（主机名称）</h3><p>设置hostname</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 登陆到192.168.100.11</span></span><br><span class="line">$ hostname node1</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆到192.168.100.12</span></span><br><span class="line">$ hostname node2</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="四、给每台机器生成ssh密钥"><a href="#四、给每台机器生成ssh密钥" class="headerlink" title="四、给每台机器生成ssh密钥"></a>四、给每台机器生成ssh密钥</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># 登陆到192.168.100.11</span></span><br><span class="line">$ <span class="built_in">cd</span> /root/.ssh</span><br><span class="line">$ ssh-keygen -t rsa</span><br><span class="line">$ ls</span><br><span class="line"></span><br><span class="line">id_rsa  id_rsa.pub</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将机器的公钥备份</span></span><br><span class="line">$ cp id_rsa.pub &gt;&gt; authorized_keys</span><br><span class="line"><span class="comment"># 将文件传输给机器192.168.100.12</span></span><br><span class="line">$ scp authorized_keys  root@node2:/root/.ssh/</span><br><span class="line"></span><br><span class="line"><span class="comment"># 登陆到192.168.100.12 </span></span><br><span class="line">$ hostname node2</span><br><span class="line"></span><br><span class="line">$ cat id_rsa.pub &gt;&gt; authorized_keys</span><br></pre></td></tr></table></figure><p>到此node2的authorized_keys包含node1和node2的公钥<br>重复此操作，即可实现node1和node2的免密访问  </p><p>测试:</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ ssh node2</span><br><span class="line">Last login: Fri Nov 13 16:01:17 2020 from node1</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> 开发总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot自定义starter</title>
      <link href="/dist/2021/01/18/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89starter/"/>
      <url>/dist/2021/01/18/SpringBoot%E8%87%AA%E5%AE%9A%E4%B9%89starter/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBoot自定义starter"><a href="#SpringBoot自定义starter" class="headerlink" title="SpringBoot自定义starter"></a>SpringBoot自定义starter</h1><h2 id="学习背景"><a href="#学习背景" class="headerlink" title="学习背景"></a>学习背景</h2><p>&nbsp;&nbsp;最近和同事在开发一个叫做数据准备的项目，用到了SpringBoot（ps：之前的项目用的是ssm，第一次正式使用SpringBoot）,现在对于这种开箱即用的SpringBoot-Starter感到无比的惊叹，需要使用某个中间件，只需引入然后附加少许配置即可投入生产。今天就开始学习一下SpringBoot的starter的开发规范。</p><h2 id="Starter的构成"><a href="#Starter的构成" class="headerlink" title="Starter的构成"></a>Starter的构成</h2><h3 id="1、命名"><a href="#1、命名" class="headerlink" title="1、命名"></a>1、命名</h3><p>创建一个工程叫做Flyway-spring-boot-starter</p><blockquote><p>Spring 官方对 starter 的命名是有规范的，只有官方提供的 starter, 才能命名为 spring-boot-starter-{name}, 比如 spring-boot-starter-web; 而对于非官方的，需以 {name}-spring-boot-starter 的格式命名。</p></blockquote><h3 id="2、增加Spring-Boot-AutoConfiguration依赖"><a href="#2、增加Spring-Boot-AutoConfiguration依赖" class="headerlink" title="2、增加Spring-Boot-AutoConfiguration依赖"></a>2、增加Spring-Boot-AutoConfiguration依赖</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 自动化配置依赖，自定义 starter 核心依赖包 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-autoconfigure<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3、新增自动配置类"><a href="#3、新增自动配置类" class="headerlink" title="3、新增自动配置类"></a>3、新增自动配置类</h3><p>&nbsp;&nbsp;创建类 FlyWayAutoConfiguration 来实现自动配置化功能</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.flyway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnClass;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.autoconfigure.condition.ConditionalOnMissingBean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.EnableConfigurationProperties;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/19 5:57 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(SelfService.class)</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(SelfProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FlyWayAutoConfiguration</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> SelfService <span class="title">selfService</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> SelfService();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>接下来，对上面相关注解说明一下：<br>@Configuration: 标注类为一个配置类，让 spring 去扫描它；<br>@ConditionalOnClass：条件注解，只有在 classpath 路径下存在指定 class 文件时，才会实例化 Bean；<br>@EnableConfigurationProperties：使指定配置类生效；<br>@Bean: 创建一个实例类注入到 Spring Ioc 容器中；<br>@ConditionalOnMissingBean：条件注解，意思是，仅当 Ioc 容器不存在指定类型的 Bean 时，才会创建 Bean。</p><h3 id="4、自定义配置类及功能实现"><a href="#4、自定义配置类及功能实现" class="headerlink" title="4、自定义配置类及功能实现"></a>4、自定义配置类及功能实现</h3><p>创建自定义配置类 SelfProperties</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.flyway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/19 6:01 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;flyway.self&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String message = <span class="string">&quot;hello flyway&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getMessage</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> message;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setMessage</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.message = message;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>创建SelfService业务方法</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.flyway;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/19 6:04 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SelfService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SelfProperties selfProperties;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> selfProperties.getMessage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="5、创建spring-factories文件"><a href="#5、创建spring-factories文件" class="headerlink" title="5、创建spring.factories文件"></a>5、创建spring.factories文件</h3><p>&nbsp;&nbsp;在resource目录下创建META-INF目录，在该目录下创建spring.factories文件。<br>Spring Boot 会在启动时，自动会去查找指定文件 /META-INF/spring.factories，若有，就会根据配置的类的全路径去自动化配置。</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">org.springframework.boot.autoconfigure.EnableAutoConfiguration</span>=<span class="string">com.yidan.flyway.FlywayAutoConfiguration</span></span><br></pre></td></tr></table></figure><h3 id="6、自定义的配置信息元数据描述"><a href="#6、自定义的配置信息元数据描述" class="headerlink" title="6、自定义的配置信息元数据描述"></a>6、自定义的配置信息元数据描述</h3><p>我们在开发SpringBoot的项目时，在写application.properties(或application.yml)时，IDEA会自动智能提醒，key和value的值。它是如何做到的呢？在Spring的官方文档中有相对应的介绍<a href="https://docs.spring.io/spring-boot/docs/current/reference/html/appendix-configuration-metadata.html">SpringBoot自定义配置详解</a></p><p>在Resourse目录下的META-INF 创建:spring-configuration-metadata.json</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;groups&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;sourceType&quot;</span>: <span class="string">&quot;com.yidan.flyway.SelfProperties&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;com.yidan.flyway.SelfProperties&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;flyway.self&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;hints&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;flyway.self.message&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;values&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;value&quot;</span>:<span class="string">&quot;hello flyway&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;第一个值&quot;</span></span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;value&quot;</span>: <span class="string">&quot;hello configuration&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;第二个值&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="attr">&quot;providers&quot;</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;flyway starter&quot;</span>,</span><br><span class="line">          <span class="attr">&quot;parameters&quot;</span>: <span class="string">&quot;123&quot;</span></span><br><span class="line">        &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;properties&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;flyway.self.message&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;java.lang.String&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;自定义的配置&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;sourceType&quot;</span>: <span class="string">&quot;com.yidan.flyway.SelfProperties&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;defaultValue&quot;</span>: <span class="string">&quot;hello flyway&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;deprecation&quot;</span>: &#123;</span><br><span class="line">        <span class="attr">&quot;level&quot;</span>: <span class="string">&quot;warning&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;reason&quot;</span>: <span class="string">&quot;测试忽略理由&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;replacement&quot;</span>: <span class="string">&quot;hello configuration&quot;</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="项目使用"><a href="#项目使用" class="headerlink" title="项目使用"></a>项目使用</h2><p>引入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.yidan<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>flyway-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;project.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>使用我们自动装配的bean： SelfService, 修改配置文件中：flyway.self.message=hello configuration （此时IDEA会自动提示我们自定义的key，甚至有值的推荐）</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yidan.passport;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yidan.flyway.SelfService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.GetMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/10/19 6:08 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> SelfService selfService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/get&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">message</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> selfService.message();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ curl http:&#x2F;&#x2F;localhost:6002&#x2F;get</span><br><span class="line">hello configuration</span><br></pre></td></tr></table></figure><p>完，后续遇到再做补充！！！</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SpringBoot </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SpringBoot测试系统整理</title>
      <link href="/dist/2021/01/18/SpringBoot%E6%B5%8B%E8%AF%95%E7%B3%BB%E7%BB%9F%E6%95%B4%E7%90%86/"/>
      <url>/dist/2021/01/18/SpringBoot%E6%B5%8B%E8%AF%95%E7%B3%BB%E7%BB%9F%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h1 id="SpringBoot测试系统整理"><a href="#SpringBoot测试系统整理" class="headerlink" title="SpringBoot测试系统整理"></a>SpringBoot测试系统整理</h1><p>Spring boot 作为当前最流行的java后端开发框架，集成了很多非常有用的东西，今天探索：Springboot test<br>引入依赖：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><h2 id="一、测试方式的整理"><a href="#一、测试方式的整理" class="headerlink" title="一、测试方式的整理"></a>一、测试方式的整理</h2><h3 id="1-1、单元测试"><a href="#1-1、单元测试" class="headerlink" title="1.1、单元测试"></a>1.1、单元测试</h3><p>在维基百科中的解释：</p><blockquote><p>在计算机编程中，单元测试（英语：Unit Testing）又称为模块测试，是针对程序模块（软件设计的最小单位）来进行正确性检验的测试工作。程序单元是应用的最小可测试部件。在过程化编程中，一个单元就是单个程序、函数、过程等；对于面向对象编程，最小单元就是方法，包括基类（超类）、抽象类、或者派生类（子类）中的方法。  </p></blockquote><p>例如在开发过程中，我们一般都是这么做单元测试的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilsTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringBuilder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String result = <span class="keyword">new</span> StringBuilder().append(<span class="number">1</span>).append(<span class="number">1</span>).toString();</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&quot;11&quot;</span>.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通常来说，开发每当修改一次方法，都会重新进行单元测试，以保证程序的方法是正确的。虽然单元测试在开发过程中不是必须的，但是对于开发来说是非常有必要的，属于开发自测的一种非常实用的手段，减少代码出现bug的机率。  </p><h3 id="1-2、集成测试"><a href="#1-2、集成测试" class="headerlink" title="1.2、集成测试"></a>1.2、集成测试</h3><blockquote><p>集成测试（有时称为集成和测试(Integration Testing)，缩写为I＆T）是软件测试的阶段，在该阶段中，将各个软件模块组合在一起并作为一个整体进行测试。集成测试中进行评估依从性的系统或部件的与指定的功能要求。[1]它发生在单元测试之后和验证测试之前。集成测试以经过单元测试的输入模块为准，将它们按较大的聚合分组，应用集成测试计划中定义的测试这些聚合，并提供集成系统作为系统测试准备就绪的输出。</p></blockquote><p>集成测试和单元测试的区别在于，单元测试仅仅测试的一般是一个方法(单元)，不涉及到方法组合测试，因此集成测试将完成多个单元的组合测试，以测试在具有业务场景的逻辑下进行的测试集成，所以一般单元测试在集成测试之前。</p><h3 id="1-3、Mock测试"><a href="#1-3、Mock测试" class="headerlink" title="1.3、Mock测试"></a>1.3、Mock测试</h3><p>Mock测试属于一种特殊的测试场景，在开发的过程中，可能由于协同开发的原因，自己需要测试自己开发的业务，但是业务中又依赖了同事开发的一些功能。按照正常的测试逻辑，可能会出现无法正常的完成测试需求，甚至代码都无法执行，此时就可以使用Mock测试的方法方法。<br>Mock测试的原理大致为：如果测试的方法依赖未知的对象时，可以通过Mock去抽象这个未知的对象，并对未知的对象的方法进行抽象返回我们想要的数据，以供我们的测试使用。以此完成我们的方法测试需求。<br>Spring Boot的测试模块支持Mock测试和junit测试。因此我们在SpringBoot开发时，可以在引入了Springboot测试模块后直接享受Mock测试和Junit单元测试带来的便利。</p><h2 id="二、Springboot常用的测试方法"><a href="#二、Springboot常用的测试方法" class="headerlink" title="二、Springboot常用的测试方法"></a>二、Springboot常用的测试方法</h2><h3 id="2-1、测试普通工具方法"><a href="#2-1、测试普通工具方法" class="headerlink" title="2.1、测试普通工具方法"></a>2.1、测试普通工具方法</h3><p>所谓普通的方法，类似于工具类中的工具方法，不依赖于任何外部环境，例如Spring上下文信息，redis template，Mysql jdbc等。那么我们可以直接使用Junit对其进行测试。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UtilsTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testStringBuilder</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String result = <span class="keyword">new</span> StringBuilder().append(<span class="number">1</span>).append(<span class="number">1</span>).toString();</span><br><span class="line">        <span class="keyword">assert</span> <span class="string">&quot;11&quot;</span>.equals(result);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-3、测试业务方法"><a href="#2-3、测试业务方法" class="headerlink" title="2.3、测试业务方法"></a>2.3、测试业务方法</h3><p>在Spring中的业务方法，都是通过IOC直接注入到Spring 容器中的，简单的使用Junit是无法直接执行的，必须指定Spring的上下文信息，保证其运行时能够从Spring容器中获取到对应的依赖Bean。<br>例如：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> CarService carService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        car.setType(<span class="string">&quot;SUV&quot;</span>);</span><br><span class="line">        car.setName(<span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        car = carService.add(car);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>测试CarService中的一个add方法，并且注入了CarService的Bean，@Transactional 开启了该方法的事务，@Rollback的意思是，执行玩测试方法，事务回滚，即不会修改数据库的数据。@Rollback必须配合@Transactional ，也就是只有事务开启了，才会生效。  </p><h3 id="2-3、测试Restful接口"><a href="#2-3、测试Restful接口" class="headerlink" title="2.3、测试Restful接口"></a>2.3、测试Restful接口</h3><p>在开发过程中，需要测试提供给前端的接口，一般有两种方式：</p><ul><li>postman：好处能够和对应的google插件一起配合使用，共享google浏览器的cookie信息</li><li>MockMvc的方式：好处就是纯代码测试，可以控制数据入库，也能得到更详细请求数据。</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarControllerTest</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> WebApplicationContext wac;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setupMockMvc</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(wac).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testListCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mockMvc.perform(get(<span class="string">&quot;/car/list/&quot;</span>)).andDo(MockMvcResultHandlers.print());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="meta">@Rollback</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;: \&quot;BMW\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;: \&quot;SUV\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/car/&quot;</span>).accept(MediaType.APPLICATION_JSON_VALUE).content(json).contentType(MediaType.APPLICATION_JSON_VALUE))</span><br><span class="line">                .andDo(MockMvcResultHandlers.print());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//测试的结果：</span></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * MockHttpServletRequest:</span></span><br><span class="line"><span class="comment">     *     HTTP Method = POST</span></span><br><span class="line"><span class="comment">     *     Request URI = /car/</span></span><br><span class="line"><span class="comment">     *     Parameters = &#123;&#125;</span></span><br><span class="line"><span class="comment">     *     Headers = [Content-Type:&quot;application/json&quot;, Accept:&quot;application/json&quot;, Content-Length:&quot;40&quot;]</span></span><br><span class="line"><span class="comment">     *     Body = &lt;no character encoding set&gt;</span></span><br><span class="line"><span class="comment">     *     Session Attrs = &#123;&#125;</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     Handler:</span></span><br><span class="line"><span class="comment">     *     Type = com.yiyi.controller.CarController</span></span><br><span class="line"><span class="comment">     *             Method = com.yiyi.controller.CarController#add(Car)</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     Async:</span></span><br><span class="line"><span class="comment">     *     Async started = false</span></span><br><span class="line"><span class="comment">     *     Async result = null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     Resolved Exception:</span></span><br><span class="line"><span class="comment">     *     Type = null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     ModelAndView:</span></span><br><span class="line"><span class="comment">     *     View name = null</span></span><br><span class="line"><span class="comment">     *     View = null</span></span><br><span class="line"><span class="comment">     *     Model = null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     FlashMap:</span></span><br><span class="line"><span class="comment">     *     Attributes = null</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     *     MockHttpServletResponse:</span></span><br><span class="line"><span class="comment">     *     Status = 200</span></span><br><span class="line"><span class="comment">     *     Error message = null</span></span><br><span class="line"><span class="comment">     *     Headers = [Content-Type:&quot;application/json&quot;]</span></span><br><span class="line"><span class="comment">     *     Content type = application/json</span></span><br><span class="line"><span class="comment">     *     Body = &#123;&quot;id&quot;:27,&quot;name&quot;:&quot;BMW&quot;,&quot;type&quot;:&quot;SUV&quot;&#125;</span></span><br><span class="line"><span class="comment">     *     Forwarded URL = null</span></span><br><span class="line"><span class="comment">     *     Redirected URL = null</span></span><br><span class="line"><span class="comment">     *     Cookies = []</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>在面的测试例子中，做了两件事：<br>1、开启了Springboot的测试，初始化了Spring的上下文环境<br>2、通过web上下文，初始化了MockMvc的Bean，便于接口的请求</p><h3 id="2-4、特殊场景下，自定义配置的测试"><a href="#2-4、特殊场景下，自定义配置的测试" class="headerlink" title="2.4、特殊场景下，自定义配置的测试"></a>2.4、特殊场景下，自定义配置的测试</h3><h4 id="2-4-1、指定profile的方式"><a href="#2-4-1、指定profile的方式" class="headerlink" title="2.4.1、指定profile的方式"></a>2.4.1、指定profile的方式</h4><p>新增配置文件application-test.xml<br>将@ActiveProfiles设置为test，在运行测试时，将会按照上面的配置文件进行初始化Spring bean</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@ActiveProfiles(&quot;test&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> CarService carService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;test.value&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        car.setType(<span class="string">&quot;SUV&quot;</span>);</span><br><span class="line">        car.setName(<span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        car = carService.add(car);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">assert</span> value == <span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="2-5、Mock测试的使用"><a href="#2-5、Mock测试的使用" class="headerlink" title="2.5、Mock测试的使用"></a>2.5、Mock测试的使用</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> CarService carService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAddCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//测试添加CarController 的addCar接口，使用MockBean模拟的CarService的Bean</span></span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        car.setId(<span class="number">111L</span>);</span><br><span class="line">        car.setName(<span class="string">&quot;BYD&quot;</span>);</span><br><span class="line">        car.setType(<span class="string">&quot;SUV&quot;</span>);</span><br><span class="line">        Car car1 = <span class="keyword">new</span> Car();</span><br><span class="line">        <span class="comment">//期望调用addCar方法传入一个car1返回一个car的对象，对象的数据为 id=111L，name=BYD， type=SUV</span></span><br><span class="line">        Mockito.when(carService.add(car1)).thenReturn(car);</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">&quot;&#123;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        mockMvc.perform(post(<span class="string">&quot;/car/&quot;</span>).accept(MediaType.APPLICATION_JSON_VALUE).content(json).contentType(MediaType.APPLICATION_JSON_VALUE))</span><br><span class="line">                .andDo(MockMvcResultHandlers.print());</span><br><span class="line">        <span class="comment">//执行结果：</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * MockHttpServletRequest:</span></span><br><span class="line"><span class="comment">         *       HTTP Method = POST</span></span><br><span class="line"><span class="comment">         *       Request URI = /car/</span></span><br><span class="line"><span class="comment">         *        Parameters = &#123;&#125;</span></span><br><span class="line"><span class="comment">         *           Headers = [Content-Type:&quot;application/json&quot;, Accept:&quot;application/json&quot;, Content-Length:&quot;2&quot;]</span></span><br><span class="line"><span class="comment">         *              Body = &lt;no character encoding set&gt;</span></span><br><span class="line"><span class="comment">         *     Session Attrs = &#123;&#125;</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Handler:</span></span><br><span class="line"><span class="comment">         *              Type = com.yiyi.controller.CarController</span></span><br><span class="line"><span class="comment">         *            Method = com.yiyi.controller.CarController#add(Car)</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Async:</span></span><br><span class="line"><span class="comment">         *     Async started = false</span></span><br><span class="line"><span class="comment">         *      Async result = null</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * Resolved Exception:</span></span><br><span class="line"><span class="comment">         *              Type = null</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * ModelAndView:</span></span><br><span class="line"><span class="comment">         *         View name = null</span></span><br><span class="line"><span class="comment">         *              View = null</span></span><br><span class="line"><span class="comment">         *             Model = null</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * FlashMap:</span></span><br><span class="line"><span class="comment">         *        Attributes = null</span></span><br><span class="line"><span class="comment">         *</span></span><br><span class="line"><span class="comment">         * MockHttpServletResponse:</span></span><br><span class="line"><span class="comment">         *            Status = 200</span></span><br><span class="line"><span class="comment">         *     Error message = null</span></span><br><span class="line"><span class="comment">         *           Headers = [Content-Type:&quot;application/json&quot;]</span></span><br><span class="line"><span class="comment">         *      Content type = application/json</span></span><br><span class="line"><span class="comment">         *              Body = &#123;&quot;id&quot;:111,&quot;name&quot;:&quot;BYD&quot;,&quot;type&quot;:&quot;SUV&quot;&#125;</span></span><br><span class="line"><span class="comment">         *     Forwarded URL = null</span></span><br><span class="line"><span class="comment">         *    Redirected URL = null</span></span><br><span class="line"><span class="comment">         *           Cookies = []</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>在这个测试代码中，模拟了一个CarService的bean，并且模拟了CarService#add(car)的方法参数及返回的结果。所以Controller的接口调用依赖了这个模拟的方法，所以返回的结果和我们预期模拟的结果是一致的。<br>针对于上面的例子，如果在不mock的方法的前提下调用Mock出来的CarSerVice#list()方法，结果会是什么呢？回去执行原本的Spring的代理方法操作数据库还是报错呢？  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MockTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@MockBean</span></span><br><span class="line">    <span class="keyword">private</span> CarService carService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MockMvc mockMvc;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> WebApplicationContext context;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setUp</span><span class="params">()</span></span>&#123;</span><br><span class="line">        mockMvc = MockMvcBuilders.webAppContextSetup(context).build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">     <span class="meta">@Test</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testList</span><span class="params">()</span></span>&#123;</span><br><span class="line">            Car car = <span class="keyword">new</span> Car();</span><br><span class="line">            car.setName(<span class="string">&quot;BYD&quot;</span>);</span><br><span class="line">            car.setType(<span class="string">&quot;SUV&quot;</span>);</span><br><span class="line">            Car car1 = carService.add(car);</span><br><span class="line">            System.out.println(<span class="string">&quot;car：&quot;</span>+car1);</span><br><span class="line">            List&lt;Car&gt; list = carService.list();</span><br><span class="line">            System.out.println(<span class="string">&quot;carList:&quot;</span>+list);</span><br><span class="line">    </span><br><span class="line">            <span class="comment">//result:</span></span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             * car：null</span></span><br><span class="line"><span class="comment">             * carList:[]</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>结果表明:没有执行数据库的操作，而是mock返回的是方法的默认值。</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> Spring test </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring事件驱动模型</title>
      <link href="/dist/2021/01/18/Spring%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B/"/>
      <url>/dist/2021/01/18/Spring%E4%BA%8B%E4%BB%B6%E9%A9%B1%E5%8A%A8%E6%A8%A1%E5%9E%8B/</url>
      
        <content type="html"><![CDATA[<h2 id="一、Spring-事件驱动的简介"><a href="#一、Spring-事件驱动的简介" class="headerlink" title="一、Spring 事件驱动的简介"></a>一、Spring 事件驱动的简介</h2><p>事件驱动模型，简单理解就是发布-订阅模型，Spring针对这种发布-订阅模型作出了两种解决方案，应用间的发布-订阅模型，可以使用Spring AMQP和 Spring for Apache Kafka，结合Rabbit或者kafka等消息中间件完成。应用内的发布-订阅模型，可以使用Spring 的Application上下文提供的方案解决。这篇文章主要描述Spring 的应用内的事件驱动的实现以及应用。</p><h2 id="二、Spring-应用内的事件驱动模型示例"><a href="#二、Spring-应用内的事件驱动模型示例" class="headerlink" title="二、Spring 应用内的事件驱动模型示例"></a>二、Spring 应用内的事件驱动模型示例</h2><h3 id="2-1、需求背景"><a href="#2-1、需求背景" class="headerlink" title="2.1、需求背景"></a>2.1、需求背景</h3><p>页面埋点，收集用户访问信息，并记录到数据库，并且根据用户的PV，作出适当的商品邮件推送</p><h3 id="2-2、需求拆解"><a href="#2-2、需求拆解" class="headerlink" title="2.2、需求拆解"></a>2.2、需求拆解</h3><ul><li>前端需要收集用户在当前页面的访问信息，调用后端提供的埋点接口，将数据提供给后端处理。（前端功能不做示例）</li><li>后端的埋点接口，调用发布消息的方法（发布事件）</li><li>后端需要开发对应的事件订阅方法，将事件解析并持久化，以及作出适当的邮件推送<h3 id="2-3、代码实现"><a href="#2-3、代码实现" class="headerlink" title="2.3、代码实现"></a>2.3、代码实现</h3>1、埋点接口<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.service.MyEventService;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.http.MediaType;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.PutMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestMapping;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RequestParam;</span><br><span class="line"><span class="keyword">import</span> org.springframework.web.bind.annotation.RestController;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/&quot;,produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventController</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyEventService myEventService;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">EventController</span><span class="params">(MyEventService myEventService)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.myEventService = myEventService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;send/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendMessage</span><span class="params">(<span class="meta">@RequestParam</span> String msg)</span></span>&#123;</span><br><span class="line">        myEventService.publishEvent(msg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>2、定义事件接受类<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.event;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationEvent;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:51 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEvent</span> <span class="keyword">extends</span> <span class="title">ApplicationEvent</span> </span>&#123;</span><br><span class="line">    <span class="comment">//前端的埋点收集信息</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a new &#123;<span class="doctag">@code</span> ApplicationEvent&#125;.</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> source the object on which the event initially occurred or with</span></span><br><span class="line"><span class="comment">     *               which the event is associated (never &#123;<span class="doctag">@code</span> null&#125;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyEvent</span><span class="params">(Object source)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyEvent</span><span class="params">(Object source, String msg)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(source);</span><br><span class="line">        <span class="keyword">this</span>.msg = msg;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>3、发布事件<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:52 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventService</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//发布事件</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishEvent</span><span class="params">(String msg)</span></span>&#123;</span><br><span class="line">        MyEvent myEvent = <span class="keyword">new</span> MyEvent(<span class="keyword">this</span>,msg);</span><br><span class="line">        applicationContext.publishEvent(myEvent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li></ul><p>4.订阅事件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.compoent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:55 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventListenerComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEvent</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;持久化用户的浏览记录：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;发送Email：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5、执行结果</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-06-22 18:01:25.599  INFO 14040 --- [nio-1234-exec-2] c.yiyi.compoent.EventListenerComponent   : 持久化用户的浏览记录：查看了华为Mate40 pro</span><br><span class="line">2020-06-22 18:01:25.599  INFO 14040 --- [nio-1234-exec-2] c.yiyi.compoent.EventListenerComponent   : 发送Email：查看了华为Mate40 pro</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="2-4、实现优化的思考及实现方法"><a href="#2-4、实现优化的思考及实现方法" class="headerlink" title="2.4、实现优化的思考及实现方法"></a>2.4、实现优化的思考及实现方法</h3><h4 id="1、如何提高埋点的并发？"><a href="#1、如何提高埋点的并发？" class="headerlink" title="1、如何提高埋点的并发？"></a>1、如何提高埋点的并发？</h4><p>答：Spring 提供了方法异步执行的功能，需要开启异步执行—–@EnableAsync。然后通过@Async开启订阅者异步消费事件，异步执行的本质，就是将方法的执行的逻辑放到一个单独的线程中去执行。示例：<br>(1)、开启异步执行</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.AsyncConfigurer;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.EnableAsync;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.concurrent.ThreadPoolTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executor;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ThreadPoolExecutor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 1:27 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAsync</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AsyncListenerConfig</span> <span class="keyword">implements</span> <span class="title">AsyncConfigurer</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义一个线程池</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Bean(name = &quot;taskExecutor&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Executor <span class="title">getAsyncExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ThreadPoolTaskExecutor executor = <span class="keyword">new</span> ThreadPoolTaskExecutor();</span><br><span class="line">        executor.initialize();</span><br><span class="line">        <span class="comment">//设置核心线程数</span></span><br><span class="line">        executor.setCorePoolSize(<span class="number">10</span>);</span><br><span class="line">        <span class="comment">//设置最大线程数</span></span><br><span class="line">        executor.setMaxPoolSize(<span class="number">20</span>);</span><br><span class="line">        <span class="comment">//设置队列的大小</span></span><br><span class="line">        executor.setQueueCapacity(<span class="number">1000</span>);</span><br><span class="line">        <span class="comment">//设置最大的线程空闲时间</span></span><br><span class="line">        executor.setKeepAliveSeconds(<span class="number">300</span>);</span><br><span class="line">        <span class="comment">//设置线程名称</span></span><br><span class="line">        executor.setThreadNamePrefix(<span class="string">&quot;event-executor-&quot;</span>);</span><br><span class="line">        <span class="comment">//拒绝策略</span></span><br><span class="line">        executor.setRejectedExecutionHandler(<span class="keyword">new</span> ThreadPoolExecutor.CallerRunsPolicy());</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ExceptionHandlingAsyncTaskExecutor(executor);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(2)、设置异步执行的任务执行器</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.task.AsyncTaskExecutor;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用独立的线程来包装，类似与<span class="doctag">@Async</span></span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 2:58 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HandlingAsyncTaskExecutor</span> <span class="keyword">implements</span> <span class="title">AsyncTaskExecutor</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> AsyncTaskExecutor executor;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task, <span class="keyword">long</span> startTimeout)</span> </span>&#123;</span><br><span class="line">        executor.execute(createWrappedRunnable(task), startTimeout);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">execute</span><span class="params">(Runnable task)</span> </span>&#123;</span><br><span class="line">        executor.execute(createWrappedRunnable(task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Future&lt;?&gt; submit(Runnable task) &#123;</span><br><span class="line">        <span class="keyword">return</span> executor.submit(createWrappedRunnable(task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">Future&lt;T&gt; <span class="title">submit</span><span class="params">(Callable&lt;T&gt; task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> executor.submit(createCallable(task));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> &lt;T&gt; <span class="function">Callable&lt;T&gt; <span class="title">createCallable</span><span class="params">(<span class="keyword">final</span> Callable&lt;T&gt; callable)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> callable.call();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                handle(e);</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Runnable <span class="title">createWrappedRunnable</span><span class="params">(Runnable task)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                task.run();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                handle(e);</span><br><span class="line">                <span class="keyword">throw</span> e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">handle</span><span class="params">(Exception e)</span> </span>&#123;</span><br><span class="line">        log.error(<span class="string">&quot;异步执行报错：&#123;&#125;&quot;</span>, e.getMessage(), e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>(3)、异步消费事件</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.compoent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.scheduling.annotation.Async;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:55 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventListenerComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEvent</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;持久化用户的浏览记录：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Async</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendEmail</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;发送Email：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>至此，发送邮件和持久化浏览记录都是异步执行的了，埋点接口的http链接会立即释放。对于执行埋点的接口执行来讲，能够多支持一些并发，当然可以在此基础上继续优化，例如批量持久化，批量发送email等。最大限度的利用线程。  </p><h4 id="2、如果持久化失败了，如何做到不让邮件发送？"><a href="#2、如果持久化失败了，如何做到不让邮件发送？" class="headerlink" title="2、如果持久化失败了，如何做到不让邮件发送？"></a>2、如果持久化失败了，如何做到不让邮件发送？</h4><p>答：在之前开发的CRUD中，我们避免程序错误导致脏库，一般在做DML操作的时候，都会加入事务。与之类似，订阅者也会有事务的概念。<br>示例：<br>发布事件，添加事务</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.domain.EventDomain;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.domain.EventMapper;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:52 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyEventService</span> <span class="keyword">implements</span> <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> EventMapper eventMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">publishEvent</span><span class="params">(String msg)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        MyEvent myEvent = <span class="keyword">new</span> MyEvent(<span class="keyword">this</span>,msg);</span><br><span class="line">        applicationContext.publishEvent(myEvent);</span><br><span class="line">        EventDomain eventDomain = <span class="keyword">new</span> EventDomain();</span><br><span class="line">        eventDomain.setMessage(msg);</span><br><span class="line">        eventMapper.save(eventDomain);</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> Exception(<span class="string">&quot;error！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>订阅事件，给getEventSecond方法添加事务监听注解</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.compoent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.event.TransactionalEventListener;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:55 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventListenerComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventFirst</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第一个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@TransactionalEventListener</span></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventSecond</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第二个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Order(3)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventThird</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第三个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：  </p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line">2020-06-22 22:12:42.980  INFO 14373 --- [nio-1234-exec-3] c.yiyi.compoent.EventListenerComponent   : 我是第一个收到消息：查看了华为Mate40 pro</span><br><span class="line">2020-06-22 22:12:42.980  INFO 14373 --- [nio-1234-exec-3] c.yiyi.compoent.EventListenerComponent   : 我是第三个收到消息：查看了华为Mate40 pro</span><br><span class="line">Hibernate: select next_val as id_val from hibernate_sequence for update</span><br><span class="line">Hibernate: update hibernate_sequence set next_val= ? where next_val=?</span><br><span class="line">java.lang.Exception: error！</span><br><span class="line">at com.yiyi.service.MyEventService.publishEvent(MyEventService.java:36)</span><br><span class="line">at com.yiyi.service.MyEventService$$FastClassBySpringCGLIB$$f3a92ba1.invoke(&lt;generated&gt;)</span><br><span class="line">at org.springframework.cglib.proxy.MethodProxy.invoke(MethodProxy.java:218)</span><br><span class="line">at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.invokeJoinpoint(CglibAopProxy.java:771)</span><br><span class="line">at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)</span><br><span class="line">at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:749)</span><br><span class="line">at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:366)</span><br><span class="line">at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:118)</span><br><span class="line">at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)</span><br><span class="line">at org.springframework.aop.framework.CglibAopProxy$CglibMethodInvocation.proceed(CglibAopProxy.java:749)</span><br><span class="line">at org.springframework.aop.framework.CglibAopProxy$DynamicAdvisedInterceptor.intercept(CglibAopProxy.java:691)</span><br><span class="line">at com.yiyi.service.MyEventService$$EnhancerBySpringCGLIB$$fb19b4c8.publishEvent(&lt;generated&gt;)</span><br><span class="line">at com.yiyi.EventController.sendMessage(EventController.java:29)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)</span><br><span class="line">at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)</span><br><span class="line">at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)</span><br><span class="line">at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)</span><br><span class="line">at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.doPut(FrameworkServlet.java:920)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:663)</span><br><span class="line">at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)</span><br><span class="line">at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.springframework.web.filter.RequestContextFilter.doFilterInternal(RequestContextFilter.java:100)</span><br><span class="line">at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.springframework.web.filter.FormContentFilter.doFilterInternal(FormContentFilter.java:93)</span><br><span class="line">at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)</span><br><span class="line">at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class="line">at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)</span><br><span class="line">at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)</span><br><span class="line">at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)</span><br><span class="line">at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class="line">at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class="line">at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)</span><br><span class="line">at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>通过上述的执行结果很容易看出，@TransactionalEventListener注解所在的方法是在发布者的事务完成之后进行调用的，而且执行的顺序落后于@EventListener。除此之外，@EventListener，不管发布者事务是否提交，都会执行订阅的逻辑。<br>:::tip<br>订阅执行的顺序：@EventListener&gt;@EventListener+@Async&gt;@TransactionalEventListener<br>:::</p><h4 id="3、如何保持订阅被有序执行？"><a href="#3、如何保持订阅被有序执行？" class="headerlink" title="3、如何保持订阅被有序执行？"></a>3、如何保持订阅被有序执行？</h4><p>答：Spring提供@Order的枚举，通过这个我们可以给订阅者设置顺序，那么在消费事件的时候，就会遵循这个顺序。示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.compoent;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.event.MyEvent;</span><br><span class="line"><span class="keyword">import</span> lombok.extern.slf4j.Slf4j;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.event.EventListener;</span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.Order;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/22 12:55 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EventListenerComponent</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Order(2)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventFirst</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第一个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Order(1)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventSecond</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第二个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@EventListener</span></span><br><span class="line">    <span class="meta">@Order(3)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">getEventThird</span><span class="params">(MyEvent myEvent)</span> </span>&#123;</span><br><span class="line">        log.info(<span class="string">&quot;我是第三个收到消息：&#123;&#125;&quot;</span>, myEvent.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>执行结果：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">2020-06-22 18:30:34.689  INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent   : 我是第二个收到消息：查看了华为Mate40 pro</span><br><span class="line">2020-06-22 18:30:34.691  INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent   : 我是第一个收到消息：查看了华为Mate40 pro</span><br><span class="line">2020-06-22 18:30:34.691  INFO 14195 --- [nio-1234-exec-1] c.yiyi.compoent.EventListenerComponent   : 我是第三个收到消息：查看了华为Mate40 pro</span><br></pre></td></tr></table></figure><h2 id="三、Spring-事件驱动的原理"><a href="#三、Spring-事件驱动的原理" class="headerlink" title="三、Spring 事件驱动的原理"></a>三、Spring 事件驱动的原理</h2>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> 事件驱动 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Spring Cache 源码学习，自定义CacheManager</title>
      <link href="/dist/2021/01/18/Spring%20Cache%20%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89CacheManager/"/>
      <url>/dist/2021/01/18/Spring%20Cache%20%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0%EF%BC%8C%E8%87%AA%E5%AE%9A%E4%B9%89CacheManager/</url>
      
        <content type="html"><![CDATA[<h1 id="Spring-Cache-源码学习，自定义CacheManager"><a href="#Spring-Cache-源码学习，自定义CacheManager" class="headerlink" title="Spring Cache 源码学习，自定义CacheManager"></a>Spring Cache 源码学习，自定义CacheManager</h1><h2 id="一、学习背景"><a href="#一、学习背景" class="headerlink" title="一、学习背景"></a>一、学习背景</h2><p>&emsp;&emsp;最近一直在学习Spring boot的框架，因为之前一直接触的都是Spring + Spring mvc + mybatis的ssm框架，对于约定大于配置的这种开发理念还是不太熟悉和上手，所以决定系统学习下Springboot。最近在看项目代码，对代码中Spring cache的一些自定义拓展很感兴趣，所以就好好整理下。（基于Spring 5.2.6-release 版本）</p><h2 id="二、Spring-Cache的源码学习"><a href="#二、Spring-Cache的源码学习" class="headerlink" title="二、Spring Cache的源码学习"></a>二、Spring Cache的源码学习</h2><h3 id="2-1、Spring-Cache的核心接口"><a href="#2-1、Spring-Cache的核心接口" class="headerlink" title="2.1、Spring Cache的核心接口"></a>2.1、Spring Cache的核心接口</h3><h4 id="2-1-1、Cache"><a href="#2-1-1、Cache" class="headerlink" title="2.1.1、Cache"></a>2.1.1、Cache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 定义通用缓存操作的接口。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;b&gt;注意：&lt;/b&gt;由于缓存的一般用法，建议实现允许存储&lt;tt&gt; null &lt;/tt&gt;值（例如，存储返回&#123;<span class="doctag">@code</span> null&#125;的方法）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Juergen Hoeller</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Cache</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回缓存的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">getName</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回基础本机缓存提供程序。这里是指缓存实现类对象,返回类型为Class&lt;T extend Cache&gt; class</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Object <span class="title">getNativeCache</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回此缓存将指定键映射到的值。 &lt;p&gt;如果缓存不包含该键的映射，则返回&#123;<span class="doctag">@code</span> null&#125;； 否则，缓存的值（本身可能为&#123;<span class="doctag">@code</span> null&#125;）将在&#123;<span class="doctag">@link</span>  </span></span><br><span class="line"><span class="comment">     * ValueWrapper&#125;中返回。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 要返回其关联值的key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 此缓存将指定键映射到的值，该值包含在&#123;<span class="doctag">@link</span> ValueWrapper&#125;中，该值也可以保存缓存的&#123;<span class="doctag">@code</span> null&#125;值。 直接返回&#123;<span class="doctag">@code</span> null&#125;表示缓* 存不包含该键的映射。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #get(Object, Class)</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #get(Object, Callable)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function">ValueWrapper <span class="title">get</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回此缓存将指定键映射到的值，通常指定返回值将强制转换为的类型。 &lt;p&gt;注意：&#123;<span class="doctag">@code</span> get&#125;的此变体不允许区分已缓存的&#123;<span class="doctag">@code</span> null&#125;值和根本找不 * 到缓存条目。 为此，请使用标准的&#123;<span class="doctag">@link</span> #get(Object）&#125;变体。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 要返回其关联值的key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> type 需要返回值的类型（可以为&#123;<span class="doctag">@code</span> null&#125;来绕过类型检查；如果在缓存中找到&#123;<span class="doctag">@code</span> null&#125;值，则指定的类型无关紧要）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 此高速缓存将指定键映射到的值（本身可以是&#123;<span class="doctag">@code</span> null&#125;），如果高速缓存不包含此键的映射，则还可以是&#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> IllegalStateException 如果找到了高速缓存条目但未能匹配指定的类型</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.0</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #get(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Object key, <span class="meta">@Nullable</span> Class&lt;T&gt; type)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回此缓存将指定键映射到的值，并在必要时从&#123;<span class="doctag">@code</span> valueLoader&#125;获取该值。 此方法为常规的“如果已缓存，则返回；否则创建，缓存并返回”模式提供</span></span><br><span class="line"><span class="comment">     * 了简单的替代方法。 &lt;p&gt;如果可能，实现应确保加载操作是同步的，以便在同时访问同一键的情况下，仅调用一次指定的&#123;<span class="doctag">@code</span> valueLoader&#125;。 &lt;p&gt;如果  </span></span><br><span class="line"><span class="comment">     *&#123;<span class="doctag">@code</span> valueLoader&#125;引发异常，则将其包装在&#123;<span class="doctag">@link</span> ValueRetrievalException&#125;中</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 要返回其关联值的key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 此缓存将指定键映射到的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@throws</span> ValueRetrievalException 如果&#123;<span class="doctag">@code</span> valueLoader&#125;抛出异常</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #get(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line">&lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Object key, Callable&lt;T&gt; valueLoader)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将指定的值与此高速缓存中的指定键相关联。 &lt;p&gt;如果高速缓存先前包含此键的映射，则旧值将由指定值替换。 &lt;p&gt;可以以异步或延迟的方式执行实际注册，随</span></span><br><span class="line"><span class="comment">     * 后的查找可能仍未看到该条目。 例如，事务性缓存装饰器可能就是这种情况。 使用&#123;<span class="doctag">@link</span> #putIfAbsent&#125;保证立即注册。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key the key with which the specified value is to be associated</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value the value to be associated with the specified key</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #putIfAbsent(Object, Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">put</span><span class="params">(Object key, <span class="meta">@Nullable</span> Object value)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果尚未将指定值与该高速缓存中的指定键原子关联，则该值尚未设置。 &lt;p&gt;这等效于：&lt;pre&gt; &lt;code&gt; ValueWrapper existingValue = cache.get（key）; 如果（existingValue == null）&#123;cache.put（key，value）; 返回现存值； &lt;/ code&gt; &lt;/ pre&gt;，但该操作是原子执行的。 虽然所有开箱即用的&#123;<span class="doctag">@link</span> CacheManager&#125;实现都可以自动执行放置，但操作也可以分两个步骤实现，例如 以非原子方式检查存在性并随后放置。 有关更多详细信息，请查看所使用的本机缓存实现的文档。 &lt;p&gt;默认实现沿着上面的代码片段委托给&#123;<span class="doctag">@link</span> #get（Object）&#125;和&#123;<span class="doctag">@link</span> #put（Object，Object）&#125;。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 与指定值关联的键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> value 与指定键关联的值</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 此缓存将指定键映射到的值（本身可能是&#123;<span class="doctag">@code</span> null&#125;），如果在此调用之前缓存不包含该键的任何映射，则还为&#123;<span class="doctag">@code</span> null&#125;。 因此，返回&#123;<span class="doctag">@code</span> null&#125;表示给定的&#123;<span class="doctag">@code</span> value&#125;已与密钥相关联。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #put(Object, Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> ValueWrapper <span class="title">putIfAbsent</span><span class="params">(Object key, <span class="meta">@Nullable</span> Object value)</span> </span>&#123;</span><br><span class="line">ValueWrapper existingValue = get(key);</span><br><span class="line"><span class="keyword">if</span> (existingValue == <span class="keyword">null</span>) &#123;</span><br><span class="line">put(key, value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> existingValue;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果存在，请从此缓存中退出此键的映射。 &lt;p&gt;可以以异步或延迟的方式执行实际逐出，随后的查找可能仍会看到该条目。 例如，事务性缓存装饰器可能就是这种情况。 使用&#123;<span class="doctag">@link</span> #evictIfPresent&#125;确保立即删除。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 要从缓存中删除其映射的键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #evictIfPresent(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">evict</span><span class="params">(Object key)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果存在此键，则从此缓存中退出该键的映射，并期望该键对于后续查找立即不可见。 &lt;p&gt;默认实现委派给&#123;<span class="doctag">@link</span> #evict（Object）&#125;，对于未确定的先前存在的键，返回&#123;<span class="doctag">@code</span> false&#125;。 鼓励高速缓存提供者，尤其是高速缓存装饰器，如果可能的话（例如，在事务中通常延迟的高速缓存操作的情况下）执行立即驱逐并可靠地确定给定密钥的先前存在。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> key 要从缓存中删除其映射的键</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125;（如果以前知道缓存对此键有映射），&#123;@ code false&#125;（如果没有）（或者无法确定先前的存在）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 5.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #evict(Object)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">evictIfPresent</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">evict(key);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过删除所有映射来清除缓存。 &lt;p&gt;可以以异步或延迟的方式执行实际清除，随后的查找可能仍会看到条目。 例如，事务性缓存装饰器可能就是这种情况。 使用&#123;<span class="doctag">@link</span> #invalidate（）&#125;可以确保立即删除条目。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #invalidate()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过删除所有映射来使缓存无效，并期望所有条目对于随后的查找立即不可见。 <span class="doctag">@return</span> &#123;<span class="doctag">@code</span> true&#125;（如果以前知道该缓存具有映射），&#123;@ code false&#125;（如果没有）（或者如果无法确定先前是否存在条目）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 5.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #clear()</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">default</span> <span class="keyword">boolean</span> <span class="title">invalidate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">clear();</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 代表缓存值的（包装）对象。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@FunctionalInterface</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ValueWrapper</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 返回缓存中的实际值。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function">Object <span class="title">get</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果值加载程序回调因异常而失败，则从&#123;<span class="doctag">@link</span> #get(Object，Callable）&#125;引发包装器异常。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.3</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;serial&quot;)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ValueRetrievalException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> Object key;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ValueRetrievalException</span><span class="params">(<span class="meta">@Nullable</span> Object key, Callable&lt;?&gt; loader, Throwable ex)</span> </span>&#123;</span><br><span class="line"><span class="keyword">super</span>(String.format(<span class="string">&quot;Value for key &#x27;%s&#x27; could not be loaded using &#x27;%s&#x27;&quot;</span>, key, loader), ex);</span><br><span class="line"><span class="keyword">this</span>.key = key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Object <span class="title">getKey</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.key;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-1-2、CacheManager"><a href="#2-1-2、CacheManager" class="headerlink" title="2.1.2、CacheManager"></a>2.1.2、CacheManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Copyright 2002-2019 the original author or authors.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Licensed under the Apache License, Version 2.0 (the &quot;License&quot;);</span></span><br><span class="line"><span class="comment"> * you may not use this file except in compliance with the License.</span></span><br><span class="line"><span class="comment"> * You may obtain a copy of the License at</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> *      https://www.apache.org/licenses/LICENSE-2.0</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Unless required by applicable law or agreed to in writing, software</span></span><br><span class="line"><span class="comment"> * distributed under the License is distributed on an &quot;AS IS&quot; BASIS,</span></span><br><span class="line"><span class="comment"> * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></span><br><span class="line"><span class="comment"> * See the License for the specific language governing permissions and</span></span><br><span class="line"><span class="comment"> * limitations under the License.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> org.springframework.cache;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.lang.Nullable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring的中央缓存管理器SPI。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;允许检索命名的&#123;<span class="doctag">@link</span> Cache&#125;区域。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取与给定名称关联的缓存。 &lt;p&gt;请注意，如果本机提供程序支持，则缓存可能会在运行时延迟创建。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@param</span> name 缓存标识符（不得为&#123;<span class="doctag">@code</span> null&#125;）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 关联的缓存，如果不存在或无法创建，则为&#123;<span class="doctag">@code</span> null&#125;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Nullable</span></span><br><span class="line"><span class="function">Cache <span class="title">getCache</span><span class="params">(String name)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 获取此管理器已知的缓存名称的集合。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> 缓存管理器已知的所有缓存的名称</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">Collection&lt;String&gt; <span class="title">getCacheNames</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-1-3、Cache相关的注解"><a href="#2-1-3、Cache相关的注解" class="headerlink" title="2.1.3、Cache相关的注解"></a>2.1.3、Cache相关的注解</h4><p>Spring cache 为了方便我们对缓存的使用，提供了五个比较有用的注解：  </p><blockquote><p>@Cacheable<br>  @CachePut<br>  @CacheEvict<br>  @Caching<br>  @CacheConfig  </p></blockquote><h5 id="2-1-3-1、-Cacheable"><a href="#2-1-3-1、-Cacheable" class="headerlink" title="2.1.3.1、@Cacheable"></a>2.1.3.1、@Cacheable</h5><p>源码注释翻译：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AliasFor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 标注可以缓存调用方法（或类中的所有方法）结果的注释。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;每次调用建议的方法时，都会应用缓存行为，检查是否已为给定参数调用了该方法。 通常默认设置只是使用方法参数来计算密钥，但是可以通过&#123;<span class="doctag">@link</span> #key&#125;属性提供SpEL表达式，或者自定义&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.KeyGenerator&#125;实现可以替换 默认值之一（请参见&#123;<span class="doctag">@link</span> #keyGenerator&#125;）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;如果在高速缓存中找不到所计算键的值，则将调用目标方法，并将返回的值存储在关联的高速缓存中。 请注意，Java8的&#123;<span class="doctag">@code</span> Optional&#125;返回类型是自动处理的，并且其内容存储在缓存中（如果存在）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;此注释可用作&lt;em&gt;元注释&lt;/ em&gt;，以创建具有属性覆盖的自定义&lt;em&gt;组成的注释&lt;/ em&gt;。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Phillip Webb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Cacheable &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 缓存名称的别名</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;cacheNames&quot;)</span></span><br><span class="line">String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 存储方法调用结果的缓存的名称。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;名称可用于确定目标缓存（或多个缓存），与特定Bean定义的限定符值或Bean名称匹配。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheNames</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">key</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要使用的自定义&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.KeyGenerator&#125;的bean名称。 &lt;p&gt;与&#123;<span class="doctag">@link</span> #key&#125;属性互斥。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#keyGenerator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义&#123;<span class="doctag">@link</span> org.springframework.cache.CacheManager&#125;的bean名称，用于创建默认的&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;（如果尚未设置）。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与&#123;<span class="doctag">@link</span> #cacheResolver&#125;属性互斥。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.cache.interceptor.SimpleCacheResolver</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheManager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要使用的定制&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;的bean名称。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheResolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring表达式语言（SpEL）表达式，用于使方法缓存成为条件。 </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;默认值为&#123;<span class="doctag">@code</span>“”&#125;，这意味着方法结果始终被缓存。 </span></span><br><span class="line"><span class="comment"> * &lt;p&gt; SpEL表达式根据提供以下元数据的专用上下文进行评估：&lt;ul&gt;  </span></span><br><span class="line"><span class="comment"> * &lt;li&gt; &#123;@ code＃root.method&#125;，&#123;@ code＃root.target&#125;和&#123;<span class="doctag">@code</span> #root。 缓存&#125;，分别引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method方法&#125;，目标对象和受影响的缓存。&lt;/li&gt;  </span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法名称的快捷方式（&#123;<span class="doctag">@code</span>＃root.methodName &#125;）和目标类别（&#123;<span class="doctag">@code</span>＃root.targetClass&#125;）也可用。  </span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args [1]&#125;，&#123;@ code＃p1&#125;或&#123;<span class="doctag">@code</span>＃a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt; &lt;/ ul&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">condition</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Spring表达式语言（SpEL）表达式用于否决方法缓存。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与&#123;<span class="doctag">@link</span> #condition&#125;不同，此表达式是在调用方法后求值的，因此可以引用&#123;<span class="doctag">@code</span> result&#125;。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;默认值为&#123;<span class="doctag">@code</span>“”&#125;，表示永远不会否决缓存。</span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.2</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">unless</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 如果多个线程试图为同一键加载值，则同步基础方法的调用。 同步带来了两个限制：</span></span><br><span class="line"><span class="comment"> * &lt;ol&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;不支持&#123;<span class="doctag">@link</span> #unless（）&#125;&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;只能指定一个缓存&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;不能合并其他与缓存相关的操作&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> * &lt;/ol&gt;</span></span><br><span class="line"><span class="comment"> * 这实际上是一个提示，您正在使用的实际缓存提供程序可能不以同步方式支持它。 检查您的提供程序文档，以获取有关实际语义的更多详细信息。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.3</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.cache.Cache#get(Object, Callable)</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">sync</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>主要参数</th><th>描述</th><th>用法</th></tr></thead><tbody><tr><td>value</td><td>cacheNames 的别名</td><td>@Cacheable(“mysqlCache”)</td></tr><tr><td>cacheNames</td><td>缓存的名称</td><td>@Cacheable(cacheNames = MysqlCache.NAME)</td></tr><tr><td>key</td><td>缓存的key，支持Spring EL 表达式</td><td>@Cacheable(cacheNames = MysqlCache.NAME, key = “‘CacheDemoService-get’+ args[0]”) @Cacheable(cacheNames = MysqlCache.NAME, key = “‘CacheDemoService-get’+ #p0”)</td></tr><tr><td>@Cacheable(cacheNames = MysqlCache.NAME, key = “‘CacheDemoService-get’+ #a0”)</td><td></td><td></td></tr><tr><td>keyGenerator</td><td>key的构造器，和key属性互斥</td><td>需要定义一个customerKeyGenerator的bean  @Cacheable(cacheNames = MysqlCache.NAME, keyGenerator = “customerKeyGenerator”)</td></tr><tr><td>cacheManager</td><td>指定CacheManager，需要先定义CacheManager的bean，指定后则不能指定cacheResolver，两者互斥，如不指定，则使用注入的默认的CacheManagerBean</td><td>@Cacheable(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”）</td></tr><tr><td>cacheResolver</td><td>指定cacheResolver的bean的名称，和cacheManager互斥</td><td>暂时未做测试</td></tr><tr><td>condition</td><td>是否使用方法缓存条件，默认“”，是否去取方法缓存，在方法执行之前计算条件结果</td><td>@Cacheable(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”,condition=“#a0 == ‘xx’”)</td></tr><tr><td>unless</td><td>否决方法的结果缓存，默认“”，始终缓存方法，如果条件不成立则不缓存方法结果，在方法执行结果后计算条件结果</td><td>@Cacheable(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”,unless=“#a0 == ‘xx’”)</td></tr><tr><td>sync</td><td>多线程访问方法，是否同步缓存，默认值为false，使用有三个限制，不支持unless，只能指定一个缓存，不能与@Caching一起使用</td><td>@Cacheable(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”,sync=false)</td></tr></tbody></table><h5 id="2-1-3-2、-CachePut"><a href="#2-1-3-2、-CachePut" class="headerlink" title="2.1.3.2、@CachePut"></a>2.1.3.2、@CachePut</h5><p>源码注释翻译：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AliasFor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 指示方法（或类中的所有方法）触发&#123;<span class="doctag">@link</span> org.springframework.cache.Cache＃put(Object，Object）cache put&#125;操作的注释。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与&#123;<span class="doctag">@link</span> Cacheable <span class="doctag">@Cacheable</span>&#125;注释相反，此注释不会导致建议的方法被跳过。 而是，它总是使方法被调用并将其结果存储在关联的缓存中。 请注意，Java8的&#123;<span class="doctag">@code</span> Optional&#125;返回类型是自动处理的，并且其内容存储在缓存中（如果存在）。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;此注释可用作&lt;em&gt;元注释&lt;/ em&gt;，以创建具有属性覆盖的自定义&lt;em&gt;组成的注释&lt;/ em&gt;。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Phillip Webb</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CachePut &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 别名&#123;<span class="doctag">@link</span> #cacheNames&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;cacheNames&quot;)</span></span><br><span class="line">String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于缓存放置操作的缓存名称。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;名称可以用来确定目标缓存（或多个缓存），与特定bean定义的限定符值或bean名称匹配。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheNames</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">key</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要使用的自定义&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.KeyGenerator&#125;的bean名称。 &lt;p&gt;与&#123;<span class="doctag">@link</span> #key&#125;属性互斥。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#keyGenerator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义&#123;<span class="doctag">@link</span> org.springframework.cache.CacheManager&#125;的bean名称，用于创建默认的&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;（如果尚未设置）。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与&#123;<span class="doctag">@link</span> #cacheResolver&#125;属性互斥。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.cache.interceptor.SimpleCacheResolver</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheManager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要使用的定制&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;的bean名称。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheResolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">condition</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">unless</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>主要参数</th><th>描述</th><th>注释</th></tr></thead><tbody><tr><td>value</td><td>同Cacheable</td><td>@CachePut(“mysqlCache”)</td></tr><tr><td>cacheNames</td><td>同Cacheable</td><td>@CachePut(cacheNames=”mysqlCache”)</td></tr><tr><td>key</td><td>同Cacheable</td><td>@CachePut(cacheNames=”mysqlCache”,key=”#a1”)</td></tr><tr><td>keyGenerator</td><td>同Cacheable</td><td>@CachePut(cacheNames=”mysqlCache”,keyGenerator=”customKeyGenerator”)</td></tr><tr><td>cacheManager</td><td>同Cacheable</td><td>@CachePut(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”)</td></tr><tr><td>cacheResolver()</td><td>同Cacheable</td><td>暂未测试</td></tr><tr><td>condition</td><td>同Cacheable</td><td>@CachePut(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”,condition=”#a1 == ‘xxx’”)</td></tr><tr><td>unless</td><td>同Cacheable</td><td>@CachePut(cacheNames = MysqlCache.NAME, cacheManager=”mysqlCacheManager”,keyGenerator = “customerKeyGenerator”,unless=”#a1 == ‘xxx’”)</td></tr></tbody></table><h5 id="2-1-3-3、-CacheEvict"><a href="#2-1-3-3、-CacheEvict" class="headerlink" title="2.1.3.3、@CacheEvict"></a>2.1.3.3、@CacheEvict</h5><p>源码注释翻译：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.core.annotation.AliasFor;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 表示方法（或类中的所有方法）触发&#123;<span class="doctag">@link</span> org.springframework.cache.Cache＃evict（Object）cache evict&#125;操作的注释。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;此注释可用作&lt;em&gt;元注释&lt;/ em&gt;，以创建具有属性覆盖的自定义&lt;em&gt;组成的注释&lt;/ em&gt;。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CacheEvict &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 别名 &#123;<span class="doctag">@link</span> #cacheNames&#125;.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;cacheNames&quot;)</span></span><br><span class="line">String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于缓存逐出操作的缓存名称。 &lt;p&gt;名称可用于确定目标缓存（或多个缓存），与特定Bean定义的限定符值或Bean名称匹配。</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.2</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> #value</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheNames</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AliasFor(&quot;value&quot;)</span></span><br><span class="line">String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">key</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义key生成器的bean名字&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.KeyGenerator&#125;</span></span><br><span class="line"><span class="comment"> * to use.</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与 &#123;<span class="doctag">@link</span> #key&#125; 互斥</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#keyGenerator</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义&#123;<span class="doctag">@link</span> org.springframework.cache.CacheManager&#125;的bean名称，用于创建默认的&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;（如果尚未设置）。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;与&#123;<span class="doctag">@link</span> #cacheResolver&#125; 互斥.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> org.springframework.cache.interceptor.SimpleCacheResolver</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheManager</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义的bean的名称&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;</span></span><br><span class="line"><span class="comment"> * to use.</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@see</span> CacheConfig#cacheResolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 用于动态计算键的Spring表达式语言(SpEL)表达式。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 默认值是&#123;<span class="doctag">@code</span> &quot;&quot;&#125;，意味着所有的方法参数都会被考虑作为一个key，除非自定义的key生成器生效。 &#123;<span class="doctag">@link</span> #keyGenerator&#125; </span></span><br><span class="line"><span class="comment"> * </span></span><br><span class="line"><span class="comment"> * spring el表达式的计算取决于上小文提供的元数据：</span></span><br><span class="line"><span class="comment"> * 包含&#123;<span class="doctag">@code</span> #root.method&#125;, &#123;<span class="doctag">@code</span> #root.target&#125;, and &#123;<span class="doctag">@code</span> #root.caches&#125; 引用&#123;<span class="doctag">@link</span> java.lang.reflect.Method method&#125;，目标对象，和受影响的缓存。还提供了(&#123;<span class="doctag">@code</span> #root.methodName&#125;) 方法名称 (&#123;<span class="doctag">@code</span> #root.targetClass&#125;)目标类名称的快捷方式</span></span><br><span class="line"><span class="comment"> * 方法参数可以作为关联索引</span></span><br><span class="line"><span class="comment"> * &lt;li&gt;方法参数可以通过索引访问。 例如，可以通过&#123;<span class="doctag">@code</span>＃root.args[1]&#125;，&#123;@ code #p1&#125;或&#123;<span class="doctag">@code</span> #a1&#125;访问第二个自变量。 如果该信息可用，也可以按名称访问参数。&lt;/li&gt;</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">condition</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 是否删除缓存内的所有条目。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;默认情况下，仅删除关联键下的值。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;请注意，不允许将此参数设置为&#123;<span class="doctag">@code</span> true&#125;并指定&#123;<span class="doctag">@link</span> #key&#125;。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">allEntries</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 在调用该方法之前是否应该收回。   </span></span><br><span class="line"><span class="comment"> * &lt;p&gt;将此属性设置为&#123;<span class="doctag">@code</span> true&#125;，将导致驱逐发生，而与方法结果无关（即，是否引发异常）。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;默认值为&#123;<span class="doctag">@code</span> false&#125;，这意味着将在成功调用建议的方法后（即仅在调用未引发异常的情况下）&lt;/ em&gt;进行缓存逐出操作。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">beforeInvocation</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">false</span></span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><table><thead><tr><th>主要参数</th><th>描述</th><th>用法</th></tr></thead><tbody><tr><td>value</td><td>同Cacheable</td><td>@CacheEvict(“mysqlCache”)</td></tr><tr><td>cacheNames</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”)</td></tr><tr><td>key</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”#a1”)</td></tr><tr><td>keyGenerator</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”customKeyGenerator”)</td></tr><tr><td>cacheManager</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”customKeyGenerator”,cacheManager=”customCacheManager”)</td></tr><tr><td>cacheResolver</td><td>同Cacheable</td><td>暂时未测试</td></tr><tr><td>condition</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”#a1”,condition=”#a1 == true”)</td></tr><tr><td>unless</td><td>同Cacheable</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”#a1”,unless=”#a1 == true”)</td></tr><tr><td>allEntries</td><td>是否删除该缓存实例下的所有缓存的信息，默认值：false，当值为true时，则与属性key互斥</td><td>@CacheEvict(cacheNames=”mysqlCache”,allEntries = false</td></tr><tr><td>beforeInvocation</td><td>在调用该方法之前是否移除缓存，默认为false，如果为true时，则移除缓存和方法是否执行异常无关</td><td>@CacheEvict(cacheNames=”mysqlCache”,key=”#a1”,unless=”#a1 == true”,beforeInvocation = true)</td></tr></tbody></table><h5 id="2-1-3-4、-Caching"><a href="#2-1-3-4、-Caching" class="headerlink" title="2.1.3.4、@Caching"></a>2.1.3.4、@Caching</h5><p>源码注释翻译：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Inherited;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 多个（不同或相同类型的）缓存注释的组注释。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;此注释可用作&lt;em&gt;元注释&lt;/ em&gt;，以创建具有属性覆盖的自定义&lt;em&gt;组成的注释&lt;/ em&gt;。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Costin Leau</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Chris Beams</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 3.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(&#123;ElementType.TYPE, ElementType.METHOD&#125;)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Inherited</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Caching &#123;</span><br><span class="line"></span><br><span class="line">Cacheable[] cacheable() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">CachePut[] put() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">CacheEvict[] evict() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2-1-3-5、-CacheConfig"><a href="#2-1-3-5、-CacheConfig" class="headerlink" title="2.1.3.5、@CacheConfig"></a>2.1.3.5、@CacheConfig</h5><p>源码注释翻译:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> org.springframework.cache.annotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Documented;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.ElementType;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Target;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * &#123;<span class="doctag">@code</span> <span class="doctag">@CacheConfig</span>&#125;提供了一种在类级别共享与缓存相关的常见设置的机制。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;当给定类上存在此批注时，它将为该类中定义的任何缓存操作提供一组默认设置。</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Stephane Nicoll</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> Sam Brannen</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@since</span> 4.1</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Target(ElementType.TYPE)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CacheConfig &#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要为带注释的类中定义的缓存操作考虑的默认缓存的名称。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;如果在操作级别未设置任何值，则将使用这些值而不是默认值。</span></span><br><span class="line"><span class="comment">     * &lt;p&gt;可用于确定目标缓存（或多个缓存），与</span></span><br><span class="line"><span class="comment">     * 限定符值或特定bean定义的bean名称。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">String[] cacheNames() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 默认&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.KeyGenerator&#125;的bean名</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;如果在操作级别未设置任何值，则使用该值代替默认值。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;密钥生成器与自定义密钥互斥。 当这样的钥匙是</span></span><br><span class="line"><span class="comment"> * 为操作定义的，此密钥生成器的值将被忽略。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">keyGenerator</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 自定义&#123;<span class="doctag">@link</span> org.springframework.cache.CacheManager&#125;的bean名称，用于创建默认&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;（如果尚未设置）。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;如果在操作级别未设置解析器和缓存管理器，并且未通过&#123;<span class="doctag">@link</span> #cacheResolver&#125;设置缓存解析器，则使用该解析器而不是默认值。 <span class="doctag">@see</span> org.springframework.cache.interceptor.SimpleCacheResolver</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheManager</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 要使用的定制&#123;<span class="doctag">@link</span> org.springframework.cache.interceptor.CacheResolver&#125;的bean名称。</span></span><br><span class="line"><span class="comment"> * &lt;p&gt;如果在操作级别未设置解析器和缓存管理器，则使用该解析器而不是默认值。</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function">String <span class="title">cacheResolver</span><span class="params">()</span> <span class="keyword">default</span> &quot;&quot;</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>该注解只能使用在类上，为该类中的@Cacheable、@CachePut、@CacheEvict提供cacheNames、cacheManager、keyGenerator、cacheResolver默认的设置。不难发现这些值都是Spring 的bean的实例名称。</p><table><thead><tr><th>主要参数</th><th>描述</th><th>用法</th></tr></thead><tbody><tr><td>cacheNames</td><td>缓存名称的bean的名称,默认值：“”，则以实际的设置为准</td><td>@CacheConfig(cacheNames=”mysqlCache”)</td></tr><tr><td>cacheManager</td><td>缓存管理器的bean的名称,默认值：“”，则以实际的设置为准</td><td>@CacheConfig(cacheManager=”customCacheManager”)</td></tr><tr><td>keyGenerator</td><td>key生成器的bean的名称,默认值：“”，则以实际的设置为准</td><td>@CacheConfig(keyGenerator=”customKeyGnenrator”)</td></tr><tr><td>cacheResolver</td><td>缓存实现的bean的名称,默认值：“”，则以实际的设置为准</td><td>@CacheConfig(cacheResolver=”customCacheResolver”)</td></tr></tbody></table><h2 id="三、Spring-Cache的实现原理"><a href="#三、Spring-Cache的实现原理" class="headerlink" title="三、Spring Cache的实现原理"></a>三、Spring Cache的实现原理</h2><h3 id="3-1、基本实现原理"><a href="#3-1、基本实现原理" class="headerlink" title="3.1、基本实现原理"></a>3.1、基本实现原理</h3><p>&emsp;&emsp;Spring的缓存实现，依赖于Spring AOP，通过获取上面讲述的五个注解的切点位置，来实现对应的功能。<br>&emsp;&emsp;那么意味着如果要使用缓存或者缓存生效前提，所有的缓存方法调用实例都必须是Spring 代理的Bean。否则的话就无法使用。</p><h3 id="3-2、核心实现类"><a href="#3-2、核心实现类" class="headerlink" title="3.2、核心实现类"></a>3.2、核心实现类</h3><p>Spring Cache的核心类的依赖关系图： </p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/cache-aspect.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/cache-aspect.png" srcset="data:image/png;base64,666" alt="cache aspect"><br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/cache-operation.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/cache-operation.png" srcset="data:image/png;base64,666" alt="cache opration">  </p><p>Spring Cache的执行逻辑：  </p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/SpringCache-flow.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/SpringCache-flow.png" srcset="data:image/png;base64,666" alt="Spring Cache的执行逻辑"></p><h3 id="3-3、Spring-Cache-注解失效的场景"><a href="#3-3、Spring-Cache-注解失效的场景" class="headerlink" title="3.3、Spring Cache 注解失效的场景"></a>3.3、Spring Cache 注解失效的场景</h3><p>在开发的过程中，可能会发现缓存没有生效，原因可能如下：</p><p>1、方法所在的Bean没有注入到Spring的容器<br>2、方法是私有的或者是final修饰的<br>3、方法的调用对象为非Spring的代理类，类似于this.method()方式调用  </p><h2 id="四、自定义Spring-Cache"><a href="#四、自定义Spring-Cache" class="headerlink" title="四、自定义Spring Cache"></a>四、自定义Spring Cache</h2><p>在学习的过程中，做了一个简单的小demo拓展了一个Cache方式，尝试将缓存存储到Mysql的数据表中。</p><h3 id="4-1、准备阶段"><a href="#4-1、准备阶段" class="headerlink" title="4.1、准备阶段"></a>4.1、准备阶段</h3><table><thead><tr><th>技术选型</th><th>版本</th></tr></thead><tbody><tr><td>java</td><td>1.8.0_241</td></tr><tr><td>Spring boot</td><td>2.3.0.release</td></tr><tr><td>Spring jpa</td><td>2.3.0.release</td></tr><tr><td>数据库</td><td>Mysql 5.x</td></tr><tr><td>Spring boot test</td><td>2.3.0.release</td></tr><tr><td>实体类加强工具</td><td>lombok</td></tr></tbody></table><h3 id="4-2、创建缓存表的CRUD"><a href="#4-2、创建缓存表的CRUD" class="headerlink" title="4.2、创建缓存表的CRUD"></a>4.2、创建缓存表的CRUD</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.persistence.*;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 1:42 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity(name = &quot;t_cache&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheObject</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.AUTO)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;cache_key&quot;,nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String cacheKey;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;cache_value&quot;,nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String cacheValue;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;create_date&quot;,nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createDate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.Modifying;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 4:07 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">CacheObjectMapper</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">CacheObject</span>,<span class="title">String</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function">CacheObject <span class="title">getByCacheKey</span><span class="params">(String cacheKey)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Modifying</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">deleteCacheObjectByCacheKey</span><span class="params">(String cacheKey)</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"><span class="keyword">import</span> org.springframework.transaction.annotation.Transactional;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"><span class="keyword">import</span> java.time.LocalDateTime;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 4:08 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheObjectService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CacheObjectMapper cacheObjectMapper;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">(String key)</span></span>&#123;</span><br><span class="line">        CacheObject cacheObject = cacheObjectMapper.getByCacheKey(key);</span><br><span class="line">        <span class="keyword">if</span> (cacheObject == <span class="keyword">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> cacheObject.getCacheValue();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Transactional(rollbackFor = Exception.class)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">putValue</span><span class="params">(String key, String value)</span> </span>&#123;</span><br><span class="line">        CacheObject oldCacheObject = cacheObjectMapper.getByCacheKey(key);</span><br><span class="line">        <span class="keyword">if</span> (oldCacheObject != <span class="keyword">null</span>)&#123;</span><br><span class="line">            cacheObjectMapper.delete(oldCacheObject);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        CacheObject cacheObject = <span class="keyword">new</span> CacheObject();</span><br><span class="line">        cacheObject.setCacheKey(key);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(value);</span><br><span class="line">        cacheObject.setCacheValue(json);</span><br><span class="line">        cacheObject.setCreateDate(LocalDateTime.now());</span><br><span class="line">        cacheObjectMapper.save(cacheObject);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evict</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        cacheObjectMapper.deleteCacheObjectByCacheKey(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        cacheObjectMapper.deleteAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-3、Spring-Cache的拓展"><a href="#4-3、Spring-Cache的拓展" class="headerlink" title="4.3、Spring Cache的拓展"></a>4.3、Spring Cache的拓展</h3><h4 id="4-3-1、定义CacheManager"><a href="#4-3-1、定义CacheManager" class="headerlink" title="4.3.1、定义CacheManager"></a>4.3.1、定义CacheManager</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.manager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Collection;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentMap;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 3:52 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCacheManager</span> <span class="keyword">implements</span> <span class="title">CacheManager</span> </span>&#123;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义存储Cache的存储器，所有拓展并且实例化的Cache对象都会存到这里面</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> ConcurrentMap&lt;String,Cache&gt; cacheMap = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//通过名称，获取Cache实例化对象，我们定义Cacheable的注解用到的CacheNames属性的值，所标注的名称获取Cache实例就是这个方法提供的</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Cache <span class="title">getCache</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cacheMap.get(name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取所有的cache实例化对象的名称</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Collection&lt;String&gt; <span class="title">getCacheNames</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> cacheMap.keySet();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建Cache实例</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">createCache</span><span class="params">(Cache cache)</span></span>&#123;</span><br><span class="line">        cacheMap.put(cache.getName(),cache);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-3-2、定义Cache"><a href="#4-3-2、定义Cache" class="headerlink" title="4.3.2、定义Cache"></a>4.3.2、定义Cache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.manager;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.entity.CacheObjectService;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.serializer.CustomSerializerImpl;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.BeansException;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.Cache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.support.SimpleValueWrapper;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContext;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.ApplicationContextAware;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 4:02 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MysqlCache</span> <span class="keyword">implements</span> <span class="title">Cache</span>, <span class="title">ApplicationContextAware</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">static</span> String NAME = <span class="string">&quot;MYSQL&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> ApplicationContext applicationContext;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> NAME;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getNativeCache</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ValueWrapper <span class="title">get</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString());</span><br><span class="line">        <span class="keyword">return</span> value != <span class="keyword">null</span> ? <span class="keyword">new</span> SimpleValueWrapper(fromStoreValue(value)) : <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Object key, Class&lt;T&gt; type)</span> </span>&#123;</span><br><span class="line">        String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString());</span><br><span class="line">        <span class="keyword">return</span> (T) fromStoreValue(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> &lt;T&gt; <span class="function">T <span class="title">get</span><span class="params">(Object key, Callable&lt;T&gt; valueLoader)</span> </span>&#123;</span><br><span class="line">        String value = applicationContext.getBean(CacheObjectService.class).getValue(key.toString());</span><br><span class="line">        <span class="keyword">return</span> (T) fromStoreValue(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Object key, Object value)</span> </span>&#123;</span><br><span class="line">        String cacheValue = toStoreValue(value);</span><br><span class="line">        applicationContext.getBean(CacheObjectService.class).putValue(key.toString(), cacheValue);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">evict</span><span class="params">(Object key)</span> </span>&#123;</span><br><span class="line">        applicationContext.getBean(CacheObjectService.class).evict(key.toString());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        applicationContext.getBean(CacheObjectService.class).clear();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.applicationContext = applicationContext;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> String <span class="title">toStoreValue</span><span class="params">(Object value)</span></span>&#123;</span><br><span class="line">        CustomSerializerImpl customSerializer = <span class="keyword">new</span> CustomSerializerImpl();</span><br><span class="line">        <span class="keyword">return</span> customSerializer.serialize(value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> Object <span class="title">fromStoreValue</span><span class="params">(String value)</span></span>&#123;</span><br><span class="line">        CustomSerializerImpl customSerializer = <span class="keyword">new</span> CustomSerializerImpl();</span><br><span class="line">        <span class="keyword">return</span> customSerializer.deserialize(value);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-3-3、配置Cache"><a href="#4-3-3、配置Cache" class="headerlink" title="4.3.3、配置Cache"></a>4.3.3、配置Cache</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.config;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.manager.CustomCacheManager;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.manager.MysqlCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.CacheManager;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.concurrent.ConcurrentMapCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Bean;</span><br><span class="line"><span class="keyword">import</span> org.springframework.context.annotation.Configuration;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 3:40 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> MysqlCache mysqlCache;</span><br><span class="line"></span><br><span class="line"><span class="comment">//定义了两个Cache：一个自己实现的MysqlCache（Mysql） 还有一个就是Spring Cache默认实现了的基于并发包ConcurrentMap实现的的ConcurrentMapCache   (LOCAL)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> CacheManager <span class="title">cacheManager</span><span class="params">()</span></span>&#123;</span><br><span class="line">        CustomCacheManager customCacheManager = <span class="keyword">new</span> CustomCacheManager();</span><br><span class="line">        customCacheManager.createCache(mysqlCache);</span><br><span class="line">        ConcurrentMapCache local = <span class="keyword">new</span> ConcurrentMapCache(<span class="string">&quot;LOCAL&quot;</span>);</span><br><span class="line">        customCacheManager.createCache(local);</span><br><span class="line">        <span class="keyword">return</span> customCacheManager;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-4-4、Cache的使用"><a href="#4-4-4、Cache的使用" class="headerlink" title="4.4.4、Cache的使用"></a>4.4.4、Cache的使用</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.cache.cache.service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.manager.MysqlCache;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.CacheEvict;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Cacheable;</span><br><span class="line"><span class="keyword">import</span> org.springframework.cache.annotation.Caching;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 2:46 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheDemoService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(cacheNames = MysqlCache.NAME, keyGenerator = &quot;customKeyGenerator&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">keyGenerator</span><span class="params">(String name, String value)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(name+value);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-getUser&#x27;+ args[0]&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        User user = <span class="keyword">new</span> User();</span><br><span class="line">        user.setUsername(name);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Cacheable(cacheNames = &quot;LOCAL&quot;, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getLocalCache</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Caching(evict = &#123;</span></span><br><span class="line"><span class="meta">            @CacheEvict(cacheNames = &#123;MysqlCache.NAME&#125;, key = &quot;&#x27;CacheDemoService-get&#x27;+ args[0]&quot;),</span></span><br><span class="line"><span class="meta">            @CacheEvict(cacheNames = MysqlCache.NAME, key = &quot;&#x27;CacheDemoService-getUser&#x27;+ args[0]&quot;)</span></span><br><span class="line"><span class="meta">    &#125;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clearCache</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试用例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.yiyi.cache.SpringCacheApplication;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.entity.User;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.cache.cache.service.CacheDemoService;</span><br><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.annotation.Resource;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/4 2:49 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@SpringBootTest(classes = &#123;SpringCacheApplication.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CacheDemoServiceTest</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Resource</span></span><br><span class="line">    <span class="keyword">private</span> CacheDemoService cacheDemoService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGet</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String name = <span class="string">&quot;1231231&quot;</span>;</span><br><span class="line">        String s = cacheDemoService.get(name);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        System.out.println(cacheDemoService.get(<span class="string">&quot;1231&quot;</span>).equals(<span class="string">&quot;1231&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetUser</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String name = <span class="string">&quot;1231231&quot;</span>;</span><br><span class="line">        User user = cacheDemoService.getUser(name);</span><br><span class="line">        System.out.println(user.getUsername().equals(name));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testGetLocalCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">        String name = <span class="string">&quot;1231231&quot;</span>;</span><br><span class="line">        String s = cacheDemoService.getLocalCache(name);</span><br><span class="line">        System.out.println(s);</span><br><span class="line"></span><br><span class="line">        System.out.println(cacheDemoService.getLocalCache(<span class="string">&quot;1231&quot;</span>).equals(<span class="string">&quot;1231&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testClearCache</span><span class="params">()</span></span>&#123;</span><br><span class="line">        cacheDemoService.clearCache(<span class="string">&quot;1231231&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testKeyGenerator</span><span class="params">()</span></span>&#123;</span><br><span class="line">        User wuxuan = cacheDemoService.keyGenerator(<span class="string">&quot;wuxuan&quot;</span>, <span class="string">&quot;123456&quot;</span>);</span><br><span class="line">        System.out.println(wuxuan);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五、总结"><a href="#五、总结" class="headerlink" title="五、总结"></a>五、总结</h2><p>&emsp;&emsp;通过阅读Spring Cache的源码后，感觉收获到了很多，首先从心理上认识到，源码也并没有那么的难。其次，Spring 能够受到广大Java开发人员的追捧也并非偶然，Spring的源码从思路上以及设计上还是非常的优秀的，从中能够学到很多。以后再接再厉，多多尝试Discover Why 而不 Ask Why。</p>]]></content>
      
      
      <categories>
          
          <category> Spring </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Spring </tag>
            
            <tag> SpringCache </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac的VM中设置虚拟机静态ip</title>
      <link href="/dist/2021/01/18/Mac%E7%9A%84VM%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%9D%99%E6%80%81ip/"/>
      <url>/dist/2021/01/18/Mac%E7%9A%84VM%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%9D%99%E6%80%81ip/</url>
      
        <content type="html"><![CDATA[<h2 id="Mac的VM中设置虚拟机静态ip"><a href="#Mac的VM中设置虚拟机静态ip" class="headerlink" title="Mac的VM中设置虚拟机静态ip"></a>Mac的VM中设置虚拟机静态ip</h2><p>闲来无事，想学习下spark相关的知识，于是需要几台服务器，无奈囊中羞涩双十一都买不起一台服务器，只能借助2015款的mac pro帮助虚拟几台服务器来暂时用用。</p><h3 id="准备过程"><a href="#准备过程" class="headerlink" title="准备过程"></a>准备过程</h3><p>FinalShell 一款国产的mac上可用的shell命令工具<br>VMware Fusion  mac上用来安装虚拟机的工具<br>centos7 的最简版镜像</p><h3 id="设置VMware-Fusion"><a href="#设置VMware-Fusion" class="headerlink" title="设置VMware Fusion"></a>设置VMware Fusion</h3><h4 id="第一步：修改vmware-配置网卡的配置文件"><a href="#第一步：修改vmware-配置网卡的配置文件" class="headerlink" title="第一步：修改vmware 配置网卡的配置文件"></a>第一步：修改vmware 配置网卡的配置文件</h4><p>只更改Vnet8 的网卡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ vim /Library/Preferences/VMware\ Fusion/networking</span><br><span class="line"></span><br><span class="line">VERSION=1,0</span><br><span class="line">answer VNET_1_DHCP yes</span><br><span class="line">answer VNET_1_DHCP_CFG_HASH EC13F23285B5086AFF5BDFFA85E8DE0338C2AF74</span><br><span class="line">answer VNET_1_HOSTONLY_NETMASK 255.255.255.0</span><br><span class="line">answer VNET_1_HOSTONLY_SUBNET 172.16.208.0</span><br><span class="line">answer VNET_1_VIRTUAL_ADAPTER yes</span><br><span class="line"><span class="comment">#关闭dhcp</span></span><br><span class="line">answer VNET_8_DHCP no</span><br><span class="line">answer VNET_8_DHCP_CFG_HASH 13FB4A1FC14575A20209A2C7C8C2E5EED98C6665</span><br><span class="line"><span class="comment"># 子网掩码</span></span><br><span class="line">answer VNET_8_HOSTONLY_NETMASK 255.255.255.0</span><br><span class="line"><span class="comment">#设置ip段</span></span><br><span class="line">answer VNET_8_HOSTONLY_SUBNET 192.168.100.0</span><br><span class="line">answer VNET_8_NAT yes</span><br><span class="line">answer VNET_8_VIRTUAL_ADAPTER yes</span><br><span class="line"><span class="comment"># vmnet8 的IP</span></span><br><span class="line">answer VNET_8_VIRTUAL_ADAPTER_ADDR 192.168.100.1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="第二步：设置网关"><a href="#第二步：设置网关" class="headerlink" title="第二步：设置网关"></a>第二步：设置网关</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置nat.conf 这个文件</span></span><br><span class="line">vim /Library/Preferences/VMware\ Fusion/vmnet8/nat.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#设定nat网管和子网</span></span><br><span class="line"><span class="comment"># NAT gateway address</span></span><br><span class="line">ip = 192.168.100.2</span><br><span class="line">netmask = 255.255.255.0</span><br></pre></td></tr></table></figure><h4 id="第三步：-重启vmnet8网卡"><a href="#第三步：-重启vmnet8网卡" class="headerlink" title="第三步： 重启vmnet8网卡"></a>第三步： 重启vmnet8网卡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡状态</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --status  </span><br><span class="line"><span class="comment"># 关闭网卡</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动网卡</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --start</span><br></pre></td></tr></table></figure><p>～～～～<br>中间省去在vm中创建centos的虚拟机步骤<br>～～～～</p><h4 id="第四步：设置centos网卡"><a href="#第四步：设置centos网卡" class="headerlink" title="第四步：设置centos网卡"></a>第四步：设置centos网卡</h4><h5 id="1、配置网卡"><a href="#1、配置网卡" class="headerlink" title="1、配置网卡"></a>1、配置网卡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> $ vi /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line"><span class="comment"># 设置静态的ip，而不是dhcp方式</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=74ad3dd0-742d-422b-b165-6f0d0b6e2f6d</span><br><span class="line">DEVICE=ens33</span><br><span class="line"><span class="comment"># 设置网卡开机启动</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># 设置当前centos的ip地址</span></span><br><span class="line">IPADDR=192.168.100.15</span><br><span class="line"><span class="comment"># 设置网关</span></span><br><span class="line">GATEWAY=192.168.100.2</span><br><span class="line"><span class="comment"># 设置子网掩码</span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="comment">#设置dns</span></span><br><span class="line">DNS1=119.29.29.29</span><br><span class="line">DNS2=182.254.116.116</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2、重启centos网卡"><a href="#2、重启centos网卡" class="headerlink" title="2、重启centos网卡"></a>2、重启centos网卡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启网卡</span></span><br><span class="line">systemctl restart network </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡</span></span><br><span class="line">ip addr </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2、测试"><a href="#2、测试" class="headerlink" title="2、测试"></a>2、测试</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:dd:bc:55 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.100.15/24 brd 192.168.100.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a3c4:b923:6d37:e7aa/64 scope link tentative noprefixroute dadfailed </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::3427:d5be:210e:dce2/64 scope link tentative noprefixroute dadfailed </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::3f6a:22ae:8bdd:e0ac/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试发现ens33的ip地址已经变成了我们设置的ip了.</p><p>测试访问外网</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ping www.baidu.com</span><br><span class="line"></span><br><span class="line">PING www.a.shifen.com (180.101.49.12) 56(84) bytes of data.</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=1 ttl=128 time=17.9 ms</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=2 ttl=128 time=117 ms</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=4 ttl=128 time=26.7 ms</span><br><span class="line">^C</span><br><span class="line">--- www.a.shifen.com ping statistics ---</span><br><span class="line">4 packets transmitted, 3 received, 25% packet loss, time 3004ms</span><br><span class="line">rtt min/avg/max/mdev = 17.996/54.184/117.813/45.134 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>大工告成，开始happy！！！</p>]]></content>
      
      
      <categories>
          
          <category> 项目管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> CentOS </tag>
            
            <tag> VM </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Apache SkyWalking 单机版测试</title>
      <link href="/dist/2021/01/18/Apache%20SkyWalking%20%E5%8D%95%E6%9C%BA%E7%89%88%E6%B5%8B%E8%AF%95/"/>
      <url>/dist/2021/01/18/Apache%20SkyWalking%20%E5%8D%95%E6%9C%BA%E7%89%88%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Apache-SkyWalking-单机版测试"><a href="#Apache-SkyWalking-单机版测试" class="headerlink" title="Apache SkyWalking 单机版测试"></a>Apache SkyWalking 单机版测试</h1><h2 id="一、部署SkyWalking"><a href="#一、部署SkyWalking" class="headerlink" title="一、部署SkyWalking"></a>一、部署SkyWalking</h2><p>学习之前，最好先浏览一下SkyWalking的设计原理：<a href="https://juejin.im/entry/5a6e491a6fb9a01cbb395ea2">分布式追踪 &amp; APM 系统 SkyWalking 源码分析 —— Collector 存储 Trace 数据</a></p><h3 id="1、下载SkyWalking"><a href="#1、下载SkyWalking" class="headerlink" title="1、下载SkyWalking"></a>1、下载SkyWalking</h3><p><a href="http://skywalking.apache.org/downloads/">SkyWalking官方下载地址</a></p><h3 id="2、解压tar-gz"><a href="#2、解压tar-gz" class="headerlink" title="2、解压tar.gz"></a>2、解压tar.gz</h3><p>得到类似的目录：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-01.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-01.png" srcset="data:image/png;base64,666" alt="SkyWalking的目录"></p><h3 id="3、启动SkyWalking"><a href="#3、启动SkyWalking" class="headerlink" title="3、启动SkyWalking"></a>3、启动SkyWalking</h3><p>SkyWalking启动分两步进行：webApp、OapServer</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localhost:bin wuxuan.chai$ <span class="built_in">pwd</span></span><br><span class="line">/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/bin</span><br><span class="line">localhost:bin wuxuan.chai$ ls -l</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1352 12 24 14:10 oapService.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1599 12 24 14:10 oapService.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1364 12 24 14:10 oapServiceInit.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1597 12 24 14:10 oapServiceInit.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1367 12 24 14:10 oapServiceNoInit.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1616 12 24 14:10 oapServiceNoInit.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff   941 12 24 14:10 startup.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff   934 12 24 14:10 startup.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1426 12 24 14:10 webappService.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1630 12 24 14:10 webappService.sh</span><br><span class="line">localhost:bin wuxuan.chai$ </span><br></pre></td></tr></table></figure><p>bin目录里面包含了三个部分：oap服务、oap服务初始化、webappService</p><ul><li>webappService服务的作用：提供SkyWalking的web服务</li><li>oap服务初始化：初始化oap服务所需要的环境初始化，例如：DataStorage的初始化,读取配置中心配置等</li><li>oap服务：相当于监控数据的收集（collecter）和持久化</li></ul><p>如果配置完成，可以直接执行 sh startup.sh,启动整个项目</p><h3 id="4、SkyWalking相关的配置"><a href="#4、SkyWalking相关的配置" class="headerlink" title="4、SkyWalking相关的配置"></a>4、SkyWalking相关的配置</h3><h4 id="4-1、oap收集数据存储位置配置"><a href="#4-1、oap收集数据存储位置配置" class="headerlink" title="4.1、oap收集数据存储位置配置"></a>4.1、oap收集数据存储位置配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./config/application.yml</span><br><span class="line"><span class="comment"># 查看storage配置项的支持，SkyWalking支持将数据落地到：elasticsearch、elasticsearch7、h2</span></span><br><span class="line"><span class="comment"># 根据实际需求设置响应的配置信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-2、设置配置中心"><a href="#4-2、设置配置中心" class="headerlink" title="4.2、设置配置中心"></a>4.2、设置配置中心</h4><p>SkyWalking支持的配置中心有apollo、nacos、zookeeper、etcd、consul</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./config/application.yml</span><br><span class="line"><span class="comment"># 根据实际需求设置响应的配置信息</span></span><br></pre></td></tr></table></figure><h4 id="4-3、服务端口的设置"><a href="#4-3、服务端口的设置" class="headerlink" title="4.3、服务端口的设置"></a>4.3、服务端口的设置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./webapp/webapp.yml</span><br><span class="line"><span class="comment"># 修改web端口，server.port=9090 默认为8080</span></span><br><span class="line"><span class="comment"># cellector服务的调用地址 修改listOfServers，多个服务用‘,’隔开</span></span><br></pre></td></tr></table></figure><h4 id="4-4、Agent的配置"><a href="#4-4、Agent的配置" class="headerlink" title="4.4、Agent的配置"></a>4.4、Agent的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">～ vim ./agent/config/agent.config</span><br><span class="line"><span class="comment"># oapservice的后端服务，用于应用订阅（默认值127.0.0.1:11800）</span></span><br><span class="line">collector.backend_service=xxx</span><br><span class="line"><span class="comment"># 是否追踪sql的参数</span></span><br><span class="line">plugin.mysql.trace_sql_parameters=<span class="literal">true</span>/<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置完成这些基本配置之后，就可以直接执行 sh startup.sh,启动整个项目了</p><h3 id="5、将应用加入到SkyWalking的监控代理中"><a href="#5、将应用加入到SkyWalking的监控代理中" class="headerlink" title="5、将应用加入到SkyWalking的监控代理中"></a>5、将应用加入到SkyWalking的监控代理中</h3><h4 id="5-1、springboot项目"><a href="#5-1、springboot项目" class="headerlink" title="5.1、springboot项目"></a>5.1、springboot项目</h4><p>springboot应用：启动springboot的demo应用，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SkyWalking Agent 配置</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_NAME=demo-application <span class="comment"># 配置 Agent 名字。一般来说，我们直接使用 Spring Boot 项目的 `spring.application.name` 。</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 <span class="comment"># 配置 Collector 地址。</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_SPAN_LIMIT=2000 <span class="comment"># 配置链路的最大 Span 数量。一般情况下，不需要配置，默认为 300 。主要考虑，有些新上 SkyWalking Agent 的项目，代码可能比较糟糕。</span></span><br><span class="line"><span class="built_in">export</span> JAVA_AGENT=-javaagent:/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar <span class="comment"># SkyWalking Agent jar 地址。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jar 启动</span></span><br><span class="line">java -jar <span class="variable">$JAVA_AGENT</span> -jar lab-39-demo-2.2.2.RELEASE.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行启动脚本，即可在SkyWalking的拓扑图中看到对应的服务监控信息</p><h4 id="5-2、传统的ssm项目，使用tomcat-jetty等容器发布的工程"><a href="#5-2、传统的ssm项目，使用tomcat-jetty等容器发布的工程" class="headerlink" title="5.2、传统的ssm项目，使用tomcat/jetty等容器发布的工程"></a>5.2、传统的ssm项目，使用tomcat/jetty等容器发布的工程</h4><p>需要在启动的参数中加入</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-DSW_AGENT_NAME</span>=<span class="string">xxx</span></span><br><span class="line"><span class="meta">-DSW_AGENT_COLLECTOR_BACKEND_SERVICES</span>=<span class="string">127.0.0.1:11800</span></span><br><span class="line"><span class="meta">-DSW_AGENT_SPAN_LIMIT</span>=<span class="string">2000</span></span><br><span class="line"><span class="meta">-javaagent</span>:<span class="string">/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar</span></span><br></pre></td></tr></table></figure><p>启动tomcat/jetty，即可。</p><p>效果如图：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-02.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-02.png" srcset="data:image/png;base64,666" alt="应用服务的拓扑图"></p>]]></content>
      
      
      <categories>
          
          <category> 项目管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SkyWalking </tag>
            
            <tag> 系统监控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven常用命令</title>
      <link href="/dist/2021/01/18/maven%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
      <url>/dist/2021/01/18/maven%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h2><h3 id="一、上传包到maven中央仓库"><a href="#一、上传包到maven中央仓库" class="headerlink" title="一、上传包到maven中央仓库"></a>一、上传包到maven中央仓库</h3><p>命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file -DgroupId=com.aliyun -DartifactId=taobao-sdk-java-auto -Dversion=202011-release -Dpackaging=jar -Dfile=/Users/wuxuan.chai/Downloads/dingtalk-sdk-java/taobao-sdk-java-auto_1479188381469-20201126.jar -Durl=http://ci.yunat.com:8091/nexus/content/repositories/thirdparty/ -DrepositoryId=nexus</span><br></pre></td></tr></table></figure><p>参数解释:<br>deploy:deploy-file：发布，发布文件到远程，和install的区别在于，install的意思是将jar安装到本地maven仓库<br>groupId、artifactId、version：表示maven的坐标<br>file：发布的文件的本地地址<br>url：远程仓库的地址<br>repositoryId：本地maven配置文件的仓库id，配置这个的话他会去找配置文件中的对应仓库的访问鉴权所需的账户和密码</p>]]></content>
      
      
      <categories>
          
          <category> 开发总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>项目版本管理的最佳实践</title>
      <link href="/dist/2021/01/18/%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
      <url>/dist/2021/01/18/%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="项目版本管理的最佳实践"><a href="#项目版本管理的最佳实践" class="headerlink" title="项目版本管理的最佳实践"></a>项目版本管理的最佳实践</h1><h2 id="一、Git设置"><a href="#一、Git设置" class="headerlink" title="一、Git设置"></a>一、Git设置</h2><p>1、添加公钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">打开 git bash (mac 下直接打开终端即可)</span><br><span class="line"><span class="comment">#: ssh-keygen -t rsa -C &quot;邮箱&quot;</span></span><br><span class="line"><span class="comment">#: cat ~/.ssh/id_rsa.pub</span></span><br><span class="line">会生成：以ssh-rsa 开头的字符串，复制，贴到git公钥管理里面</span><br><span class="line"></span><br><span class="line">测试是否可以通过公钥，免密拉取上传代码</span><br><span class="line"><span class="comment">#: ssh -T git@gitee.com （我这里用的gitee，对应的域名请自行切换）</span></span><br><span class="line"></span><br><span class="line">成功：</span><br><span class="line">Hi 柴梧炫 (DeployKey)! You<span class="string">&#x27;ve successfully authenticated, but GITEE.COM does not provide shell access.</span></span><br><span class="line"><span class="string">Note: Perhaps the current use is DeployKey.</span></span><br><span class="line"><span class="string">Note: DeployKey only supports pull/fetch operations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">失败：</span></span><br><span class="line"><span class="string">The authenticity of host &#x27;</span>gitlab.com (172.65.251.78)<span class="string">&#x27; can&#x27;</span>t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521122520622.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521122520622.png" srcset="data:image/png;base64,666" alt="git中的配置"></p><h2 id="二、项目版本"><a href="#二、项目版本" class="headerlink" title="二、项目版本"></a>二、项目版本</h2><p>在web开发的过程中，maven 除了作为项目的依赖管理之外，还处理着项目的版本控制</p><h2 id="1、maven-的多项目的标准结构"><a href="#1、maven-的多项目的标准结构" class="headerlink" title="1、maven 的多项目的标准结构"></a>1、maven 的多项目的标准结构</h2><h3 id="1-1、如何组织项目"><a href="#1-1、如何组织项目" class="headerlink" title="1.1、如何组织项目"></a>1.1、如何组织项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[MavenMultiProject]</span><br><span class="line"> ├── module-1</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   └── src</span><br><span class="line"> ├── module-2</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   └── src</span><br><span class="line"> ├── module-3</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   ├── module-3-1</span><br><span class="line"> │       ├── pom.xml</span><br><span class="line"> │       └── src</span><br><span class="line"> │   ├── module-3-2</span><br><span class="line"> │       ├── pom.xml</span><br><span class="line"> │       └── src</span><br><span class="line"> ├── pom.xml</span><br><span class="line"> ├── README.en.md</span><br><span class="line"> ├── README.md</span><br></pre></td></tr></table></figure><p>其中子模块也可以有其子模块</p><h3 id="1-2、POM文件中的内容"><a href="#1-2、POM文件中的内容" class="headerlink" title="1.2、POM文件中的内容"></a>1.2、POM文件中的内容</h3><h4 id="1-2-1、parent-pom-xml"><a href="#1-2-1、parent-pom-xml" class="headerlink" title="1.2.1、parent pom.xml"></a>1.2.1、parent pom.xml</h4><p>父模块的pom文件一般存放公用的信息，以及定义标准，打包的格式：pom</p><p>除了上述的信息，一般不要引入其他的元素，因为一旦引入，子模块就会继承这些依赖，导致子模块的依赖被污染</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 属性定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  ....</span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 仓库的定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 软件配置管理（项目git地址信息）如果git需要权限，则需要加入公钥，免密访问--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">connection</span>&gt;</span></span><br><span class="line">            scm:git:https://gitee.com/wuxuanchai_admin/m-v.git</span><br><span class="line">   <span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">            scm:git:https://gitee.com/wuxuanchai_admin/m-v.git</span><br><span class="line">   <span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">            https://gitee.com/liang.liang/version-mangement-best-practices</span><br><span class="line">   <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--开发者--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>wuxuan.chai<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">email</span>&gt;</span>wuxuan.chai@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>www.shuyun.com<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--模块定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">moudles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">moudle</span>&gt;</span>../moudle1<span class="tag">&lt;/<span class="name">moudle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">moudles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--插件定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--依赖定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>pom文件中可被继承的元素：</p><ul><li>可继承的POM元素如下：<ul><li>groupId：项目组ID，项目坐标的核心元素</li><li>version：项目版本，项目坐标的核心因素</li><li>description：项目的描述信息</li><li>organization：项目的组织信息</li><li>inceptionYear：项目的创始年份</li><li>url：项目的URL地址</li><li>developers：项目的开发者信息</li><li>contributors：项目的贡献者信息</li><li>distributionManagement：项目的部署配置</li><li>issueManagement：项目的缺陷跟踪系统信息</li><li>ciManagement：项目的持续集成系统信息</li><li>scm：项目的版本控制系统西溪</li><li>malilingLists：项目的邮件列表信息</li><li>properties：自定义的Maven属性</li><li>dependencies：项目的依赖配置</li><li>dependencyManagement：项目的依赖管理配置</li><li>repositories：项目的仓库配置</li><li>build：包括项目的源码目录配置、输出目录配置、插件配置、插件管理配置等</li><li>reporting：包括项目的报告输出目录配置、报告插件配置等</li></ul></li></ul><h4 id="1-2-2、子模块"><a href="#1-2-2、子模块" class="headerlink" title="1.2.2、子模块"></a>1.2.2、子模块</h4><p>子模块是具体依赖的配置，一般以jar包的格式提供服务（使用springboot后，war包格式会被打成jar）</p><p>在子模块中，所有的version都不应该存在，要放在parent.pom 中进行统一管理</p><ul><li>模块本身：version 继承父模块的versoin</li><li>所有依赖version，在父模块的dependencyManagement 元素中进行定义</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父模块的坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当前模块的坐标，不需要写版本信息，会继承父模块的版本号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块描述--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块依赖列表--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块的构建所需要的插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-3、语义化的版本号（Semantic-Versioning）"><a href="#1-3、语义化的版本号（Semantic-Versioning）" class="headerlink" title="1.3、语义化的版本号（Semantic Versioning）"></a>1.3、语义化的版本号（Semantic Versioning）</h3><h4 id="1-3-1、版本号的格式"><a href="#1-3-1、版本号的格式" class="headerlink" title="1.3.1、版本号的格式"></a>1.3.1、版本号的格式</h4><p>版本号的格式： 主版本号.次版本号.修订号        </p><p>版本号的递增的规则：</p><p>1、主版本号：当你做了不兼容的API修改</p><p>2、次版本号：当你做了向下兼容的功能性新增</p><p>3、修订号：当你做了向下兼容的问题修正</p><p>先行版本号及版本编译元数据可以加到“主版本号.次版本号.修订号”的后面，作为延伸。</p><p>也就是说可以支持这种版本号：</p><p>4.7.5.202005</p><ul><li>4 主版本号</li><li>7 次版本号</li><li>5 修订号</li><li>202005 编译元数据-编译日期</li></ul><p>其他的语义描述：</p><ul><li>Alpha：内测版</li><li>Beta：公测版</li><li>Gamma：比较成熟的测试版，与即将发行的正式版相差无几</li><li>RC：是 Release Candidate 的缩写，意思是发布倒计时，候选版本</li><li>Stable：稳定版</li></ul><h3 id="1-4、版本性质：-Snapshot-与Release"><a href="#1-4、版本性质：-Snapshot-与Release" class="headerlink" title="1.4、版本性质： Snapshot 与Release"></a>1.4、版本性质： Snapshot 与Release</h3><h4 id="1-4-1、概念"><a href="#1-4-1、概念" class="headerlink" title="1.4.1、概念"></a>1.4.1、概念</h4><p>Snapshot：快照，他是一个不稳定的版本，处于开发中的，经常变化的版本</p><p>Release：发行版，功能稳定的版本，将停止代码的更新，用于发行到生产环境</p><h4 id="1-4-2、理想的流程"><a href="#1-4-2、理想的流程" class="headerlink" title="1.4.2、理想的流程"></a>1.4.2、理想的流程</h4><h5 id="日常的开发"><a href="#日常的开发" class="headerlink" title="日常的开发"></a>日常的开发</h5><p>基于Snapshot的版本进行开发，snapshot版本会有一些特性</p><ul><li>执行 mvn complie 时会去仓库中尝试拉最新打包，因为他可以被多次构建，使用时必须保证最新</li><li>可以被重复构建</li></ul><h5 id="版本发布"><a href="#版本发布" class="headerlink" title="版本发布"></a>版本发布</h5><p>在发布版本的时候，我们需要做以下的几件事：</p><p>1、创建Tag分支，tag/v版本号（例如：tag/v0.0.1）</p><p>2、在仓库中构建发布包（release 的jar）</p><p>3、创建新的开发分支，升级本地pom文件版本，根据实际的需求提升版本号</p><ul><li>如果hotfix发布，则：x.y.z -&gt; x.y.z+1            例如：4.7.5 &gt; 4.7.6</li><li>次版本发布， 则： x.y.z -&gt; x.y+1.0                例如：4.7.5 &gt; 4.8.0</li><li>大版本更新，则：x.y.z -&gt; x+1.0.0                  例如：4.7.5 &gt; 5.0.0</li></ul><p>4、非hotfix版本发布，还需要创建hotfix分支，用于以后修复</p><h5 id="现有的项目如何做？"><a href="#现有的项目如何做？" class="headerlink" title="现有的项目如何做？"></a>现有的项目如何做？</h5><p>插件管理：maven-release-plugin</p><p>插件地址：<a href="http://maven.apache.org/maven-release/maven-release-plugin/">http://maven.apache.org/maven-release/maven-release-plugin/</a></p><p>parent pom配置文件配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- git项目地址可以用SSH  也可以用 HTTPS的--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:git:https://gitee.com/wuxuanchai_admin/m-v.git<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- #git项目地址可以用SSH  也可以用 HTTPS的--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:git:https://gitee.com/wuxuanchai_admin/m-v.git<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- #git项目浏览器里的地址--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://gitee.com/liang.liang/version-mangement-best-practices<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-release-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag分支的名称，project.version只包含版本，不包含SNAPSHOT后缀 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tagNameFormat</span>&gt;</span>v@&#123;project.version&#125;<span class="tag">&lt;/<span class="name">tagNameFormat</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 升级子模块 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">autoVersionSubmodules</span>&gt;</span>true<span class="tag">&lt;/<span class="name">autoVersionSubmodules</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 跳过单元测试 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-DskipTests<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 执行目标，此句可省 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span>-f pom.xml deploy<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="如何使用？？"><a href="#如何使用？？" class="headerlink" title="如何使用？？"></a>如何使用？？</h5><h6 id="1-release-branch（创建分支-）"><a href="#1-release-branch（创建分支-）" class="headerlink" title="1) release:branch（创建分支 ）"></a>1) release:branch（创建分支 ）</h6><p>创建的分支是用于hotfix修复的基础分支，在第一次创建次要版本是，要一并创建，以后的修改都基于此分支，后续如果有需要的hotfix来修复问题，则基于此分支创建一个新的分支hotfix-xxx，然后提交代码后，将release一个hotfix的版本：x.y.z+1(z表示当前的修订号)</p><p>命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:branch -DbranchName=0.2.x -DupdateBranchVersions=<span class="literal">true</span> -DupdateWorkingCopyVersions=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>命令含义：</p><ul><li>-DbranchName=0.2.x：创建一个叫 0.2.x 的分支</li><li>-DupdateBranchVersions=true ：分支会升级版本号，如果当前的版本号为0.0.1-snapshot，则新的分支版本号为： 0.0.2-snapshot</li><li>DupdateWorkingCopyVersions=false 当前工作空间的pom文件不做更改，方便后面的release操作</li></ul><h6 id="2-release-prepare-预处理，升级pom-version"><a href="#2-release-prepare-预处理，升级pom-version" class="headerlink" title="2)  release:prepare(预处理，升级pom-version)"></a>2)  release:prepare(预处理，升级pom-version)</h6><p>预处理阶段，release插件会：</p><ul><li>执行一次打包过程</li><li>在git仓库里面创建好Tag分支</li><li>升级pom文件版本，并提交到本地仓库（此处不会更改远程仓库的分支）</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:prepare</span><br></pre></td></tr></table></figure><p>在默认的情况下，他是一个交互式的命令，有如下问题需要确认：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">What is the release version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.15: :</span><br><span class="line">What is SCM release tag or label for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) v0.1.15: :</span><br><span class="line">What is the new development version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.16-SNAPSHOT: :</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;要发布的版本是哪一个？默认当前版本</span><br><span class="line">&#x2F;&#x2F;要打的tag叫什么？现在的样子 </span><br><span class="line">&#x2F;&#x2F;创建一个新的开发版本吗？默认当前版本+1 修订（此处我们可以手工改成 子版本号更新）</span><br></pre></td></tr></table></figure><p>执行了 release:prepare命令后，在git仓库中，我们可以看到一个叫：v0.1.15的tag被创建，这操作是可以回滚的，插件在项目里面创建了一个，pom.xml.releaseBackup的文件，用于回滚pom.xml，同时还会生成：release.properties 里面会记录release版本的属性</p><h6 id="3-release-rollback-回滚"><a href="#3-release-rollback-回滚" class="headerlink" title="3) release:rollback(回滚)"></a>3) release:rollback(回滚)</h6><p>Release:prepare 阶段都是进行了本地的提交，因此可以进行回滚，但tag分支必须手工删除，插件不能帮你删除已经创建好的本地Tag</p><p>除此之外，可以还行发布预览：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:prepare -DdryRun=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>干跑会生成预览文件：</p><p>pom.xml.next<br>pom.xml.releaseBackup<br>pom.xml.tag<br>release.properties</p><p>但是不会提交。</p><h6 id="4-release-perform-执行"><a href="#4-release-perform-执行" class="headerlink" title="4) release:perform (执行)"></a>4) release:perform (执行)</h6><p>执行命令，会在release仓库里面构建发布包</p><h5 id="可能碰到的问题"><a href="#可能碰到的问题" class="headerlink" title="可能碰到的问题"></a>可能碰到的问题</h5><ul><li><p>release:rollback不会回滚git的tag，需要手动删除tag</p></li><li><p>maven配置的优先级(idea下)    pom.xml&gt;.m2/setting.xml&gt;setting.xml</p></li><li><p>pom.xml 发生改变，无法执行release:prepare</p></li><li><p>私服的设置和maven的配置文件如果配置不正确，无法执行命令</p></li></ul><h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>私服中release的jar：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521143731682.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521143731682.png" srcset="data:image/png;base64,666" alt="image-20200521143731682"></p><p>私服中的snapshot的jar：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144447952.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144447952.png" srcset="data:image/png;base64,666" alt="image-20200521144447952"></p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144515512.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144515512.png" srcset="data:image/png;base64,666" alt="image-20200521144515512"></p><p>git中的tag：发布release后创建的tag分支</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144553460.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144553460.png" srcset="data:image/png;base64,666" alt="image-20200521144553460"></p>]]></content>
      
      
      <categories>
          
          <category> 开发总结 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arthas诊断神器</title>
      <link href="/dist/2021/01/17/Arthas%E8%AF%8A%E6%96%AD%E7%A5%9E%E5%99%A8/"/>
      <url>/dist/2021/01/17/Arthas%E8%AF%8A%E6%96%AD%E7%A5%9E%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="一、快速入门"><a href="#一、快速入门" class="headerlink" title="一、快速入门"></a>一、快速入门</h2><h3 id="1-1、Arthas简介"><a href="#1-1、Arthas简介" class="headerlink" title="1.1、Arthas简介"></a>1.1、Arthas简介</h3><p>Arthas 是Alibaba开源的Java诊断工具。可以安装在系统所在服务器，也可以远程诊断其他服务器的服务。可以帮助开发人员或者运维人员查找问题，分析性能，bug追踪。</p><h3 id="1-2、Arthas的快速入门"><a href="#1-2、Arthas的快速入门" class="headerlink" title="1.2、Arthas的快速入门"></a>1.2、Arthas的快速入门</h3><p>下载地址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://alibaba.github.io/arthas/arthas-boot.jar</span><br></pre></td></tr></table></figure><p>应用程序：可以自己启一个java服务</p><h3 id="1-3、启动Arthas"><a href="#1-3、启动Arthas" class="headerlink" title="1.3、启动Arthas"></a>1.3、启动Arthas</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar </span><br></pre></td></tr></table></figure><p>执行arthas程序的用户要和应用程序的执行用户为相同的权限。比如：应用程序使用admin用户来执行，那么arthas的启动：sudo su admin &amp;&amp; java -jar arthas-boot.jar 或者 sudo -u admin -EH java -jar arthas-boot.jar<br>java -jar arthas-boot.jar -h 打印更多的信息</p><p>开始启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar </span><br><span class="line">[INFO] arthas-boot version: 3.3.3</span><br><span class="line">[INFO] Process 84742 already using port 3658</span><br><span class="line">[INFO] Process 84742 already using port 8563</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br></pre></td></tr></table></figure><p>可以看到我们通过wuxuan.chai用户启动了7个java进程（pid）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br></pre></td></tr></table></figure><p>选择应用的java进程：<br>这里我们选择我们的测试app，1<br>输入1，再回车/enter，arthas会attach到目标进程：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar </span><br><span class="line">[INFO] arthas-boot version: 3.3.3</span><br><span class="line">[INFO] Process 84742 already using port 3658</span><br><span class="line">[INFO] Process 84742 already using port 8563</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br><span class="line">1</span><br><span class="line">[INFO] arthas home: /Users/wuxuan.chai/.arthas/lib/3.3.6/arthas</span><br><span class="line">[INFO] The target process already listen port 3658, skip attach.</span><br><span class="line">[INFO] arthas-client connect 127.0.0.1 3658</span><br><span class="line">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </span><br><span class="line"> /  O  \ |  .--. &#x27;&#x27;--.  .--&#x27;|  &#x27;--&#x27;  | /  O  \ &#x27;   .-&#x27;                          </span><br><span class="line">|  .-.  ||  &#x27;--&#x27;.&#x27;   |  |   |  .--.  ||  .-.  |`.  `-.                          </span><br><span class="line">|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-&#x27;    |                         </span><br><span class="line">`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27;   `--&#x27;   `--&#x27;  `--&#x27;`--&#x27; `--&#x27;`-----&#x27;                          </span><br><span class="line">                                                                                </span><br><span class="line"></span><br><span class="line">wiki      https://alibaba.github.io/arthas                                      </span><br><span class="line">tutorials https://alibaba.github.io/arthas/arthas-tutorials                     </span><br><span class="line">version   3.3.6                                                                 </span><br><span class="line">pid       84742                                                                 </span><br><span class="line">time      2020-07-06 10:46:47                                                   </span><br><span class="line"></span><br><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4、Arthas的基本操作"><a href="#1-4、Arthas的基本操作" class="headerlink" title="1.4、Arthas的基本操作"></a>1.4、Arthas的基本操作</h3><p>Arthas的入门基本操作：Dashboard/thread/jad/watch，来查看一些最基本的指标信息，比如，资源占用，线程，类信息，方法执行信息。</p><h4 id="1-4-1、查看Dashboard"><a href="#1-4-1、查看Dashboard" class="headerlink" title="1.4.1、查看Dashboard"></a>1.4.1、查看Dashboard</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> dashboard</span> </span><br><span class="line">ID          NAME                                 GROUP                    PRIORITY    STATE       %CPU        TIME         INTERRUPTED DAEMON      </span><br><span class="line">149         Timer-for-arthas-dashboard-3bf90e35- system                   10          RUNNABLE    51          0:0          false       true        </span><br><span class="line">113         Catalina-utility-1                   main                     1           TIMED_WAITI 14          0:0          false       false       </span><br><span class="line">116         http-nio-7070-BlockPoller            main                     5           RUNNABLE    14          0:0          false       true        </span><br><span class="line">127         http-nio-7070-ClientPoller           main                     5           RUNNABLE    13          0:0          false       true        </span><br><span class="line">114         Catalina-utility-2                   main                     1           WAITING     5           0:0          false       false       </span><br><span class="line">131         Attach Listener                      system                   9           RUNNABLE    0           0:0          false       true        </span><br><span class="line">130         DestroyJavaVM                        main                     5           RUNNABLE    0           0:1          false       false       </span><br><span class="line">3           Finalizer                            system                   8           WAITING     0           0:0          false       true        </span><br><span class="line">2           Reference Handler                    system                   10          WAITING     0           0:0          false       true        </span><br><span class="line">4           Signal Dispatcher                    system                   9           RUNNABLE    0           0:0          false       true        </span><br><span class="line">136         arthas-shell-server                  system                   9           TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">137         arthas-shell-server                  system                   9           TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">133         arthas-timer                         system                   9           WAITING     0           0:0          false       true        </span><br><span class="line">141         as-command-execute-daemon            system                   10          TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">115         container-0                          main                     5           TIMED_WAITI 0           0:0          false       false       </span><br><span class="line">Memory                          used      total      max       usage      GC                                                                       </span><br><span class="line">heap                            169M      370M       3641M     4.66%      gc.ps_scavenge.count                 4                                   </span><br><span class="line">ps_eden_space                   140M      183M       1344M     10.46%     gc.ps_scavenge.time(ms)              37                                  </span><br><span class="line">ps_survivor_space               0K        10752K     10752K    0.00%      gc.ps_marksweep.count                2                                   </span><br><span class="line">ps_old_gen                      29M       176M       2731M     1.07%      gc.ps_marksweep.time(ms)             118                                 </span><br><span class="line">nonheap                         53M       57M        -1        92.98%                                                                              </span><br><span class="line">code_cache                      5M        7M         240M      2.17%                                                                               </span><br><span class="line">metaspace                       42M       44M        -1        95.78%                                                                              </span><br><span class="line">Runtime                                                                                                                                            </span><br><span class="line">os.name                                                                   Mac OS X                                                                 </span><br><span class="line">os.version                                                                10.14.6                                                                  </span><br><span class="line">java.version                                                              1.8.0_241                                                                </span><br><span class="line">java.home                                                                 /Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre     </span><br><span class="line">systemload.average                                                        3.25                                                                     </span><br><span class="line">processors                                                                8                                                                        </span><br><span class="line">uptime               </span><br></pre></td></tr></table></figure><p>上半部分是程序的线程信息，中间是内存使用情况，这里可以查看gc的次数，下面是当前程序运行的环境信息</p><h4 id="1-4-2、thread命令查看进程"><a href="#1-4-2、thread命令查看进程" class="headerlink" title="1.4.2、thread命令查看进程"></a>1.4.2、thread命令查看进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> thread 115</span> </span><br><span class="line">&quot;container-0&quot; Id=115 TIMED_WAITING</span><br><span class="line">    at java.lang.Thread.sleep(Native Method)</span><br><span class="line">    at org.apache.catalina.core.StandardServer.await(StandardServer.java:570)</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer$1.run(TomcatWebServer.java:197)</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:0) cost in 1 ms.</span><br></pre></td></tr></table></figure><p>查看线程的具体信息，调用对象，状态等。。。</p><h4 id="1-4-3、jad反编译class类"><a href="#1-4-3、jad反编译class类" class="headerlink" title="1.4.3、jad反编译class类"></a>1.4.3、jad反编译class类</h4><p>通过jad反编译springboot的启动类：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> jad com.yiyi.Application</span></span><br><span class="line"></span><br><span class="line">ClassLoader:                                                                                                                                       </span><br><span class="line">+-sun.misc.Launcher$AppClassLoader@4e25154f                                                                                                        </span><br><span class="line">  +-sun.misc.Launcher$ExtClassLoader@2ef1e4fa                                                                                                      </span><br><span class="line"></span><br><span class="line">Location:                                                                                                                                          </span><br><span class="line">/Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                       </span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Decompiled with CFR.</span><br><span class="line"> */</span><br><span class="line">package com.yiyi;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@ComponentScan(value=&#123;&quot;com.yiyi&quot;&#125;)</span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:2) cost in 181 ms.</span><br><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><h4 id="1-4-4、watch查看函数的返回值"><a href="#1-4-4、watch查看函数的返回值" class="headerlink" title="1.4.4、watch查看函数的返回值"></a>1.4.4、watch查看函数的返回值</h4><p>通过watch命令查看方法的返回值，查看获取微信的accessToken的方法返回值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> watch com.yiyi.api.WeixinSupportApi getAccessToken</span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 38 ms, listenerId: 3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行命令后，Arthas会监听该方法的执行，每次调用，都会将执行结果打印出来,例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ts=2020-07-06 11:26:17; [cost=3.13107ms] result=@ArrayList[</span><br><span class="line">    @Object[][isEmpty=false;size=2],</span><br><span class="line">    @WeixinSupportApi[com.yiyi.api.WeixinSupportApi@14cb7037],</span><br><span class="line">    @String[i9c7LCIqY8cJuneYN9C9q4kN-FZoo7YZFVxEpgT3ugMmeX1KJ5HuVgSLK5IkJW7JF_adbkmjGrGdu9aw9XFhrMBLBMC9eFm82ICpst1-UVGujAvdUMcPRkUNcgb7I7MmxHk2ZVIpZzLKxf-3zw1-oE-wfhETKjRrjRhoP7z7g9UD4OS-cctNJBUJk8XfcE2cW_S2GUuj-tm2vyvVNK9oDQ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="二、进阶使用"><a href="#二、进阶使用" class="headerlink" title="二、进阶使用"></a>二、进阶使用</h2><h3 id="2-1、基础命令"><a href="#2-1、基础命令" class="headerlink" title="2.1、基础命令"></a>2.1、基础命令</h3><h4 id="2-1-1、所有命令的集合"><a href="#2-1-1、所有命令的集合" class="headerlink" title="2.1.1、所有命令的集合"></a>2.1.1、所有命令的集合</h4><table><thead><tr><th>NAME</th><th>DESCRIPTION</th></tr></thead><tbody><tr><td>help</td><td>展示Arthas帮助</td></tr><tr><td>keymap</td><td>展示所有指定的连接的可用的快捷键</td></tr><tr><td>sc</td><td>搜索所有被jvm加载类</td></tr><tr><td>sm</td><td>搜索所有被jvm加载的类的方法</td></tr><tr><td>classloader</td><td>展示类加载器的信息</td></tr><tr><td>jad</td><td>类反编译</td></tr><tr><td>getstatic</td><td>展示一个类的静态的属性字段</td></tr><tr><td>monitor</td><td>监控方法执行的数据，例如：合计/成功/失败的数值，实时平均值失败比率等</td></tr><tr><td>stack</td><td>展示指定类和方法的调用栈信息</td></tr><tr><td>thread</td><td>展示线程信息和调用栈</td></tr><tr><td>trace</td><td>指定方法调用栈的执行时间</td></tr><tr><td>watch</td><td>展示指定方法的调用过程中，输入/输出的参数，结果返回值，异常抛出等</td></tr><tr><td>tt</td><td>时间隧道</td></tr><tr><td>jvm</td><td>展示目标jvm的信息</td></tr><tr><td>perfcounter</td><td>展示性能计数器的信息</td></tr><tr><td>ognl</td><td>执行ognl表达式</td></tr><tr><td>mc</td><td>内存编译器，将java文件在内存中编译成字节码和内存中的类文件</td></tr><tr><td>redefine</td><td>重新定义类，参考Instrumentation#redefineClasses(ClassDefinition…)</td></tr><tr><td>dashboard</td><td>预览目标jvm的线程，gc，环境变量，tomcat信息</td></tr><tr><td>dump</td><td>从jvm中转存类的字节码</td></tr><tr><td>heapdump</td><td>堆转存</td></tr><tr><td>options</td><td>查看和更改各种Arthas选项</td></tr><tr><td>cls</td><td>清理屏幕</td></tr><tr><td>reset</td><td>重置所有的增强类</td></tr><tr><td>version</td><td>展示Arthas版本</td></tr><tr><td>session</td><td>展示当前会话的信息</td></tr><tr><td>sysprop</td><td>展示，修改系统的配置</td></tr><tr><td>sysenv</td><td>展示系统环境变量</td></tr><tr><td>vmoption</td><td>展示修改vm诊断选项</td></tr><tr><td>logger</td><td>打印日志信息，修改日志级别</td></tr><tr><td>history</td><td>展示历史命令</td></tr><tr><td>cat</td><td>连接并打印文件内容，类似linux的cat命令</td></tr><tr><td>echo</td><td>将参数写入标准输出</td></tr><tr><td>pwd</td><td>返回工作目录名称</td></tr><tr><td>mbean</td><td>显示mbean信息</td></tr><tr><td>grep</td><td>用于管道的grep命令</td></tr><tr><td>tee</td><td>管道的tee命令</td></tr><tr><td>profiler</td><td>异步分析工具<a href="https://github.com/jvm-profiling-tools/async-profiler">https://github.com/jvm-profiling-tools/async-profiler</a></td></tr><tr><td>stop</td><td>停止/关闭Arthas服务器并退出控制台</td></tr></tbody></table><h4 id="2-1-2、redefine命令，替换指定源class文件"><a href="#2-1-2、redefine命令，替换指定源class文件" class="headerlink" title="2.1.2、redefine命令，替换指定源class文件"></a>2.1.2、redefine命令，替换指定源class文件</h4><p>redefine后的原来的类不能恢复，redefine也有可能失败（比如新增了field），reset命令对redefine无效，如果想重置，需要redefine原始的字节码。<br>不允许新增加field/method。<br>正在执行的函数，没有退出不能生效。</p><p>示例，替换接口的返回值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinSupportApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;这是正牌的接口结果&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请求接口会返回一个字符串：“这是正牌的接口结果”。接下来通过arthas的redifine命令替换成接口返回成一个：“hello”   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinSupportApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">方式一、 </span><br><span class="line">将上述的java文件编译成<span class="class"><span class="keyword">class</span>文件,上传到服务器，使用<span class="title">redefine</span>命令,开始替换：</span></span><br><span class="line"><span class="class">```<span class="title">shell</span></span></span><br><span class="line"><span class="class"><span class="title">redefine</span> <span class="title">weixin</span>/<span class="title">WeixinSupportApi</span>.<span class="title">class</span></span></span><br></pre></td></tr></table></figure><p>方式二、</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//通过jad将class 文件编译成java文件</span><br><span class="line">jad --source-only com.yiyi.api.WeixinSupportApi &gt; weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java</span><br><span class="line">//通过vim对文件进行编辑，实现我们想要的一个逻辑</span><br><span class="line">vim weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java</span><br><span class="line">//通过mc 内存编译，将上面的java文件编译成class 代码</span><br><span class="line">mc weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java -d weixin</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">输出编译后的class 文件地址：</span></span><br><span class="line">Memory compiler output:</span><br><span class="line">/Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.class</span><br><span class="line">Affect(row-cnt:1) cost in 1467 ms.</span><br><span class="line">//redefine 替换内存中的class文件为刚才编译的class 文件</span><br><span class="line">redefine /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.class</span><br><span class="line">即可实现对源class 的编辑，并且进行热部署。。</span><br></pre></td></tr></table></figure><h4 id="2-1-3、headdump命令"><a href="#2-1-3、headdump命令" class="headerlink" title="2.1.3、headdump命令"></a>2.1.3、headdump命令</h4><p>dump java heap，类似jmap命令的heap dump功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//dump到指定的文件</span><br><span class="line">heapdump ./dump.hprof</span><br><span class="line">//只dump live对象</span><br><span class="line">heapdump --live ./dump.hprof</span><br><span class="line">//dump到临时文件</span><br><span class="line">heapdump</span><br></pre></td></tr></table></figure><h4 id="2-1-4、classloader的命令"><a href="#2-1-4、classloader的命令" class="headerlink" title="2.1.4、classloader的命令"></a>2.1.4、classloader的命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">//按类加载类型查看统计信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader</span> </span><br><span class="line"> name                                                numberOfInstances  loadedCountTotal                                                                            </span><br><span class="line"> sun.misc.Launcher$AppClassLoader                    1                  4440                                                                                        </span><br><span class="line"> BootstrapClassLoader                                1                  2932                                                                                        </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader           1                  2095                                                                                        </span><br><span class="line"> lombok.launch.ShadowClassLoader                     1                  242                                                                                         </span><br><span class="line"> sun.reflect.DelegatingClassLoader                   77                 77                                                                                          </span><br><span class="line"> sun.misc.Launcher$ExtClassLoader                    1                  4                                                                                           </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader  2                  2                                                                                           </span><br><span class="line"> sun.reflect.misc.MethodUtil                         1                  1                                                                                           </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//按类加载实例查看统计信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -l</span></span><br><span class="line"> name                                                         loadedCount  hash      parent                                                                         </span><br><span class="line"> BootstrapClassLoader                                         2932         null      null                                                                           </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader@3c708a1d           2095         3c708a1d  sun.misc.Launcher$ExtClassLoader@770c2e6b                                      </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader@1060b431  1            1060b431  null                                                                           </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader@63440df3  1            63440df3  null                                                                           </span><br><span class="line"> lombok.launch.ShadowClassLoader@1756d9eb                     242          1756d9eb  sun.misc.Launcher$AppClassLoader@18b4aac2                                      </span><br><span class="line"> sun.misc.Launcher$AppClassLoader@18b4aac2                    4440         18b4aac2  sun.misc.Launcher$ExtClassLoader@770c2e6b                                      </span><br><span class="line"> sun.misc.Launcher$ExtClassLoader@770c2e6b                    4            770c2e6b  null                                                                           </span><br><span class="line"> sun.reflect.misc.MethodUtil@2c109df9                         1            2c109df9  sun.misc.Launcher$AppClassLoader@18b4aac2                                      </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">// 查看classloader的继承树</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -t</span></span><br><span class="line">+-BootstrapClassLoader                                                                                                                                              </span><br><span class="line">+-javax.management.remote.rmi.NoCallStackClassLoader@1060b431                                                                                                       </span><br><span class="line">+-javax.management.remote.rmi.NoCallStackClassLoader@63440df3                                                                                                       </span><br><span class="line">+-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                                         </span><br><span class="line">  +-com.taobao.arthas.agent.ArthasClassloader@3c708a1d                                                                                                              </span><br><span class="line">  +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                                       </span><br><span class="line">    +-lombok.launch.ShadowClassLoader@1756d9eb                                                                                                                      </span><br><span class="line">    +-sun.reflect.misc.MethodUtil@2c109df9                                                                                                                          </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//查看URLClassloader的实际urls</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 770c2e6b</span></span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunec.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/nashorn.jar                                                                       </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/cldrdata.jar                                                                      </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jfxrt.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/dnsns.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/localedata.jar                                                                    </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar                                                               </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar                                                              </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar                                                              </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar                                                                     </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jaccess.jar                                                                       </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/zipfs.jar                                                                         </span><br><span class="line">file:/System/Library/Java/Extensions/MRJToolkit.jar                                                                                                                 </span><br><span class="line">Affect(row-cnt:84) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//尝试查找类的class文件</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 770c2e6b -r java/lang/String.class jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/rt.jar!/java/lang/String.class</span>                                                   </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 4 ms.</span><br><span class="line"></span><br><span class="line">//使用classloader加载类</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 2c109df9 --load com.yiyi.api.WeixinSupportApi</span></span><br><span class="line">load class success.</span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//使用classloader去查找resource</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader  -c 2c109df9 -r META-INF/MANIFEST.MF</span></span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> jar:file:/System/Library/Java/Extensions/MRJToolkit.jar!/META-INF/MANIFEST.MF                                                                                      </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/charsets.jar!/META-INF/MANIFEST.MF                                               </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/deploy.jar!/META-INF/MANIFEST.MF                                                 </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> </span><br></pre></td></tr></table></figure><h4 id="2-1-4、getstatic获取类中的静态属性"><a href="#2-1-4、getstatic获取类中的静态属性" class="headerlink" title="2.1.4、getstatic获取类中的静态属性"></a>2.1.4、getstatic获取类中的静态属性</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> getstatic com.yiyi.api.WeixinSupportApi CORP_ID</span></span><br><span class="line">field: CORP_ID</span><br><span class="line">@String[ww91156f2c9067a7ba]</span><br><span class="line">Affect(row-cnt:1) cost in 4 ms.</span><br></pre></td></tr></table></figure><p>如果对象是一个复杂的对象，可以使用OGNL表达式进行遍历,过滤</p><h4 id="2-1-5、tt命令，记录调用记录"><a href="#2-1-5、tt命令，记录调用记录" class="headerlink" title="2.1.5、tt命令，记录调用记录"></a>2.1.5、tt命令，记录调用记录</h4><p>方法执行记录的隧道，记录指定方法每次调用的入参和返回的信息，并能对这些不同时间下的调用进行观测。   </p><p>tt的调用方式：<br>|选项|描述|<br>|-|-|<br>|-d,–delete|删除索引指定的时间片段|<br>|–delete-all|删除所有的时间片段|<br>|-x,–expand  value|展开对象级别(默认为1)|<br>|-h,–help|命令使用指南|<br>|-i,–index value|展示指定的时间片段的相信信息|<br>|-n,–limits value|执行时间阈值|<br>|-l,–list|展示所有的时间片段的信息|<br>|–listenerId value|指定监听id|<br>|-p,–play|重放由索引指定的时间片段|<br>|-E,–regex|启用正则表达式匹配(默认情况下为通配符匹配)|<br>|–replay-interval value|选项r大于1的tt的回放间隔|<br>|–replay-times value|执行tt时的次数|<br>|-s,–search-express value|搜索表达式，用ognl表达式搜索时间片段。|<br>||advice的结构类似条件式表达|<br>|-M,–sizeLimit value|结果的字节上限(默认为10<em>1024</em>1024)|<br>|-t,–time-tunnel|在时间片段内记录方法调用|<br>|-w,–watch-express value&gt;|观看ognlexpress的时间片段|<br>|class-pattern|模式匹配的路径和类名|<br>|method-pattern|模式匹配法|<br>|condition-express|ognl风格的条件表达式|</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">//记录调用</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -t com.yiyi.api.WeixinSupportApi <span class="built_in">test</span></span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 129 ms, listenerId: 1</span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000      2020-07-06 17:21:20       0.531715    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1001      2020-07-06 17:21:24       0.026004    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1002      2020-07-06 17:21:27       0.027567    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1003      2020-07-06 17:21:28       0.064779    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"></span><br><span class="line">//展示时间片列表</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -l</span></span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000      2020-07-06 17:21:20       0.531715    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1001      2020-07-06 17:21:24       0.026004    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1002      2020-07-06 17:21:27       0.027567    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1003      2020-07-06 17:21:28       0.064779    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line">Affect(row-cnt:4) cost in 1 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//展示时间片的具体信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1000</span></span><br><span class="line"> INDEX         1000                                                                                                                                                 </span><br><span class="line"> GMT-CREATE    2020-07-06 17:21:20                                                                                                                                  </span><br><span class="line"> COST(ms)      0.531715                                                                                                                                             </span><br><span class="line"> OBJECT        0x437d2cf                                                                                                                                            </span><br><span class="line"> CLASS         com.yiyi.api.WeixinSupportApi                                                                                                                        </span><br><span class="line"> METHOD        test                                                                                                                                                 </span><br><span class="line"> IS-RETURN     true                                                                                                                                                 </span><br><span class="line"> IS-EXCEPTION  false                                                                                                                                                </span><br><span class="line"> RETURN-OBJ    @String[hello]                                                                                                                                       </span><br><span class="line">Affect(row-cnt:1) cost in 1 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//重新调用索引为1000的调用</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1000 -p</span></span><br><span class="line"> RE-INDEX      1000                                                                                                                                                 </span><br><span class="line"> GMT-REPLAY    2020-07-06 17:22:10                                                                                                                                  </span><br><span class="line"> OBJECT        0x437d2cf                                                                                                                                            </span><br><span class="line"> CLASS         com.yiyi.api.WeixinSupportApi                                                                                                                        </span><br><span class="line"> METHOD        test                                                                                                                                                 </span><br><span class="line"> IS-RETURN     true                                                                                                                                                 </span><br><span class="line"> IS-EXCEPTION  false                                                                                                                                                </span><br><span class="line"> COST(ms)      0.260785                                                                                                                                             </span><br><span class="line"> RETURN-OBJ    @String[hello]                                                                                                                                       </span><br><span class="line">Time fragment[1000] successfully replayed 1 times.</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><table><thead><tr><th>表格字段</th><th>字段解释</th></tr></thead><tbody><tr><td>INDEX</td><td>时间片段记录编号，每一个编号代表着一次调用，后续tt还有很多命令都是基于此编号指定记录操作，非常重要。</td></tr><tr><td>TIMESTAMP</td><td>方法执行的本机时间，记录了这个时间片段所发生的本机时间</td></tr><tr><td>COST(ms)</td><td>方法执行的耗时</td></tr><tr><td>IS-RET</td><td>方法是否以正常返回的形式结束</td></tr><tr><td>IS-EXP</td><td>方法是否以抛异常的形式结束</td></tr><tr><td>OBJECT</td><td>执行对象的hashCode()，注意，曾经有人误认为是对象在JVM中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td></tr><tr><td>CLASS</td><td>执行的类名</td></tr><tr><td>METHOD</td><td>执行的方法名</td></tr></tbody></table><p>使用OGNL表达式，对调用参数进行过滤监听。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -t com.yiyi.api.WeixinSupportApi sendMessage <span class="string">&#x27;params[0].text.content==&quot;test&quot;&#x27;</span></span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 72 ms, listenerId: 5</span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1004      2020-07-06 17:33:42       354.578854  true      false      0x437d2cf          WeixinSupportApi                      sendMessage                          </span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1004</span></span><br><span class="line"> INDEX          1004                                                                                                                                                </span><br><span class="line"> GMT-CREATE     2020-07-06 17:33:42                                                                                                                                 </span><br><span class="line"> COST(ms)       354.578854                                                                                                                                          </span><br><span class="line"> OBJECT         0x437d2cf                                                                                                                                           </span><br><span class="line"> CLASS          com.yiyi.api.WeixinSupportApi                                                                                                                       </span><br><span class="line"> METHOD         sendMessage                                                                                                                                         </span><br><span class="line"> IS-RETURN      true                                                                                                                                                </span><br><span class="line"> IS-EXCEPTION   false                                                                                                                                               </span><br><span class="line"> PARAMETERS[0]  @SendMessageVO[                                                                                                                                     </span><br><span class="line">                    touser=@String[Feng],                                                                                                                           </span><br><span class="line">                    msgtype=@String[text],                                                                                                                          </span><br><span class="line">                    agentid=@Integer[1000036],                                                                                                                      </span><br><span class="line">                    text=@Text[com.yiyi.model.SendMessageVO$Text@504511d7],                                                                                         </span><br><span class="line">                    safe=@Integer[0],                                                                                                                               </span><br><span class="line">                ]                                                                                                                                                   </span><br><span class="line"> RETURN-OBJ     @WeixinResponse[                                                                                                                                    </span><br><span class="line">                    errcode=@Integer[0],                                                                                                                            </span><br><span class="line">                    errmsg=@String[ok],                                                                                                                             </span><br><span class="line">                    invaliduser=@String[],                                                                                                                          </span><br><span class="line">                ]                                                                                                                                                   </span><br><span class="line">Affect(row-cnt:1) cost in 1 ms.</span><br></pre></td></tr></table></figure><h4 id="2-1-6、使用sc查看jvm已加载的类信息"><a href="#2-1-6、使用sc查看jvm已加载的类信息" class="headerlink" title="2.1.6、使用sc查看jvm已加载的类信息"></a>2.1.6、使用sc查看jvm已加载的类信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">//模糊匹配，查看某个包下面的类加载信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc com.yiyi.*</span></span><br><span class="line">com.yiyi.Application</span><br><span class="line">com.yiyi.Application$$EnhancerBySpringCGLIB$$7f85004e</span><br><span class="line">com.yiyi.WebConfig</span><br><span class="line">com.yiyi.WebConfig$$EnhancerBySpringCGLIB$$bf76c934</span><br><span class="line">com.yiyi.api.WeixinSupportApi</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$451/966754950</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$467/1545239474</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$468/1304820993</span><br><span class="line">com.yiyi.model.AccessTokenVo</span><br><span class="line">com.yiyi.model.SendMessageVO</span><br><span class="line">com.yiyi.model.SendMessageVO$Text</span><br><span class="line">com.yiyi.model.WeixinResponse</span><br><span class="line">Affect(row-cnt:12) cost in 15 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//指定类的详细信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc -d com.yiyi.api.WeixinSupportApi</span></span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                         </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 8 ms.</span><br><span class="line"></span><br><span class="line">// 指定类的加载信息以及属性字段的信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc -d -f com.yiyi.api.WeixinSupportApi</span></span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                         </span><br><span class="line"> fields            name     log                                                                                                                                     </span><br><span class="line">                   type     org.slf4j.Logger                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    Logger[com.yiyi.api.WeixinSupportApi]                                                                                                   </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name       response                                                                                                                              </span><br><span class="line">                   type       javax.servlet.http.HttpServletResponse                                                                                                </span><br><span class="line">                   modifier   private                                                                                                                               </span><br><span class="line">                   annotation javax.annotation.Resource                                                                                                             </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     CORP_ID                                                                                                                                 </span><br><span class="line">                   type     java.lang.String                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    ww91156f2c9067a7ba                                                                                                                      </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     APP_SECRET                                                                                                                              </span><br><span class="line">                   type     java.lang.String                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    r5ifq9RFqtsL34sdWXmrzMytY7KYksz5cAimzoH1jeg                                                                                             </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     ACCESS_TOKEN_CACHE                                                                                                                      </span><br><span class="line">                   type     com.google.common.cache.Cache                                                                                                           </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    com.google.common.cache.LocalCache$LocalManualCache@39373908                                                                            </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 10 ms.</span><br></pre></td></tr></table></figure><h4 id="2-1-7、mc，内存编译"><a href="#2-1-7、mc，内存编译" class="headerlink" title="2.1.7、mc，内存编译"></a>2.1.7、mc，内存编译</h4><p>Memory Compiler/内存编译器，编译.java 生成.class文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc /tmp/Test.java</span><br></pre></td></tr></table></figure><p>可以通过-c指定classloader：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -c 327a647b /tmp/Test.java</span><br></pre></td></tr></table></figure><p>可以通过-d指定输出的class文件的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java</span><br></pre></td></tr></table></figure><p>编译成的.class文件后，可以结合redefine命令实现热更新代码</p><p>注意，mc命令有可能失败。如果编译失败可以在本地编译好.class文件，再上传到服务器。</p><h4 id="2-1-8、查看方法的stack"><a href="#2-1-8、查看方法的stack" class="headerlink" title="2.1.8、查看方法的stack"></a>2.1.8、查看方法的stack</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> stack com.yiyi.api.WeixinSupportApi getAccessToken</span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 43 ms, listenerId: 8</span><br><span class="line">ts=2020-07-06 17:50:49;thread_name=http-nio-7070-exec-2;id=83;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@2fc07784</span><br><span class="line">    @com.yiyi.api.WeixinSupportApi.getAccessToken()</span><br><span class="line">        at com.yiyi.api.WeixinSupportApi.sendMessage(WeixinSupportApi.java:68)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class="line">        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)</span><br><span class="line">        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)</span><br><span class="line">        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)</span><br><span class="line">        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class="line">        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)</span><br><span class="line">        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>也可以使用OGNL表达式，对请求参数进行过滤，或者使用执行时间进行过滤</p><h3 id="2-2-1、Springboot集成arthas"><a href="#2-2-1、Springboot集成arthas" class="headerlink" title="2.2.1、Springboot集成arthas"></a>2.2.1、Springboot集成arthas</h3><p>引入arthas的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arthas.version</span>&gt;</span>3.3.6<span class="tag">&lt;/<span class="name">arthas.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taobao.arthas<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>arthas-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;arthas.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>应用配置：application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//指定arthas的agentId</span></span><br><span class="line"><span class="meta">arthas.agentId</span>=<span class="string">weixin</span></span><br><span class="line"><span class="meta">//arthas</span> <span class="string">tunnel server 的websocket的地址</span></span><br><span class="line"><span class="meta">arthas.tunnel-server</span>=<span class="string">ws://localhost:7777/ws</span></span><br></pre></td></tr></table></figure><p>重启应用</p><h3 id="2-2-2、通过浏览器连接arthas"><a href="#2-2-2、通过浏览器连接arthas" class="headerlink" title="2.2.2、通过浏览器连接arthas"></a>2.2.2、通过浏览器连接arthas</h3><p>第一步：下载arthas tunnel server<br>wget <a href="https://github.com/alibaba/arthas/releases/download/arthas-all-3.3.6/arthas-tunnel-server-3.3.6.jar">https://github.com/alibaba/arthas/releases/download/arthas-all-3.3.6/arthas-tunnel-server-3.3.6.jar</a><br>第二步：启动arthas tunnel server</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-tunnel-server.jar -server.port=8888 启动并指定web的端口</span><br></pre></td></tr></table></figure><p>这个服务有两个socket连接方式，一个正常的http，用的端口是我们指定的8888，还有一个就是供显示服务器的命令行的websocket连接，端口7777<br>第三步：<br>访问arthas tunnel server ，我是本机测试，所以就是localhost:8888,如图：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/arthas-index.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/arthas-index.png" srcset="data:image/png;base64,666" alt="首页"></p><p>连接指定的应用：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/connect-arthas.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/connect-arthas.png" srcset="data:image/png;base64,666" alt="连接成功"></p><p>默认情况下，连接地址为本地，websocket的端口为7777</p><h3 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h3><p>Arthas贵为java应用诊断神器，对于应用的资源占用，性能分析，jvm监控都有很大的支持帮助。除此之外，在排查线上问题时，可以监听对应的方法的调用，以及动态修改class类，很湿，很方便。而且Arthas对docker的java进程，以及k8s都有很好的支持，后续用到的时候在做学习。</p>]]></content>
      
      
      <categories>
          
          <category> 项目管理 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Arthas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过Jackson玩转Json</title>
      <link href="/dist/2021/01/17/%E9%80%9A%E8%BF%87Jackson%E7%8E%A9%E8%BD%ACJson/"/>
      <url>/dist/2021/01/17/%E9%80%9A%E8%BF%87Jackson%E7%8E%A9%E8%BD%ACJson/</url>
      
        <content type="html"><![CDATA[<h2 id="一、Jackson-注解示例"><a href="#一、Jackson-注解示例" class="headerlink" title="一、Jackson 注解示例"></a>一、Jackson 注解示例</h2><h3 id="1-1、简介"><a href="#1-1、简介" class="headerlink" title="1.1、简介"></a>1.1、简介</h3><p>在本章中，我们将深入探讨Jackson注解。我们将看到如何使用现有的注解，如何创建自定义注解，最后-如何禁用它们。  </p><h3 id="1-2、maven-依赖"><a href="#1-2、maven-依赖" class="headerlink" title="1.2、maven 依赖"></a>1.2、maven 依赖</h3><p>首先，将jackson-databind依赖项添加到pom.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此依赖项还将在类路径中可传递地添加以下库：</p><ol><li>jackson-annotations-2.9.8.jar  </li><li>jackson-core-2.9.8.jar  </li><li>jackson-databind-2.9.8.jar </li></ol><h3 id="1-3、Jackson序列化注解"><a href="#1-3、Jackson序列化注解" class="headerlink" title="1.3、Jackson序列化注解"></a>1.3、Jackson序列化注解</h3><p>首先，我们来看看序列化注解。  </p><h4 id="1-3-1、-JsonAnyGetter"><a href="#1-3-1、-JsonAnyGetter" class="headerlink" title="1.3.1、@JsonAnyGetter"></a>1.3.1、@JsonAnyGetter</h4><p>{@JsonAnyGetter } 注解允许灵活地使用Map字段作为标准属性。<br>这是一个简单的示例– ExtendableBean实体具有name属性和一组以键/值对形式的可扩展属性,我们还可以使用启用为false的可选参数来禁用@JsonAnyGetter()。 在这种情况下，Map将转换为JSON，并在序列化后显示在properties变量下。  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAnyGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 9:44 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties1;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnyGetter(enabled = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnyGetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">getProperties1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        ExtendableBean extendableBean = <span class="keyword">new</span> ExtendableBean();</span><br><span class="line">        extendableBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line">        map.put(<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;male&quot;</span>);</span><br><span class="line">        extendableBean.setProperties(map);</span><br><span class="line">        Map&lt;String, Object&gt; map1 = Maps.newHashMap();</span><br><span class="line">        map1.put(<span class="string">&quot;work&quot;</span>,<span class="string">&quot;java pg&quot;</span>);</span><br><span class="line">        map1.put(<span class="string">&quot;no&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        extendableBean.setProperties1(map1);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(extendableBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// result:  &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;properties&quot;:&#123;&quot;sex&quot;:&quot;male&quot;,&quot;age&quot;:11&#125;,&quot;no&quot;:1,&quot;work&quot;:&quot;java pg&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-1、-JsonGetter"><a href="#1-3-1、-JsonGetter" class="headerlink" title="1.3.1、@JsonGetter"></a>1.3.1、@JsonGetter</h4><p>@JsonGetter注解是@JsonProperty注解的替代方法将方法标记为getter方法。<br>在以下示例中，我们将方法getTheName() 指定为MyBeanentity的name属性的getter方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:06 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonGetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-3、-JsonPropertyOrder"><a href="#1-3-3、-JsonPropertyOrder" class="headerlink" title="1.3.3、@JsonPropertyOrder"></a>1.3.3、@JsonPropertyOrder</h4><p>我们可以使用@JsonPropertyOrder批注指定序列化属性的顺序。让我们为MyBean实体的属性设置自定义顺序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:06 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonGetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还可以使用@JsonPropertyOrder（alphabetic = true）按字母顺序对属性进行排序。 在这种情况下，序列化的输出将是：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-4、-JsonRawValue"><a href="#1-3-4、-JsonRawValue" class="headerlink" title="1.3.4、@JsonRawValue"></a>1.3.4、@JsonRawValue</h4><p>@JsonRawValue批注可以指示Jackson完全按原样序列化属性。在以下示例中，我们使用@JsonRawValue嵌入一些自定义JSON作为实体的值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRawValue;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:15 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RawBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonRawValue(false)</span></span><br><span class="line">    <span class="keyword">public</span> String json;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RawBean rawBean = <span class="keyword">new</span> RawBean();</span><br><span class="line">        rawBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        rawBean.setJson(<span class="string">&quot;&#123;\&quot;raw\&quot;:false&#125;&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(rawBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//@JsonRawValue result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&#123;&quot;raw&quot;:false&#125;&#125;</span></span><br><span class="line">        <span class="comment">//@JsonRawValue(false) result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&quot;&#123;\&quot;raw\&quot;:false&#125;&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还可以使用可选的布尔参数值来定义此注解是否处于活动状态。</p><h4 id="1-3-5、-JsonValue"><a href="#1-3-5、-JsonValue" class="headerlink" title="1.3.5、@JsonValue"></a>1.3.5、@JsonValue</h4><p>@JsonValue表示库将用于序列化整个实例的单个方法。例如，在一个枚举中，我们用@JsonValue注解getName，以便任何这样的实体都通过其名称序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonValue;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:23 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">TypeEnumWithValue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试枚举序列化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    TYPE1(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>),</span><br><span class="line">    TYPE2(<span class="number">2</span>, <span class="string">&quot;yiyi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(TYPE1);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &quot;wuxuan&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-6、-JsonRootName"><a href="#1-3-6、-JsonRootName" class="headerlink" title="1.3.6、@JsonRootName"></a>1.3.6、@JsonRootName</h4><p>如果启用了包装，则使用@JsonRootName批注指定要使用的根包装的名称。包装意味着不要将用户序列化为以下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而是序列化为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">     <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此，让我们看一个示例–我们将使用@JsonRootName批注指示此潜在包装实体的名称：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRootName;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:30 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonRootName(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRoot userWithRoot = <span class="keyword">new</span> UserWithRoot();</span><br><span class="line">        userWithRoot.setId(<span class="number">1</span>);</span><br><span class="line">        userWithRoot.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);</span><br><span class="line">        String json = objectMapper.writeValueAsString(userWithRoot);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:  &#123;&quot;user&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>默认情况下，包装器的名称将为类– UserWithRoot。 通过使用注解，我们得到了看上去更干净的用户：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">     <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从Jackson 2.4开始，新的可选参数名称空间可用于XML之类的数据格式。 如果添加它，它将成为标准名称的一部分：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRootName;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.xml.XmlMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:30 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonRootName(value = &quot;user&quot;,namespace = &quot;users&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRoot userWithRoot = <span class="keyword">new</span> UserWithRoot();</span><br><span class="line">        userWithRoot.setId(<span class="number">1</span>);</span><br><span class="line">        userWithRoot.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        XmlMapper xmlMapper = <span class="keyword">new</span> XmlMapper();</span><br><span class="line">        xmlMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);</span><br><span class="line">        String xml = xmlMapper.writeValueAsString(userWithRoot);</span><br><span class="line">        System.out.println(xml);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        result:</span></span><br><span class="line"><span class="comment">//        &lt;user xmlns=&quot;users&quot;&gt;</span></span><br><span class="line"><span class="comment">//            &lt;id xmlns=&quot;&quot;&gt;1&lt;/id&gt;</span></span><br><span class="line"><span class="comment">//            &lt;name xmlns=&quot;&quot;&gt;wuxuan&lt;/name&gt;</span></span><br><span class="line"><span class="comment">//        &lt;/user&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>序列化的xmlMapper结果为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">xmlns</span>=<span class="string">&quot;users&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">xmlns</span>=<span class="string">&quot;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span> <span class="attr">xmlns</span>=<span class="string">&quot;&quot;</span>&gt;</span>wuxuan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-3-6、-JsonSerialize"><a href="#1-3-6、-JsonSerialize" class="headerlink" title="1.3.6、@JsonSerialize"></a>1.3.6、@JsonSerialize</h4><p>@JsonSerialize表示在编组实体时要使用的自定义序列化程序。让我们看一个简单的例子。 我们将使用@JsonSerialize通过CustomDateSerializer序列化eventDate属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonSerialize;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.annotation.support.CustomDateSerializer;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:45 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonSerialize(using = CustomDateSerializer.class)</span></span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyy hh:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Event event = <span class="keyword">new</span> Event();</span><br><span class="line">        event.setName(<span class="string">&quot;wuxuan coming&quot;</span>);</span><br><span class="line">        Date eventDate = <span class="keyword">new</span> Date();</span><br><span class="line">        event.setEventDate(eventDate);</span><br><span class="line">        System.out.println(simpleDateFormat.format(eventDate));</span><br><span class="line"></span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(event);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: 08-06-2020 10:54:12</span></span><br><span class="line">        <span class="comment">//result:  &#123;&quot;name&quot;:&quot;wuxuan coming&quot;,&quot;eventDate&quot;:&quot;08-06-2020 10:52:37&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4、Jackson-反序列化的注解"><a href="#1-4、Jackson-反序列化的注解" class="headerlink" title="1.4、Jackson 反序列化的注解"></a>1.4、Jackson 反序列化的注解</h3><p>接下来，开始探索Jackson的反序列化的注解</p><h4 id="1-4-1、-JsonCreator"><a href="#1-4-1、-JsonCreator" class="headerlink" title="1.4.1、@JsonCreator"></a>1.4.1、@JsonCreator</h4><p>我们可以使用@JsonCreator批注来调整反序列化中使用的构造函数/工厂。 当我们需要反序列化某些与我们需要获取的目标实体不完全匹配的JSON时，这非常有用。<br>看下面的例子，我们需要反序列化这个json：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;the name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是，我们的目标实体中没有TheName字段-只有一个name字段。 现在，我们不想更改实体本身-我们只需要对解组过程进行更多控制-通过使用@JsonCreator注解构造函数并同时使用@JsonProperty注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:04 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCreator</span><span class="params">(<span class="meta">@JsonProperty(&quot;id&quot;)</span> <span class="keyword">int</span> id,<span class="meta">@JsonProperty(&quot;the name&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;id\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;the name\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        BeanWithCreator value = <span class="keyword">new</span> ObjectMapper().readerFor(BeanWithCreator.class).readValue(json);</span><br><span class="line">        System.out.println(value.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: BeanWithCreator(id=1, name=wuxuan)</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-2-JacksonInject"><a href="#1-4-2-JacksonInject" class="headerlink" title="1.4.2. @JacksonInject"></a>1.4.2. @JacksonInject</h4><p>@JacksonInject指示属性将从注入而不是从JSON数据获取其值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JacksonInject;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.InjectableValues;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:15 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithInject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JacksonInject</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;name\&quot;: \&quot;wuxuan\&quot;&#125;&quot;</span>;</span><br><span class="line">        InjectableValues.Std std = <span class="keyword">new</span> InjectableValues.Std().addValue(<span class="keyword">int</span>.class, <span class="number">1</span>);</span><br><span class="line">        BeanWithInject beanWithInject  = <span class="keyword">new</span> ObjectMapper().reader(std).forType(BeanWithInject.class).readValue(json);</span><br><span class="line">        System.out.println(beanWithInject.id == <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-3-JsonAnySetter"><a href="#1-4-3-JsonAnySetter" class="headerlink" title="1.4.3. @JsonAnySetter"></a>1.4.3. @JsonAnySetter</h4><p>@JsonAnySetter使我们可以灵活地使用Map作为标准属性。 反序列化时，JSON的属性将被简单地添加到Map中。让我们看看它是如何工作的–我们将使用@JsonAnySetter反序列化实体ExtendableBean，将下列的json反序列化：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr2&quot;</span>:<span class="string">&quot;val2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr1&quot;</span>:<span class="string">&quot;val1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如何使用@JsonAnySetter注解：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAnySetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:21 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnySetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        properties.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;:\&quot;My bean\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;attr2\&quot;:\&quot;val2\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;attr1\&quot;:\&quot;val1\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ExtendableBean extendableBean = <span class="keyword">new</span> ObjectMapper().readerFor(ExtendableBean.class).readValue(json);</span><br><span class="line">        System.out.println(extendableBean.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: ExtendableBean(name=My bean, properties=&#123;attr2=val2, attr1=val1&#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-4-JsonSetter"><a href="#1-4-4-JsonSetter" class="headerlink" title="1.4.4. @JsonSetter"></a>1.4.4. @JsonSetter</h4><p>@JsonSetter是@JsonProperty的替代方法––将方法标记为设置方法。<br>当我们需要读取一些JSON数据但目标实体类与数据不完全匹配时，这非常有用，因此我们需要调整过程以使其适合。在以下示例中，我们将在MyBeanentity中将setTheName()方法指定为name属性的设置方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonSetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:36 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String theName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonSetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.theName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;id\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> ObjectMapper().readerFor(MyBean.class).readValue(json);</span><br><span class="line">        System.out.println(myBean.getTheName().equals(<span class="string">&quot;wuxuan&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-5-JsonDeserialize"><a href="#1-4-5-JsonDeserialize" class="headerlink" title="1.4.5. @JsonDeserialize"></a>1.4.5. @JsonDeserialize</h4><p>@JsonDeserialize指示使用自定义解串器。<br>让我们看一下效果如何–我们将使用@JsonDeserialize通过CustomDateDeserializer反序列化eventDate属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonDeserialize;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.annotation.support.CustomDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:41 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonDeserialize(using = CustomDateDeserializer.class)</span></span><br><span class="line">    <span class="keyword">private</span> Date eventDate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyy hh:mm:ss&quot;</span>);</span><br><span class="line">        Date parse = simpleDateFormat.parse(<span class="string">&quot;08-06-2020 10:52:37&quot;</span>);</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;wuxuan coming\&quot;,\&quot;eventDate\&quot;:\&quot;08-06-2020 10:52:37\&quot;&#125;&quot;</span>;</span><br><span class="line">        Event event = <span class="keyword">new</span> ObjectMapper().readerFor(Event.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line">        System.out.println(parse.equals(event.eventDate));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-6-JsonAlias"><a href="#1-4-6-JsonAlias" class="headerlink" title="1.4.6. @JsonAlias"></a>1.4.6. @JsonAlias</h4><p>@JsonAlias在反序列化期间为属性定义一个或多个备用名称。 让我们用一个简单的例子来看看这个注解是如何工作的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAlias;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:52 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliasBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonAlias(&#123;&quot;f_name&quot;,&quot;fName&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secondName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;f_name\&quot;: \&quot;chai\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;secondName\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        AliasBean aliasBean= <span class="keyword">new</span> ObjectMapper().readerFor(AliasBean.class).readValue(json);</span><br><span class="line">        System.out.println(aliasBean.getFirstName().equals(<span class="string">&quot;chai&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-5、Jackson多态类型处理注解"><a href="#1-5、Jackson多态类型处理注解" class="headerlink" title="1.5、Jackson多态类型处理注解"></a>1.5、Jackson多态类型处理注解</h3><p>接下来–让我们看一下Jackson的多态类型处理注解：</p><ul><li>@JsonTypeInfo - 指示要在序列化中包含哪些类型信息的详细信息</li><li>@JsonSubTypes - 指示带注解类型的子类型</li><li>@JsonTypeName - 定义用于注解类的逻辑类型名称<br>让我们看一个更复杂的示例，并使用全部三个@ JsonTypeInfo，@ JsonSubTypes和@JsonTypeName来序列化/反序列化实体Zoo：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line">        dog.setName(<span class="string">&quot;wangwang&quot;</span>);</span><br><span class="line">        dog.setBackVolume(<span class="number">2.0</span>);</span><br><span class="line">        Zoo zoo = <span class="keyword">new</span> Zoo();</span><br><span class="line">        zoo.setAnimal(dog);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(zoo);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;animal&quot;:&#123;&quot;type&quot;:&quot;dog&quot;,&quot;name&quot;:&quot;wangwang&quot;,&quot;backVolume&quot;:2.0&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonSubTypes;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = &quot;type&quot;)</span></span><br><span class="line"><span class="meta">@JsonSubTypes(&#123;@JsonSubTypes.Type(value = Dog.class, name = &quot;dog&quot;), @JsonSubTypes.Type(value = Cat.class, name = &quot;cat&quot;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeName;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeName(&quot;dog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> backVolume;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeName;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:56 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeName(&quot;cat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> likesCream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> lives;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在测试反序列化：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;animal&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;dog&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wangwang&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;backVolume&quot;</span>:<span class="number">2.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String dJson = <span class="string">&quot;&#123;\&quot;animal\&quot;:&#123;\&quot;type\&quot;:\&quot;dog\&quot;,\&quot;name\&quot;:\&quot;wangwang\&quot;,\&quot;backVolume\&quot;:2.0&#125;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Zoo zoo1  = <span class="keyword">new</span> ObjectMapper().readerFor(Zoo.class).readValue(dJson);</span><br><span class="line">        System.out.println(zoo1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: Zoo(animal=Dog(backVolume=2.0))</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-6、Jackson一般的注解"><a href="#1-6、Jackson一般的注解" class="headerlink" title="1.6、Jackson一般的注解"></a>1.6、Jackson一般的注解</h3><p>接下来，一起讨论一些jackson的一般注解</p><h4 id="1-6-1、-JsonProperty"><a href="#1-6-1、-JsonProperty" class="headerlink" title="1.6.1、@JsonProperty"></a>1.6.1、@JsonProperty</h4><p>我们可以添加@JsonProperty注解去表示在json中的属性名称，在处理非标准的getter和setter时，让我们使用@JsonProperty对属性名称进行序列化/反序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 1:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String theName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.theName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> theName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setTheName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        MyBean myBean1 = <span class="keyword">new</span> ObjectMapper().readerFor(MyBean.class).readValue(json);</span><br><span class="line">        System.out.println(myBean1.theName.equals(myBean.theName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//reasult:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">        <span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-2、-JsonFormat"><a href="#1-6-2、-JsonFormat" class="headerlink" title="1.6.2、@JsonFormat"></a>1.6.2、@JsonFormat</h4><p>@JsonFormat批注指定序列化日期/时间值时的格式。在下面的示例中，我们使用@JsonFormat来控制属性eventDate的格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 1:53 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING,pattern = &quot;dd-MM-yyyy hh:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date eventDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyyy hh:mm:ss&quot;</span>);</span><br><span class="line">        String format = simpleDateFormat.format(date);</span><br><span class="line">        Event event = <span class="keyword">new</span> Event(<span class="string">&quot;wuxuan comming&quot;</span>, date);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(event);</span><br><span class="line">        <span class="keyword">assert</span> json.contains(format);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-3、-JsonUnWrapped"><a href="#1-6-3、-JsonUnWrapped" class="headerlink" title="1.6.3、@JsonUnWrapped"></a>1.6.3、@JsonUnWrapped</h4><p>@JsonUnwrapped定义应展开/展平的值序列化/反序列化时。让我们看看它是如何工作的； 我们将使用注解解开属性名称：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonUnwrapped;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:01 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnwappedUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonUnwrapped(prefix = &quot;n_&quot;,suffix = &quot;_o&quot;,enabled = true)</span></span><br><span class="line">    <span class="keyword">private</span> Name name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String firstName;</span><br><span class="line">        <span class="keyword">private</span> String lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Name name = <span class="keyword">new</span> Name();</span><br><span class="line">        name.setFirstName(<span class="string">&quot;chai&quot;</span>);</span><br><span class="line">        name.setLastName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        UnwappedUser unwappedUser = <span class="keyword">new</span> UnwappedUser();</span><br><span class="line">        unwappedUser.setName(name);</span><br><span class="line"></span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(unwappedUser);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:0,&quot;n_firstName_o&quot;:&quot;chai&quot;,&quot;n_lastName_o&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-4、-JsonView"><a href="#1-6-4、-JsonView" class="headerlink" title="1.6.4、@JsonView"></a>1.6.4、@JsonView</h4><p>@JsonView指示将在其中包含属性以进行序列化/反序列化的View。一个示例将确切显示其工作原理-我们将使用@JsonView序列化Item实体的实例。 让我们从视图开始：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonView;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:08 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line">    <span class="meta">@JsonView(Views.internal.class)</span></span><br><span class="line">    <span class="keyword">private</span> String ownerName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>, <span class="string">&quot;wuxuan111&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writerWithView(Views.Public.class).writeValueAsString(item);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-5-JsonManagedReference-JsonBackReference"><a href="#1-6-5-JsonManagedReference-JsonBackReference" class="headerlink" title="1.6.5. @JsonManagedReference, @JsonBackReference"></a>1.6.5. @JsonManagedReference, @JsonBackReference</h4><p>@JsonManagedReference和@JsonBackReference注解可以处理父/子关系并解决循环。在以下示例中–我们使用@JsonManagedReference和@JsonBackReference序列化我们的ItemWithRefentity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonManagedReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:18 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonManagedReference</span></span><br><span class="line">    <span class="keyword">public</span> UserWithRef owner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRef userWithRef = <span class="keyword">new</span> UserWithRef(<span class="number">1</span>,<span class="string">&quot;wuxuan&quot;</span>,<span class="keyword">null</span>);</span><br><span class="line">        ItemWithRef itemWithRef = <span class="keyword">new</span> ItemWithRef(<span class="number">1</span>, <span class="string">&quot;wwww&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;ItemWithRef&gt; itemWithRefs = Lists.newArrayList();</span><br><span class="line">        itemWithRefs.add(itemWithRef);</span><br><span class="line">        userWithRef.setUserItems(itemWithRefs);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(userWithRef);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonBackReference;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:19 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonBackReference</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; userItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ItemWithRef&gt; <span class="title">addItem</span><span class="params">(ItemWithRef itemWithRef)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userItems == <span class="keyword">null</span>)&#123;</span><br><span class="line">            userItems = Lists.newArrayList();</span><br><span class="line">            userItems.add(itemWithRef);</span><br><span class="line">            <span class="keyword">return</span> userItems;</span><br><span class="line">        &#125;</span><br><span class="line">        userItems.add(itemWithRef);</span><br><span class="line">        <span class="keyword">return</span> userItems;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>处理循环调用的场景</p><h4 id="1-6-6-JsonIdentityInfo"><a href="#1-6-6-JsonIdentityInfo" class="headerlink" title="1.6.6. @JsonIdentityInfo"></a>1.6.6. @JsonIdentityInfo</h4><p>@JsonIdentityInfo指示在对值进行序列化/反序列化时应使用对象标识，例如，以处理无限递归类型的问题。在以下示例中–我们有一个ItemWithIdentity实体，它与UserWithIdentity实体具有双向关系：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIdentityInfo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.ObjectIdGenerators;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:30 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(</span></span><br><span class="line"><span class="meta">        generator= ObjectIdGenerators.PropertyGenerator.class,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ItemWithIdentity&gt; userItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserWithIdentity</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(ItemWithIdentity item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userItems == <span class="keyword">null</span>)&#123;</span><br><span class="line">            userItems = Lists.newArrayList();</span><br><span class="line">            userItems.add(item);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        userItems.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIdentityInfo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.ObjectIdGenerators;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:29 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(</span></span><br><span class="line"><span class="meta">        generator = ObjectIdGenerators.PropertyGenerator.class,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserWithIdentity owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemWithIdentity</span><span class="params">(Integer id, String itemName, UserWithIdentity owner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithIdentity user = <span class="keyword">new</span> UserWithIdentity(<span class="number">1</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        ItemWithIdentity item = <span class="keyword">new</span> ItemWithIdentity(<span class="number">2</span>, <span class="string">&quot;book&quot;</span>, user);</span><br><span class="line">        user.addItem(item);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:2,&quot;itemName&quot;:&quot;book&quot;,&quot;owner&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;John&quot;,&quot;userItems&quot;:[2]&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-6-7-JsonFilter"><a href="#1-6-7-JsonFilter" class="headerlink" title="1.6.7. @JsonFilter"></a>1.6.7. @JsonFilter</h4><p>@JsonFilter批注指定在序列化期间使用的过滤器。让我们看一个例子； 首先，我们定义实体，然后指向过滤器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonFilter(&quot;myFilter&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithFilter</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BeanWithFilter beanWithFilter = <span class="keyword">new</span> BeanWithFilter(<span class="number">1</span>, <span class="string">&quot;Wuxuuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writer(<span class="keyword">new</span> SimpleFilterProvider()</span><br><span class="line">                        .addFilter(<span class="string">&quot;myFilter&quot;</span>, SimpleBeanPropertyFilter.filterOutAllExcept(<span class="string">&quot;name&quot;</span>)))</span><br><span class="line">                .writeValueAsString(beanWithFilter);</span><br><span class="line"></span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;Wuxuuan&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-7、自定义Jackson注解"><a href="#1-7、自定义Jackson注解" class="headerlink" title="1.7、自定义Jackson注解"></a>1.7、自定义Jackson注解</h3><p>接下来，我们一起学习如何创建一个Jackson自定义注解，我们可以使用@JacksonAnnotationsInside注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.customAnnotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JacksonAnnotationsInside;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:54 下午</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 运行时注解</span></span><br><span class="line"><span class="comment"> * json包含非空</span></span><br><span class="line"><span class="comment"> * json排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;,&quot;datteCreated&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CustomAnnotation &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.customAnnotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:56 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CustomAnnotation</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCustomAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Date dateCreated;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCustomAnnotation</span><span class="params">(Integer id, String name, Date dateCreated)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.dateCreated = dateCreated;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BeanWithCustomAnnotation bean = <span class="keyword">new</span> BeanWithCustomAnnotation(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result：&#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1,&quot;dateCreated&quot;:1591599545147&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-8、Jackson-混入注解"><a href="#1-8、Jackson-混入注解" class="headerlink" title="1.8、Jackson 混入注解"></a>1.8、Jackson 混入注解</h3><p>接下来，让我们一起看看如何使用Jackson的混入注解，让我们用混入注解举个例子 - 忽略User类中的属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:05 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:06 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:04 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  Integer id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line">    <span class="keyword">private</span> User owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(Integer id, String itemName, User owner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">&quot;ccc&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line">        <span class="comment">//检查是否序列化了User类型</span></span><br><span class="line">        <span class="keyword">assert</span> json.contains(<span class="string">&quot;owner&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().addMixIn(User.class, MyMixinForIgnoreType.class);</span><br><span class="line">        String json1 = objectMapper.writeValueAsString(item);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//检查是否忽略了User类型</span></span><br><span class="line">        <span class="keyword">assert</span> !json1.contains(<span class="string">&quot;owner&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-9、禁用-Jackson-注解"><a href="#1-9、禁用-Jackson-注解" class="headerlink" title="1.9、禁用 Jackson 注解"></a>1.9、禁用 Jackson 注解</h3><p>最后，我们一起看看如何禁用所有的jackson注解，我们可以通过禁用MapperFeature.USE_ANNOTATIONS来实现此目的，如以下示例所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.disabledJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.MapperFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:13 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyBean wuxuan = <span class="keyword">new</span> MyBean(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().disable(MapperFeature.USE_ANNOTATIONS).writeValueAsString(wuxuan);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//期望，非空校验和排序注解都失效</span></span><br><span class="line">        <span class="comment">//result：&#123;&quot;id&quot;:&quot;1&quot;,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、Jackson-ObjectMapper-的简介"><a href="#二、Jackson-ObjectMapper-的简介" class="headerlink" title="二、Jackson ObjectMapper 的简介"></a>二、Jackson ObjectMapper 的简介</h2><h3 id="2-1、简介"><a href="#2-1、简介" class="headerlink" title="2.1、简介"></a>2.1、简介</h3><p>本章着重于理解Jackson ObjectMapper类，以及如何将Java对象序列化为JSON以及如何将JSON字符串反序列化为Java对象。</p><h3 id="2-2、使用ObjectMapper读和写"><a href="#2-2、使用ObjectMapper读和写" class="headerlink" title="2.2、使用ObjectMapper读和写"></a>2.2、使用ObjectMapper读和写</h3><p>让我们从基本的读写操作开始。ObjectMapper的简单readValue API是一个很好的入口点。 我们可以使用它来将JSON内容解析或反序列化为Java对象。同样，在编写方面，我们可以使用writeValue API将任何Java对象序列化为JSON输出。在本章中，我们将使用以下带有两个字段的Car类作为对象进行序列化或反序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-1、Java对象序列化成json"><a href="#2-2-1、Java对象序列化成json" class="headerlink" title="2.2.1、Java对象序列化成json"></a>2.2.1、Java对象序列化成json</h4><p>让我们一起学习第一个序列化例子，用ObjectMapper类的writeValue将java转换成json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> ObjectMapper().writeValue(<span class="keyword">new</span> File(<span class="string">&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;</span>),car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">生成一个Car.json文件</span><br><span class="line">内容：</span><br><span class="line">&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ObjectMapper类的writeValueAsString和writeValueAsBytes方法从Java对象生成JSON，并以字符串或字节数组形式返回生成的JSON：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(car);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> ObjectMapper().writeValueAsBytes(car);</span><br><span class="line">        String bytesStr = <span class="keyword">new</span> String(bytes);</span><br><span class="line">        System.out.println(json.equals(bytesStr));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125;</span><br><span class="line">true</span><br></pre></td></tr></table></figure><h4 id="2-2-2、Json转换成Java对象"><a href="#2-2-2、Json转换成Java对象" class="headerlink" title="2.2.2、Json转换成Java对象"></a>2.2.2、Json转换成Java对象</h4><p>以下是使用ObjectMapper类将JSON字符串转换为Java对象的简单示例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;red&quot;</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;BMW&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>readValue（）函数还接受其他形式的输入，例如包含JSON字符串的文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;color\&quot;:\&quot;red\&quot;,\&quot;type\&quot;:\&quot;BMW\&quot;&#125;&quot;</span>;</span><br><span class="line">        Car car1 = <span class="keyword">new</span> ObjectMapper().readValue(json, Car.class);</span><br><span class="line">        System.out.println(car1.equals(car));</span><br><span class="line"></span><br><span class="line">        Car car2 = <span class="keyword">new</span> ObjectMapper().readValue(<span class="keyword">new</span> File(<span class="string">&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;</span>), Car.class);</span><br><span class="line">        System.out.println(car2.equals(car));</span><br><span class="line">        <span class="comment">//result：</span></span><br><span class="line">        <span class="comment">// true</span></span><br><span class="line">        <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-3、Json转换成Jackson的Json节点"><a href="#2-2-3、Json转换成Jackson的Json节点" class="headerlink" title="2.2.3、Json转换成Jackson的Json节点"></a>2.2.3、Json转换成Jackson的Json节点</h4><p>另外，可以将JSON解析为JsonNode对象，并用于从特定节点检索数据：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;color\&quot;:\&quot;red\&quot;,\&quot;type\&quot;:\&quot;BMW\&quot;&#125;&quot;</span>;</span><br><span class="line">        JsonNode jsonNode = <span class="keyword">new</span> ObjectMapper().readTree(json);</span><br><span class="line">        String type = jsonNode.get(<span class="string">&quot;type&quot;</span>).asText();</span><br><span class="line">        System.out.println(type.equals(<span class="string">&quot;BMW&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-4、从Json数组字符串中创建Java集合"><a href="#2-2-4、从Json数组字符串中创建Java集合" class="headerlink" title="2.2.4、从Json数组字符串中创建Java集合"></a>2.2.4、从Json数组字符串中创建Java集合</h4><p>我们可以使用TypeReference将数组形式的JSON解析为Java对象列表：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String jsonArray = <span class="string">&quot;[\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Black\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;audi\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        List&lt;Car&gt; cars  = <span class="keyword">new</span> ObjectMapper().readValue(jsonArray,</span><br><span class="line">                <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br><span class="line">        System.out.println(cars);</span><br><span class="line">        <span class="comment">//result: [Car(color=Red, type=BMW), Car(color=Black, type=audi)]</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-5、从json中创建Java-Map"><a href="#2-2-5、从json中创建Java-Map" class="headerlink" title="2.2.5、从json中创建Java Map"></a>2.2.5、从json中创建Java Map</h4><p>同样，我们可以将JSON解析为Java Map：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;: \&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; javaMap = <span class="keyword">new</span> ObjectMapper().readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(javaMap);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;color=Red, type=BMW&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="三、高级功能"><a href="#三、高级功能" class="headerlink" title="三、高级功能"></a>三、高级功能</h2><p>Jackson库的最大优势之一是高度可定制的序列化和反序列化过程。在本部分中，我们将介绍一些高级功能，其中输入或输出JSON响应可能不同于生成或使用响应的对象。</p><h3 id="3-1、-配置-Serialization-Deserialization-功能"><a href="#3-1、-配置-Serialization-Deserialization-功能" class="headerlink" title="3.1、 配置 Serialization / Deserialization 功能"></a>3.1、 配置 Serialization / Deserialization 功能</h3><p>在将JSON对象转换为Java类时，如果JSON字符串具有一些新字段，则默认过程将导致异常：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;Red&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;BMW&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;year&quot;</span>: <span class="string">&quot;2020&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面示例中的默认解析过程中，针对Car类的Java对象的JSON字符串将导致UnrecognizedPropertyException异常。通过configure方法，我们可以扩展默认过程以忽略新字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;year\&quot;: \&quot;2020\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 也可以这么写：  new ObjectMapper().configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);</span></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        Car car = objectMapper.readValue(json, Car.class);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        JsonNode jsonNode = objectMapper.readTree(json);</span><br><span class="line">        String year = jsonNode.get(<span class="string">&quot;year&quot;</span>).asText();</span><br><span class="line">        System.out.println(year);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>对于DeserializationFeature枚举中中的设置的描述：</p><table><thead><tr><th>配置</th><th>默认值</th><th>作用描述</th></tr></thead><tbody><tr><td>USE_BIG_DECIMAL_FOR_FLOATS</td><td>false</td><td>如果只有通用类型描述（Object或Number或未类型化的java.util.Map或java.util.Collection上下文中）可用，此功能确定是否将JSON浮点数反序列化为java.math.BigDecimals。 如果启用，则将这些值反序列化为java.math.BigDecimals;。 如果禁用，将反序列化为Doubles。默认情况下，此功能为禁用状态，这意味着默认情况下，“未类型化”的浮点数将反序列化为Doubles（出于性能考虑，选择-BigDecimals慢于Doubles）。</td></tr><tr><td>USE_BIG_INTEGER_FOR_INTS</td><td>false</td><td>确定是否将JSON整数（非浮点数）数字反序列化为java.math.BigIntegers的功能（如果只有通用类型描述（Object或Number或在无类型的java.util.Map或java.util.Collection上下文中） ）可用。 如果启用，则将这些值反序列化为java.math.BigIntegers;。 如果禁用，则将反序列化为“最小”可用类型，根据类型的数目，可以是Integer，Long或java.math.BigInteger。默认情况下，此功能是禁用的，这意味着默认情况下，将使用最紧凑的整数类型对“未类型化”的整数进行反序列化，以优化效率。</td></tr><tr><td>USE_LONG_FOR_INTS</td><td>false</td><td>当目标类型被松散地键入为Object或Number（或在其中）时，用于确定如何绑定“小” JSON整数（非浮点数）（适合32位有符号整数（int））的功能 未类型化的java.util.Map或java.util.Collection上下文）。 如果启用，则这些值将反序列化为Long； 如果禁用，它们将反序列化为“最小”可用类型，整数。 此外，如果启用了该选项，则尝试绑定不适合Long的值将引发com.fasterxml.jackson.core.JsonProcessingException。注意：如果启用USE_BIG_INTEGER_FOR_INTS，它将优先于此设置，并强制对所有整数值使用java.math.BigInteger。该功能默认情况下处于禁用状态，这意味着如果值合适，默认情况下将使用Integer反序列化“无类型”整数。</td></tr><tr><td>USE_JAVA_ARRAY_FOR_JSON_ARRAY</td><td>false</td><td>绑定“无类型”对象（标称类型为java.lang.Object的对象）时确定JSON数组是映射到Object[]还是List<?>的功能。 如果为true，则绑定为Object[]; 如果为false，则为List<?>。默认情况下，功能是禁用的，这意味着JSON数组绑定为java.util.Lists。</td></tr><tr><td>FAIL_ON_UNKNOWN_PROPERTIES</td><td>true</td><td>确定遇到未知属性（不映射到属性，并且没有“任何setter”或处理程序的处理程序）的功能是否会导致失败（通过抛出JsonMappingException）。 仅在尝试了其他所有用于未知属性的处理方法并且该属性保持未处理状态后，此设置才生效。 默认情况下启用此功能（这意味着如果遇到未知属性，将抛出JsonMappingException）。</td></tr><tr><td>FAIL_ON_NULL_FOR_PRIMITIVES</td><td>false</td><td>反序列化为Java基本类型（如“ int”或“ double”）时，确定是否遇到JSON null的错误的功能。 如果是，则抛出JsonProcessingException来表明这一点。 如果不是，则使用默认值（0表示“ int”，0.0表示double，与JVM使用的默认值相同）。默认情况下禁用此功能。</td></tr><tr><td>FAIL_ON_NUMBERS_FOR_ENUMS</td><td>false</td><td>确定JSON整数是否是用于反序列化Java枚举值的有效值的功能。 如果设置为“ false”，则数字是可接受的，并用于映射到匹配枚举值的ordinal（）； 如果为“ true”，则不允许数字，并且将引发JsonMappingException。 如果担心可能会发生从整数值到枚举的意外映射（并且枚举始终序列化为JSON字符串的情况），那么后者的行为就很有意义。默认情况下禁用此功能。</td></tr><tr><td>FAIL_ON_INVALID_SUBTYPE</td><td>true</td><td>确定无法找到（丢失）或解决（丢失）类名称（例如，无效的类名，不可映射的id）的多态值的类型（例如，由com.fasterxml.jackson.annotation.JsonTypeInfo指示）时发生的情况的功能； 如果启用，则引发异常； 如果为false，则使用null值。默认情况下启用功能，以便因缺少类型信息或无效类型信息而引发异常。</td></tr><tr><td>FAIL_ON_READING_DUP_TREE_KEY</td><td>false</td><td>该功能确定在将JSON内容读入树（com.fasterxml.jackson.core.TreeNode）并遇到重复键（已为JSON对象看到的属性名称）时发生什么情况。 如果启用，将抛出JsonMappingException； 如果禁用，则不会引发异常，并且新的（较新的）值将覆盖较早的值。请注意，此属性不会影响数据绑定的其他方面。 也就是说，不对POJO属性或java.util.Map键进行检测。 可以添加新功能来控制其他情况。默认情况下，功能是禁用的，因此不会引发异常。</td></tr><tr><td>FAIL_ON_IGNORED_PROPERTIES</td><td>false</td><td>确定在输入中遇到显式标记为可忽略的属性时将发生什么的功能：如果启用了功能，则抛出JsonMappingException； 如果为false，则默默地跳过属性。 默认情况下，功能是禁用的，因此不会引发异常。</td></tr><tr><td>FAIL_ON_UNRESOLVED_OBJECT_IDS</td><td>true</td><td>确定遇到的对象ID引用不引用具有该ID的实际对象（“未解决的对象ID”）的情况时发生的功能：抛出异常（true），或者使用空对象代替（false） 。 请注意，如果将其设置为false，则不会进行进一步处理； 具体来说，如果引用是通过setter方法定义的，则不会调用该方法。默认情况下启用此功能，以便在反序列化结束时，未知的对象ID将导致引发异常。</td></tr><tr><td>FAIL_ON_MISSING_CREATOR_PROPERTIES</td><td>false</td><td>该功能确定一个或多个创建者属性（绑定到创建者方法（构造函数或静态工厂方法）的参数的属性）缺少要从内容绑定到的值时发生的情况。 如果启用，则此类缺少的值会导致抛出JsonMappingException并附带第一个（按索引）缺少的属性的信息。 如果禁用，并且未将属性标记为必需，则缺少的Creator属性将由反序列化器为参数类型提供的空值填充（通常对于Object类型为null，对于基元为默认值；但可通过自定义反序列化器重新定义）。注意，具有可注射的值算作“不丢失”。默认情况下，该功能为禁用状态，因此除非缺少将创建者属性值明确标记为“必需”的属性，否则不会引发任何异常。</td></tr><tr><td>FAIL_ON_NULL_CREATOR_PROPERTIES</td><td>false</td><td>该功能可确定如果将一个或多个Creator属性（绑定到Creator方法（构造方法或静态工厂方法）的参数的属性）绑定到null值（来自JSON或作为默认值）时会发生什么。 如果要避免代码库中为null，则这很有用，如果对非强制性字段使用Java或Scala可选参数，则这特别有用。 默认情况下，该功能为禁用状态，因此除非缺少将创建者属性值明确标记为“必需”的属性，否则不会引发任何异常。</td></tr><tr><td>FAIL_ON_MISSING_EXTERNAL_TYPE_ID_PROPERTY</td><td>true</td><td>该功能确定缺少使用com.fasterxml.jackson.annotation.JsonTypeInfo.As.EXTERNAL_PROPERTY注解的属性但用的关联类型ID时发生的情况。 如果启用，则总是在缺少属性值时（如果类型ID确实存在）抛出JsonMappingException； 如果禁用，则仅在将属性标记为“必需”时抛出异常。默认情况下启用功能，以便在缺少子类型属性时引发异常。</td></tr><tr><td>FAIL_ON_TRAILING_TOKENS</td><td>false</td><td>绑定根值后确定数据绑定行为的功能。 如果启用了功能，则再次调用com.fasterxml.jackson.core.JsonParser.nextToken以确保找不到更多令牌（如果找到了更多令牌，则抛出com.fasterxml.jackson.databind.exc.MismatchedInputException ）; 如果禁用，则不进行进一步检查。该功能也可以称为READ_FULL_STREAM，因为它可以有效地验证输入流仅包含绑定完整值所需的数据，而仅包含其他内容（可能的可忽略空格或注解，如果数据格式支持，则除外）。由于向后兼容的原因，默认情况下功能是禁用的（因此不检查可能的尾随令牌）。</td></tr><tr><td>WRAP_EXCEPTIONS</td><td>true</td><td>确定杰克逊代码是否应捕获并包装异常（但绝不要出错！）以添加有关问题位置（在输入范围内）的附加信息的功能。 如果启用，大多数异常将被捕获并重新抛出（特别是java.io.IOExceptions可以按原样传递，因为它们被声明为可抛出）。 这很方便，因为将检查并声明所有异常，因此有更多上下文信息。 但是，有时调用应用程序可能只希望按原样传递“原始”未经检查的异常。默认情况下启用此功能。</td></tr><tr><td>ACCEPT_SINGLE_VALUE_AS_ARRAY</td><td>false</td><td>确定强制将非数组（JSON）值强制用于Java集合（数组，java.util.Collection）类型的功能。 如果启用，集合反序列化器将尝试处理非数组值，就像它们对JSON数组具有“隐式”一样。 此功能旨在出于兼容性/互操作性原因而使用，以与在数组中只有单个元素的情况下忽略JSON数组的程序包（例如XML到JSON转换器）一起使用。默认情况下禁用此功能。</td></tr><tr><td>UNWRAP_SINGLE_VALUE_ARRAYS</td><td>false</td><td>确定将单个值数组（在JSON中）的值强制转换为相应值类型是否可接受的功能。 这基本上与ACCEPT_SINGLE_VALUE_AS_ARRAY功能相反。 如果在数组中找到多个值，则抛出JsonMappingException。默认情况下禁用功能</td></tr><tr><td>UNWRAP_ROOT_VALUE</td><td>false</td><td>允许“解包”根级JSON值以匹配用于序列化的SerializationFeature.WRAP_ROOT_VALUE的设置。 将验证根JSON值是一个JSON对象，并且它具有具有预期根名的单个属性。 如果不是，则抛出JsonMappingException。 否则，包装属性的值将被反序列化，就好像它是根值一样。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_EMPTY_STRING_AS_NULL_OBJECT</td><td>false</td><td>可以启用此功能以允许将POJO和其他结构化值（java.util.Maps，java.util.Collections）的JSON空字符串值（“”）绑定为“ null”。 如果禁用，则只能从JSON<code>null</code>或JSON对象绑定标准POJO（标准含义是未定义任何自定义反序列化器或构造函数；这两种都可以添加对其他种类JSON值的支持）； 如果启用，则可以将空JSON字符串等效为JSON null。注意：这不适用于标量值，例如布尔值和数字； 是否可以强制使用它们取决于MapperFeature.ALLOW_COERCION_OF_SCALARS。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_EMPTY_ARRAY_AS_NULL_OBJECT</td><td>false</td><td>可以启用此功能，以允许将空JSON数组值（即[]）绑定为POOL（以及2.9，还包含其他值）为“ null”。 如果禁用，则只能从JSON<code>null</code>或JSON对象绑定标准POJO（标准含义是未定义任何自定义反序列化器或构造函数；这两种都可以添加对其他种类JSON值的支持）； 如果启用，则将使用空JSON数组等效于JSON null。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_FLOAT_AS_INT</td><td>true</td><td>确定是否强制转换为从JSON浮点数（任何带命令（<code>.</code>）或指数部分（<code>e</code> /<code>E&#39;））到期望的整数（</code>int<code>，</code>long<code>，</code>java.lang .integer，java.lang.Long，java.math.BigDecimal是否允许。 如果启用，强制将截断值； 如果禁用，将抛出JsonMappingException。默认情况下启用此功能。</td></tr><tr><td>READ_ENUMS_USING_TO_STRING</td><td>false</td><td>确定用于Enum值的标准反序列化机制的功能：如果启用，则假定Enums已使用Enum.toString（）的返回值进行了序列化； 如果禁用，则假定已使用Enum.name（）的返回值。注意：此功能通常应与SerializationFeature.WRITE_ENUMS_USING_TO_STRING具有相同的值。默认情况下禁用此功能。</td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_AS_NULL</td><td>false</td><td>允许将未知的Enum值解析为空值的功能。 如果禁用，未知的Enum值将引发异常。请注意，在某些情况下，这基本上会忽略未知的Enum值； 这是java.util.EnumMap的键的键和java.util.EnumSet的值的（因为在这些情况下不接受null）。默认情况下禁用此功能。</td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE</td><td>false</td><td>该功能允许忽略未知的Enum值，并通过@JsonEnumDefaultValue批注指定预定义值。 如果禁用，未知的Enum值将引发异常。 如果启用，但未指定预定义的默认Enum值，则也会引发异常。 默认情况下禁用此功能。</td></tr><tr><td>READ_DATE_TIMESTAMPS_AS_NANOSECONDS</td><td>true</td><td>当且仅当数据类型支持这种分辨率时，此功能可控制是否应使用（启用）或不使用（禁用）纳秒级时间戳写入数字时间戳值。 只有较新的数据类型（例如Java8日期/时间）才支持这种分辨率-较旧的类型（Java8之前的java.util.Date等）和Joda则不支持-并且此设置对此类类型无效。如果禁用，则假定为标准毫秒时间戳。 这与SerializationFeature.WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS相对应。默认情况下启用此功能，以支持最准确的时间值。</td></tr><tr><td>ADJUST_DATES_TO_CONTEXT_TIME_ZONE</td><td>true</td><td>该功能指定上下文提供的java.util.TimeZone（DeserializationContext.getTimeZone（）是否应用于在反序列化时调整日期/时间值，即使值本身包含时区信息也是如此。 如果禁用，则仅当值本身不包含任何TimeZone信息时才使用它。请注意，确切的行为取决于所讨论的日期/时间类型。 特别是JDK类型的java.util.Date没有内置时区信息，因此此设置无效。 此外，尽管java.util.Calendar确实具有此信息，但是基本JDK java.text.SimpleDateFormat无法保留已解析的区域信息，因此，无论此设置如何，java.util.Calendar始终将获得上下文时区调整。考虑到上述因素，只有Joda和Java 8日期/文字数据类型的扩展模块才支持此功能。</td></tr><tr><td>EAGER_DESERIALIZER_FETCH</td><td>true</td><td>决定ObjectReader是否应在可能的情况下热切获取必要的JsonDeserializer的功能。 如果多次使用类似配置的ObjectReader实例，则可以提高性能。 并且不会对一次性使用案例产生重大影响。请注意，通常不需要禁用此功能：仅在存在实际可察觉问题的情况下考虑。 默认情况下启用此功能。</td></tr></tbody></table><p>对于SerializationFeature枚举中的设置进行描述： </p><p>|配置|默认值|作用描述|<br>|-|-|<br>|WRAP_ROOT_VALUE|false|可以启用以使根值（通常为JSON对象，但可以是任何类型）包装在单个属性JSON对象中的功能，其中键为“根名”，由注释内省者确定（对于使用@XmlRootElement的JAXB尤其如此） .name）或后备广告（非合格的类名）。 功能主要是为了与JAXB兼容。默认情况下禁用此功能。|<br>|INDENT_OUTPUT|false|该功能允许使用为ObjectMapper（以及从mapper创建的ObjectWriters）配置的默认漂亮打印机为基础生成器启用（或禁用）缩进。请注意，仅当未为生成器或ObjectWriter配置显式com.fasterxml.jackson.core.PrettyPrinter时，才使用默认的漂亮打印机。默认情况下禁用此功能。|<br>|FAIL_ON_EMPTY_BEANS|true|该功能用于确定在找不到类型的访问器时会发生什么情况（并且没有注释指示它打算被序列化）。 如果启用（默认），则将引发异常以指示这些类型为不可序列化的类型； 如果禁用，它们将被序列化为空对象，即没有任何属性。请注意，此功能仅对那些没有任何可识别注释的“空” bean（例如，@JsonSerialize）起作用的空类型：具有注释的那些不会导致抛出异常。默认情况下启用此功能。|<br>|FAIL_ON_SELF_REFERENCES|true|决定POJO检测到直接自我引用时会发生什么情况的功能（并且未启用对象ID处理）：抛出JsonMappingException（如果为true），或者通常对引用进行处理（false）。默认情况下启用功能|<br>|WRAP_EXCEPTIONS|true|确定Jackson代码是否应捕获并包装异常（但绝不要出错！）以添加有关问题位置（在输入范围内）的附加信息的功能。 如果启用，大多数异常将被捕获并重新抛出（特别是java.io.IOExceptions可以按原样传递，因为它们被声明为可抛出）。 这很方便，因为将检查并声明所有异常，因此有更多上下文信息。 但是，有时调用应用程序可能只希望按原样传递“原始”未经检查的异常。默认情况下启用此功能。|<br>|FAIL_ON_UNWRAPPED_TYPE_IDENTIFIERS|true|确定通常具有Jackson包含的类型信息的对象与com.fasterxml.jackson.annotation.JsonUnwrapped结合使用时发生的功能。 在默认（启用）状态下，当展开的对象具有类型信息时，将引发错误。 禁用时，将解包该对象，并丢弃类型信息。默认情况下启用此功能。|<br>|WRITE_SELF_REFERENCES_AS_NULL|false|决定POJO检测到直接自引用时会发生什么情况的功能（并且未启用对象ID处理）：如果启用，则将该引用写为null； 如果禁用，则使用默认行为（它将尝试序列化，通常会导致异常）。 但是，如果启用了FAIL_ON_SELF_REFERENCES。 此属性将被忽略。|<br>|CLOSE_CLOSEABLE|false|用于确定是否在序列化后调用实现java.io.Closeable的序列化根级对象的close方法（调用了ObjectMapper的writeValue（）（或等效方法）的对象）的功能。 如果启用，则在序列化完成后（无论成功还是由于抛出异常而显示的错误）将调用close（）。 您可以将其视为某种“最终”处理。注意：仅影响根对象的行为，而不影响从根对象可访问的其他对象。 换句话说，每个“ writeValue”调用将只进行一次调用。默认情况下禁用此功能。|<br>|FLUSH_AFTER_WRITE_VALUE|true|确定是否以JsonGenerator作为参数的writeValue（）方法完成后是否调用JsonGenerator.flush（）的功能（即不影响使用其他目标的方法）; ObjectWriter中的方法相同。 这通常是有道理的； 但是在某些情况下不应该强制执行刷新：例如，在底层流进行压缩时，并且flush（）导致刷新了压缩状态（某些压缩编解码器会发生这种情况）。默认情况下启用此功能。|<br>|WRITE_DATES_AS_TIMESTAMPS|true|确定是否将Date（和日期/时间）值（以及基于Date的东西，如java.util.Calendars）序列化为数字时间戳记（true；默认值）或其他值（通常是文本表示形式）的功能。如果使用文本表示，则实际格式取决于配置设置，包括@JsonFormat批注的按属性使用，全局配置的java.text.DateFormat。对于“经典” JDK日期类型（java.util.Date，java.util.Calendar），默认格式由com.fasterxml.jackson.databind.util.StdDateFormat提供，并且对应于格式字符串“ yyyy-MM-dd” ‘T’HH：mm：ss.SSSX”（有关字符串格式的详细信息，请参见java.text.DateFormat）。此功能是否影响其他与日期相关的类型的处理取决于这些类型的处理程序，尽管理想情况下，他们应该使用此功能注意：使用WRITE_DATE_KEYS_AS_TIMESTAMPS代替此功能来控制java.util.Map密钥是否序列化为字符串。默认情况下启用功能，因此默认情况下将日期/时间序列化为时间戳。|<br>|WRITE_DATE_KEYS_AS_TIMESTAMPS|false|确定是否将用作java.util.Map键的java.util.Dates（和子类型）序列化为时间戳的功能（如果没有，则序列化为文本值）。默认值为“ false”，表示将日期值映射键序列化为文本（ISO-8601）值。默认情况下禁用此功能。|<br>|WRITE_DATES_WITH_ZONE_ID|false|用于确定日期/日期时间值是否应该序列化的功能，以便在类型本身包含时区信息的情况下，它们包括时区id。 包含此信息可能会导致兼容性问题，因为ISO-8601规范未定义包含此类信息的格式。如果启用，则应使用Java 8 DateTimeFormatter＃ISO_ZONED_DATE_TIME定义所指定的格式来包含时区ID（例如，“ 2011-12-03T10：15：30 + 01：00 [欧洲/巴黎]”）。注意：如果日期/时间值被序列化为时间戳，则该设置不相关。默认情况下，该功能处于禁用状态，因此不包含区域ID。 相反，时区偏移量用于ISO-8601兼容性（如果值中包含任何时区信息）。|<br>|WRITE_DURATIONS_AS_TIMESTAMPS|true|默认情况下，用于确定表示时间段（持续时间，时间段，范围）的时间值是否要使用数字（true）或文本（false）表示序列化的功能。 请注意，根据类型的不同，数字表示可能表示简单数字或数字数组。注意：使用WRITE_DATE_KEYS_AS_TIMESTAMPS来控制java.util.Map密钥是否序列化为字符串。默认情况下启用此功能，因此默认情况下将周期/持续时间序列化为时间戳。|<br>|WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS|false|确定char []类型如何序列化的功能：启用后，将序列化为显式JSON数组（以单字符字符串作为值）； 禁用时，默认情况下将其序列化为字符串（更为紧凑）。默认情况下禁用此功能。|<br>|WRITE_ENUMS_USING_TO_STRING|false|确定用于Enum值的标准序列化机制的功能：如果启用，则使用Enum.toString（）的返回值； 如果禁用，则使用Enum.name（）的返回值。注意：此功能通常应与DeserializationFeature.READ_ENUMS_USING_TO_STRING具有相同的值。默认情况下禁用此功能。|<br>|WRITE_ENUMS_USING_INDEX|false|确定Java Enum值是序列化为数字（true）还是文本值（false）的功能。 如果使用文本值，则还将考虑其他设置。 如果启用此功能，则Enum.ordinal（）的返回值（整数）将用作序列化。请注意，此功能的优先级高于WRITE_ENUMS_USING_TO_STRING，只有将此功能设置为false时，才考虑此功能。请注意，从2.10开始，这不适用于作为java.util.Map值的键编写的枚举，该枚举具有单独的设置WRITE_ENUM_KEYS_USING_INDEX。默认情况下禁用此功能。|<br>|WRITE_ENUM_KEYS_USING_INDEX|false|确定是否将用作java.util.Map密钥的{link Enum}序列化为使用Enum.ordinal（）的功能。 与将枚举写入常规值时使用的WRITE_ENUMS_USING_INDEX相似。默认情况下禁用此功能。|<br>|WRITE_NULL_MAP_VALUES|true|确定是否要对具有空值的Map条目进行序列化（true）或不进行序列化（false）的功能。注意：与其他SerializationFeatures不同，此功能不能在每次调用的基础上动态更改，因为在构造序列化程序和属性处理程序时会考虑其作用。默认情况下启用此功能。|<br>|WRITE_EMPTY_JSON_ARRAYS|true|确定是否将容器属性（具有声明的Collection或数组值的POJO属性；即，产生JSON数组的事物）为空（没有元素）的属性，将被序列化为空JSON数组（true），还是从输出中取消显示（false） 。请注意，这不会更改java.util.Maps或“类似集合”类型的行为。注意：与其他SerializationFeatures不同，此功能不能在每次调用的基础上动态更改，因为在构造序列化程序和属性处理程序时会考虑其作用。默认情况下启用此功能。|<br>|WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED|false|为互操作性而添加的功能，以与所谓的“ BadgerFish”约定兼容。 功能确定对单个元素java.util.Collections和数组的处理：如果启用，则仅包含一个元素的java.util.Collections和数组将被序列化，就好像该元素本身已被序列化一样。启用后，带有数组的POJO通常如下所示：{“ arrayProperty”：[1]}而是序列化为{“ arrayProperty”：1}请注意，此功能与DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY相对（即，通常两者都启用，或两者都不启用）。|<br>|WRITE_BIGDECIMAL_AS_PLAIN|false|确定是否使用java.math.BigDecimal.toPlainString（）序列化java.math.BigDecimal条目的功能，以防止使用科学计数法写入值。注意：由于此功能通常需要使用com.fasterxml.jackson.core.JsonGenerator.writeNumber（String），因此可能会导致兼容性问题，因为并非所有com.fasterxml.jackson.core.JsonGenerator实现都支持这种输出模式：通常仅文本 基于格式的格式支持它。默认情况下禁用此功能。|<br>|WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS|true|控制是否使用纳秒级时间戳写入数字时间戳值（启用）（禁用）的功能； 当且仅当数据类型支持这种分辨率时。 只有较新的数据类型（例如Java8日期/时间）才支持这种分辨率-较旧的类型（Java8之前的java.util.Date等）和Joda则不支持-并且此设置对此类类型无效。如果禁用，则假定为标准毫秒时间戳。 这与DeserializationFeature.READ_DATE_TIMESTAMPS_AS_NANOSECONDS对应。默认情况下启用此功能，以支持最准确的时间值。|<br>|ORDER_MAP_ENTRIES_BY_KEYS|false|确定是否在序列化之前首先按键对java.util.Map条目进行排序的功能：如果启用，则在必要时执行附加的排序步骤（对于java.util.SortedMaps不必要），如果禁用，则无需进行其他排序。默认情况下禁用此功能。|<br>|EAGER_SERIALIZER_FETCH|true|决定ObjectWriter是否应在可能的情况下热切获取必要的JsonSerializer的功能。 如果多次使用类似配置的ObjectWriter实例，则可以提高性能。 并且不会对一次性使用案例产生重大影响。请注意，通常不需要禁用此功能：仅在存在实际可察觉问题的情况下考虑。默认情况下启用此功能。|<br>|USE_EQUALITY_FOR_OBJECT_ID|false|确定是否使用对象的真实JVM级别标识（false）比较对象标识的功能； 或equals（）方法。 当使用ORM库（例如Hibernate）处理数据库绑定的对象时，后期有时会很有用。 注意对象本身是实际比较的，不是对象ID。 此功能的命名有些令人困惑，因此重要的是，要为其保留身份的对象在id之上和之外都被认为是相等的（无论如何，它们总是使用相等性进行比较）。注意：由于实现功能的方式，非常重要的是，除了覆盖Object.equals以使对象匹配（被视为“相同”）之外，还必须确保Object.hashCode（）被覆盖以产生 相等实例的值完全相同。默认情况下禁用此功能； 表示使用严格的身份，而不是equals（）|</p><h3 id="3-2、创建自定义的序列化-反序列化器"><a href="#3-2、创建自定义的序列化-反序列化器" class="headerlink" title="3.2、创建自定义的序列化/反序列化器"></a>3.2、创建自定义的序列化/反序列化器</h3><p>ObjectMapper类的另一个基本功能是能够注册自定义序列化器和反序列化器。 在输入或输出JSON响应的结构不同且必须对其进行序列化或反序列化的Java类的结构时，自定义序列化器和反序列化器非常有用。<br>以下是自定义JSON序列化程序的示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.std.StdSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 4:49 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">CustomCarSerializer</span><span class="params">(Class&lt;Car&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Car car, JsonGenerator gen, SerializerProvider provider)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        gen.writeStartObject();</span><br><span class="line">        gen.writeStringField(<span class="string">&quot;car_brand&quot;</span>, car.getType());</span><br><span class="line">        gen.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此自定义序列化器可以这样调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .registerModule(</span><br><span class="line">                        <span class="keyword">new</span> SimpleModule(</span><br><span class="line">                                <span class="string">&quot;CustomCarSerializer&quot;</span>,</span><br><span class="line">                                <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>)</span><br><span class="line">                        ).addSerializer(Car.class, <span class="keyword">new</span> CustomCarSerializer()))</span><br><span class="line">                .writeValueAsString(car);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;car_brand&quot;:&quot;BMW&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是自定义JSON反序列化的示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonParser;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.ObjectCodec;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.TreeNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationContext;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.deser.std.StdDeserializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 4:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarDeserializer</span> <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">CustomCarDeserializer</span><span class="params">(Class&lt;?&gt; vc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(vc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        ObjectCodec codec = p.getCodec();</span><br><span class="line">        JsonNode treeNode = codec.readTree(p);</span><br><span class="line">        JsonNode colorNode = treeNode.get(<span class="string">&quot;color&quot;</span>);</span><br><span class="line">        String color = colorNode.asText();</span><br><span class="line">        car.setColor(color);</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此自定义反序列化器可以这样调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;&quot;</span>+</span><br><span class="line">                <span class="string">&quot;    &#125;&quot;</span>;</span><br><span class="line">        Car car = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .registerModule(</span><br><span class="line">                        <span class="keyword">new</span> SimpleModule(</span><br><span class="line">                                <span class="string">&quot;CustomCarDeserializer&quot;</span>,</span><br><span class="line">                                <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>)</span><br><span class="line">                        ).addDeserializer(Car.class, <span class="keyword">new</span> CustomCarDeserializer()))</span><br><span class="line">                .readValue(json, Car.class);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        <span class="comment">//result:  Car(type=null, color=Red)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3、Date-格式化的处理方式"><a href="#3-3、Date-格式化的处理方式" class="headerlink" title="3.3、Date 格式化的处理方式"></a>3.3、Date 格式化的处理方式</h3><p>java.util.Date的默认序列化产生一个数字，即纪元时间戳（自1970年1月1日起，以UTC为单位的毫秒数）。 但这不是人类可读的，并且需要进一步转换以人类可读的格式显示。 让我们使用datePurchased属性将到目前为止使用的Car实例包装在Request类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:12 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>控制日期的字符串格式，并将其设置为例如 yyyy-MM-dd HH:mm a z，请考虑以下代码段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:12 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(Car car, Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.car = car;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(StrinDeserializationFeatureg[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        Request request = <span class="keyword">new</span> Request(car,<span class="keyword">new</span> Date());</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm a z&quot;</span>);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().setDateFormat(simpleDateFormat);</span><br><span class="line"></span><br><span class="line">        String json = objectMapper.writeValueAsString(request);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;car&quot;:&#123;&quot;type&quot;:&quot;BMW&quot;,&quot;color&quot;:&quot;Red&quot;&#125;,&quot;createDate&quot;:&quot;2020-06-08 17:16 下午 CST&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>更多的时间格式化的方式参考：<a href="https://www.baeldung.com/jackson-serialize-dates">深入学习日期格式化</a></p><h3 id="3-4、集合的处理方式"><a href="#3-4、集合的处理方式" class="headerlink" title="3.4、集合的处理方式"></a>3.4、集合的处理方式</h3><p>DeserializationFeature类提供的另一个小而有用的功能是能够根据JSON数组响应生成所需类型的集合的功能。例如，我们可以将结果生成为数组：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;[\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;:\&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;:\&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;:\&quot;Black\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;:\&quot;audi\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        <span class="comment">//也可以写成： objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, true);</span></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().enable(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY);</span><br><span class="line">        Car[] cars = objectMapper.readValue(json, Car[].class);       </span><br><span class="line">        List&lt;Car&gt; carList = objectMapper.readValue(json,<span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="四、Jackson序列化是忽略属性"><a href="#四、Jackson序列化是忽略属性" class="headerlink" title="四、Jackson序列化是忽略属性"></a>四、Jackson序列化是忽略属性</h2><h3 id="4-1、简介"><a href="#4-1、简介" class="headerlink" title="4.1、简介"></a>4.1、简介</h3><p>本章将展示在使用Jackson 2.x将对象序列化为JSON时如何忽略某些字段。当Jackson默认值还不够，并且我们需要精确控制要序列化为JSON的内容时，这非常有用-并且有几种方法可以忽略属性。</p><h3 id="4-2、在类级别上忽略字段"><a href="#4-2、在类级别上忽略字段" class="headerlink" title="4.2、在类级别上忽略字段"></a>4.2、在类级别上忽略字段</h3><p>我们可以使用@JsonIgnoreProperties批注并按名称指定字段，从而在类级别忽略特定字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:32 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&#123;&quot;intValue&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> Boolean booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, Boolean booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">12</span>, <span class="keyword">false</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result: &#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;booleanValue&quot;:false&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>要毫无例外地忽略JSON输入中的任何未知属性，我们可以设置@JsonIgnoreProperties批注的ignoreUnknown = true。</p><h3 id="4-3、在字段级别上忽略字段"><a href="#4-3、在字段级别上忽略字段" class="headerlink" title="4.3、在字段级别上忽略字段"></a>4.3、在字段级别上忽略字段</h3><p>我们也可以直接通过@JsonIgnore批注直接忽略该字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:32 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Boolean booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, Boolean booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">12</span>, <span class="keyword">false</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result：&#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;intValue&quot;:12&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4、通过类型忽略所有字段"><a href="#4-4、通过类型忽略所有字段" class="headerlink" title="4.4、通过类型忽略所有字段"></a>4.4、通过类型忽略所有字段</h3><p>最后，我们可以使用@JsonIgnoreType批注忽略指定类型的所有字段。 如果我们控制类型，那么我们可以直接注解类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:42 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> MyDto myDto;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SomeType</span><span class="params">(String type, MyDto myDto)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.myDto = myDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto wuxuan = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">        SomeType type = <span class="keyword">new</span> SomeType(<span class="string">&quot;www&quot;</span>, wuxuan);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(type);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;type&quot;:&quot;www&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是，我们常常无法控制类本身； 在这种情况下，我们可以充分利用Jackson的混入注解。<br>首先，我们为要忽略的类型定义一个MixIn，然后使用@JsonIgnoreType对其进行注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后，我们在编组期间注册该mixin来替换（并忽略）所有String[]类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:57 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoWithSpecialField</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoWithSpecialField</span><span class="params">(String[] stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDtoWithSpecialField myDtoWithSpecialField = <span class="keyword">new</span> MyDtoWithSpecialField(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>&#125;, <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().addMixIn(String[].class, MyMixinForIgnoreType.class);</span><br><span class="line">        String json = objectMapper.writeValueAsString(myDtoWithSpecialField);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;intValue&quot;:1,&quot;booleanValue&quot;:false&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5、通过过滤器忽略字段"><a href="#4-5、通过过滤器忽略字段" class="headerlink" title="4.5、通过过滤器忽略字段"></a>4.5、通过过滤器忽略字段</h3><p>最后，我们还可以使用过滤器来忽略Jackson中的特定字段。 首先，我们需要在Java对象上定义过滤器,去除掉name属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:03 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonFilter(&quot;myFilter&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoFilter</span><span class="params">(String type, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDtoFilter myDtoFilter = <span class="keyword">new</span> MyDtoFilter(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;x5&quot;</span>);</span><br><span class="line">        SimpleBeanPropertyFilter filter = SimpleBeanPropertyFilter.serializeAllExcept(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        SimpleFilterProvider myFilter = <span class="keyword">new</span> SimpleFilterProvider().addFilter(<span class="string">&quot;myFilter&quot;</span>, filter);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writer(myFilter).writeValueAsString(myDtoFilter);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;type&quot;:&quot;BMW&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五、在Jackson中忽略值为NULL的字段"><a href="#五、在Jackson中忽略值为NULL的字段" class="headerlink" title="五、在Jackson中忽略值为NULL的字段"></a>五、在Jackson中忽略值为NULL的字段</h2><h3 id="5-1、简介"><a href="#5-1、简介" class="headerlink" title="5.1、简介"></a>5.1、简介</h3><p>本快速章节将介绍如何在序列化Java类时设置Jackson以忽略空字段。</p><h3 id="5-2、在类上忽略NULL字段"><a href="#5-2、在类上忽略NULL字段" class="headerlink" title="5.2、在类上忽略NULL字段"></a>5.2、在类上忽略NULL字段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>或者-更细粒度上讲-在字段级级：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span></span>&#123;</span><br><span class="line">    <span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-全局忽略NULL的字段"><a href="#4-3-全局忽略NULL的字段" class="headerlink" title="4.3. 全局忽略NULL的字段"></a>4.3. 全局忽略NULL的字段</h3><p>Jackson还允许在ObjectMapper上全局配置此行为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoTest</span></span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNullField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper().setSerializationInclusion(Include.NON_NULL);</span><br><span class="line">        ...</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>忽略空字段是一种常见的Jackson配置，因为通常情况下，我们需要更好地控制JSON输出。 本章说明如何对类进行此操作。 但是，还有更高级的用例，例如在序列化Map时忽略空值。</p><h2 id="六、Jackson更改字段的名称"><a href="#六、Jackson更改字段的名称" class="headerlink" title="六、Jackson更改字段的名称"></a>六、Jackson更改字段的名称</h2><h3 id="6-1、简介"><a href="#6-1、简介" class="headerlink" title="6.1、简介"></a>6.1、简介</h3><p>本快速章节说明了如何更改字段名称以在序列化时映射到另一个JSON属性。</p><h3 id="6-2、更改要序列化的字段名称"><a href="#6-2、更改要序列化的字段名称" class="headerlink" title="6.2、更改要序列化的字段名称"></a>6.2、更改要序列化的字段名称</h3><p>以MyDto类为例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.changeFieldName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:18 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String value, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;value_fact&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;sfsd&quot;</span>, <span class="string">&quot;www&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;www&quot;,&quot;value_fact&quot;:&quot;sfsd&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="七、Jackson用未知属性反序列化JSON"><a href="#七、Jackson用未知属性反序列化JSON" class="headerlink" title="七、Jackson用未知属性反序列化JSON"></a>七、Jackson用未知属性反序列化JSON</h2><h3 id="7-1、简介"><a href="#7-1、简介" class="headerlink" title="7.1、简介"></a>7.1、简介</h3><p>在本章中，我们将研究Jackson 2.x的解组过程，特别是如何处理具有未知属性的JSON内容。</p><h3 id="7-2、使用其他-未知字段反序列化JSON"><a href="#7-2、使用其他-未知字段反序列化JSON" class="headerlink" title="7.2、使用其他/未知字段反序列化JSON"></a>7.2、使用其他/未知字段反序列化JSON</h3><p>JSON输入有各种形态和大小-在大多数情况下，我们需要将其映射到具有一定数量字段的预定义Java对象。 目标是简单地忽略所有无法映射到现有Java字段的JSON属性。<br>例如，假设我们需要将JSON解组到以下Java实体：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-3、未知字段上的UnrecognizedPropertyException"><a href="#7-3、未知字段上的UnrecognizedPropertyException" class="headerlink" title="7.3、未知字段上的UnrecognizedPropertyException"></a>7.3、未知字段上的UnrecognizedPropertyException</h3><p>尝试将具有未知属性的JSON反序列化到此简单Java实体将导致com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: false\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        <span class="comment">//throw UnrecognizedPropertyException 异常</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Unrecognized field &quot;booleanValue111&quot; (class com.yiyi.unmarshall.MyDto), not marked as ignorable (3 known properties: &quot;stringValue&quot;, &quot;booleanValue&quot;, &quot;intValue&quot;])</span></span><br><span class="line"><span class="comment">         *  at [Source: (String)&quot;&#123;</span></span><br><span class="line"><span class="comment">         *     &quot;stringValue&quot;: &quot;wuxuan&quot;,</span></span><br><span class="line"><span class="comment">         *     &quot;intValue&quot;: 1,</span></span><br><span class="line"><span class="comment">         *     &quot;booleanValue111&quot;: false</span></span><br><span class="line"><span class="comment">         * &#125;&quot;; line: 4, column: 29] (through reference chain: com.yiyi.unmarshall.MyDto[&quot;booleanValue111&quot;])</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-4、通过设置ObjectMapper处理未知字段的异常"><a href="#7-4、通过设置ObjectMapper处理未知字段的异常" class="headerlink" title="7.4、通过设置ObjectMapper处理未知字段的异常"></a>7.4、通过设置ObjectMapper处理未知字段的异常</h3><p>现在，我们可以配置完整的ObjectMapper以忽略JSON中的未知属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: true\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//也可以写成：objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);</span></span><br><span class="line">        objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        System.out.println(myDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false)  </span></span><br><span class="line">        <span class="comment">// booleanValue=false 是对象的属性的默认值，因为booleanValue 是基本类型，不是包装类型，默认值为false</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-5、通过类上注解处理未知字段"><a href="#7-5、通过类上注解处理未知字段" class="headerlink" title="7.5、通过类上注解处理未知字段"></a>7.5、通过类上注解处理未知字段</h3><p>我们还可以将单个类标记为接受未知字段，而不是整个Jackson对象映射器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: true\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        System.out.println(myDto);</span><br><span class="line">        <span class="comment">//result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false)</span></span><br><span class="line">        <span class="comment">// booleanValue=false 是对象的属性的默认值，因为booleanValue 是基本类型，不是包装类型，默认值为false</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>初次系统的学习Jackson的使用方式，感受到了Jackson特别灵活，定制化强的特点，针对于日常的业务需求，已经足够了。更让人惊讶的是自定义的Jackson注解，更是让Jackson如虎添翼。</p>]]></content>
      
      
      <categories>
          
          <category> 详细教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL语句概念简单整理</title>
      <link href="/dist/2021/01/17/SQL%E8%AF%AD%E5%8F%A5%E6%A6%82%E5%BF%B5%E7%AE%80%E5%8D%95%E6%95%B4%E7%90%86/"/>
      <url>/dist/2021/01/17/SQL%E8%AF%AD%E5%8F%A5%E6%A6%82%E5%BF%B5%E7%AE%80%E5%8D%95%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="一、SQL语言共分为四大类"><a href="#一、SQL语言共分为四大类" class="headerlink" title="一、SQL语言共分为四大类"></a>一、SQL语言共分为四大类</h2><ul><li>数据查询语言DQL</li><li>数据操纵语言DML</li><li>数据定义语言DDL</li><li>数据控制语言DCL。</li></ul><h2 id="二、简要描述这四类"><a href="#二、简要描述这四类" class="headerlink" title="二、简要描述这四类"></a>二、简要描述这四类</h2><h3 id="1、数据查询语言DQL"><a href="#1、数据查询语言DQL" class="headerlink" title="1、数据查询语言DQL"></a>1、数据查询语言DQL</h3><p>数据查询语言DQL基本结构是由SELECT子句，FROM子句，WHERE子句组成的查询块：<br>SELECT &lt;字段名表&gt;FROM &lt;表或视图名&gt;WHERE &lt;查询条件&gt;</p><h3 id="2、数据操纵语言DML"><a href="#2、数据操纵语言DML" class="headerlink" title="2、数据操纵语言DML"></a>2、数据操纵语言DML</h3><p>数据操纵语言DML主要有三种形式：</p><ul><li>插入：INSERT</li><li>更新：UPDATE</li><li>删除：DELETE（删除表中的数据不删除表结构，可以回滚）</li></ul><h3 id="3、数据定义语言DDL"><a href="#3、数据定义语言DDL" class="headerlink" title="3、数据定义语言DDL"></a>3、数据定义语言DDL</h3><ul><li>CREATE：创建</li><li>ALTER：修改表结构</li><li>RENAME：修改表名或列名</li><li>DROP：删除表中的数据和结构，删除后不能回滚</li><li>TRUNCATE：删除表中的数据不删除表结构，删除后不能回滚，效率比DELETE高</li></ul><h3 id="4、数据控制语言DCL"><a href="#4、数据控制语言DCL" class="headerlink" title="4、数据控制语言DCL"></a>4、数据控制语言DCL</h3><ul><li>GRANT：授权</li><li>REVOKE ：回收权限</li></ul><h3 id="还有事务控制语句TCL："><a href="#还有事务控制语句TCL：" class="headerlink" title="还有事务控制语句TCL："></a>还有事务控制语句TCL：</h3><ul><li>SAVEPOINT：保存点  </li><li>ROLLBACK：回退到某点   </li><li>COMMIT：提交事务  </li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之----工厂模式</title>
      <link href="/dist/2021/01/17/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B----%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/dist/2021/01/17/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B----%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式之—-工厂模式"><a href="#设计模式之—-工厂模式" class="headerlink" title="设计模式之—-工厂模式"></a>设计模式之—-工厂模式</h1><p>工厂模式（Factory Pattern）是java中最常用的设计模式之一，这种类型设计模式属于创建型模式，它提供了一种创建对象的最佳方式。在工厂模式中，我们在创建对象是不会对客户暴露创建逻辑，并且是通过使用一个共同的接口，以此来达到解耦的目的。    </p><p>下面的例子以造车为例来说明三种模式。</p><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><h2 id="1、简单工厂模式-Simple-Factory"><a href="#1、简单工厂模式-Simple-Factory" class="headerlink" title="1、简单工厂模式 (Simple Factory)"></a>1、简单工厂模式 (Simple Factory)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CarType</span> </span>&#123;</span><br><span class="line">    BMW, AUDI, DAZHONG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwCar</span> <span class="keyword">extends</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BmwCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是宝马车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCar</span> <span class="keyword">extends</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AudiCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是奥迪车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongCar</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaZhongCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是大众车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态工厂方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> carType 车的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title">createCar</span><span class="params">(CarType carType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (carType) &#123;</span><br><span class="line">            <span class="keyword">case</span> BMW:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">            <span class="keyword">case</span> AUDI:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">            <span class="keyword">case</span> DAZHONG:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CarFactory.createCar(CarType.AUDI);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是奥迪车</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>这种工厂模式，已经完成了我们工厂模式的基本的需求，创建对象和解耦<br>缺点：<br>1、用户调用需要知道自己要创建的对象在工厂中的类型<br>2、拓展很麻烦，如果新增一个产品，需要在产品的具体创建对象的实现，还需使工厂支持创建这种产品，这显然是违背开闭原则的  </p><h2 id="2、工厂方法模式（Factory-Method）"><a href="#2、工厂方法模式（Factory-Method）" class="headerlink" title="2、工厂方法模式（Factory Method）"></a>2、工厂方法模式（Factory Method）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产车的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Car <span class="title">createCar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BmwFactory bmwFactory = <span class="keyword">new</span> BmwFactory();</span><br><span class="line">        bmwFactory.createCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是宝马车</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>工厂方法模式组成：<br>       1)抽象工厂角色： 这是工厂方法模式的核心，它与应用程序无关。是具体工厂角色必须实现的接口或者必须继承的父类。在java中它由抽象类或者接口来实现。<br>       2)具体工厂角色：它含有和具体业务逻辑有关的代码。由应用程序调用以创建对应的具体产品的对象。<br>       3)抽象产品角色：它是具体产品继承的父类或者是实现的接口。在java中一般有抽象类或者接口来实现。<br>       4)具体产品角色：具体工厂角色所创建的对象就是此角色的实例。在java中由具体的类来实现。   </p><p>方法工厂模式和简单工厂模式最大的不同，就是将实现交给了具体的工厂，核心工厂只提供产品线，具体的实现工厂只需要去实现对应的需求即可。如果新增产，只需要去实现对应的产品工厂即可，显然这种方式是符合开闭原则的</p><h2 id="3、抽象工厂模式-Abstract-Factory"><a href="#3、抽象工厂模式-Abstract-Factory" class="headerlink" title="3、抽象工厂模式 (Abstract Factory)"></a>3、抽象工厂模式 (Abstract Factory)</h2><p>个人觉得抽象工厂模式和工厂方法模式区别不是很大。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产车的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Car <span class="title">createCar</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取价钱</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 价钱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：20_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：25_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">25_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：18_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">18_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BmwFactory bmwFactory = <span class="keyword">new</span> BmwFactory();</span><br><span class="line">        bmwFactory.createCar();</span><br><span class="line">        bmwFactory.pricing();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结：<br>无论是简单工厂模式，工厂方法模式，还是抽象工厂模式，他们都属于工厂模式，在形式和特点上也是极为相似的，他们的最终目的都是为了解耦。在使用时，我们不必去在意这个模式到底工厂方法模式还是抽象工厂模式，因为他们之间的演变常常是令人琢磨不透的。经常你会发现，明明使用的工厂方法模式，当新需求来临，稍加修改，加入了一个新方法后，由于类中的产品构成了不同等级结构中的产品族，它就变成抽象工厂模式了；而对于抽象工厂模式，当减少一个方法使的提供的产品不再构成产品族之后，它就演变成了工厂方法模式。<br>所以，在使用工厂模式时，只需要关心降低耦合度的目的是否达到了。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DO、DTO、BO、VO、POJO的定义</title>
      <link href="/dist/2021/01/17/DO%E3%80%81DTO%E3%80%81BO%E3%80%81VO%E3%80%81POJO%E7%9A%84%E5%AE%9A%E4%B9%89/"/>
      <url>/dist/2021/01/17/DO%E3%80%81DTO%E3%80%81BO%E3%80%81VO%E3%80%81POJO%E7%9A%84%E5%AE%9A%E4%B9%89/</url>
      
        <content type="html"><![CDATA[<h1 id="DO、DTO、BO、VO、POJO的定义"><a href="#DO、DTO、BO、VO、POJO的定义" class="headerlink" title="DO、DTO、BO、VO、POJO的定义"></a>DO、DTO、BO、VO、POJO的定义</h1><h2 id="分层领域模型规约"><a href="#分层领域模型规约" class="headerlink" title="分层领域模型规约"></a>分层领域模型规约</h2><p>DO（ Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。<br>DTO（ Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。<br>BO（ Business Object）：业务对象。 由Service层输出的封装业务逻辑的对象。<br>AO（ Application Object）：应用对象。 在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。<br>VO（ View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。<br>POJO（ Plain Ordinary Java Object）：在本手册中， POJO专指只有setter/getter/toString的简单类，包括DO/DTO/BO/VO等。<br>Query：数据查询对象，各层接收上层的查询请求。 注意超过2个参数的查询封装，禁止使用Map类来传输。  </p><h2 id="领域模型命名规约"><a href="#领域模型命名规约" class="headerlink" title="领域模型命名规约"></a>领域模型命名规约</h2><p>数据对象：xxxDO，xxx即为数据表名。<br>数据传输对象：xxxDTO，xxx为业务领域相关的名称。<br>展示对象：xxxVO，xxx一般为网页名称。<br>POJO: 专指只有 setter / getter / toString的简单类，包括DO/DTO/BO/VO等,禁止命名成 xxxPOJO</p>]]></content>
      
      
      <categories>
          
          <category> 代码规范 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码规范 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
