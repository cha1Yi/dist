<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Apache SkyWalking 单机版测试</title>
      <link href="/dist/2021/01/18/Apache%20SkyWalking%20%E5%8D%95%E6%9C%BA%E7%89%88%E6%B5%8B%E8%AF%95/"/>
      <url>/dist/2021/01/18/Apache%20SkyWalking%20%E5%8D%95%E6%9C%BA%E7%89%88%E6%B5%8B%E8%AF%95/</url>
      
        <content type="html"><![CDATA[<h1 id="Apache-SkyWalking-单机版测试"><a href="#Apache-SkyWalking-单机版测试" class="headerlink" title="Apache SkyWalking 单机版测试"></a>Apache SkyWalking 单机版测试</h1><h2 id="一、部署SkyWalking"><a href="#一、部署SkyWalking" class="headerlink" title="一、部署SkyWalking"></a>一、部署SkyWalking</h2><p>学习之前，最好先浏览一下SkyWalking的设计原理：<a href="https://juejin.im/entry/5a6e491a6fb9a01cbb395ea2">分布式追踪 &amp; APM 系统 SkyWalking 源码分析 —— Collector 存储 Trace 数据</a></p><h3 id="1、下载SkyWalking"><a href="#1、下载SkyWalking" class="headerlink" title="1、下载SkyWalking"></a>1、下载SkyWalking</h3><p><a href="http://skywalking.apache.org/downloads/">SkyWalking官方下载地址</a></p><h3 id="2、解压tar-gz"><a href="#2、解压tar-gz" class="headerlink" title="2、解压tar.gz"></a>2、解压tar.gz</h3><p>得到类似的目录：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-01.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-01.png" srcset="data:image/png;base64,666" alt="SkyWalking的目录"></p><h3 id="3、启动SkyWalking"><a href="#3、启动SkyWalking" class="headerlink" title="3、启动SkyWalking"></a>3、启动SkyWalking</h3><p>SkyWalking启动分两步进行：webApp、OapServer</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">localhost:bin wuxuan.chai$ <span class="built_in">pwd</span></span><br><span class="line">/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/bin</span><br><span class="line">localhost:bin wuxuan.chai$ ls -l</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1352 12 24 14:10 oapService.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1599 12 24 14:10 oapService.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1364 12 24 14:10 oapServiceInit.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1597 12 24 14:10 oapServiceInit.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1367 12 24 14:10 oapServiceNoInit.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1616 12 24 14:10 oapServiceNoInit.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff   941 12 24 14:10 startup.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff   934 12 24 14:10 startup.sh</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1426 12 24 14:10 webappService.bat</span><br><span class="line">-rwxr-xr-x  1 wuxuan.chai  staff  1630 12 24 14:10 webappService.sh</span><br><span class="line">localhost:bin wuxuan.chai$ </span><br></pre></td></tr></table></figure><p>bin目录里面包含了三个部分：oap服务、oap服务初始化、webappService</p><ul><li>webappService服务的作用：提供SkyWalking的web服务</li><li>oap服务初始化：初始化oap服务所需要的环境初始化，例如：DataStorage的初始化,读取配置中心配置等</li><li>oap服务：相当于监控数据的收集（collecter）和持久化</li></ul><p>如果配置完成，可以直接执行 sh startup.sh,启动整个项目</p><h3 id="4、SkyWalking相关的配置"><a href="#4、SkyWalking相关的配置" class="headerlink" title="4、SkyWalking相关的配置"></a>4、SkyWalking相关的配置</h3><h4 id="4-1、oap收集数据存储位置配置"><a href="#4-1、oap收集数据存储位置配置" class="headerlink" title="4.1、oap收集数据存储位置配置"></a>4.1、oap收集数据存储位置配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./config/application.yml</span><br><span class="line"><span class="comment"># 查看storage配置项的支持，SkyWalking支持将数据落地到：elasticsearch、elasticsearch7、h2</span></span><br><span class="line"><span class="comment"># 根据实际需求设置响应的配置信息</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="4-2、设置配置中心"><a href="#4-2、设置配置中心" class="headerlink" title="4.2、设置配置中心"></a>4.2、设置配置中心</h4><p>SkyWalking支持的配置中心有apollo、nacos、zookeeper、etcd、consul</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./config/application.yml</span><br><span class="line"><span class="comment"># 根据实际需求设置响应的配置信息</span></span><br></pre></td></tr></table></figure><h4 id="4-3、服务端口的设置"><a href="#4-3、服务端口的设置" class="headerlink" title="4.3、服务端口的设置"></a>4.3、服务端口的设置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">~ vim ./webapp/webapp.yml</span><br><span class="line"><span class="comment"># 修改web端口，server.port=9090 默认为8080</span></span><br><span class="line"><span class="comment"># cellector服务的调用地址 修改listOfServers，多个服务用‘,’隔开</span></span><br></pre></td></tr></table></figure><h4 id="4-4、Agent的配置"><a href="#4-4、Agent的配置" class="headerlink" title="4.4、Agent的配置"></a>4.4、Agent的配置</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 打开配置文件</span></span><br><span class="line">～ vim ./agent/config/agent.config</span><br><span class="line"><span class="comment"># oapservice的后端服务，用于应用订阅（默认值127.0.0.1:11800）</span></span><br><span class="line">collector.backend_service=xxx</span><br><span class="line"><span class="comment"># 是否追踪sql的参数</span></span><br><span class="line">plugin.mysql.trace_sql_parameters=<span class="literal">true</span>/<span class="literal">false</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>配置完成这些基本配置之后，就可以直接执行 sh startup.sh,启动整个项目了</p><h3 id="5、将应用加入到SkyWalking的监控代理中"><a href="#5、将应用加入到SkyWalking的监控代理中" class="headerlink" title="5、将应用加入到SkyWalking的监控代理中"></a>5、将应用加入到SkyWalking的监控代理中</h3><h4 id="5-1、springboot项目"><a href="#5-1、springboot项目" class="headerlink" title="5.1、springboot项目"></a>5.1、springboot项目</h4><p>springboot应用：启动springboot的demo应用，</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/usr/bin/env sh</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># SkyWalking Agent 配置</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_NAME=demo-application <span class="comment"># 配置 Agent 名字。一般来说，我们直接使用 Spring Boot 项目的 `spring.application.name` 。</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_COLLECTOR_BACKEND_SERVICES=127.0.0.1:11800 <span class="comment"># 配置 Collector 地址。</span></span><br><span class="line"><span class="built_in">export</span> SW_AGENT_SPAN_LIMIT=2000 <span class="comment"># 配置链路的最大 Span 数量。一般情况下，不需要配置，默认为 300 。主要考虑，有些新上 SkyWalking Agent 的项目，代码可能比较糟糕。</span></span><br><span class="line"><span class="built_in">export</span> JAVA_AGENT=-javaagent:/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar <span class="comment"># SkyWalking Agent jar 地址。</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Jar 启动</span></span><br><span class="line">java -jar <span class="variable">$JAVA_AGENT</span> -jar lab-39-demo-2.2.2.RELEASE.jar</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行启动脚本，即可在SkyWalking的拓扑图中看到对应的服务监控信息</p><h4 id="5-2、传统的ssm项目，使用tomcat-jetty等容器发布的工程"><a href="#5-2、传统的ssm项目，使用tomcat-jetty等容器发布的工程" class="headerlink" title="5.2、传统的ssm项目，使用tomcat/jetty等容器发布的工程"></a>5.2、传统的ssm项目，使用tomcat/jetty等容器发布的工程</h4><p>需要在启动的参数中加入</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">-DSW_AGENT_NAME</span>=<span class="string">xxx</span></span><br><span class="line"><span class="meta">-DSW_AGENT_COLLECTOR_BACKEND_SERVICES</span>=<span class="string">127.0.0.1:11800</span></span><br><span class="line"><span class="meta">-DSW_AGENT_SPAN_LIMIT</span>=<span class="string">2000</span></span><br><span class="line"><span class="meta">-javaagent</span>:<span class="string">/Users/wuxuan.chai/Documents/application/skywalking/apache-skywalking-apm-bin-es7/agent/skywalking-agent.jar</span></span><br></pre></td></tr></table></figure><p>启动tomcat/jetty，即可。</p><p>效果如图：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-02.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-skywalking-02.png" srcset="data:image/png;base64,666" alt="应用服务的拓扑图"></p>]]></content>
      
      
      
        <tags>
            
            <tag> SkyWalking </tag>
            
            <tag> 系统监控 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Maven常用命令</title>
      <link href="/dist/2021/01/18/maven%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/"/>
      <url>/dist/2021/01/18/maven%E7%9B%B8%E5%85%B3%E5%91%BD%E4%BB%A4/</url>
      
        <content type="html"><![CDATA[<h2 id="maven常用命令"><a href="#maven常用命令" class="headerlink" title="maven常用命令"></a>maven常用命令</h2><h3 id="一、上传包到maven中央仓库"><a href="#一、上传包到maven中央仓库" class="headerlink" title="一、上传包到maven中央仓库"></a>一、上传包到maven中央仓库</h3><p>命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn deploy:deploy-file -DgroupId=com.aliyun -DartifactId=taobao-sdk-java-auto -Dversion=202011-release -Dpackaging=jar -Dfile=/Users/wuxuan.chai/Downloads/dingtalk-sdk-java/taobao-sdk-java-auto_1479188381469-20201126.jar -Durl=http://ci.yunat.com:8091/nexus/content/repositories/thirdparty/ -DrepositoryId=nexus</span><br></pre></td></tr></table></figure><p>参数解释:<br>deploy:deploy-file：发布，发布文件到远程，和install的区别在于，install的意思是将jar安装到本地maven仓库<br>groupId、artifactId、version：表示maven的坐标<br>file：发布的文件的本地地址<br>url：远程仓库的地址<br>repositoryId：本地maven配置文件的仓库id，配置这个的话他会去找配置文件中的对应仓库的访问鉴权所需的账户和密码</p>]]></content>
      
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>项目版本管理的最佳实践</title>
      <link href="/dist/2021/01/18/%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/"/>
      <url>/dist/2021/01/18/%E9%A1%B9%E7%9B%AE%E7%89%88%E6%9C%AC%E7%AE%A1%E7%90%86%E7%9A%84%E6%9C%80%E4%BD%B3%E5%AE%9E%E8%B7%B5/</url>
      
        <content type="html"><![CDATA[<h1 id="项目版本管理的最佳实践"><a href="#项目版本管理的最佳实践" class="headerlink" title="项目版本管理的最佳实践"></a>项目版本管理的最佳实践</h1><h2 id="一、Git设置"><a href="#一、Git设置" class="headerlink" title="一、Git设置"></a>一、Git设置</h2><p>1、添加公钥</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">打开 git bash (mac 下直接打开终端即可)</span><br><span class="line"><span class="comment">#: ssh-keygen -t rsa -C &quot;邮箱&quot;</span></span><br><span class="line"><span class="comment">#: cat ~/.ssh/id_rsa.pub</span></span><br><span class="line">会生成：以ssh-rsa 开头的字符串，复制，贴到git公钥管理里面</span><br><span class="line"></span><br><span class="line">测试是否可以通过公钥，免密拉取上传代码</span><br><span class="line"><span class="comment">#: ssh -T git@gitee.com （我这里用的gitee，对应的域名请自行切换）</span></span><br><span class="line"></span><br><span class="line">成功：</span><br><span class="line">Hi 柴梧炫 (DeployKey)! You<span class="string">&#x27;ve successfully authenticated, but GITEE.COM does not provide shell access.</span></span><br><span class="line"><span class="string">Note: Perhaps the current use is DeployKey.</span></span><br><span class="line"><span class="string">Note: DeployKey only supports pull/fetch operations</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">失败：</span></span><br><span class="line"><span class="string">The authenticity of host &#x27;</span>gitlab.com (172.65.251.78)<span class="string">&#x27; can&#x27;</span>t be established.</span><br><span class="line">ECDSA key fingerprint is SHA256:HbW3g8zUjNSksFbqTiUWPWg2Bq1x8xdGUrliXFzSnUw.</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521122520622.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521122520622.png" srcset="data:image/png;base64,666" alt="git中的配置"></p><h2 id="二、项目版本"><a href="#二、项目版本" class="headerlink" title="二、项目版本"></a>二、项目版本</h2><p>在web开发的过程中，maven 除了作为项目的依赖管理之外，还处理着项目的版本控制</p><h2 id="1、maven-的多项目的标准结构"><a href="#1、maven-的多项目的标准结构" class="headerlink" title="1、maven 的多项目的标准结构"></a>1、maven 的多项目的标准结构</h2><h3 id="1-1、如何组织项目"><a href="#1-1、如何组织项目" class="headerlink" title="1.1、如何组织项目"></a>1.1、如何组织项目</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">[MavenMultiProject]</span><br><span class="line"> ├── module-1</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   └── src</span><br><span class="line"> ├── module-2</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   └── src</span><br><span class="line"> ├── module-3</span><br><span class="line"> │   ├── pom.xml</span><br><span class="line"> │   ├── module-3-1</span><br><span class="line"> │       ├── pom.xml</span><br><span class="line"> │       └── src</span><br><span class="line"> │   ├── module-3-2</span><br><span class="line"> │       ├── pom.xml</span><br><span class="line"> │       └── src</span><br><span class="line"> ├── pom.xml</span><br><span class="line"> ├── README.en.md</span><br><span class="line"> ├── README.md</span><br></pre></td></tr></table></figure><p>其中子模块也可以有其子模块</p><h3 id="1-2、POM文件中的内容"><a href="#1-2、POM文件中的内容" class="headerlink" title="1.2、POM文件中的内容"></a>1.2、POM文件中的内容</h3><h4 id="1-2-1、parent-pom-xml"><a href="#1-2-1、parent-pom-xml" class="headerlink" title="1.2.1、parent pom.xml"></a>1.2.1、parent pom.xml</h4><p>父模块的pom文件一般存放公用的信息，以及定义标准，打包的格式：pom</p><p>除了上述的信息，一般不要引入其他的元素，因为一旦引入，子模块就会继承这些依赖，导致子模块的依赖被污染</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 属性定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">  ....</span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 仓库的定义 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">repository</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">id</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">name</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-releases/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">repository</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">id</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>local nexus<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://localhost:8081/repository/maven-snapshots/<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">snapshotRepository</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">distributionManagement</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 软件配置管理（项目git地址信息）如果git需要权限，则需要加入公钥，免密访问--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">connection</span>&gt;</span></span><br><span class="line">            scm:git:https://gitee.com/wuxuanchai_admin/m-v.git</span><br><span class="line">   <span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">            scm:git:https://gitee.com/wuxuanchai_admin/m-v.git</span><br><span class="line">   <span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span></span><br><span class="line">            https://gitee.com/liang.liang/version-mangement-best-practices</span><br><span class="line">   <span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--开发者--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">developers</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developer</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">name</span>&gt;</span>wuxuan.chai<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">email</span>&gt;</span>wuxuan.chai@gmail.com<span class="tag">&lt;/<span class="name">email</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">organizationUrl</span>&gt;</span>www.shuyun.com<span class="tag">&lt;/<span class="name">organizationUrl</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">developer</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">developers</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--模块定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">moudles</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">moudle</span>&gt;</span>../moudle1<span class="tag">&lt;/<span class="name">moudle</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">moudles</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--插件定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">pluginManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--依赖定义--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencyManagement</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencyManagement</span>&gt;</span></span><br></pre></td></tr></table></figure><p>pom文件中可被继承的元素：</p><ul><li>可继承的POM元素如下：<ul><li>groupId：项目组ID，项目坐标的核心元素</li><li>version：项目版本，项目坐标的核心因素</li><li>description：项目的描述信息</li><li>organization：项目的组织信息</li><li>inceptionYear：项目的创始年份</li><li>url：项目的URL地址</li><li>developers：项目的开发者信息</li><li>contributors：项目的贡献者信息</li><li>distributionManagement：项目的部署配置</li><li>issueManagement：项目的缺陷跟踪系统信息</li><li>ciManagement：项目的持续集成系统信息</li><li>scm：项目的版本控制系统西溪</li><li>malilingLists：项目的邮件列表信息</li><li>properties：自定义的Maven属性</li><li>dependencies：项目的依赖配置</li><li>dependencyManagement：项目的依赖管理配置</li><li>repositories：项目的仓库配置</li><li>build：包括项目的源码目录配置、输出目录配置、插件配置、插件管理配置等</li><li>reporting：包括项目的报告输出目录配置、报告插件配置等</li></ul></li></ul><h4 id="1-2-2、子模块"><a href="#1-2-2、子模块" class="headerlink" title="1.2.2、子模块"></a>1.2.2、子模块</h4><p>子模块是具体依赖的配置，一般以jar包的格式提供服务（使用springboot后，war包格式会被打成jar）</p><p>在子模块中，所有的version都不应该存在，要放在parent.pom 中进行统一管理</p><ul><li>模块本身：version 继承父模块的versoin</li><li>所有依赖version，在父模块的dependencyManagement 元素中进行定义</li></ul><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 父模块的坐标--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">parent</span>&gt;</span></span><br><span class="line">  </span><br><span class="line"><span class="tag">&lt;/<span class="name">parent</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 当前模块的坐标，不需要写版本信息，会继承父模块的版本号--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>com.example<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span>demo<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块描述--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">description</span>&gt;</span>xxx<span class="tag">&lt;/<span class="name">description</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块依赖列表--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 模块的构建所需要的插件--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h3 id="1-3、语义化的版本号（Semantic-Versioning）"><a href="#1-3、语义化的版本号（Semantic-Versioning）" class="headerlink" title="1.3、语义化的版本号（Semantic Versioning）"></a>1.3、语义化的版本号（Semantic Versioning）</h3><h4 id="1-3-1、版本号的格式"><a href="#1-3-1、版本号的格式" class="headerlink" title="1.3.1、版本号的格式"></a>1.3.1、版本号的格式</h4><p>版本号的格式： 主版本号.次版本号.修订号        </p><p>版本号的递增的规则：</p><p>1、主版本号：当你做了不兼容的API修改</p><p>2、次版本号：当你做了向下兼容的功能性新增</p><p>3、修订号：当你做了向下兼容的问题修正</p><p>先行版本号及版本编译元数据可以加到“主版本号.次版本号.修订号”的后面，作为延伸。</p><p>也就是说可以支持这种版本号：</p><p>4.7.5.202005</p><ul><li>4 主版本号</li><li>7 次版本号</li><li>5 修订号</li><li>202005 编译元数据-编译日期</li></ul><p>其他的语义描述：</p><ul><li>Alpha：内测版</li><li>Beta：公测版</li><li>Gamma：比较成熟的测试版，与即将发行的正式版相差无几</li><li>RC：是 Release Candidate 的缩写，意思是发布倒计时，候选版本</li><li>Stable：稳定版</li></ul><h3 id="1-4、版本性质：-Snapshot-与Release"><a href="#1-4、版本性质：-Snapshot-与Release" class="headerlink" title="1.4、版本性质： Snapshot 与Release"></a>1.4、版本性质： Snapshot 与Release</h3><h4 id="1-4-1、概念"><a href="#1-4-1、概念" class="headerlink" title="1.4.1、概念"></a>1.4.1、概念</h4><p>Snapshot：快照，他是一个不稳定的版本，处于开发中的，经常变化的版本</p><p>Release：发行版，功能稳定的版本，将停止代码的更新，用于发行到生产环境</p><h4 id="1-4-2、理想的流程"><a href="#1-4-2、理想的流程" class="headerlink" title="1.4.2、理想的流程"></a>1.4.2、理想的流程</h4><h5 id="日常的开发"><a href="#日常的开发" class="headerlink" title="日常的开发"></a>日常的开发</h5><p>基于Snapshot的版本进行开发，snapshot版本会有一些特性</p><ul><li>执行 mvn complie 时会去仓库中尝试拉最新打包，因为他可以被多次构建，使用时必须保证最新</li><li>可以被重复构建</li></ul><h5 id="版本发布"><a href="#版本发布" class="headerlink" title="版本发布"></a>版本发布</h5><p>在发布版本的时候，我们需要做以下的几件事：</p><p>1、创建Tag分支，tag/v版本号（例如：tag/v0.0.1）</p><p>2、在仓库中构建发布包（release 的jar）</p><p>3、创建新的开发分支，升级本地pom文件版本，根据实际的需求提升版本号</p><ul><li>如果hotfix发布，则：x.y.z -&gt; x.y.z+1            例如：4.7.5 &gt; 4.7.6</li><li>次版本发布， 则： x.y.z -&gt; x.y+1.0                例如：4.7.5 &gt; 4.8.0</li><li>大版本更新，则：x.y.z -&gt; x+1.0.0                  例如：4.7.5 &gt; 5.0.0</li></ul><p>4、非hotfix版本发布，还需要创建hotfix分支，用于以后修复</p><h5 id="现有的项目如何做？"><a href="#现有的项目如何做？" class="headerlink" title="现有的项目如何做？"></a>现有的项目如何做？</h5><p>插件管理：maven-release-plugin</p><p>插件地址：<a href="http://maven.apache.org/maven-release/maven-release-plugin/">http://maven.apache.org/maven-release/maven-release-plugin/</a></p><p>parent pom配置文件配置：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">scm</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- git项目地址可以用SSH  也可以用 HTTPS的--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">connection</span>&gt;</span>scm:git:https://gitee.com/wuxuanchai_admin/m-v.git<span class="tag">&lt;/<span class="name">connection</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- #git项目地址可以用SSH  也可以用 HTTPS的--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">developerConnection</span>&gt;</span>scm:git:https://gitee.com/wuxuanchai_admin/m-v.git<span class="tag">&lt;/<span class="name">developerConnection</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- #git项目浏览器里的地址--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">url</span>&gt;</span>https://gitee.com/liang.liang/version-mangement-best-practices<span class="tag">&lt;/<span class="name">url</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">tag</span>&gt;</span>HEAD<span class="tag">&lt;/<span class="name">tag</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">scm</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-release-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- tag分支的名称，project.version只包含版本，不包含SNAPSHOT后缀 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">tagNameFormat</span>&gt;</span>v@&#123;project.version&#125;<span class="tag">&lt;/<span class="name">tagNameFormat</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 升级子模块 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">autoVersionSubmodules</span>&gt;</span>true<span class="tag">&lt;/<span class="name">autoVersionSubmodules</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 跳过单元测试 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">arguments</span>&gt;</span>-DskipTests<span class="tag">&lt;/<span class="name">arguments</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 执行目标，此句可省 --&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">goals</span>&gt;</span>-f pom.xml deploy<span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure><h5 id="如何使用？？"><a href="#如何使用？？" class="headerlink" title="如何使用？？"></a>如何使用？？</h5><h6 id="1-release-branch（创建分支-）"><a href="#1-release-branch（创建分支-）" class="headerlink" title="1) release:branch（创建分支 ）"></a>1) release:branch（创建分支 ）</h6><p>创建的分支是用于hotfix修复的基础分支，在第一次创建次要版本是，要一并创建，以后的修改都基于此分支，后续如果有需要的hotfix来修复问题，则基于此分支创建一个新的分支hotfix-xxx，然后提交代码后，将release一个hotfix的版本：x.y.z+1(z表示当前的修订号)</p><p>命令：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:branch -DbranchName=0.2.x -DupdateBranchVersions=<span class="literal">true</span> -DupdateWorkingCopyVersions=<span class="literal">false</span></span><br></pre></td></tr></table></figure><p>命令含义：</p><ul><li>-DbranchName=0.2.x：创建一个叫 0.2.x 的分支</li><li>-DupdateBranchVersions=true ：分支会升级版本号，如果当前的版本号为0.0.1-snapshot，则新的分支版本号为： 0.0.2-snapshot</li><li>DupdateWorkingCopyVersions=false 当前工作空间的pom文件不做更改，方便后面的release操作</li></ul><h6 id="2-release-prepare-预处理，升级pom-version"><a href="#2-release-prepare-预处理，升级pom-version" class="headerlink" title="2)  release:prepare(预处理，升级pom-version)"></a>2)  release:prepare(预处理，升级pom-version)</h6><p>预处理阶段，release插件会：</p><ul><li>执行一次打包过程</li><li>在git仓库里面创建好Tag分支</li><li>升级pom文件版本，并提交到本地仓库（此处不会更改远程仓库的分支）</li></ul><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:prepare</span><br></pre></td></tr></table></figure><p>在默认的情况下，他是一个交互式的命令，有如下问题需要确认：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">What is the release version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.15: :</span><br><span class="line">What is SCM release tag or label for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) v0.1.15: :</span><br><span class="line">What is the new development version for &quot;mvc-test&quot;? (com.fruits.mvc:mvc-test) 0.1.16-SNAPSHOT: :</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;要发布的版本是哪一个？默认当前版本</span><br><span class="line">&#x2F;&#x2F;要打的tag叫什么？现在的样子 </span><br><span class="line">&#x2F;&#x2F;创建一个新的开发版本吗？默认当前版本+1 修订（此处我们可以手工改成 子版本号更新）</span><br></pre></td></tr></table></figure><p>执行了 release:prepare命令后，在git仓库中，我们可以看到一个叫：v0.1.15的tag被创建，这操作是可以回滚的，插件在项目里面创建了一个，pom.xml.releaseBackup的文件，用于回滚pom.xml，同时还会生成：release.properties 里面会记录release版本的属性</p><h6 id="3-release-rollback-回滚"><a href="#3-release-rollback-回滚" class="headerlink" title="3) release:rollback(回滚)"></a>3) release:rollback(回滚)</h6><p>Release:prepare 阶段都是进行了本地的提交，因此可以进行回滚，但tag分支必须手工删除，插件不能帮你删除已经创建好的本地Tag</p><p>除此之外，可以还行发布预览：</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mvn release:prepare -DdryRun=<span class="literal">true</span></span><br></pre></td></tr></table></figure><p>干跑会生成预览文件：</p><p>pom.xml.next<br>pom.xml.releaseBackup<br>pom.xml.tag<br>release.properties</p><p>但是不会提交。</p><h6 id="4-release-perform-执行"><a href="#4-release-perform-执行" class="headerlink" title="4) release:perform (执行)"></a>4) release:perform (执行)</h6><p>执行命令，会在release仓库里面构建发布包</p><h5 id="可能碰到的问题"><a href="#可能碰到的问题" class="headerlink" title="可能碰到的问题"></a>可能碰到的问题</h5><ul><li><p>release:rollback不会回滚git的tag，需要手动删除tag</p></li><li><p>maven配置的优先级(idea下)    pom.xml&gt;.m2/setting.xml&gt;setting.xml</p></li><li><p>pom.xml 发生改变，无法执行release:prepare</p></li><li><p>私服的设置和maven的配置文件如果配置不正确，无法执行命令</p></li></ul><h5 id="效果"><a href="#效果" class="headerlink" title="效果"></a>效果</h5><p>私服中release的jar：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521143731682.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521143731682.png" srcset="data:image/png;base64,666" alt="image-20200521143731682"></p><p>私服中的snapshot的jar：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144447952.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144447952.png" srcset="data:image/png;base64,666" alt="image-20200521144447952"></p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144515512.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144515512.png" srcset="data:image/png;base64,666" alt="image-20200521144515512"></p><p>git中的tag：发布release后创建的tag分支</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144553460.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/image-20200521144553460.png" srcset="data:image/png;base64,666" alt="image-20200521144553460"></p>]]></content>
      
      
      
        <tags>
            
            <tag> maven </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Arthas诊断神器</title>
      <link href="/dist/2021/01/17/Arthas%E8%AF%8A%E6%96%AD%E7%A5%9E%E5%99%A8/"/>
      <url>/dist/2021/01/17/Arthas%E8%AF%8A%E6%96%AD%E7%A5%9E%E5%99%A8/</url>
      
        <content type="html"><![CDATA[<h2 id="一、快速入门"><a href="#一、快速入门" class="headerlink" title="一、快速入门"></a>一、快速入门</h2><h3 id="1-1、Arthas简介"><a href="#1-1、Arthas简介" class="headerlink" title="1.1、Arthas简介"></a>1.1、Arthas简介</h3><p>Arthas 是Alibaba开源的Java诊断工具。可以安装在系统所在服务器，也可以远程诊断其他服务器的服务。可以帮助开发人员或者运维人员查找问题，分析性能，bug追踪。</p><h3 id="1-2、Arthas的快速入门"><a href="#1-2、Arthas的快速入门" class="headerlink" title="1.2、Arthas的快速入门"></a>1.2、Arthas的快速入门</h3><p>下载地址：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">wget https://alibaba.github.io/arthas/arthas-boot.jar</span><br></pre></td></tr></table></figure><p>应用程序：可以自己启一个java服务</p><h3 id="1-3、启动Arthas"><a href="#1-3、启动Arthas" class="headerlink" title="1.3、启动Arthas"></a>1.3、启动Arthas</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-boot.jar </span><br></pre></td></tr></table></figure><p>执行arthas程序的用户要和应用程序的执行用户为相同的权限。比如：应用程序使用admin用户来执行，那么arthas的启动：sudo su admin &amp;&amp; java -jar arthas-boot.jar 或者 sudo -u admin -EH java -jar arthas-boot.jar<br>java -jar arthas-boot.jar -h 打印更多的信息</p><p>开始启动：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar </span><br><span class="line">[INFO] arthas-boot version: 3.3.3</span><br><span class="line">[INFO] Process 84742 already using port 3658</span><br><span class="line">[INFO] Process 84742 already using port 8563</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br></pre></td></tr></table></figure><p>可以看到我们通过wuxuan.chai用户启动了7个java进程（pid）：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br></pre></td></tr></table></figure><p>选择应用的java进程：<br>这里我们选择我们的测试app，1<br>输入1，再回车/enter，arthas会attach到目标进程：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">localhost:Downloads wuxuan.chai$ java -jar arthas-boot.jar </span><br><span class="line">[INFO] arthas-boot version: 3.3.3</span><br><span class="line">[INFO] Process 84742 already using port 3658</span><br><span class="line">[INFO] Process 84742 already using port 8563</span><br><span class="line">[INFO] Found existing java process, please choose one and input the serial number of the process, eg : 1. Then hit ENTER.</span><br><span class="line">* [1]: 84742 com.yiyi.Application</span><br><span class="line">  [2]: 84898 arthas-boot.jar</span><br><span class="line">  [3]: 1572 kafka.Kafka</span><br><span class="line">  [4]: 981 org.apache.zookeeper.server.quorum.QuorumPeerMain</span><br><span class="line">  [5]: 84726 org.codehaus.plexus.classworlds.launcher.Launcher</span><br><span class="line">  [6]: 83691 </span><br><span class="line">  [7]: 84010 org.jetbrains.idea.maven.server.RemoteMavenServer36</span><br><span class="line">1</span><br><span class="line">[INFO] arthas home: /Users/wuxuan.chai/.arthas/lib/3.3.6/arthas</span><br><span class="line">[INFO] The target process already listen port 3658, skip attach.</span><br><span class="line">[INFO] arthas-client connect 127.0.0.1 3658</span><br><span class="line">  ,---.  ,------. ,--------.,--.  ,--.  ,---.   ,---.                           </span><br><span class="line"> /  O  \ |  .--. &#x27;&#x27;--.  .--&#x27;|  &#x27;--&#x27;  | /  O  \ &#x27;   .-&#x27;                          </span><br><span class="line">|  .-.  ||  &#x27;--&#x27;.&#x27;   |  |   |  .--.  ||  .-.  |`.  `-.                          </span><br><span class="line">|  | |  ||  |\  \    |  |   |  |  |  ||  | |  |.-&#x27;    |                         </span><br><span class="line">`--&#x27; `--&#x27;`--&#x27; &#x27;--&#x27;   `--&#x27;   `--&#x27;  `--&#x27;`--&#x27; `--&#x27;`-----&#x27;                          </span><br><span class="line">                                                                                </span><br><span class="line"></span><br><span class="line">wiki      https://alibaba.github.io/arthas                                      </span><br><span class="line">tutorials https://alibaba.github.io/arthas/arthas-tutorials                     </span><br><span class="line">version   3.3.6                                                                 </span><br><span class="line">pid       84742                                                                 </span><br><span class="line">time      2020-07-06 10:46:47                                                   </span><br><span class="line"></span><br><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> </span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4、Arthas的基本操作"><a href="#1-4、Arthas的基本操作" class="headerlink" title="1.4、Arthas的基本操作"></a>1.4、Arthas的基本操作</h3><p>Arthas的入门基本操作：Dashboard/thread/jad/watch，来查看一些最基本的指标信息，比如，资源占用，线程，类信息，方法执行信息。</p><h4 id="1-4-1、查看Dashboard"><a href="#1-4-1、查看Dashboard" class="headerlink" title="1.4.1、查看Dashboard"></a>1.4.1、查看Dashboard</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> dashboard</span> </span><br><span class="line">ID          NAME                                 GROUP                    PRIORITY    STATE       %CPU        TIME         INTERRUPTED DAEMON      </span><br><span class="line">149         Timer-for-arthas-dashboard-3bf90e35- system                   10          RUNNABLE    51          0:0          false       true        </span><br><span class="line">113         Catalina-utility-1                   main                     1           TIMED_WAITI 14          0:0          false       false       </span><br><span class="line">116         http-nio-7070-BlockPoller            main                     5           RUNNABLE    14          0:0          false       true        </span><br><span class="line">127         http-nio-7070-ClientPoller           main                     5           RUNNABLE    13          0:0          false       true        </span><br><span class="line">114         Catalina-utility-2                   main                     1           WAITING     5           0:0          false       false       </span><br><span class="line">131         Attach Listener                      system                   9           RUNNABLE    0           0:0          false       true        </span><br><span class="line">130         DestroyJavaVM                        main                     5           RUNNABLE    0           0:1          false       false       </span><br><span class="line">3           Finalizer                            system                   8           WAITING     0           0:0          false       true        </span><br><span class="line">2           Reference Handler                    system                   10          WAITING     0           0:0          false       true        </span><br><span class="line">4           Signal Dispatcher                    system                   9           RUNNABLE    0           0:0          false       true        </span><br><span class="line">136         arthas-shell-server                  system                   9           TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">137         arthas-shell-server                  system                   9           TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">133         arthas-timer                         system                   9           WAITING     0           0:0          false       true        </span><br><span class="line">141         as-command-execute-daemon            system                   10          TIMED_WAITI 0           0:0          false       true        </span><br><span class="line">115         container-0                          main                     5           TIMED_WAITI 0           0:0          false       false       </span><br><span class="line">Memory                          used      total      max       usage      GC                                                                       </span><br><span class="line">heap                            169M      370M       3641M     4.66%      gc.ps_scavenge.count                 4                                   </span><br><span class="line">ps_eden_space                   140M      183M       1344M     10.46%     gc.ps_scavenge.time(ms)              37                                  </span><br><span class="line">ps_survivor_space               0K        10752K     10752K    0.00%      gc.ps_marksweep.count                2                                   </span><br><span class="line">ps_old_gen                      29M       176M       2731M     1.07%      gc.ps_marksweep.time(ms)             118                                 </span><br><span class="line">nonheap                         53M       57M        -1        92.98%                                                                              </span><br><span class="line">code_cache                      5M        7M         240M      2.17%                                                                               </span><br><span class="line">metaspace                       42M       44M        -1        95.78%                                                                              </span><br><span class="line">Runtime                                                                                                                                            </span><br><span class="line">os.name                                                                   Mac OS X                                                                 </span><br><span class="line">os.version                                                                10.14.6                                                                  </span><br><span class="line">java.version                                                              1.8.0_241                                                                </span><br><span class="line">java.home                                                                 /Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre     </span><br><span class="line">systemload.average                                                        3.25                                                                     </span><br><span class="line">processors                                                                8                                                                        </span><br><span class="line">uptime               </span><br></pre></td></tr></table></figure><p>上半部分是程序的线程信息，中间是内存使用情况，这里可以查看gc的次数，下面是当前程序运行的环境信息</p><h4 id="1-4-2、thread命令查看进程"><a href="#1-4-2、thread命令查看进程" class="headerlink" title="1.4.2、thread命令查看进程"></a>1.4.2、thread命令查看进程</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> thread 115</span> </span><br><span class="line">&quot;container-0&quot; Id=115 TIMED_WAITING</span><br><span class="line">    at java.lang.Thread.sleep(Native Method)</span><br><span class="line">    at org.apache.catalina.core.StandardServer.await(StandardServer.java:570)</span><br><span class="line">    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer$1.run(TomcatWebServer.java:197)</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:0) cost in 1 ms.</span><br></pre></td></tr></table></figure><p>查看线程的具体信息，调用对象，状态等。。。</p><h4 id="1-4-3、jad反编译class类"><a href="#1-4-3、jad反编译class类" class="headerlink" title="1.4.3、jad反编译class类"></a>1.4.3、jad反编译class类</h4><p>通过jad反编译springboot的启动类：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> jad com.yiyi.Application</span></span><br><span class="line"></span><br><span class="line">ClassLoader:                                                                                                                                       </span><br><span class="line">+-sun.misc.Launcher$AppClassLoader@4e25154f                                                                                                        </span><br><span class="line">  +-sun.misc.Launcher$ExtClassLoader@2ef1e4fa                                                                                                      </span><br><span class="line"></span><br><span class="line">Location:                                                                                                                                          </span><br><span class="line">/Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                       </span><br><span class="line"></span><br><span class="line">/*</span><br><span class="line"> * Decompiled with CFR.</span><br><span class="line"> */</span><br><span class="line">package com.yiyi;</span><br><span class="line"></span><br><span class="line">import org.springframework.boot.SpringApplication;</span><br><span class="line">import org.springframework.boot.autoconfigure.SpringBootApplication;</span><br><span class="line">import org.springframework.context.annotation.ComponentScan;</span><br><span class="line"></span><br><span class="line">@SpringBootApplication</span><br><span class="line">@ComponentScan(value=&#123;&quot;com.yiyi&quot;&#125;)</span><br><span class="line">public class Application &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        SpringApplication.run(Application.class, args);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">Affect(row-cnt:2) cost in 181 ms.</span><br><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><h4 id="1-4-4、watch查看函数的返回值"><a href="#1-4-4、watch查看函数的返回值" class="headerlink" title="1.4.4、watch查看函数的返回值"></a>1.4.4、watch查看函数的返回值</h4><p>通过watch命令查看方法的返回值，查看获取微信的accessToken的方法返回值：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@84742]$</span><span class="bash"> watch com.yiyi.api.WeixinSupportApi getAccessToken</span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 38 ms, listenerId: 3</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>执行命令后，Arthas会监听该方法的执行，每次调用，都会将执行结果打印出来,例如：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ts=2020-07-06 11:26:17; [cost=3.13107ms] result=@ArrayList[</span><br><span class="line">    @Object[][isEmpty=false;size=2],</span><br><span class="line">    @WeixinSupportApi[com.yiyi.api.WeixinSupportApi@14cb7037],</span><br><span class="line">    @String[i9c7LCIqY8cJuneYN9C9q4kN-FZoo7YZFVxEpgT3ugMmeX1KJ5HuVgSLK5IkJW7JF_adbkmjGrGdu9aw9XFhrMBLBMC9eFm82ICpst1-UVGujAvdUMcPRkUNcgb7I7MmxHk2ZVIpZzLKxf-3zw1-oE-wfhETKjRrjRhoP7z7g9UD4OS-cctNJBUJk8XfcE2cW_S2GUuj-tm2vyvVNK9oDQ],</span><br><span class="line">]</span><br></pre></td></tr></table></figure><h2 id="二、进阶使用"><a href="#二、进阶使用" class="headerlink" title="二、进阶使用"></a>二、进阶使用</h2><h3 id="2-1、基础命令"><a href="#2-1、基础命令" class="headerlink" title="2.1、基础命令"></a>2.1、基础命令</h3><h4 id="2-1-1、所有命令的集合"><a href="#2-1-1、所有命令的集合" class="headerlink" title="2.1.1、所有命令的集合"></a>2.1.1、所有命令的集合</h4><table><thead><tr><th>NAME</th><th>DESCRIPTION</th></tr></thead><tbody><tr><td>help</td><td>展示Arthas帮助</td></tr><tr><td>keymap</td><td>展示所有指定的连接的可用的快捷键</td></tr><tr><td>sc</td><td>搜索所有被jvm加载类</td></tr><tr><td>sm</td><td>搜索所有被jvm加载的类的方法</td></tr><tr><td>classloader</td><td>展示类加载器的信息</td></tr><tr><td>jad</td><td>类反编译</td></tr><tr><td>getstatic</td><td>展示一个类的静态的属性字段</td></tr><tr><td>monitor</td><td>监控方法执行的数据，例如：合计/成功/失败的数值，实时平均值失败比率等</td></tr><tr><td>stack</td><td>展示指定类和方法的调用栈信息</td></tr><tr><td>thread</td><td>展示线程信息和调用栈</td></tr><tr><td>trace</td><td>指定方法调用栈的执行时间</td></tr><tr><td>watch</td><td>展示指定方法的调用过程中，输入/输出的参数，结果返回值，异常抛出等</td></tr><tr><td>tt</td><td>时间隧道</td></tr><tr><td>jvm</td><td>展示目标jvm的信息</td></tr><tr><td>perfcounter</td><td>展示性能计数器的信息</td></tr><tr><td>ognl</td><td>执行ognl表达式</td></tr><tr><td>mc</td><td>内存编译器，将java文件在内存中编译成字节码和内存中的类文件</td></tr><tr><td>redefine</td><td>重新定义类，参考Instrumentation#redefineClasses(ClassDefinition…)</td></tr><tr><td>dashboard</td><td>预览目标jvm的线程，gc，环境变量，tomcat信息</td></tr><tr><td>dump</td><td>从jvm中转存类的字节码</td></tr><tr><td>heapdump</td><td>堆转存</td></tr><tr><td>options</td><td>查看和更改各种Arthas选项</td></tr><tr><td>cls</td><td>清理屏幕</td></tr><tr><td>reset</td><td>重置所有的增强类</td></tr><tr><td>version</td><td>展示Arthas版本</td></tr><tr><td>session</td><td>展示当前会话的信息</td></tr><tr><td>sysprop</td><td>展示，修改系统的配置</td></tr><tr><td>sysenv</td><td>展示系统环境变量</td></tr><tr><td>vmoption</td><td>展示修改vm诊断选项</td></tr><tr><td>logger</td><td>打印日志信息，修改日志级别</td></tr><tr><td>history</td><td>展示历史命令</td></tr><tr><td>cat</td><td>连接并打印文件内容，类似linux的cat命令</td></tr><tr><td>echo</td><td>将参数写入标准输出</td></tr><tr><td>pwd</td><td>返回工作目录名称</td></tr><tr><td>mbean</td><td>显示mbean信息</td></tr><tr><td>grep</td><td>用于管道的grep命令</td></tr><tr><td>tee</td><td>管道的tee命令</td></tr><tr><td>profiler</td><td>异步分析工具<a href="https://github.com/jvm-profiling-tools/async-profiler">https://github.com/jvm-profiling-tools/async-profiler</a></td></tr><tr><td>stop</td><td>停止/关闭Arthas服务器并退出控制台</td></tr></tbody></table><h4 id="2-1-2、redefine命令，替换指定源class文件"><a href="#2-1-2、redefine命令，替换指定源class文件" class="headerlink" title="2.1.2、redefine命令，替换指定源class文件"></a>2.1.2、redefine命令，替换指定源class文件</h4><p>redefine后的原来的类不能恢复，redefine也有可能失败（比如新增了field），reset命令对redefine无效，如果想重置，需要redefine原始的字节码。<br>不允许新增加field/method。<br>正在执行的函数，没有退出不能生效。</p><p>示例，替换接口的返回值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinSupportApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;这是正牌的接口结果&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>请求接口会返回一个字符串：“这是正牌的接口结果”。接下来通过arthas的redifine命令替换成接口返回成一个：“hello”   </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(value = &quot;/weixin&quot;, produces = MediaType.APPLICATION_JSON_VALUE)</span></span><br><span class="line"><span class="meta">@Slf4j</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WeixinSupportApi</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GetMapping(&quot;/test/&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">test</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;hello&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">```  </span><br><span class="line">方式一、 </span><br><span class="line">将上述的java文件编译成<span class="class"><span class="keyword">class</span>文件,上传到服务器，使用<span class="title">redefine</span>命令,开始替换：</span></span><br><span class="line"><span class="class">```<span class="title">shell</span></span></span><br><span class="line"><span class="class"><span class="title">redefine</span> <span class="title">weixin</span>/<span class="title">WeixinSupportApi</span>.<span class="title">class</span></span></span><br></pre></td></tr></table></figure><p>方式二、</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">//通过jad将class 文件编译成java文件</span><br><span class="line">jad --source-only com.yiyi.api.WeixinSupportApi &gt; weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java</span><br><span class="line">//通过vim对文件进行编辑，实现我们想要的一个逻辑</span><br><span class="line">vim weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java</span><br><span class="line">//通过mc 内存编译，将上面的java文件编译成class 代码</span><br><span class="line">mc weixin/src/main/java/com/yiyi/api/WeixinSupportApi.java -d weixin</span><br><span class="line"><span class="meta">-&gt;</span><span class="bash">输出编译后的class 文件地址：</span></span><br><span class="line">Memory compiler output:</span><br><span class="line">/Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.class</span><br><span class="line">Affect(row-cnt:1) cost in 1467 ms.</span><br><span class="line">//redefine 替换内存中的class文件为刚才编译的class 文件</span><br><span class="line">redefine /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/com/yiyi/api/WeixinSupportApi.class</span><br><span class="line">即可实现对源class 的编辑，并且进行热部署。。</span><br></pre></td></tr></table></figure><h4 id="2-1-3、headdump命令"><a href="#2-1-3、headdump命令" class="headerlink" title="2.1.3、headdump命令"></a>2.1.3、headdump命令</h4><p>dump java heap，类似jmap命令的heap dump功能</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//dump到指定的文件</span><br><span class="line">heapdump ./dump.hprof</span><br><span class="line">//只dump live对象</span><br><span class="line">heapdump --live ./dump.hprof</span><br><span class="line">//dump到临时文件</span><br><span class="line">heapdump</span><br></pre></td></tr></table></figure><h4 id="2-1-4、classloader的命令"><a href="#2-1-4、classloader的命令" class="headerlink" title="2.1.4、classloader的命令"></a>2.1.4、classloader的命令</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line">//按类加载类型查看统计信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader</span> </span><br><span class="line"> name                                                numberOfInstances  loadedCountTotal                                                                            </span><br><span class="line"> sun.misc.Launcher$AppClassLoader                    1                  4440                                                                                        </span><br><span class="line"> BootstrapClassLoader                                1                  2932                                                                                        </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader           1                  2095                                                                                        </span><br><span class="line"> lombok.launch.ShadowClassLoader                     1                  242                                                                                         </span><br><span class="line"> sun.reflect.DelegatingClassLoader                   77                 77                                                                                          </span><br><span class="line"> sun.misc.Launcher$ExtClassLoader                    1                  4                                                                                           </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader  2                  2                                                                                           </span><br><span class="line"> sun.reflect.misc.MethodUtil                         1                  1                                                                                           </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//按类加载实例查看统计信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -l</span></span><br><span class="line"> name                                                         loadedCount  hash      parent                                                                         </span><br><span class="line"> BootstrapClassLoader                                         2932         null      null                                                                           </span><br><span class="line"> com.taobao.arthas.agent.ArthasClassloader@3c708a1d           2095         3c708a1d  sun.misc.Launcher$ExtClassLoader@770c2e6b                                      </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader@1060b431  1            1060b431  null                                                                           </span><br><span class="line"> javax.management.remote.rmi.NoCallStackClassLoader@63440df3  1            63440df3  null                                                                           </span><br><span class="line"> lombok.launch.ShadowClassLoader@1756d9eb                     242          1756d9eb  sun.misc.Launcher$AppClassLoader@18b4aac2                                      </span><br><span class="line"> sun.misc.Launcher$AppClassLoader@18b4aac2                    4440         18b4aac2  sun.misc.Launcher$ExtClassLoader@770c2e6b                                      </span><br><span class="line"> sun.misc.Launcher$ExtClassLoader@770c2e6b                    4            770c2e6b  null                                                                           </span><br><span class="line"> sun.reflect.misc.MethodUtil@2c109df9                         1            2c109df9  sun.misc.Launcher$AppClassLoader@18b4aac2                                      </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">// 查看classloader的继承树</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -t</span></span><br><span class="line">+-BootstrapClassLoader                                                                                                                                              </span><br><span class="line">+-javax.management.remote.rmi.NoCallStackClassLoader@1060b431                                                                                                       </span><br><span class="line">+-javax.management.remote.rmi.NoCallStackClassLoader@63440df3                                                                                                       </span><br><span class="line">+-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                                         </span><br><span class="line">  +-com.taobao.arthas.agent.ArthasClassloader@3c708a1d                                                                                                              </span><br><span class="line">  +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                                       </span><br><span class="line">    +-lombok.launch.ShadowClassLoader@1756d9eb                                                                                                                      </span><br><span class="line">    +-sun.reflect.misc.MethodUtil@2c109df9                                                                                                                          </span><br><span class="line">Affect(row-cnt:8) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//查看URLClassloader的实际urls</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 770c2e6b</span></span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunec.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/nashorn.jar                                                                       </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/cldrdata.jar                                                                      </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jfxrt.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/dnsns.jar                                                                         </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/localedata.jar                                                                    </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunjce_provider.jar                                                               </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar                                                              </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar                                                              </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/sunpkcs11.jar                                                                     </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/jaccess.jar                                                                       </span><br><span class="line">file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/zipfs.jar                                                                         </span><br><span class="line">file:/System/Library/Java/Extensions/MRJToolkit.jar                                                                                                                 </span><br><span class="line">Affect(row-cnt:84) cost in 5 ms.</span><br><span class="line"></span><br><span class="line">//尝试查找类的class文件</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 770c2e6b -r java/lang/String.class jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/rt.jar!/java/lang/String.class</span>                                                   </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 4 ms.</span><br><span class="line"></span><br><span class="line">//使用classloader加载类</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader -c 2c109df9 --load com.yiyi.api.WeixinSupportApi</span></span><br><span class="line">load class success.</span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//使用classloader去查找resource</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> classloader  -c 2c109df9 -r META-INF/MANIFEST.MF</span></span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk16-143.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> jar:file:/System/Library/Java/Extensions/MRJToolkit.jar!/META-INF/MANIFEST.MF                                                                                      </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/charsets.jar!/META-INF/MANIFEST.MF                                               </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/deploy.jar!/META-INF/MANIFEST.MF                                                 </span><br><span class="line"> jar:file:/Library/Java/JavaVirtualMachines/jdk1.8.0_241.jdk/Contents/Home/jre/lib/ext/bcprov-jdk15-135.jar!/META-INF/MANIFEST.MF                                   </span><br><span class="line"> </span><br></pre></td></tr></table></figure><h4 id="2-1-4、getstatic获取类中的静态属性"><a href="#2-1-4、getstatic获取类中的静态属性" class="headerlink" title="2.1.4、getstatic获取类中的静态属性"></a>2.1.4、getstatic获取类中的静态属性</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> getstatic com.yiyi.api.WeixinSupportApi CORP_ID</span></span><br><span class="line">field: CORP_ID</span><br><span class="line">@String[ww91156f2c9067a7ba]</span><br><span class="line">Affect(row-cnt:1) cost in 4 ms.</span><br></pre></td></tr></table></figure><p>如果对象是一个复杂的对象，可以使用OGNL表达式进行遍历,过滤</p><h4 id="2-1-5、tt命令，记录调用记录"><a href="#2-1-5、tt命令，记录调用记录" class="headerlink" title="2.1.5、tt命令，记录调用记录"></a>2.1.5、tt命令，记录调用记录</h4><p>方法执行记录的隧道，记录指定方法每次调用的入参和返回的信息，并能对这些不同时间下的调用进行观测。   </p><p>tt的调用方式：<br>|选项|描述|<br>|-|-|<br>|-d,–delete|删除索引指定的时间片段|<br>|–delete-all|删除所有的时间片段|<br>|-x,–expand  value|展开对象级别(默认为1)|<br>|-h,–help|命令使用指南|<br>|-i,–index value|展示指定的时间片段的相信信息|<br>|-n,–limits value|执行时间阈值|<br>|-l,–list|展示所有的时间片段的信息|<br>|–listenerId value|指定监听id|<br>|-p,–play|重放由索引指定的时间片段|<br>|-E,–regex|启用正则表达式匹配(默认情况下为通配符匹配)|<br>|–replay-interval value|选项r大于1的tt的回放间隔|<br>|–replay-times value|执行tt时的次数|<br>|-s,–search-express value|搜索表达式，用ognl表达式搜索时间片段。|<br>||advice的结构类似条件式表达|<br>|-M,–sizeLimit value|结果的字节上限(默认为10<em>1024</em>1024)|<br>|-t,–time-tunnel|在时间片段内记录方法调用|<br>|-w,–watch-express value&gt;|观看ognlexpress的时间片段|<br>|class-pattern|模式匹配的路径和类名|<br>|method-pattern|模式匹配法|<br>|condition-express|ognl风格的条件表达式|</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">//记录调用</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -t com.yiyi.api.WeixinSupportApi <span class="built_in">test</span></span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 129 ms, listenerId: 1</span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000      2020-07-06 17:21:20       0.531715    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1001      2020-07-06 17:21:24       0.026004    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1002      2020-07-06 17:21:27       0.027567    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1003      2020-07-06 17:21:28       0.064779    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"></span><br><span class="line">//展示时间片列表</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -l</span></span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1000      2020-07-06 17:21:20       0.531715    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1001      2020-07-06 17:21:24       0.026004    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1002      2020-07-06 17:21:27       0.027567    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line"> 1003      2020-07-06 17:21:28       0.064779    true      false      0x437d2cf          WeixinSupportApi                      test                                 </span><br><span class="line">Affect(row-cnt:4) cost in 1 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//展示时间片的具体信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1000</span></span><br><span class="line"> INDEX         1000                                                                                                                                                 </span><br><span class="line"> GMT-CREATE    2020-07-06 17:21:20                                                                                                                                  </span><br><span class="line"> COST(ms)      0.531715                                                                                                                                             </span><br><span class="line"> OBJECT        0x437d2cf                                                                                                                                            </span><br><span class="line"> CLASS         com.yiyi.api.WeixinSupportApi                                                                                                                        </span><br><span class="line"> METHOD        test                                                                                                                                                 </span><br><span class="line"> IS-RETURN     true                                                                                                                                                 </span><br><span class="line"> IS-EXCEPTION  false                                                                                                                                                </span><br><span class="line"> RETURN-OBJ    @String[hello]                                                                                                                                       </span><br><span class="line">Affect(row-cnt:1) cost in 1 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//重新调用索引为1000的调用</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1000 -p</span></span><br><span class="line"> RE-INDEX      1000                                                                                                                                                 </span><br><span class="line"> GMT-REPLAY    2020-07-06 17:22:10                                                                                                                                  </span><br><span class="line"> OBJECT        0x437d2cf                                                                                                                                            </span><br><span class="line"> CLASS         com.yiyi.api.WeixinSupportApi                                                                                                                        </span><br><span class="line"> METHOD        test                                                                                                                                                 </span><br><span class="line"> IS-RETURN     true                                                                                                                                                 </span><br><span class="line"> IS-EXCEPTION  false                                                                                                                                                </span><br><span class="line"> COST(ms)      0.260785                                                                                                                                             </span><br><span class="line"> RETURN-OBJ    @String[hello]                                                                                                                                       </span><br><span class="line">Time fragment[1000] successfully replayed 1 times.</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> </span></span><br></pre></td></tr></table></figure><table><thead><tr><th>表格字段</th><th>字段解释</th></tr></thead><tbody><tr><td>INDEX</td><td>时间片段记录编号，每一个编号代表着一次调用，后续tt还有很多命令都是基于此编号指定记录操作，非常重要。</td></tr><tr><td>TIMESTAMP</td><td>方法执行的本机时间，记录了这个时间片段所发生的本机时间</td></tr><tr><td>COST(ms)</td><td>方法执行的耗时</td></tr><tr><td>IS-RET</td><td>方法是否以正常返回的形式结束</td></tr><tr><td>IS-EXP</td><td>方法是否以抛异常的形式结束</td></tr><tr><td>OBJECT</td><td>执行对象的hashCode()，注意，曾经有人误认为是对象在JVM中的内存地址，但很遗憾他不是。但他能帮助你简单的标记当前执行方法的类实体</td></tr><tr><td>CLASS</td><td>执行的类名</td></tr><tr><td>METHOD</td><td>执行的方法名</td></tr></tbody></table><p>使用OGNL表达式，对调用参数进行过滤监听。</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -t com.yiyi.api.WeixinSupportApi sendMessage <span class="string">&#x27;params[0].text.content==&quot;test&quot;&#x27;</span></span></span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 72 ms, listenerId: 5</span><br><span class="line"> INDEX     TIMESTAMP                 COST(ms)    IS-RET    IS-EXP     OBJECT             CLASS                                 METHOD                               </span><br><span class="line">--------------------------------------------------------------------------------------------------------------------------------------------------------------------</span><br><span class="line"> 1004      2020-07-06 17:33:42       354.578854  true      false      0x437d2cf          WeixinSupportApi                      sendMessage                          </span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> tt -i 1004</span></span><br><span class="line"> INDEX          1004                                                                                                                                                </span><br><span class="line"> GMT-CREATE     2020-07-06 17:33:42                                                                                                                                 </span><br><span class="line"> COST(ms)       354.578854                                                                                                                                          </span><br><span class="line"> OBJECT         0x437d2cf                                                                                                                                           </span><br><span class="line"> CLASS          com.yiyi.api.WeixinSupportApi                                                                                                                       </span><br><span class="line"> METHOD         sendMessage                                                                                                                                         </span><br><span class="line"> IS-RETURN      true                                                                                                                                                </span><br><span class="line"> IS-EXCEPTION   false                                                                                                                                               </span><br><span class="line"> PARAMETERS[0]  @SendMessageVO[                                                                                                                                     </span><br><span class="line">                    touser=@String[Feng],                                                                                                                           </span><br><span class="line">                    msgtype=@String[text],                                                                                                                          </span><br><span class="line">                    agentid=@Integer[1000036],                                                                                                                      </span><br><span class="line">                    text=@Text[com.yiyi.model.SendMessageVO$Text@504511d7],                                                                                         </span><br><span class="line">                    safe=@Integer[0],                                                                                                                               </span><br><span class="line">                ]                                                                                                                                                   </span><br><span class="line"> RETURN-OBJ     @WeixinResponse[                                                                                                                                    </span><br><span class="line">                    errcode=@Integer[0],                                                                                                                            </span><br><span class="line">                    errmsg=@String[ok],                                                                                                                             </span><br><span class="line">                    invaliduser=@String[],                                                                                                                          </span><br><span class="line">                ]                                                                                                                                                   </span><br><span class="line">Affect(row-cnt:1) cost in 1 ms.</span><br></pre></td></tr></table></figure><h4 id="2-1-6、使用sc查看jvm已加载的类信息"><a href="#2-1-6、使用sc查看jvm已加载的类信息" class="headerlink" title="2.1.6、使用sc查看jvm已加载的类信息"></a>2.1.6、使用sc查看jvm已加载的类信息</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line">//模糊匹配，查看某个包下面的类加载信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc com.yiyi.*</span></span><br><span class="line">com.yiyi.Application</span><br><span class="line">com.yiyi.Application$$EnhancerBySpringCGLIB$$7f85004e</span><br><span class="line">com.yiyi.WebConfig</span><br><span class="line">com.yiyi.WebConfig$$EnhancerBySpringCGLIB$$bf76c934</span><br><span class="line">com.yiyi.api.WeixinSupportApi</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$451/966754950</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$467/1545239474</span><br><span class="line">com.yiyi.api.WeixinSupportApi$$Lambda$468/1304820993</span><br><span class="line">com.yiyi.model.AccessTokenVo</span><br><span class="line">com.yiyi.model.SendMessageVO</span><br><span class="line">com.yiyi.model.SendMessageVO$Text</span><br><span class="line">com.yiyi.model.WeixinResponse</span><br><span class="line">Affect(row-cnt:12) cost in 15 ms.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">//指定类的详细信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc -d com.yiyi.api.WeixinSupportApi</span></span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                         </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 8 ms.</span><br><span class="line"></span><br><span class="line">// 指定类的加载信息以及属性字段的信息</span><br><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> sc -d -f com.yiyi.api.WeixinSupportApi</span></span><br><span class="line"> class-info        com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> code-source       /Users/wuxuan.chai/Documents/project/springboot-learn/weixin/target/classes/                                                                     </span><br><span class="line"> name              com.yiyi.api.WeixinSupportApi                                                                                                                    </span><br><span class="line"> isInterface       false                                                                                                                                            </span><br><span class="line"> isAnnotation      false                                                                                                                                            </span><br><span class="line"> isEnum            false                                                                                                                                            </span><br><span class="line"> isAnonymousClass  false                                                                                                                                            </span><br><span class="line"> isArray           false                                                                                                                                            </span><br><span class="line"> isLocalClass      false                                                                                                                                            </span><br><span class="line"> isMemberClass     false                                                                                                                                            </span><br><span class="line"> isPrimitive       false                                                                                                                                            </span><br><span class="line"> isSynthetic       false                                                                                                                                            </span><br><span class="line"> simple-name       WeixinSupportApi                                                                                                                                 </span><br><span class="line"> modifier          public                                                                                                                                           </span><br><span class="line"> annotation        org.springframework.web.bind.annotation.RestController,org.springframework.web.bind.annotation.RequestMapping                                    </span><br><span class="line"> interfaces                                                                                                                                                         </span><br><span class="line"> super-class       +-java.lang.Object                                                                                                                               </span><br><span class="line"> class-loader      +-sun.misc.Launcher$AppClassLoader@18b4aac2                                                                                                      </span><br><span class="line">                     +-sun.misc.Launcher$ExtClassLoader@770c2e6b                                                                                                    </span><br><span class="line"> classLoaderHash   18b4aac2                                                                                                                                         </span><br><span class="line"> fields            name     log                                                                                                                                     </span><br><span class="line">                   type     org.slf4j.Logger                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    Logger[com.yiyi.api.WeixinSupportApi]                                                                                                   </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name       response                                                                                                                              </span><br><span class="line">                   type       javax.servlet.http.HttpServletResponse                                                                                                </span><br><span class="line">                   modifier   private                                                                                                                               </span><br><span class="line">                   annotation javax.annotation.Resource                                                                                                             </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     CORP_ID                                                                                                                                 </span><br><span class="line">                   type     java.lang.String                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    ww91156f2c9067a7ba                                                                                                                      </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     APP_SECRET                                                                                                                              </span><br><span class="line">                   type     java.lang.String                                                                                                                        </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    r5ifq9RFqtsL34sdWXmrzMytY7KYksz5cAimzoH1jeg                                                                                             </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line">                   name     ACCESS_TOKEN_CACHE                                                                                                                      </span><br><span class="line">                   type     com.google.common.cache.Cache                                                                                                           </span><br><span class="line">                   modifier final,private,static                                                                                                                    </span><br><span class="line">                   value    com.google.common.cache.LocalCache$LocalManualCache@39373908                                                                            </span><br><span class="line">                                                                                                                                                                    </span><br><span class="line"></span><br><span class="line">Affect(row-cnt:1) cost in 10 ms.</span><br></pre></td></tr></table></figure><h4 id="2-1-7、mc，内存编译"><a href="#2-1-7、mc，内存编译" class="headerlink" title="2.1.7、mc，内存编译"></a>2.1.7、mc，内存编译</h4><p>Memory Compiler/内存编译器，编译.java 生成.class文件</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc /tmp/Test.java</span><br></pre></td></tr></table></figure><p>可以通过-c指定classloader：</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -c 327a647b /tmp/Test.java</span><br></pre></td></tr></table></figure><p>可以通过-d指定输出的class文件的目录</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mc -d /tmp/output /tmp/ClassA.java /tmp/ClassB.java</span><br></pre></td></tr></table></figure><p>编译成的.class文件后，可以结合redefine命令实现热更新代码</p><p>注意，mc命令有可能失败。如果编译失败可以在本地编译好.class文件，再上传到服务器。</p><h4 id="2-1-8、查看方法的stack"><a href="#2-1-8、查看方法的stack" class="headerlink" title="2.1.8、查看方法的stack"></a>2.1.8、查看方法的stack</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">[arthas@89977]$</span><span class="bash"> stack com.yiyi.api.WeixinSupportApi getAccessToken</span> </span><br><span class="line">Press Q or Ctrl+C to abort.</span><br><span class="line">Affect(class count: 1 , method count: 1) cost in 43 ms, listenerId: 8</span><br><span class="line">ts=2020-07-06 17:50:49;thread_name=http-nio-7070-exec-2;id=83;is_daemon=true;priority=5;TCCL=org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedWebappClassLoader@2fc07784</span><br><span class="line">    @com.yiyi.api.WeixinSupportApi.getAccessToken()</span><br><span class="line">        at com.yiyi.api.WeixinSupportApi.sendMessage(WeixinSupportApi.java:68)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke0(NativeMethodAccessorImpl.java:-2)</span><br><span class="line">        at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)</span><br><span class="line">        at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)</span><br><span class="line">        at java.lang.reflect.Method.invoke(Method.java:498)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.doInvoke(InvocableHandlerMethod.java:190)</span><br><span class="line">        at org.springframework.web.method.support.InvocableHandlerMethod.invokeForRequest(InvocableHandlerMethod.java:138)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.ServletInvocableHandlerMethod.invokeAndHandle(ServletInvocableHandlerMethod.java:105)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.invokeHandlerMethod(RequestMappingHandlerAdapter.java:879)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.annotation.RequestMappingHandlerAdapter.handleInternal(RequestMappingHandlerAdapter.java:793)</span><br><span class="line">        at org.springframework.web.servlet.mvc.method.AbstractHandlerMethodAdapter.handle(AbstractHandlerMethodAdapter.java:87)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doDispatch(DispatcherServlet.java:1040)</span><br><span class="line">        at org.springframework.web.servlet.DispatcherServlet.doService(DispatcherServlet.java:943)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.processRequest(FrameworkServlet.java:1006)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.doPost(FrameworkServlet.java:909)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:660)</span><br><span class="line">        at org.springframework.web.servlet.FrameworkServlet.service(FrameworkServlet.java:883)</span><br><span class="line">        at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.springframework.web.filter.CharacterEncodingFilter.doFilterInternal(CharacterEncodingFilter.java:201)</span><br><span class="line">        at org.springframework.web.filter.OncePerRequestFilter.doFilter(OncePerRequestFilter.java:119)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)</span><br><span class="line">        at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)</span><br><span class="line">        at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:202)</span><br><span class="line">        at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)</span><br><span class="line">        at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:541)</span><br><span class="line">        at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)</span><br><span class="line">        at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)</span><br><span class="line">        at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)</span><br><span class="line">        at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)</span><br><span class="line">        at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:373)</span><br><span class="line">        at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)</span><br><span class="line">        at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)</span><br><span class="line">        at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)</span><br><span class="line">        at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)</span><br><span class="line">        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)</span><br><span class="line">        at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)</span><br><span class="line">        at java.lang.Thread.run(Thread.java:748)</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>也可以使用OGNL表达式，对请求参数进行过滤，或者使用执行时间进行过滤</p><h3 id="2-2-1、Springboot集成arthas"><a href="#2-2-1、Springboot集成arthas" class="headerlink" title="2.2.1、Springboot集成arthas"></a>2.2.1、Springboot集成arthas</h3><p>引入arthas的依赖</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">arthas.version</span>&gt;</span>3.3.6<span class="tag">&lt;/<span class="name">arthas.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.taobao.arthas<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>arthas-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;arthas.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure><p>应用配置：application.properties</p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">//指定arthas的agentId</span></span><br><span class="line"><span class="meta">arthas.agentId</span>=<span class="string">weixin</span></span><br><span class="line"><span class="meta">//arthas</span> <span class="string">tunnel server 的websocket的地址</span></span><br><span class="line"><span class="meta">arthas.tunnel-server</span>=<span class="string">ws://localhost:7777/ws</span></span><br></pre></td></tr></table></figure><p>重启应用</p><h3 id="2-2-2、通过浏览器连接arthas"><a href="#2-2-2、通过浏览器连接arthas" class="headerlink" title="2.2.2、通过浏览器连接arthas"></a>2.2.2、通过浏览器连接arthas</h3><p>第一步：下载arthas tunnel server<br>wget <a href="https://github.com/alibaba/arthas/releases/download/arthas-all-3.3.6/arthas-tunnel-server-3.3.6.jar">https://github.com/alibaba/arthas/releases/download/arthas-all-3.3.6/arthas-tunnel-server-3.3.6.jar</a><br>第二步：启动arthas tunnel server</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -jar arthas-tunnel-server.jar -server.port=8888 启动并指定web的端口</span><br></pre></td></tr></table></figure><p>这个服务有两个socket连接方式，一个正常的http，用的端口是我们指定的8888，还有一个就是供显示服务器的命令行的websocket连接，端口7777<br>第三步：<br>访问arthas tunnel server ，我是本机测试，所以就是localhost:8888,如图：</p><p><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/arthas-index.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/arthas-index.png" srcset="data:image/png;base64,666" alt="首页"></p><p>连接指定的应用：<br><img src="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/connect-arthas.png" class="lazyload" data-srcset="https://chai-wuxuan.oss-cn-shanghai.aliyuncs.com/img/connect-arthas.png" srcset="data:image/png;base64,666" alt="连接成功"></p><p>默认情况下，连接地址为本地，websocket的端口为7777</p><h3 id="三、总结"><a href="#三、总结" class="headerlink" title="三、总结"></a>三、总结</h3><p>Arthas贵为java应用诊断神器，对于应用的资源占用，性能分析，jvm监控都有很大的支持帮助。除此之外，在排查线上问题时，可以监听对应的方法的调用，以及动态修改class类，很湿，很方便。而且Arthas对docker的java进程，以及k8s都有很好的支持，后续用到的时候在做学习。</p>]]></content>
      
      
      
        <tags>
            
            <tag> Arthas </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>通过Jackson玩转Json</title>
      <link href="/dist/2021/01/17/%E9%80%9A%E8%BF%87Jackson%E7%8E%A9%E8%BD%ACJson/"/>
      <url>/dist/2021/01/17/%E9%80%9A%E8%BF%87Jackson%E7%8E%A9%E8%BD%ACJson/</url>
      
        <content type="html"><![CDATA[<h2 id="一、Jackson-注解示例"><a href="#一、Jackson-注解示例" class="headerlink" title="一、Jackson 注解示例"></a>一、Jackson 注解示例</h2><h3 id="1-1、简介"><a href="#1-1、简介" class="headerlink" title="1.1、简介"></a>1.1、简介</h3><p>在本章中，我们将深入探讨Jackson注解。我们将看到如何使用现有的注解，如何创建自定义注解，最后-如何禁用它们。  </p><h3 id="1-2、maven-依赖"><a href="#1-2、maven-依赖" class="headerlink" title="1.2、maven 依赖"></a>1.2、maven 依赖</h3><p>首先，将jackson-databind依赖项添加到pom.xml：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 或者 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.dataformat<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-dataformat-xml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure><p>此依赖项还将在类路径中可传递地添加以下库：</p><ol><li>jackson-annotations-2.9.8.jar  </li><li>jackson-core-2.9.8.jar  </li><li>jackson-databind-2.9.8.jar </li></ol><h3 id="1-3、Jackson序列化注解"><a href="#1-3、Jackson序列化注解" class="headerlink" title="1.3、Jackson序列化注解"></a>1.3、Jackson序列化注解</h3><p>首先，我们来看看序列化注解。  </p><h4 id="1-3-1、-JsonAnyGetter"><a href="#1-3-1、-JsonAnyGetter" class="headerlink" title="1.3.1、@JsonAnyGetter"></a>1.3.1、@JsonAnyGetter</h4><p>{@JsonAnyGetter } 注解允许灵活地使用Map字段作为标准属性。<br>这是一个简单的示例– ExtendableBean实体具有name属性和一组以键/值对形式的可扩展属性,我们还可以使用启用为false的可选参数来禁用@JsonAnyGetter()。 在这种情况下，Map将转换为JSON，并在序列化后显示在properties变量下。  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAnyGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Maps;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 9:44 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties1;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnyGetter(enabled = false)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String, Object&gt; <span class="title">getProperties</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnyGetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">getProperties1</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> properties1;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        ExtendableBean extendableBean = <span class="keyword">new</span> ExtendableBean();</span><br><span class="line">        extendableBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        Map&lt;String, Object&gt; map = Maps.newHashMap();</span><br><span class="line">        map.put(<span class="string">&quot;age&quot;</span>,<span class="number">11</span>);</span><br><span class="line">        map.put(<span class="string">&quot;sex&quot;</span>,<span class="string">&quot;male&quot;</span>);</span><br><span class="line">        extendableBean.setProperties(map);</span><br><span class="line">        Map&lt;String, Object&gt; map1 = Maps.newHashMap();</span><br><span class="line">        map1.put(<span class="string">&quot;work&quot;</span>,<span class="string">&quot;java pg&quot;</span>);</span><br><span class="line">        map1.put(<span class="string">&quot;no&quot;</span>,<span class="number">1</span>);</span><br><span class="line">        extendableBean.setProperties1(map1);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(extendableBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// result:  &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;properties&quot;:&#123;&quot;sex&quot;:&quot;male&quot;,&quot;age&quot;:11&#125;,&quot;no&quot;:1,&quot;work&quot;:&quot;java pg&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-1、-JsonGetter"><a href="#1-3-1、-JsonGetter" class="headerlink" title="1.3.1、@JsonGetter"></a>1.3.1、@JsonGetter</h4><p>@JsonGetter注解是@JsonProperty注解的替代方法将方法标记为getter方法。<br>在以下示例中，我们将方法getTheName() 指定为MyBeanentity的name属性的getter方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:06 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonGetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-3、-JsonPropertyOrder"><a href="#1-3-3、-JsonPropertyOrder" class="headerlink" title="1.3.3、@JsonPropertyOrder"></a>1.3.3、@JsonPropertyOrder</h4><p>我们可以使用@JsonPropertyOrder批注指定序列化属性的顺序。让我们为MyBean实体的属性设置自定义顺序：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonGetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.NoArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.naming.Name;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:06 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonGetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> JsonProcessingException </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还可以使用@JsonPropertyOrder（alphabetic = true）按字母顺序对属性进行排序。 在这种情况下，序列化的输出将是：</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span><br></pre></td></tr></table></figure><h4 id="1-3-4、-JsonRawValue"><a href="#1-3-4、-JsonRawValue" class="headerlink" title="1.3.4、@JsonRawValue"></a>1.3.4、@JsonRawValue</h4><p>@JsonRawValue批注可以指示Jackson完全按原样序列化属性。在以下示例中，我们使用@JsonRawValue嵌入一些自定义JSON作为实体的值：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRawValue;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:15 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RawBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonRawValue(false)</span></span><br><span class="line">    <span class="keyword">public</span> String json;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        RawBean rawBean = <span class="keyword">new</span> RawBean();</span><br><span class="line">        rawBean.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        rawBean.setJson(<span class="string">&quot;&#123;\&quot;raw\&quot;:false&#125;&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(rawBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//@JsonRawValue result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&#123;&quot;raw&quot;:false&#125;&#125;</span></span><br><span class="line">        <span class="comment">//@JsonRawValue(false) result: &#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;json&quot;:&quot;&#123;\&quot;raw\&quot;:false&#125;&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>我们还可以使用可选的布尔参数值来定义此注解是否处于活动状态。</p><h4 id="1-3-5、-JsonValue"><a href="#1-3-5、-JsonValue" class="headerlink" title="1.3.5、@JsonValue"></a>1.3.5、@JsonValue</h4><p>@JsonValue表示库将用于序列化整个实例的单个方法。例如，在一个枚举中，我们用@JsonValue注解getName，以便任何这样的实体都通过其名称序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonValue;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:23 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">TypeEnumWithValue</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试枚举序列化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    TYPE1(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>),</span><br><span class="line">    TYPE2(<span class="number">2</span>, <span class="string">&quot;yiyi&quot;</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">getId</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> id;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonValue</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getName</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(TYPE1);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &quot;wuxuan&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-3-6、-JsonRootName"><a href="#1-3-6、-JsonRootName" class="headerlink" title="1.3.6、@JsonRootName"></a>1.3.6、@JsonRootName</h4><p>如果启用了包装，则使用@JsonRootName批注指定要使用的根包装的名称。包装意味着不要将用户序列化为以下内容：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">  <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>而是序列化为：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">     <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>因此，让我们看一个示例–我们将使用@JsonRootName批注指示此潜在包装实体的名称：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRootName;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:30 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonRootName(&quot;user&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRoot userWithRoot = <span class="keyword">new</span> UserWithRoot();</span><br><span class="line">        userWithRoot.setId(<span class="number">1</span>);</span><br><span class="line">        userWithRoot.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        objectMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);</span><br><span class="line">        String json = objectMapper.writeValueAsString(userWithRoot);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:  &#123;&quot;user&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>默认情况下，包装器的名称将为类– UserWithRoot。 通过使用注解，我们得到了看上去更干净的用户：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;</span><br><span class="line">     <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>, </span><br><span class="line">     <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>从Jackson 2.4开始，新的可选参数名称空间可用于XML之类的数据格式。 如果添加它，它将成为标准名称的一部分：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonRootName;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.dataformat.xml.XmlMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:30 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonRootName(value = &quot;user&quot;,namespace = &quot;users&quot;)</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRoot</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRoot userWithRoot = <span class="keyword">new</span> UserWithRoot();</span><br><span class="line">        userWithRoot.setId(<span class="number">1</span>);</span><br><span class="line">        userWithRoot.setName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        XmlMapper xmlMapper = <span class="keyword">new</span> XmlMapper();</span><br><span class="line">        xmlMapper.enable(SerializationFeature.WRAP_ROOT_VALUE);</span><br><span class="line">        String xml = xmlMapper.writeValueAsString(userWithRoot);</span><br><span class="line">        System.out.println(xml);</span><br><span class="line"></span><br><span class="line"><span class="comment">//        result:</span></span><br><span class="line"><span class="comment">//        &lt;user xmlns=&quot;users&quot;&gt;</span></span><br><span class="line"><span class="comment">//            &lt;id xmlns=&quot;&quot;&gt;1&lt;/id&gt;</span></span><br><span class="line"><span class="comment">//            &lt;name xmlns=&quot;&quot;&gt;wuxuan&lt;/name&gt;</span></span><br><span class="line"><span class="comment">//        &lt;/user&gt;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>序列化的xmlMapper结果为：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">user</span> <span class="attr">xmlns</span>=<span class="string">&quot;users&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">xmlns</span>=<span class="string">&quot;&quot;</span>&gt;</span>1<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">name</span> <span class="attr">xmlns</span>=<span class="string">&quot;&quot;</span>&gt;</span>wuxuan<span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="1-3-6、-JsonSerialize"><a href="#1-3-6、-JsonSerialize" class="headerlink" title="1.3.6、@JsonSerialize"></a>1.3.6、@JsonSerialize</h4><p>@JsonSerialize表示在编组实体时要使用的自定义序列化程序。让我们看一个简单的例子。 我们将使用@JsonSerialize通过CustomDateSerializer序列化eventDate属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.entity;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonSerialize;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.annotation.support.CustomDateSerializer;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 10:45 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonSerialize(using = CustomDateSerializer.class)</span></span><br><span class="line">    <span class="keyword">public</span> Date eventDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyy hh:mm:ss&quot;</span>);</span><br><span class="line"></span><br><span class="line">        Event event = <span class="keyword">new</span> Event();</span><br><span class="line">        event.setName(<span class="string">&quot;wuxuan coming&quot;</span>);</span><br><span class="line">        Date eventDate = <span class="keyword">new</span> Date();</span><br><span class="line">        event.setEventDate(eventDate);</span><br><span class="line">        System.out.println(simpleDateFormat.format(eventDate));</span><br><span class="line"></span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(event);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: 08-06-2020 10:54:12</span></span><br><span class="line">        <span class="comment">//result:  &#123;&quot;name&quot;:&quot;wuxuan coming&quot;,&quot;eventDate&quot;:&quot;08-06-2020 10:52:37&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-4、Jackson-反序列化的注解"><a href="#1-4、Jackson-反序列化的注解" class="headerlink" title="1.4、Jackson 反序列化的注解"></a>1.4、Jackson 反序列化的注解</h3><p>接下来，开始探索Jackson的反序列化的注解</p><h4 id="1-4-1、-JsonCreator"><a href="#1-4-1、-JsonCreator" class="headerlink" title="1.4.1、@JsonCreator"></a>1.4.1、@JsonCreator</h4><p>我们可以使用@JsonCreator批注来调整反序列化中使用的构造函数/工厂。 当我们需要反序列化某些与我们需要获取的目标实体不完全匹配的JSON时，这非常有用。<br>看下面的例子，我们需要反序列化这个json：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;the name&quot;</span>: <span class="string">&quot;wuxuan&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>但是，我们的目标实体中没有TheName字段-只有一个name字段。 现在，我们不想更改实体本身-我们只需要对解组过程进行更多控制-通过使用@JsonCreator注解构造函数并同时使用@JsonProperty注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:04 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCreator</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCreator</span><span class="params">(<span class="meta">@JsonProperty(&quot;id&quot;)</span> <span class="keyword">int</span> id,<span class="meta">@JsonProperty(&quot;the name&quot;)</span> String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;id\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;\&quot;the name\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        BeanWithCreator value = <span class="keyword">new</span> ObjectMapper().readerFor(BeanWithCreator.class).readValue(json);</span><br><span class="line">        System.out.println(value.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: BeanWithCreator(id=1, name=wuxuan)</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-2-JacksonInject"><a href="#1-4-2-JacksonInject" class="headerlink" title="1.4.2. @JacksonInject"></a>1.4.2. @JacksonInject</h4><p>@JacksonInject指示属性将从注入而不是从JSON数据获取其值。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JacksonInject;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.InjectableValues;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:15 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithInject</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JacksonInject</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;name\&quot;: \&quot;wuxuan\&quot;&#125;&quot;</span>;</span><br><span class="line">        InjectableValues.Std std = <span class="keyword">new</span> InjectableValues.Std().addValue(<span class="keyword">int</span>.class, <span class="number">1</span>);</span><br><span class="line">        BeanWithInject beanWithInject  = <span class="keyword">new</span> ObjectMapper().reader(std).forType(BeanWithInject.class).readValue(json);</span><br><span class="line">        System.out.println(beanWithInject.id == <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-3-JsonAnySetter"><a href="#1-4-3-JsonAnySetter" class="headerlink" title="1.4.3. @JsonAnySetter"></a>1.4.3. @JsonAnySetter</h4><p>@JsonAnySetter使我们可以灵活地使用Map作为标准属性。 反序列化时，JSON的属性将被简单地添加到Map中。让我们看看它是如何工作的–我们将使用@JsonAnySetter反序列化实体ExtendableBean，将下列的json反序列化：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;My bean&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr2&quot;</span>:<span class="string">&quot;val2&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;attr1&quot;</span>:<span class="string">&quot;val1&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>如何使用@JsonAnySetter注解：  </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAnySetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:21 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExtendableBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,Object&gt; properties = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonAnySetter</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(String key,String value)</span></span>&#123;</span><br><span class="line">        properties.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;:\&quot;My bean\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;attr2\&quot;:\&quot;val2\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;attr1\&quot;:\&quot;val1\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ExtendableBean extendableBean = <span class="keyword">new</span> ObjectMapper().readerFor(ExtendableBean.class).readValue(json);</span><br><span class="line">        System.out.println(extendableBean.toString());</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: ExtendableBean(name=My bean, properties=&#123;attr2=val2, attr1=val1&#125;)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-4-JsonSetter"><a href="#1-4-4-JsonSetter" class="headerlink" title="1.4.4. @JsonSetter"></a>1.4.4. @JsonSetter</h4><p>@JsonSetter是@JsonProperty的替代方法––将方法标记为设置方法。<br>当我们需要读取一些JSON数据但目标实体类与数据不完全匹配时，这非常有用，因此我们需要调整过程以使其适合。在以下示例中，我们将在MyBeanentity中将setTheName()方法指定为name属性的设置方法：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonSetter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:36 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String theName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonSetter(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.theName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;id\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;name\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> ObjectMapper().readerFor(MyBean.class).readValue(json);</span><br><span class="line">        System.out.println(myBean.getTheName().equals(<span class="string">&quot;wuxuan&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-5-JsonDeserialize"><a href="#1-4-5-JsonDeserialize" class="headerlink" title="1.4.5. @JsonDeserialize"></a>1.4.5. @JsonDeserialize</h4><p>@JsonDeserialize指示使用自定义解串器。<br>让我们看一下效果如何–我们将使用@JsonDeserialize通过CustomDateDeserializer反序列化eventDate属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.annotation.JsonDeserialize;</span><br><span class="line"><span class="keyword">import</span> com.yiyi.annotation.support.CustomDateDeserializer;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:41 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="meta">@JsonDeserialize(using = CustomDateDeserializer.class)</span></span><br><span class="line">    <span class="keyword">private</span> Date eventDate;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyy hh:mm:ss&quot;</span>);</span><br><span class="line">        Date parse = simpleDateFormat.parse(<span class="string">&quot;08-06-2020 10:52:37&quot;</span>);</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;name\&quot;:\&quot;wuxuan coming\&quot;,\&quot;eventDate\&quot;:\&quot;08-06-2020 10:52:37\&quot;&#125;&quot;</span>;</span><br><span class="line">        Event event = <span class="keyword">new</span> ObjectMapper().readerFor(Event.class)</span><br><span class="line">                .readValue(json);</span><br><span class="line">        System.out.println(parse.equals(event.eventDate));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-4-6-JsonAlias"><a href="#1-4-6-JsonAlias" class="headerlink" title="1.4.6. @JsonAlias"></a>1.4.6. @JsonAlias</h4><p>@JsonAlias在反序列化期间为属性定义一个或多个备用名称。 让我们用一个简单的例子来看看这个注解是如何工作的：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.deseizlize;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonAlias;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 11:52 上午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AliasBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonAlias(&#123;&quot;f_name&quot;,&quot;fName&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String firstName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String secondName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;f_name\&quot;: \&quot;chai\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;secondName\&quot;: \&quot;wuxuan\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        AliasBean aliasBean= <span class="keyword">new</span> ObjectMapper().readerFor(AliasBean.class).readValue(json);</span><br><span class="line">        System.out.println(aliasBean.getFirstName().equals(<span class="string">&quot;chai&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-5、Jackson多态类型处理注解"><a href="#1-5、Jackson多态类型处理注解" class="headerlink" title="1.5、Jackson多态类型处理注解"></a>1.5、Jackson多态类型处理注解</h3><p>接下来–让我们看一下Jackson的多态类型处理注解：</p><ul><li>@JsonTypeInfo - 指示要在序列化中包含哪些类型信息的详细信息</li><li>@JsonSubTypes - 指示带注解类型的子类型</li><li>@JsonTypeName - 定义用于注解类的逻辑类型名称<br>让我们看一个更复杂的示例，并使用全部三个@ JsonTypeInfo，@ JsonSubTypes和@JsonTypeName来序列化/反序列化实体Zoo：</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Dog dog = <span class="keyword">new</span> Dog();</span><br><span class="line">        dog.setName(<span class="string">&quot;wangwang&quot;</span>);</span><br><span class="line">        dog.setBackVolume(<span class="number">2.0</span>);</span><br><span class="line">        Zoo zoo = <span class="keyword">new</span> Zoo();</span><br><span class="line">        zoo.setAnimal(dog);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(zoo);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;animal&quot;:&#123;&quot;type&quot;:&quot;dog&quot;,&quot;name&quot;:&quot;wangwang&quot;,&quot;backVolume&quot;:2.0&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonSubTypes;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeInfo;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeInfo(use = JsonTypeInfo.Id.NAME, include = JsonTypeInfo.As.PROPERTY, property = &quot;type&quot;)</span></span><br><span class="line"><span class="meta">@JsonSubTypes(&#123;@JsonSubTypes.Type(value = Dog.class, name = &quot;dog&quot;), @JsonSubTypes.Type(value = Cat.class, name = &quot;cat&quot;)&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeName;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeName(&quot;dog&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Dog</span> <span class="keyword">extends</span> <span class="title">Animal</span> </span>&#123;</span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">double</span> backVolume;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonTypeName;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:56 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@JsonTypeName(&quot;cat&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Cat</span> <span class="keyword">extends</span> <span class="title">Animal</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> likesCream;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> lives;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>现在测试反序列化：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;animal&quot;</span>:</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="attr">&quot;type&quot;</span>:<span class="string">&quot;dog&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;name&quot;</span>:<span class="string">&quot;wangwang&quot;</span>,</span><br><span class="line">        <span class="attr">&quot;backVolume&quot;</span>:<span class="number">2.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.polymorphic;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 12:54 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Zoo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> Animal animal;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String dJson = <span class="string">&quot;&#123;\&quot;animal\&quot;:&#123;\&quot;type\&quot;:\&quot;dog\&quot;,\&quot;name\&quot;:\&quot;wangwang\&quot;,\&quot;backVolume\&quot;:2.0&#125;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        Zoo zoo1  = <span class="keyword">new</span> ObjectMapper().readerFor(Zoo.class).readValue(dJson);</span><br><span class="line">        System.out.println(zoo1);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: Zoo(animal=Dog(backVolume=2.0))</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-6、Jackson一般的注解"><a href="#1-6、Jackson一般的注解" class="headerlink" title="1.6、Jackson一般的注解"></a>1.6、Jackson一般的注解</h3><p>接下来，一起讨论一些jackson的一般注解</p><h4 id="1-6-1、-JsonProperty"><a href="#1-6-1、-JsonProperty" class="headerlink" title="1.6.1、@JsonProperty"></a>1.6.1、@JsonProperty</h4><p>我们可以添加@JsonProperty注解去表示在json中的属性名称，在处理非标准的getter和setter时，让我们使用@JsonProperty对属性名称进行序列化/反序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Getter;</span><br><span class="line"><span class="keyword">import</span> lombok.Setter;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 1:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Getter</span></span><br><span class="line">    <span class="meta">@Setter</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String theName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setTheName</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.theName = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;name&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getTheName</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> theName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyBean myBean = <span class="keyword">new</span> MyBean();</span><br><span class="line">        myBean.setId(<span class="number">1</span>);</span><br><span class="line">        myBean.setTheName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myBean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        MyBean myBean1 = <span class="keyword">new</span> ObjectMapper().readerFor(MyBean.class).readValue(json);</span><br><span class="line">        System.out.println(myBean1.theName.equals(myBean.theName));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//reasult:</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">//&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">        <span class="comment">//true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-2、-JsonFormat"><a href="#1-6-2、-JsonFormat" class="headerlink" title="1.6.2、@JsonFormat"></a>1.6.2、@JsonFormat</h4><p>@JsonFormat批注指定序列化日期/时间值时的格式。在下面的示例中，我们使用@JsonFormat来控制属性eventDate的格式：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFormat;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 1:53 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Getter</span></span><br><span class="line"><span class="meta">@Setter</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Event</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonFormat(shape = JsonFormat.Shape.STRING,pattern = &quot;dd-MM-yyyy hh:mm:ss&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date eventDate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Date date = <span class="keyword">new</span> Date();</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;dd-MM-yyyy hh:mm:ss&quot;</span>);</span><br><span class="line">        String format = simpleDateFormat.format(date);</span><br><span class="line">        Event event = <span class="keyword">new</span> Event(<span class="string">&quot;wuxuan comming&quot;</span>, date);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(event);</span><br><span class="line">        <span class="keyword">assert</span> json.contains(format);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-3、-JsonUnWrapped"><a href="#1-6-3、-JsonUnWrapped" class="headerlink" title="1.6.3、@JsonUnWrapped"></a>1.6.3、@JsonUnWrapped</h4><p>@JsonUnwrapped定义应展开/展平的值序列化/反序列化时。让我们看看它是如何工作的； 我们将使用注解解开属性名称：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonUnwrapped;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:01 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UnwappedUser</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonUnwrapped(prefix = &quot;n_&quot;,suffix = &quot;_o&quot;,enabled = true)</span></span><br><span class="line">    <span class="keyword">private</span> Name name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Data</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;</span><br><span class="line">        <span class="keyword">private</span> String firstName;</span><br><span class="line">        <span class="keyword">private</span> String lastName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Name name = <span class="keyword">new</span> Name();</span><br><span class="line">        name.setFirstName(<span class="string">&quot;chai&quot;</span>);</span><br><span class="line">        name.setLastName(<span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        UnwappedUser unwappedUser = <span class="keyword">new</span> UnwappedUser();</span><br><span class="line">        unwappedUser.setName(name);</span><br><span class="line"></span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(unwappedUser);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:0,&quot;n_firstName_o&quot;:&quot;chai&quot;,&quot;n_lastName_o&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-4、-JsonView"><a href="#1-6-4、-JsonView" class="headerlink" title="1.6.4、@JsonView"></a>1.6.4、@JsonView</h4><p>@JsonView指示将在其中包含属性以进行序列化/反序列化的View。一个示例将确切显示其工作原理-我们将使用@JsonView序列化Item实体的实例。 让我们从视图开始：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonView;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:08 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="meta">@JsonView(Views.Public.class)</span></span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line">    <span class="meta">@JsonView(Views.internal.class)</span></span><br><span class="line">    <span class="keyword">private</span> String ownerName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>, <span class="string">&quot;wuxuan111&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writerWithView(Views.Public.class).writeValueAsString(item);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="1-6-5-JsonManagedReference-JsonBackReference"><a href="#1-6-5-JsonManagedReference-JsonBackReference" class="headerlink" title="1.6.5. @JsonManagedReference, @JsonBackReference"></a>1.6.5. @JsonManagedReference, @JsonBackReference</h4><p>@JsonManagedReference和@JsonBackReference注解可以处理父/子关系并解决循环。在以下示例中–我们使用@JsonManagedReference和@JsonBackReference序列化我们的ItemWithRefentity：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonManagedReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:18 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonManagedReference</span></span><br><span class="line">    <span class="keyword">public</span> UserWithRef owner;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithRef userWithRef = <span class="keyword">new</span> UserWithRef(<span class="number">1</span>,<span class="string">&quot;wuxuan&quot;</span>,<span class="keyword">null</span>);</span><br><span class="line">        ItemWithRef itemWithRef = <span class="keyword">new</span> ItemWithRef(<span class="number">1</span>, <span class="string">&quot;wwww&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        List&lt;ItemWithRef&gt; itemWithRefs = Lists.newArrayList();</span><br><span class="line">        itemWithRefs.add(itemWithRef);</span><br><span class="line">        userWithRef.setUserItems(itemWithRefs);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(userWithRef);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:1,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonBackReference;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.AllArgsConstructor;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:19 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithRef</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonBackReference</span></span><br><span class="line">    <span class="keyword">public</span> List&lt;ItemWithRef&gt; userItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;ItemWithRef&gt; <span class="title">addItem</span><span class="params">(ItemWithRef itemWithRef)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userItems == <span class="keyword">null</span>)&#123;</span><br><span class="line">            userItems = Lists.newArrayList();</span><br><span class="line">            userItems.add(itemWithRef);</span><br><span class="line">            <span class="keyword">return</span> userItems;</span><br><span class="line">        &#125;</span><br><span class="line">        userItems.add(itemWithRef);</span><br><span class="line">        <span class="keyword">return</span> userItems;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>::: danger<br>处理循环调用的场景<br>:::</p><h4 id="1-6-6-JsonIdentityInfo"><a href="#1-6-6-JsonIdentityInfo" class="headerlink" title="1.6.6. @JsonIdentityInfo"></a>1.6.6. @JsonIdentityInfo</h4><p>@JsonIdentityInfo指示在对值进行序列化/反序列化时应使用对象标识，例如，以处理无限递归类型的问题。在以下示例中–我们有一个ItemWithIdentity实体，它与UserWithIdentity实体具有双向关系：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIdentityInfo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.ObjectIdGenerators;</span><br><span class="line"><span class="keyword">import</span> com.google.common.collect.Lists;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:30 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(</span></span><br><span class="line"><span class="meta">        generator= ObjectIdGenerators.PropertyGenerator.class,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;ItemWithIdentity&gt; userItems;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">UserWithIdentity</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addItem</span><span class="params">(ItemWithIdentity item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (userItems == <span class="keyword">null</span>)&#123;</span><br><span class="line">            userItems = Lists.newArrayList();</span><br><span class="line">            userItems.add(item);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        userItems.add(item);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIdentityInfo;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.ObjectIdGenerators;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:29 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIdentityInfo(</span></span><br><span class="line"><span class="meta">        generator = ObjectIdGenerators.PropertyGenerator.class,</span></span><br><span class="line"><span class="meta">        property = &quot;id&quot;</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ItemWithIdentity</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> UserWithIdentity owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">ItemWithIdentity</span><span class="params">(Integer id, String itemName, UserWithIdentity owner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        UserWithIdentity user = <span class="keyword">new</span> UserWithIdentity(<span class="number">1</span>, <span class="string">&quot;John&quot;</span>);</span><br><span class="line">        ItemWithIdentity item = <span class="keyword">new</span> ItemWithIdentity(<span class="number">2</span>, <span class="string">&quot;book&quot;</span>, user);</span><br><span class="line">        user.addItem(item);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;id&quot;:2,&quot;itemName&quot;:&quot;book&quot;,&quot;owner&quot;:&#123;&quot;id&quot;:1,&quot;name&quot;:&quot;John&quot;,&quot;userItems&quot;:[2]&#125;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="1-6-7-JsonFilter"><a href="#1-6-7-JsonFilter" class="headerlink" title="1.6.7. @JsonFilter"></a>1.6.7. @JsonFilter</h4><p>@JsonFilter批注指定在序列化期间使用的过滤器。让我们看一个例子； 首先，我们定义实体，然后指向过滤器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.generate;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonFilter(&quot;myFilter&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithFilter</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithFilter</span><span class="params">(Integer id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BeanWithFilter beanWithFilter = <span class="keyword">new</span> BeanWithFilter(<span class="number">1</span>, <span class="string">&quot;Wuxuuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .writer(<span class="keyword">new</span> SimpleFilterProvider()</span><br><span class="line">                        .addFilter(<span class="string">&quot;myFilter&quot;</span>, SimpleBeanPropertyFilter.filterOutAllExcept(<span class="string">&quot;name&quot;</span>)))</span><br><span class="line">                .writeValueAsString(beanWithFilter);</span><br><span class="line"></span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;Wuxuuan&quot;&#125;</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-7、自定义Jackson注解"><a href="#1-7、自定义Jackson注解" class="headerlink" title="1.7、自定义Jackson注解"></a>1.7、自定义Jackson注解</h3><p>接下来，我们一起学习如何创建一个Jackson自定义注解，我们可以使用@JacksonAnnotationsInside注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.customAnnotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JacksonAnnotationsInside;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.Retention;</span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.RetentionPolicy;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:54 下午</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * 运行时注解</span></span><br><span class="line"><span class="comment"> * json包含非空</span></span><br><span class="line"><span class="comment"> * json排序</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@JacksonAnnotationsInside</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;,&quot;datteCreated&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> CustomAnnotation &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.customAnnotation;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 2:56 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@CustomAnnotation</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BeanWithCustomAnnotation</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Date dateCreated;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BeanWithCustomAnnotation</span><span class="params">(Integer id, String name, Date dateCreated)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">        <span class="keyword">this</span>.dateCreated = dateCreated;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        BeanWithCustomAnnotation bean = <span class="keyword">new</span> BeanWithCustomAnnotation(<span class="number">1</span>, <span class="string">&quot;wuxuan&quot;</span>, <span class="keyword">new</span> Date());</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(bean);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result：&#123;&quot;name&quot;:&quot;wuxuan&quot;,&quot;id&quot;:1,&quot;dateCreated&quot;:1591599545147&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-8、Jackson-混入注解"><a href="#1-8、Jackson-混入注解" class="headerlink" title="1.8、Jackson 混入注解"></a>1.8、Jackson 混入注解</h3><p>接下来，让我们一起看看如何使用Jackson的混入注解，让我们用混入注解举个例子 - 忽略User类中的属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:05 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String sex;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:06 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.mixln;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:04 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Item</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span>  Integer id;</span><br><span class="line">    <span class="keyword">private</span> String itemName;</span><br><span class="line">    <span class="keyword">private</span> User owner;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Item</span><span class="params">(Integer id, String itemName, User owner)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.itemName = itemName;</span><br><span class="line">        <span class="keyword">this</span>.owner = owner;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Item item = <span class="keyword">new</span> Item(<span class="number">1</span>, <span class="string">&quot;ccc&quot;</span>, <span class="keyword">null</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(item);</span><br><span class="line">        <span class="comment">//检查是否序列化了User类型</span></span><br><span class="line">        <span class="keyword">assert</span> json.contains(<span class="string">&quot;owner&quot;</span>);</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().addMixIn(User.class, MyMixinForIgnoreType.class);</span><br><span class="line">        String json1 = objectMapper.writeValueAsString(item);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//检查是否忽略了User类型</span></span><br><span class="line">        <span class="keyword">assert</span> !json1.contains(<span class="string">&quot;owner&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="1-9、禁用-Jackson-注解"><a href="#1-9、禁用-Jackson-注解" class="headerlink" title="1.9、禁用 Jackson 注解"></a>1.9、禁用 Jackson 注解</h3><p>最后，我们一起看看如何禁用所有的jackson注解，我们可以通过禁用MapperFeature.USE_ANNOTATIONS来实现此目的，如以下示例所示：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.annotation.disabledJson;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonInclude;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonPropertyOrder;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.MapperFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:13 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonInclude(JsonInclude.Include.NON_NULL)</span></span><br><span class="line"><span class="meta">@JsonPropertyOrder(&#123;&quot;name&quot;,&quot;id&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyBean</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyBean</span><span class="params">(String id, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyBean wuxuan = <span class="keyword">new</span> MyBean(<span class="string">&quot;1&quot;</span>, <span class="string">&quot;wuxuan&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().disable(MapperFeature.USE_ANNOTATIONS).writeValueAsString(wuxuan);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//期望，非空校验和排序注解都失效</span></span><br><span class="line">        <span class="comment">//result：&#123;&quot;id&quot;:&quot;1&quot;,&quot;name&quot;:&quot;wuxuan&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="二、Jackson-ObjectMapper-的简介"><a href="#二、Jackson-ObjectMapper-的简介" class="headerlink" title="二、Jackson ObjectMapper 的简介"></a>二、Jackson ObjectMapper 的简介</h2><h3 id="2-1、简介"><a href="#2-1、简介" class="headerlink" title="2.1、简介"></a>2.1、简介</h3><p>本章着重于理解Jackson ObjectMapper类，以及如何将Java对象序列化为JSON以及如何将JSON字符串反序列化为Java对象。</p><h3 id="2-2、使用ObjectMapper读和写"><a href="#2-2、使用ObjectMapper读和写" class="headerlink" title="2.2、使用ObjectMapper读和写"></a>2.2、使用ObjectMapper读和写</h3><p>让我们从基本的读写操作开始。ObjectMapper的简单readValue API是一个很好的入口点。 我们可以使用它来将JSON内容解析或反序列化为Java对象。同样，在编写方面，我们可以使用writeValue API将任何Java对象序列化为JSON输出。在本章中，我们将使用以下带有两个字段的Car类作为对象进行序列化或反序列化：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-1、Java对象序列化成json"><a href="#2-2-1、Java对象序列化成json" class="headerlink" title="2.2.1、Java对象序列化成json"></a>2.2.1、Java对象序列化成json</h4><p>让我们一起学习第一个序列化例子，用ObjectMapper类的writeValue将java转换成json</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> ObjectMapper().writeValue(<span class="keyword">new</span> File(<span class="string">&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;</span>),car);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">生成一个Car.json文件</span><br><span class="line">内容：</span><br><span class="line">&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ObjectMapper类的writeValueAsString和writeValueAsBytes方法从Java对象生成JSON，并以字符串或字节数组形式返回生成的JSON：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(car);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> ObjectMapper().writeValueAsBytes(car);</span><br><span class="line">        String bytesStr = <span class="keyword">new</span> String(bytes);</span><br><span class="line">        System.out.println(json.equals(bytesStr));</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>运行结果：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;&quot;color&quot;:&quot;red&quot;,&quot;type&quot;:&quot;BMW&quot;&#125;</span><br><span class="line">true</span><br></pre></td></tr></table></figure><h4 id="2-2-2、Json转换成Java对象"><a href="#2-2-2、Json转换成Java对象" class="headerlink" title="2.2.2、Json转换成Java对象"></a>2.2.2、Json转换成Java对象</h4><p>以下是使用ObjectMapper类将JSON字符串转换为Java对象的简单示例：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">&quot;color&quot;</span>:<span class="string">&quot;red&quot;</span>,<span class="attr">&quot;type&quot;</span>:<span class="string">&quot;BMW&quot;</span>&#125;</span><br></pre></td></tr></table></figure><p>readValue（）函数还接受其他形式的输入，例如包含JSON字符串的文件：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;red&quot;</span>, <span class="string">&quot;BMW&quot;</span>);</span><br><span class="line"></span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;color\&quot;:\&quot;red\&quot;,\&quot;type\&quot;:\&quot;BMW\&quot;&#125;&quot;</span>;</span><br><span class="line">        Car car1 = <span class="keyword">new</span> ObjectMapper().readValue(json, Car.class);</span><br><span class="line">        System.out.println(car1.equals(car));</span><br><span class="line"></span><br><span class="line">        Car car2 = <span class="keyword">new</span> ObjectMapper().readValue(<span class="keyword">new</span> File(<span class="string">&quot;/Users/wuxuan.chai/Documents/project/springboot-learn/Jackson/src/main/java/com/yiyi/objectMapper/using/Car.json&quot;</span>), Car.class);</span><br><span class="line">        System.out.println(car2.equals(car));</span><br><span class="line">        <span class="comment">//result：</span></span><br><span class="line">        <span class="comment">// true</span></span><br><span class="line">        <span class="comment">// true</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-3、Json转换成Jackson的Json节点"><a href="#2-2-3、Json转换成Jackson的Json节点" class="headerlink" title="2.2.3、Json转换成Jackson的Json节点"></a>2.2.3、Json转换成Jackson的Json节点</h4><p>另外，可以将JSON解析为JsonNode对象，并用于从特定节点检索数据：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.net.URL;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\&quot;color\&quot;:\&quot;red\&quot;,\&quot;type\&quot;:\&quot;BMW\&quot;&#125;&quot;</span>;</span><br><span class="line">        JsonNode jsonNode = <span class="keyword">new</span> ObjectMapper().readTree(json);</span><br><span class="line">        String type = jsonNode.get(<span class="string">&quot;type&quot;</span>).asText();</span><br><span class="line">        System.out.println(type.equals(<span class="string">&quot;BMW&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: true</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-4、从Json数组字符串中创建Java集合"><a href="#2-2-4、从Json数组字符串中创建Java集合" class="headerlink" title="2.2.4、从Json数组字符串中创建Java集合"></a>2.2.4、从Json数组字符串中创建Java集合</h4><p>我们可以使用TypeReference将数组形式的JSON解析为Java对象列表：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String jsonArray = <span class="string">&quot;[\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Black\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;audi\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        List&lt;Car&gt; cars  = <span class="keyword">new</span> ObjectMapper().readValue(jsonArray,</span><br><span class="line">                <span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br><span class="line">        System.out.println(cars);</span><br><span class="line">        <span class="comment">//result: [Car(color=Red, type=BMW), Car(color=Black, type=audi)]</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="2-2-5、从json中创建Java-Map"><a href="#2-2-5、从json中创建Java-Map" class="headerlink" title="2.2.5、从json中创建Java Map"></a>2.2.5、从json中创建Java Map</h4><p>同样，我们可以将JSON解析为Java Map：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.objectMapper.using;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.type.TypeReference;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:23 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String color, String type)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;: \&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line">        Map&lt;String, String&gt; javaMap = <span class="keyword">new</span> ObjectMapper().readValue(json, <span class="keyword">new</span> TypeReference&lt;Map&lt;String, String&gt;&gt;() &#123;&#125;);</span><br><span class="line"></span><br><span class="line">        System.out.println(javaMap);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;color=Red, type=BMW&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="三、高级功能"><a href="#三、高级功能" class="headerlink" title="三、高级功能"></a>三、高级功能</h2><p>Jackson库的最大优势之一是高度可定制的序列化和反序列化过程。在本部分中，我们将介绍一些高级功能，其中输入或输出JSON响应可能不同于生成或使用响应的对象。</p><h3 id="3-1、-配置-Serialization-Deserialization-功能"><a href="#3-1、-配置-Serialization-Deserialization-功能" class="headerlink" title="3.1、 配置 Serialization / Deserialization 功能"></a>3.1、 配置 Serialization / Deserialization 功能</h3><p>在将JSON对象转换为Java类时，如果JSON字符串具有一些新字段，则默认过程将导致异常：</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;color&quot;</span>: <span class="string">&quot;Red&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;BMW&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;year&quot;</span>: <span class="string">&quot;2020&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>上面示例中的默认解析过程中，针对Car类的Java对象的JSON字符串将导致UnrecognizedPropertyException异常。通过configure方法，我们可以扩展默认过程以忽略新字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;year\&quot;: \&quot;2020\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    &#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 也可以这么写：  new ObjectMapper().configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);</span></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        Car car = objectMapper.readValue(json, Car.class);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        JsonNode jsonNode = objectMapper.readTree(json);</span><br><span class="line">        String year = jsonNode.get(<span class="string">&quot;year&quot;</span>).asText();</span><br><span class="line">        System.out.println(year);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>对于DeserializationFeature枚举中中的设置的描述：</p><table><thead><tr><th>配置</th><th>默认值</th><th>作用描述</th></tr></thead><tbody><tr><td>USE_BIG_DECIMAL_FOR_FLOATS</td><td>false</td><td>如果只有通用类型描述（Object或Number或未类型化的java.util.Map或java.util.Collection上下文中）可用，此功能确定是否将JSON浮点数反序列化为java.math.BigDecimals。 如果启用，则将这些值反序列化为java.math.BigDecimals;。 如果禁用，将反序列化为Doubles。默认情况下，此功能为禁用状态，这意味着默认情况下，“未类型化”的浮点数将反序列化为Doubles（出于性能考虑，选择-BigDecimals慢于Doubles）。</td></tr><tr><td>USE_BIG_INTEGER_FOR_INTS</td><td>false</td><td>确定是否将JSON整数（非浮点数）数字反序列化为java.math.BigIntegers的功能（如果只有通用类型描述（Object或Number或在无类型的java.util.Map或java.util.Collection上下文中） ）可用。 如果启用，则将这些值反序列化为java.math.BigIntegers;。 如果禁用，则将反序列化为“最小”可用类型，根据类型的数目，可以是Integer，Long或java.math.BigInteger。默认情况下，此功能是禁用的，这意味着默认情况下，将使用最紧凑的整数类型对“未类型化”的整数进行反序列化，以优化效率。</td></tr><tr><td>USE_LONG_FOR_INTS</td><td>false</td><td>当目标类型被松散地键入为Object或Number（或在其中）时，用于确定如何绑定“小” JSON整数（非浮点数）（适合32位有符号整数（int））的功能 未类型化的java.util.Map或java.util.Collection上下文）。 如果启用，则这些值将反序列化为Long； 如果禁用，它们将反序列化为“最小”可用类型，整数。 此外，如果启用了该选项，则尝试绑定不适合Long的值将引发com.fasterxml.jackson.core.JsonProcessingException。注意：如果启用USE_BIG_INTEGER_FOR_INTS，它将优先于此设置，并强制对所有整数值使用java.math.BigInteger。该功能默认情况下处于禁用状态，这意味着如果值合适，默认情况下将使用Integer反序列化“无类型”整数。</td></tr><tr><td>USE_JAVA_ARRAY_FOR_JSON_ARRAY</td><td>false</td><td>绑定“无类型”对象（标称类型为java.lang.Object的对象）时确定JSON数组是映射到Object[]还是List<?>的功能。 如果为true，则绑定为Object[]; 如果为false，则为List<?>。默认情况下，功能是禁用的，这意味着JSON数组绑定为java.util.Lists。</td></tr><tr><td>FAIL_ON_UNKNOWN_PROPERTIES</td><td>true</td><td>确定遇到未知属性（不映射到属性，并且没有“任何setter”或处理程序的处理程序）的功能是否会导致失败（通过抛出JsonMappingException）。 仅在尝试了其他所有用于未知属性的处理方法并且该属性保持未处理状态后，此设置才生效。 默认情况下启用此功能（这意味着如果遇到未知属性，将抛出JsonMappingException）。</td></tr><tr><td>FAIL_ON_NULL_FOR_PRIMITIVES</td><td>false</td><td>反序列化为Java基本类型（如“ int”或“ double”）时，确定是否遇到JSON null的错误的功能。 如果是，则抛出JsonProcessingException来表明这一点。 如果不是，则使用默认值（0表示“ int”，0.0表示double，与JVM使用的默认值相同）。默认情况下禁用此功能。</td></tr><tr><td>FAIL_ON_NUMBERS_FOR_ENUMS</td><td>false</td><td>确定JSON整数是否是用于反序列化Java枚举值的有效值的功能。 如果设置为“ false”，则数字是可接受的，并用于映射到匹配枚举值的ordinal（）； 如果为“ true”，则不允许数字，并且将引发JsonMappingException。 如果担心可能会发生从整数值到枚举的意外映射（并且枚举始终序列化为JSON字符串的情况），那么后者的行为就很有意义。默认情况下禁用此功能。</td></tr><tr><td>FAIL_ON_INVALID_SUBTYPE</td><td>true</td><td>确定无法找到（丢失）或解决（丢失）类名称（例如，无效的类名，不可映射的id）的多态值的类型（例如，由com.fasterxml.jackson.annotation.JsonTypeInfo指示）时发生的情况的功能； 如果启用，则引发异常； 如果为false，则使用null值。默认情况下启用功能，以便因缺少类型信息或无效类型信息而引发异常。</td></tr><tr><td>FAIL_ON_READING_DUP_TREE_KEY</td><td>false</td><td>该功能确定在将JSON内容读入树（com.fasterxml.jackson.core.TreeNode）并遇到重复键（已为JSON对象看到的属性名称）时发生什么情况。 如果启用，将抛出JsonMappingException； 如果禁用，则不会引发异常，并且新的（较新的）值将覆盖较早的值。请注意，此属性不会影响数据绑定的其他方面。 也就是说，不对POJO属性或java.util.Map键进行检测。 可以添加新功能来控制其他情况。默认情况下，功能是禁用的，因此不会引发异常。</td></tr><tr><td>FAIL_ON_IGNORED_PROPERTIES</td><td>false</td><td>确定在输入中遇到显式标记为可忽略的属性时将发生什么的功能：如果启用了功能，则抛出JsonMappingException； 如果为false，则默默地跳过属性。 默认情况下，功能是禁用的，因此不会引发异常。</td></tr><tr><td>FAIL_ON_UNRESOLVED_OBJECT_IDS</td><td>true</td><td>确定遇到的对象ID引用不引用具有该ID的实际对象（“未解决的对象ID”）的情况时发生的功能：抛出异常（true），或者使用空对象代替（false） 。 请注意，如果将其设置为false，则不会进行进一步处理； 具体来说，如果引用是通过setter方法定义的，则不会调用该方法。默认情况下启用此功能，以便在反序列化结束时，未知的对象ID将导致引发异常。</td></tr><tr><td>FAIL_ON_MISSING_CREATOR_PROPERTIES</td><td>false</td><td>该功能确定一个或多个创建者属性（绑定到创建者方法（构造函数或静态工厂方法）的参数的属性）缺少要从内容绑定到的值时发生的情况。 如果启用，则此类缺少的值会导致抛出JsonMappingException并附带第一个（按索引）缺少的属性的信息。 如果禁用，并且未将属性标记为必需，则缺少的Creator属性将由反序列化器为参数类型提供的空值填充（通常对于Object类型为null，对于基元为默认值；但可通过自定义反序列化器重新定义）。注意，具有可注射的值算作“不丢失”。默认情况下，该功能为禁用状态，因此除非缺少将创建者属性值明确标记为“必需”的属性，否则不会引发任何异常。</td></tr><tr><td>FAIL_ON_NULL_CREATOR_PROPERTIES</td><td>false</td><td>该功能可确定如果将一个或多个Creator属性（绑定到Creator方法（构造方法或静态工厂方法）的参数的属性）绑定到null值（来自JSON或作为默认值）时会发生什么。 如果要避免代码库中为null，则这很有用，如果对非强制性字段使用Java或Scala可选参数，则这特别有用。 默认情况下，该功能为禁用状态，因此除非缺少将创建者属性值明确标记为“必需”的属性，否则不会引发任何异常。</td></tr><tr><td>FAIL_ON_MISSING_EXTERNAL_TYPE_ID_PROPERTY</td><td>true</td><td>该功能确定缺少使用com.fasterxml.jackson.annotation.JsonTypeInfo.As.EXTERNAL_PROPERTY注解的属性但用的关联类型ID时发生的情况。 如果启用，则总是在缺少属性值时（如果类型ID确实存在）抛出JsonMappingException； 如果禁用，则仅在将属性标记为“必需”时抛出异常。默认情况下启用功能，以便在缺少子类型属性时引发异常。</td></tr><tr><td>FAIL_ON_TRAILING_TOKENS</td><td>false</td><td>绑定根值后确定数据绑定行为的功能。 如果启用了功能，则再次调用com.fasterxml.jackson.core.JsonParser.nextToken以确保找不到更多令牌（如果找到了更多令牌，则抛出com.fasterxml.jackson.databind.exc.MismatchedInputException ）; 如果禁用，则不进行进一步检查。该功能也可以称为READ_FULL_STREAM，因为它可以有效地验证输入流仅包含绑定完整值所需的数据，而仅包含其他内容（可能的可忽略空格或注解，如果数据格式支持，则除外）。由于向后兼容的原因，默认情况下功能是禁用的（因此不检查可能的尾随令牌）。</td></tr><tr><td>WRAP_EXCEPTIONS</td><td>true</td><td>确定杰克逊代码是否应捕获并包装异常（但绝不要出错！）以添加有关问题位置（在输入范围内）的附加信息的功能。 如果启用，大多数异常将被捕获并重新抛出（特别是java.io.IOExceptions可以按原样传递，因为它们被声明为可抛出）。 这很方便，因为将检查并声明所有异常，因此有更多上下文信息。 但是，有时调用应用程序可能只希望按原样传递“原始”未经检查的异常。默认情况下启用此功能。</td></tr><tr><td>ACCEPT_SINGLE_VALUE_AS_ARRAY</td><td>false</td><td>确定强制将非数组（JSON）值强制用于Java集合（数组，java.util.Collection）类型的功能。 如果启用，集合反序列化器将尝试处理非数组值，就像它们对JSON数组具有“隐式”一样。 此功能旨在出于兼容性/互操作性原因而使用，以与在数组中只有单个元素的情况下忽略JSON数组的程序包（例如XML到JSON转换器）一起使用。默认情况下禁用此功能。</td></tr><tr><td>UNWRAP_SINGLE_VALUE_ARRAYS</td><td>false</td><td>确定将单个值数组（在JSON中）的值强制转换为相应值类型是否可接受的功能。 这基本上与ACCEPT_SINGLE_VALUE_AS_ARRAY功能相反。 如果在数组中找到多个值，则抛出JsonMappingException。默认情况下禁用功能</td></tr><tr><td>UNWRAP_ROOT_VALUE</td><td>false</td><td>允许“解包”根级JSON值以匹配用于序列化的SerializationFeature.WRAP_ROOT_VALUE的设置。 将验证根JSON值是一个JSON对象，并且它具有具有预期根名的单个属性。 如果不是，则抛出JsonMappingException。 否则，包装属性的值将被反序列化，就好像它是根值一样。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_EMPTY_STRING_AS_NULL_OBJECT</td><td>false</td><td>可以启用此功能以允许将POJO和其他结构化值（java.util.Maps，java.util.Collections）的JSON空字符串值（“”）绑定为“ null”。 如果禁用，则只能从JSON<code>null</code>或JSON对象绑定标准POJO（标准含义是未定义任何自定义反序列化器或构造函数；这两种都可以添加对其他种类JSON值的支持）； 如果启用，则可以将空JSON字符串等效为JSON null。注意：这不适用于标量值，例如布尔值和数字； 是否可以强制使用它们取决于MapperFeature.ALLOW_COERCION_OF_SCALARS。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_EMPTY_ARRAY_AS_NULL_OBJECT</td><td>false</td><td>可以启用此功能，以允许将空JSON数组值（即[]）绑定为POOL（以及2.9，还包含其他值）为“ null”。 如果禁用，则只能从JSON<code>null</code>或JSON对象绑定标准POJO（标准含义是未定义任何自定义反序列化器或构造函数；这两种都可以添加对其他种类JSON值的支持）； 如果启用，则将使用空JSON数组等效于JSON null。默认情况下禁用此功能。</td></tr><tr><td>ACCEPT_FLOAT_AS_INT</td><td>true</td><td>确定是否强制转换为从JSON浮点数（任何带命令（<code>.</code>）或指数部分（<code>e</code> /<code>E&#39;））到期望的整数（</code>int<code>，</code>long<code>，</code>java.lang .integer，java.lang.Long，java.math.BigDecimal是否允许。 如果启用，强制将截断值； 如果禁用，将抛出JsonMappingException。默认情况下启用此功能。</td></tr><tr><td>READ_ENUMS_USING_TO_STRING</td><td>false</td><td>确定用于Enum值的标准反序列化机制的功能：如果启用，则假定Enums已使用Enum.toString（）的返回值进行了序列化； 如果禁用，则假定已使用Enum.name（）的返回值。注意：此功能通常应与SerializationFeature.WRITE_ENUMS_USING_TO_STRING具有相同的值。默认情况下禁用此功能。</td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_AS_NULL</td><td>false</td><td>允许将未知的Enum值解析为空值的功能。 如果禁用，未知的Enum值将引发异常。请注意，在某些情况下，这基本上会忽略未知的Enum值； 这是java.util.EnumMap的键的键和java.util.EnumSet的值的（因为在这些情况下不接受null）。默认情况下禁用此功能。</td></tr><tr><td>READ_UNKNOWN_ENUM_VALUES_USING_DEFAULT_VALUE</td><td>false</td><td>该功能允许忽略未知的Enum值，并通过@JsonEnumDefaultValue批注指定预定义值。 如果禁用，未知的Enum值将引发异常。 如果启用，但未指定预定义的默认Enum值，则也会引发异常。 默认情况下禁用此功能。</td></tr><tr><td>READ_DATE_TIMESTAMPS_AS_NANOSECONDS</td><td>true</td><td>当且仅当数据类型支持这种分辨率时，此功能可控制是否应使用（启用）或不使用（禁用）纳秒级时间戳写入数字时间戳值。 只有较新的数据类型（例如Java8日期/时间）才支持这种分辨率-较旧的类型（Java8之前的java.util.Date等）和Joda则不支持-并且此设置对此类类型无效。如果禁用，则假定为标准毫秒时间戳。 这与SerializationFeature.WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS相对应。默认情况下启用此功能，以支持最准确的时间值。</td></tr><tr><td>ADJUST_DATES_TO_CONTEXT_TIME_ZONE</td><td>true</td><td>该功能指定上下文提供的java.util.TimeZone（DeserializationContext.getTimeZone（）是否应用于在反序列化时调整日期/时间值，即使值本身包含时区信息也是如此。 如果禁用，则仅当值本身不包含任何TimeZone信息时才使用它。请注意，确切的行为取决于所讨论的日期/时间类型。 特别是JDK类型的java.util.Date没有内置时区信息，因此此设置无效。 此外，尽管java.util.Calendar确实具有此信息，但是基本JDK java.text.SimpleDateFormat无法保留已解析的区域信息，因此，无论此设置如何，java.util.Calendar始终将获得上下文时区调整。考虑到上述因素，只有Joda和Java 8日期/文字数据类型的扩展模块才支持此功能。</td></tr><tr><td>EAGER_DESERIALIZER_FETCH</td><td>true</td><td>决定ObjectReader是否应在可能的情况下热切获取必要的JsonDeserializer的功能。 如果多次使用类似配置的ObjectReader实例，则可以提高性能。 并且不会对一次性使用案例产生重大影响。请注意，通常不需要禁用此功能：仅在存在实际可察觉问题的情况下考虑。 默认情况下启用此功能。</td></tr></tbody></table><p>对于SerializationFeature枚举中的设置进行描述： </p><p>|配置|默认值|作用描述|<br>|-|-|<br>|WRAP_ROOT_VALUE|false|可以启用以使根值（通常为JSON对象，但可以是任何类型）包装在单个属性JSON对象中的功能，其中键为“根名”，由注释内省者确定（对于使用@XmlRootElement的JAXB尤其如此） .name）或后备广告（非合格的类名）。 功能主要是为了与JAXB兼容。默认情况下禁用此功能。|<br>|INDENT_OUTPUT|false|该功能允许使用为ObjectMapper（以及从mapper创建的ObjectWriters）配置的默认漂亮打印机为基础生成器启用（或禁用）缩进。请注意，仅当未为生成器或ObjectWriter配置显式com.fasterxml.jackson.core.PrettyPrinter时，才使用默认的漂亮打印机。默认情况下禁用此功能。|<br>|FAIL_ON_EMPTY_BEANS|true|该功能用于确定在找不到类型的访问器时会发生什么情况（并且没有注释指示它打算被序列化）。 如果启用（默认），则将引发异常以指示这些类型为不可序列化的类型； 如果禁用，它们将被序列化为空对象，即没有任何属性。请注意，此功能仅对那些没有任何可识别注释的“空” bean（例如，@JsonSerialize）起作用的空类型：具有注释的那些不会导致抛出异常。默认情况下启用此功能。|<br>|FAIL_ON_SELF_REFERENCES|true|决定POJO检测到直接自我引用时会发生什么情况的功能（并且未启用对象ID处理）：抛出JsonMappingException（如果为true），或者通常对引用进行处理（false）。默认情况下启用功能|<br>|WRAP_EXCEPTIONS|true|确定Jackson代码是否应捕获并包装异常（但绝不要出错！）以添加有关问题位置（在输入范围内）的附加信息的功能。 如果启用，大多数异常将被捕获并重新抛出（特别是java.io.IOExceptions可以按原样传递，因为它们被声明为可抛出）。 这很方便，因为将检查并声明所有异常，因此有更多上下文信息。 但是，有时调用应用程序可能只希望按原样传递“原始”未经检查的异常。默认情况下启用此功能。|<br>|FAIL_ON_UNWRAPPED_TYPE_IDENTIFIERS|true|确定通常具有Jackson包含的类型信息的对象与com.fasterxml.jackson.annotation.JsonUnwrapped结合使用时发生的功能。 在默认（启用）状态下，当展开的对象具有类型信息时，将引发错误。 禁用时，将解包该对象，并丢弃类型信息。默认情况下启用此功能。|<br>|WRITE_SELF_REFERENCES_AS_NULL|false|决定POJO检测到直接自引用时会发生什么情况的功能（并且未启用对象ID处理）：如果启用，则将该引用写为null； 如果禁用，则使用默认行为（它将尝试序列化，通常会导致异常）。 但是，如果启用了FAIL_ON_SELF_REFERENCES。 此属性将被忽略。|<br>|CLOSE_CLOSEABLE|false|用于确定是否在序列化后调用实现java.io.Closeable的序列化根级对象的close方法（调用了ObjectMapper的writeValue（）（或等效方法）的对象）的功能。 如果启用，则在序列化完成后（无论成功还是由于抛出异常而显示的错误）将调用close（）。 您可以将其视为某种“最终”处理。注意：仅影响根对象的行为，而不影响从根对象可访问的其他对象。 换句话说，每个“ writeValue”调用将只进行一次调用。默认情况下禁用此功能。|<br>|FLUSH_AFTER_WRITE_VALUE|true|确定是否以JsonGenerator作为参数的writeValue（）方法完成后是否调用JsonGenerator.flush（）的功能（即不影响使用其他目标的方法）; ObjectWriter中的方法相同。 这通常是有道理的； 但是在某些情况下不应该强制执行刷新：例如，在底层流进行压缩时，并且flush（）导致刷新了压缩状态（某些压缩编解码器会发生这种情况）。默认情况下启用此功能。|<br>|WRITE_DATES_AS_TIMESTAMPS|true|确定是否将Date（和日期/时间）值（以及基于Date的东西，如java.util.Calendars）序列化为数字时间戳记（true；默认值）或其他值（通常是文本表示形式）的功能。如果使用文本表示，则实际格式取决于配置设置，包括@JsonFormat批注的按属性使用，全局配置的java.text.DateFormat。对于“经典” JDK日期类型（java.util.Date，java.util.Calendar），默认格式由com.fasterxml.jackson.databind.util.StdDateFormat提供，并且对应于格式字符串“ yyyy-MM-dd” ‘T’HH：mm：ss.SSSX”（有关字符串格式的详细信息，请参见java.text.DateFormat）。此功能是否影响其他与日期相关的类型的处理取决于这些类型的处理程序，尽管理想情况下，他们应该使用此功能注意：使用WRITE_DATE_KEYS_AS_TIMESTAMPS代替此功能来控制java.util.Map密钥是否序列化为字符串。默认情况下启用功能，因此默认情况下将日期/时间序列化为时间戳。|<br>|WRITE_DATE_KEYS_AS_TIMESTAMPS|false|确定是否将用作java.util.Map键的java.util.Dates（和子类型）序列化为时间戳的功能（如果没有，则序列化为文本值）。默认值为“ false”，表示将日期值映射键序列化为文本（ISO-8601）值。默认情况下禁用此功能。|<br>|WRITE_DATES_WITH_ZONE_ID|false|用于确定日期/日期时间值是否应该序列化的功能，以便在类型本身包含时区信息的情况下，它们包括时区id。 包含此信息可能会导致兼容性问题，因为ISO-8601规范未定义包含此类信息的格式。如果启用，则应使用Java 8 DateTimeFormatter＃ISO_ZONED_DATE_TIME定义所指定的格式来包含时区ID（例如，“ 2011-12-03T10：15：30 + 01：00 [欧洲/巴黎]”）。注意：如果日期/时间值被序列化为时间戳，则该设置不相关。默认情况下，该功能处于禁用状态，因此不包含区域ID。 相反，时区偏移量用于ISO-8601兼容性（如果值中包含任何时区信息）。|<br>|WRITE_DURATIONS_AS_TIMESTAMPS|true|默认情况下，用于确定表示时间段（持续时间，时间段，范围）的时间值是否要使用数字（true）或文本（false）表示序列化的功能。 请注意，根据类型的不同，数字表示可能表示简单数字或数字数组。注意：使用WRITE_DATE_KEYS_AS_TIMESTAMPS来控制java.util.Map密钥是否序列化为字符串。默认情况下启用此功能，因此默认情况下将周期/持续时间序列化为时间戳。|<br>|WRITE_CHAR_ARRAYS_AS_JSON_ARRAYS|false|确定char []类型如何序列化的功能：启用后，将序列化为显式JSON数组（以单字符字符串作为值）； 禁用时，默认情况下将其序列化为字符串（更为紧凑）。默认情况下禁用此功能。|<br>|WRITE_ENUMS_USING_TO_STRING|false|确定用于Enum值的标准序列化机制的功能：如果启用，则使用Enum.toString（）的返回值； 如果禁用，则使用Enum.name（）的返回值。注意：此功能通常应与DeserializationFeature.READ_ENUMS_USING_TO_STRING具有相同的值。默认情况下禁用此功能。|<br>|WRITE_ENUMS_USING_INDEX|false|确定Java Enum值是序列化为数字（true）还是文本值（false）的功能。 如果使用文本值，则还将考虑其他设置。 如果启用此功能，则Enum.ordinal（）的返回值（整数）将用作序列化。请注意，此功能的优先级高于WRITE_ENUMS_USING_TO_STRING，只有将此功能设置为false时，才考虑此功能。请注意，从2.10开始，这不适用于作为java.util.Map值的键编写的枚举，该枚举具有单独的设置WRITE_ENUM_KEYS_USING_INDEX。默认情况下禁用此功能。|<br>|WRITE_ENUM_KEYS_USING_INDEX|false|确定是否将用作java.util.Map密钥的{link Enum}序列化为使用Enum.ordinal（）的功能。 与将枚举写入常规值时使用的WRITE_ENUMS_USING_INDEX相似。默认情况下禁用此功能。|<br>|WRITE_NULL_MAP_VALUES|true|确定是否要对具有空值的Map条目进行序列化（true）或不进行序列化（false）的功能。注意：与其他SerializationFeatures不同，此功能不能在每次调用的基础上动态更改，因为在构造序列化程序和属性处理程序时会考虑其作用。默认情况下启用此功能。|<br>|WRITE_EMPTY_JSON_ARRAYS|true|确定是否将容器属性（具有声明的Collection或数组值的POJO属性；即，产生JSON数组的事物）为空（没有元素）的属性，将被序列化为空JSON数组（true），还是从输出中取消显示（false） 。请注意，这不会更改java.util.Maps或“类似集合”类型的行为。注意：与其他SerializationFeatures不同，此功能不能在每次调用的基础上动态更改，因为在构造序列化程序和属性处理程序时会考虑其作用。默认情况下启用此功能。|<br>|WRITE_SINGLE_ELEM_ARRAYS_UNWRAPPED|false|为互操作性而添加的功能，以与所谓的“ BadgerFish”约定兼容。 功能确定对单个元素java.util.Collections和数组的处理：如果启用，则仅包含一个元素的java.util.Collections和数组将被序列化，就好像该元素本身已被序列化一样。启用后，带有数组的POJO通常如下所示：{“ arrayProperty”：[1]}而是序列化为{“ arrayProperty”：1}请注意，此功能与DeserializationFeature.ACCEPT_SINGLE_VALUE_AS_ARRAY相对（即，通常两者都启用，或两者都不启用）。|<br>|WRITE_BIGDECIMAL_AS_PLAIN|false|确定是否使用java.math.BigDecimal.toPlainString（）序列化java.math.BigDecimal条目的功能，以防止使用科学计数法写入值。注意：由于此功能通常需要使用com.fasterxml.jackson.core.JsonGenerator.writeNumber（String），因此可能会导致兼容性问题，因为并非所有com.fasterxml.jackson.core.JsonGenerator实现都支持这种输出模式：通常仅文本 基于格式的格式支持它。默认情况下禁用此功能。|<br>|WRITE_DATE_TIMESTAMPS_AS_NANOSECONDS|true|控制是否使用纳秒级时间戳写入数字时间戳值（启用）（禁用）的功能； 当且仅当数据类型支持这种分辨率时。 只有较新的数据类型（例如Java8日期/时间）才支持这种分辨率-较旧的类型（Java8之前的java.util.Date等）和Joda则不支持-并且此设置对此类类型无效。如果禁用，则假定为标准毫秒时间戳。 这与DeserializationFeature.READ_DATE_TIMESTAMPS_AS_NANOSECONDS对应。默认情况下启用此功能，以支持最准确的时间值。|<br>|ORDER_MAP_ENTRIES_BY_KEYS|false|确定是否在序列化之前首先按键对java.util.Map条目进行排序的功能：如果启用，则在必要时执行附加的排序步骤（对于java.util.SortedMaps不必要），如果禁用，则无需进行其他排序。默认情况下禁用此功能。|<br>|EAGER_SERIALIZER_FETCH|true|决定ObjectWriter是否应在可能的情况下热切获取必要的JsonSerializer的功能。 如果多次使用类似配置的ObjectWriter实例，则可以提高性能。 并且不会对一次性使用案例产生重大影响。请注意，通常不需要禁用此功能：仅在存在实际可察觉问题的情况下考虑。默认情况下启用此功能。|<br>|USE_EQUALITY_FOR_OBJECT_ID|false|确定是否使用对象的真实JVM级别标识（false）比较对象标识的功能； 或equals（）方法。 当使用ORM库（例如Hibernate）处理数据库绑定的对象时，后期有时会很有用。 注意对象本身是实际比较的，不是对象ID。 此功能的命名有些令人困惑，因此重要的是，要为其保留身份的对象在id之上和之外都被认为是相等的（无论如何，它们总是使用相等性进行比较）。注意：由于实现功能的方式，非常重要的是，除了覆盖Object.equals以使对象匹配（被视为“相同”）之外，还必须确保Object.hashCode（）被覆盖以产生 相等实例的值完全相同。默认情况下禁用此功能； 表示使用严格的身份，而不是equals（）|</p><h3 id="3-2、创建自定义的序列化-反序列化器"><a href="#3-2、创建自定义的序列化-反序列化器" class="headerlink" title="3.2、创建自定义的序列化/反序列化器"></a>3.2、创建自定义的序列化/反序列化器</h3><p>ObjectMapper类的另一个基本功能是能够注册自定义序列化器和反序列化器。 在输入或输出JSON响应的结构不同且必须对其进行序列化或反序列化的Java类的结构时，自定义序列化器和反序列化器非常有用。<br>以下是自定义JSON序列化程序的示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonGenerator;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.SerializerProvider;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.std.StdSerializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 4:49 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarSerializer</span> <span class="keyword">extends</span> <span class="title">StdSerializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">CustomCarSerializer</span><span class="params">(Class&lt;Car&gt; t)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarSerializer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">serialize</span><span class="params">(Car car, JsonGenerator gen, SerializerProvider provider)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        gen.writeStartObject();</span><br><span class="line">        gen.writeStringField(<span class="string">&quot;car_brand&quot;</span>, car.getType());</span><br><span class="line">        gen.writeEndObject();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此自定义序列化器可以这样调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .registerModule(</span><br><span class="line">                        <span class="keyword">new</span> SimpleModule(</span><br><span class="line">                                <span class="string">&quot;CustomCarSerializer&quot;</span>,</span><br><span class="line">                                <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>)</span><br><span class="line">                        ).addSerializer(Car.class, <span class="keyword">new</span> CustomCarSerializer()))</span><br><span class="line">                .writeValueAsString(car);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;car_brand&quot;:&quot;BMW&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>这是自定义JSON反序列化的示例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonParser;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.JsonProcessingException;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.ObjectCodec;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.TreeNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationContext;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.JsonNode;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.deser.std.StdDeserializer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 4:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CustomCarDeserializer</span> <span class="keyword">extends</span> <span class="title">StdDeserializer</span>&lt;<span class="title">Car</span>&gt; </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">protected</span> <span class="title">CustomCarDeserializer</span><span class="params">(Class&lt;?&gt; vc)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">super</span>(vc);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">CustomCarDeserializer</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">deserialize</span><span class="params">(JsonParser p, DeserializationContext ctxt)</span> <span class="keyword">throws</span> IOException, JsonProcessingException </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car();</span><br><span class="line">        ObjectCodec codec = p.getCodec();</span><br><span class="line">        JsonNode treeNode = codec.readTree(p);</span><br><span class="line">        JsonNode colorNode = treeNode.get(<span class="string">&quot;color&quot;</span>);</span><br><span class="line">        String color = colorNode.asText();</span><br><span class="line">        car.setColor(color);</span><br><span class="line">        <span class="keyword">return</span> car;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>此自定义反序列化器可以这样调用：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;color\&quot;: \&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;        \&quot;type\&quot;: \&quot;BMW\&quot;&quot;</span>+</span><br><span class="line">                <span class="string">&quot;    &#125;&quot;</span>;</span><br><span class="line">        Car car = <span class="keyword">new</span> ObjectMapper()</span><br><span class="line">                .registerModule(</span><br><span class="line">                        <span class="keyword">new</span> SimpleModule(</span><br><span class="line">                                <span class="string">&quot;CustomCarDeserializer&quot;</span>,</span><br><span class="line">                                <span class="keyword">new</span> Version(<span class="number">1</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="keyword">null</span>, <span class="keyword">null</span>, <span class="keyword">null</span>)</span><br><span class="line">                        ).addDeserializer(Car.class, <span class="keyword">new</span> CustomCarDeserializer()))</span><br><span class="line">                .readValue(json, Car.class);</span><br><span class="line">        System.out.println(car);</span><br><span class="line">        <span class="comment">//result:  Car(type=null, color=Red)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="3-3、Date-格式化的处理方式"><a href="#3-3、Date-格式化的处理方式" class="headerlink" title="3.3、Date 格式化的处理方式"></a>3.3、Date 格式化的处理方式</h3><p>java.util.Date的默认序列化产生一个数字，即纪元时间戳（自1970年1月1日起，以UTC为单位的毫秒数）。 但这不是人类可读的，并且需要进一步转换以人类可读的格式显示。 让我们使用datePurchased属性将到目前为止使用的Car实例包装在Request类中：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:12 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>控制日期的字符串格式，并将其设置为例如 yyyy-MM-dd HH:mm a z，请考虑以下代码段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.text.SimpleDateFormat;</span><br><span class="line"><span class="keyword">import</span> java.util.Date;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:12 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Request</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Car car;</span><br><span class="line">    <span class="keyword">private</span> Date createDate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Request</span><span class="params">(Car car, Date createDate)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.car = car;</span><br><span class="line">        <span class="keyword">this</span>.createDate = createDate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(StrinDeserializationFeatureg[] args)</span> </span>&#123;</span><br><span class="line">        Car car = <span class="keyword">new</span> Car(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;Red&quot;</span>);</span><br><span class="line">        Request request = <span class="keyword">new</span> Request(car,<span class="keyword">new</span> Date());</span><br><span class="line">        SimpleDateFormat simpleDateFormat = <span class="keyword">new</span> SimpleDateFormat(<span class="string">&quot;yyyy-MM-dd HH:mm a z&quot;</span>);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().setDateFormat(simpleDateFormat);</span><br><span class="line"></span><br><span class="line">        String json = objectMapper.writeValueAsString(request);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;car&quot;:&#123;&quot;type&quot;:&quot;BMW&quot;,&quot;color&quot;:&quot;Red&quot;&#125;,&quot;createDate&quot;:&quot;2020-06-08 17:16 下午 CST&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>更多的时间格式化的方式参考：<a href="https://www.baeldung.com/jackson-serialize-dates">深入学习日期格式化</a></p><h3 id="3-4、集合的处理方式"><a href="#3-4、集合的处理方式" class="headerlink" title="3.4、集合的处理方式"></a>3.4、集合的处理方式</h3><p>DeserializationFeature类提供的另一个小而有用的功能是能够根据JSON数组响应生成所需类型的集合的功能。例如，我们可以将结果生成为数组：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.advanced;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.core.Version;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.<span class="keyword">module</span>.SimpleModule;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.EqualsAndHashCode;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 3:59 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@EqualsAndHashCode</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">(String type, String color)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Car</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;[\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;:\&quot;Red\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;:\&quot;BMW\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;color\&quot;:\&quot;Black\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;type\&quot;:\&quot;audi\&quot;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;  &#125;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;]&quot;</span>;</span><br><span class="line">        <span class="comment">//也可以写成： objectMapper.configure(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY, true);</span></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().enable(DeserializationFeature.USE_JAVA_ARRAY_FOR_JSON_ARRAY);</span><br><span class="line">        Car[] cars = objectMapper.readValue(json, Car[].class);       </span><br><span class="line">        List&lt;Car&gt; carList = objectMapper.readValue(json,<span class="keyword">new</span> TypeReference&lt;List&lt;Car&gt;&gt;()&#123;&#125;);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="四、Jackson序列化是忽略属性"><a href="#四、Jackson序列化是忽略属性" class="headerlink" title="四、Jackson序列化是忽略属性"></a>四、Jackson序列化是忽略属性</h2><h3 id="4-1、简介"><a href="#4-1、简介" class="headerlink" title="4.1、简介"></a>4.1、简介</h3><p>本章将展示在使用Jackson 2.x将对象序列化为JSON时如何忽略某些字段。当Jackson默认值还不够，并且我们需要精确控制要序列化为JSON的内容时，这非常有用-并且有几种方法可以忽略属性。</p><h3 id="4-2、在类级别上忽略字段"><a href="#4-2、在类级别上忽略字段" class="headerlink" title="4.2、在类级别上忽略字段"></a>4.2、在类级别上忽略字段</h3><p>我们可以使用@JsonIgnoreProperties批注并按名称指定字段，从而在类级别忽略特定字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:32 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(&#123;&quot;intValue&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> Boolean booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, Boolean booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">12</span>, <span class="keyword">false</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result: &#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;booleanValue&quot;:false&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>要毫无例外地忽略JSON输入中的任何未知属性，我们可以设置@JsonIgnoreProperties批注的ignoreUnknown = true。</p><h3 id="4-3、在字段级别上忽略字段"><a href="#4-3、在字段级别上忽略字段" class="headerlink" title="4.3、在字段级别上忽略字段"></a>4.3、在字段级别上忽略字段</h3><p>我们也可以直接通过@JsonIgnore批注直接忽略该字段：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnore;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:32 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="meta">@JsonIgnore</span></span><br><span class="line">    <span class="keyword">private</span> Boolean booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, Boolean booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">12</span>, <span class="keyword">false</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result：&#123;&quot;stringValue&quot;:&quot;wuxuan&quot;,&quot;intValue&quot;:12&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="4-4、通过类型忽略所有字段"><a href="#4-4、通过类型忽略所有字段" class="headerlink" title="4.4、通过类型忽略所有字段"></a>4.4、通过类型忽略所有字段</h3><p>最后，我们可以使用@JsonIgnoreType批注忽略指定类型的所有字段。 如果我们控制类型，那么我们可以直接注解类：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:42 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SomeType</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> MyDto myDto;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">SomeType</span><span class="params">(String type, MyDto myDto)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.myDto = myDto;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto wuxuan = <span class="keyword">new</span> MyDto(<span class="string">&quot;wuxuan&quot;</span>, <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">        SomeType type = <span class="keyword">new</span> SomeType(<span class="string">&quot;www&quot;</span>, wuxuan);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writeValueAsString(type);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;type&quot;:&quot;www&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>但是，我们常常无法控制类本身； 在这种情况下，我们可以充分利用Jackson的混入注解。<br>首先，我们为要忽略的类型定义一个MixIn，然后使用@JsonIgnoreType对其进行注解：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>然后，我们在编组期间注册该mixin来替换（并忽略）所有String[]类型：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreType;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:47 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonIgnoreType</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMixinForIgnoreType</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 5:57 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoWithSpecialField</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String[] stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoWithSpecialField</span><span class="params">(String[] stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDtoWithSpecialField myDtoWithSpecialField = <span class="keyword">new</span> MyDtoWithSpecialField(<span class="keyword">new</span> String[]&#123;<span class="string">&quot;1&quot;</span>, <span class="string">&quot;2&quot;</span>&#125;, <span class="number">1</span>, <span class="keyword">false</span>);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper().addMixIn(String[].class, MyMixinForIgnoreType.class);</span><br><span class="line">        String json = objectMapper.writeValueAsString(myDtoWithSpecialField);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        </span><br><span class="line">        <span class="comment">//result: &#123;&quot;intValue&quot;:1,&quot;booleanValue&quot;:false&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-5、通过过滤器忽略字段"><a href="#4-5、通过过滤器忽略字段" class="headerlink" title="4.5、通过过滤器忽略字段"></a>4.5、通过过滤器忽略字段</h3><p>最后，我们还可以使用过滤器来忽略Jackson中的特定字段。 首先，我们需要在Java对象上定义过滤器,去除掉name属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.ignoreField;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleBeanPropertyFilter;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ser.impl.SimpleFilterProvider;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:03 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@JsonFilter(&quot;myFilter&quot;)</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoFilter</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String type;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoFilter</span><span class="params">(String type, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.type = type;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDtoFilter</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDtoFilter myDtoFilter = <span class="keyword">new</span> MyDtoFilter(<span class="string">&quot;BMW&quot;</span>, <span class="string">&quot;x5&quot;</span>);</span><br><span class="line">        SimpleBeanPropertyFilter filter = SimpleBeanPropertyFilter.serializeAllExcept(<span class="string">&quot;name&quot;</span>);</span><br><span class="line">        SimpleFilterProvider myFilter = <span class="keyword">new</span> SimpleFilterProvider().addFilter(<span class="string">&quot;myFilter&quot;</span>, filter);</span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        String json = objectMapper.writer(myFilter).writeValueAsString(myDtoFilter);</span><br><span class="line">        System.out.println(json);</span><br><span class="line">        <span class="comment">//result:&#123;&quot;type&quot;:&quot;BMW&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="五、在Jackson中忽略值为NULL的字段"><a href="#五、在Jackson中忽略值为NULL的字段" class="headerlink" title="五、在Jackson中忽略值为NULL的字段"></a>五、在Jackson中忽略值为NULL的字段</h2><h3 id="5-1、简介"><a href="#5-1、简介" class="headerlink" title="5.1、简介"></a>5.1、简介</h3><p>本快速章节将介绍如何在序列化Java类时设置Jackson以忽略空字段。</p><h3 id="5-2、在类上忽略NULL字段"><a href="#5-2、在类上忽略NULL字段" class="headerlink" title="5.2、在类上忽略NULL字段"></a>5.2、在类上忽略NULL字段</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure><p>或者-更细粒度上讲-在字段级级：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span></span>&#123;</span><br><span class="line">    <span class="meta">@JsonInclude(Include.NON_NULL)</span></span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="4-3-全局忽略NULL的字段"><a href="#4-3-全局忽略NULL的字段" class="headerlink" title="4.3. 全局忽略NULL的字段"></a>4.3. 全局忽略NULL的字段</h3><p>Jackson还允许在ObjectMapper上全局配置此行为：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDtoTest</span></span>&#123;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNullField</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        ObjectMapper mapper = <span class="keyword">new</span> ObjectMapper().setSerializationInclusion(Include.NON_NULL);</span><br><span class="line">        ...</span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>忽略空字段是一种常见的Jackson配置，因为通常情况下，我们需要更好地控制JSON输出。 本章说明如何对类进行此操作。 但是，还有更高级的用例，例如在序列化Map时忽略空值。</p><h2 id="六、Jackson更改字段的名称"><a href="#六、Jackson更改字段的名称" class="headerlink" title="六、Jackson更改字段的名称"></a>六、Jackson更改字段的名称</h2><h3 id="6-1、简介"><a href="#6-1、简介" class="headerlink" title="6.1、简介"></a>6.1、简介</h3><p>本快速章节说明了如何更改字段名称以在序列化时映射到另一个JSON属性。</p><h3 id="6-2、更改要序列化的字段名称"><a href="#6-2、更改要序列化的字段名称" class="headerlink" title="6.2、更改要序列化的字段名称"></a>6.2、更改要序列化的字段名称</h3><p>以MyDto类为例：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.changeFieldName;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonProperty;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:18 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String value;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String value, String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.value = value;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@JsonProperty(&quot;value_fact&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getValue</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyDto myDto = <span class="keyword">new</span> MyDto(<span class="string">&quot;sfsd&quot;</span>, <span class="string">&quot;www&quot;</span>);</span><br><span class="line">        String json = <span class="keyword">new</span> ObjectMapper().writeValueAsString(myDto);</span><br><span class="line">        System.out.println(json);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: &#123;&quot;name&quot;:&quot;www&quot;,&quot;value_fact&quot;:&quot;sfsd&quot;&#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="七、Jackson用未知属性反序列化JSON"><a href="#七、Jackson用未知属性反序列化JSON" class="headerlink" title="七、Jackson用未知属性反序列化JSON"></a>七、Jackson用未知属性反序列化JSON</h2><h3 id="7-1、简介"><a href="#7-1、简介" class="headerlink" title="7.1、简介"></a>7.1、简介</h3><p>在本章中，我们将研究Jackson 2.x的解组过程，特别是如何处理具有未知属性的JSON内容。</p><h3 id="7-2、使用其他-未知字段反序列化JSON"><a href="#7-2、使用其他-未知字段反序列化JSON" class="headerlink" title="7.2、使用其他/未知字段反序列化JSON"></a>7.2、使用其他/未知字段反序列化JSON</h3><p>JSON输入有各种形态和大小-在大多数情况下，我们需要将其映射到具有一定数量字段的预定义Java对象。 目标是简单地忽略所有无法映射到现有Java字段的JSON属性。<br>例如，假设我们需要将JSON解组到以下Java实体：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-3、未知字段上的UnrecognizedPropertyException"><a href="#7-3、未知字段上的UnrecognizedPropertyException" class="headerlink" title="7.3、未知字段上的UnrecognizedPropertyException"></a>7.3、未知字段上的UnrecognizedPropertyException</h3><p>尝试将具有未知属性的JSON反序列化到此简单Java实体将导致com.fasterxml.jackson.databind.exc.UnrecognizedPropertyException：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: false\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        <span class="comment">//throw UnrecognizedPropertyException 异常</span></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * Unrecognized field &quot;booleanValue111&quot; (class com.yiyi.unmarshall.MyDto), not marked as ignorable (3 known properties: &quot;stringValue&quot;, &quot;booleanValue&quot;, &quot;intValue&quot;])</span></span><br><span class="line"><span class="comment">         *  at [Source: (String)&quot;&#123;</span></span><br><span class="line"><span class="comment">         *     &quot;stringValue&quot;: &quot;wuxuan&quot;,</span></span><br><span class="line"><span class="comment">         *     &quot;intValue&quot;: 1,</span></span><br><span class="line"><span class="comment">         *     &quot;booleanValue111&quot;: false</span></span><br><span class="line"><span class="comment">         * &#125;&quot;; line: 4, column: 29] (through reference chain: com.yiyi.unmarshall.MyDto[&quot;booleanValue111&quot;])</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-4、通过设置ObjectMapper处理未知字段的异常"><a href="#7-4、通过设置ObjectMapper处理未知字段的异常" class="headerlink" title="7.4、通过设置ObjectMapper处理未知字段的异常"></a>7.4、通过设置ObjectMapper处理未知字段的异常</h3><p>现在，我们可以配置完整的ObjectMapper以忽略JSON中的未知属性：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: true\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//也可以写成：objectMapper.configure(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES,false);</span></span><br><span class="line">        objectMapper.disable(DeserializationFeature.FAIL_ON_UNKNOWN_PROPERTIES);</span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        System.out.println(myDto);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false)  </span></span><br><span class="line">        <span class="comment">// booleanValue=false 是对象的属性的默认值，因为booleanValue 是基本类型，不是包装类型，默认值为false</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="7-5、通过类上注解处理未知字段"><a href="#7-5、通过类上注解处理未知字段" class="headerlink" title="7.5、通过类上注解处理未知字段"></a>7.5、通过类上注解处理未知字段</h3><p>我们还可以将单个类标记为接受未知字段，而不是整个Jackson对象映射器：</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.yiyi.unmarshall;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.annotation.JsonIgnoreProperties;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.DeserializationFeature;</span><br><span class="line"><span class="keyword">import</span> com.fasterxml.jackson.databind.ObjectMapper;</span><br><span class="line"><span class="keyword">import</span> lombok.Data;</span><br><span class="line"><span class="keyword">import</span> lombok.SneakyThrows;</span><br><span class="line"><span class="keyword">import</span> lombok.ToString;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span> wuxuan.chai</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@date</span> 2020/6/8 6:25 下午</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ToString</span></span><br><span class="line"><span class="meta">@JsonIgnoreProperties(ignoreUnknown = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyDto</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String stringValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> intValue;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> booleanValue;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MyDto</span><span class="params">(String stringValue, <span class="keyword">int</span> intValue, <span class="keyword">boolean</span> booleanValue)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.stringValue = stringValue;</span><br><span class="line">        <span class="keyword">this</span>.intValue = intValue;</span><br><span class="line">        <span class="keyword">this</span>.booleanValue = booleanValue;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@SneakyThrows</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String json = <span class="string">&quot;&#123;\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;stringValue\&quot;: \&quot;wuxuan\&quot;,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;intValue\&quot;: 1,\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;    \&quot;booleanValue111\&quot;: true\n&quot;</span> +</span><br><span class="line">                <span class="string">&quot;&#125;&quot;</span>;</span><br><span class="line"></span><br><span class="line">        ObjectMapper objectMapper = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line"></span><br><span class="line">        MyDto myDto = objectMapper.readValue(json, MyDto.class);</span><br><span class="line">        System.out.println(myDto);</span><br><span class="line">        <span class="comment">//result: MyDto(stringValue=wuxuan, intValue=1, booleanValue=false)</span></span><br><span class="line">        <span class="comment">// booleanValue=false 是对象的属性的默认值，因为booleanValue 是基本类型，不是包装类型，默认值为false</span></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="八、总结"><a href="#八、总结" class="headerlink" title="八、总结"></a>八、总结</h2><p>初次系统的学习Jackson的使用方式，感受到了Jackson特别灵活，定制化强的特点，针对于日常的业务需求，已经足够了。更让人惊讶的是自定义的Jackson注解，更是让Jackson如虎添翼。</p>]]></content>
      
      
      <categories>
          
          <category> 详细教程 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> Java </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SQL语句概念简单整理</title>
      <link href="/dist/2021/01/17/SQL%E8%AF%AD%E5%8F%A5%E6%A6%82%E5%BF%B5%E7%AE%80%E5%8D%95%E6%95%B4%E7%90%86/"/>
      <url>/dist/2021/01/17/SQL%E8%AF%AD%E5%8F%A5%E6%A6%82%E5%BF%B5%E7%AE%80%E5%8D%95%E6%95%B4%E7%90%86/</url>
      
        <content type="html"><![CDATA[<h2 id="一、SQL语言共分为四大类"><a href="#一、SQL语言共分为四大类" class="headerlink" title="一、SQL语言共分为四大类"></a>一、SQL语言共分为四大类</h2><ul><li>数据查询语言DQL</li><li>数据操纵语言DML</li><li>数据定义语言DDL</li><li>数据控制语言DCL。</li></ul><h2 id="二、简要描述这四类"><a href="#二、简要描述这四类" class="headerlink" title="二、简要描述这四类"></a>二、简要描述这四类</h2><h3 id="1、数据查询语言DQL"><a href="#1、数据查询语言DQL" class="headerlink" title="1、数据查询语言DQL"></a>1、数据查询语言DQL</h3><p>数据查询语言DQL基本结构是由SELECT子句，FROM子句，WHERE子句组成的查询块：<br>SELECT &lt;字段名表&gt;FROM &lt;表或视图名&gt;WHERE &lt;查询条件&gt;</p><h3 id="2、数据操纵语言DML"><a href="#2、数据操纵语言DML" class="headerlink" title="2、数据操纵语言DML"></a>2、数据操纵语言DML</h3><p>数据操纵语言DML主要有三种形式：</p><ul><li>插入：INSERT</li><li>更新：UPDATE</li><li>删除：DELETE（删除表中的数据不删除表结构，可以回滚）</li></ul><h3 id="3、数据定义语言DDL"><a href="#3、数据定义语言DDL" class="headerlink" title="3、数据定义语言DDL"></a>3、数据定义语言DDL</h3><ul><li>CREATE：创建</li><li>ALTER：修改表结构</li><li>RENAME：修改表名或列名</li><li>DROP：删除表中的数据和结构，删除后不能回滚</li><li>TRUNCATE：删除表中的数据不删除表结构，删除后不能回滚，效率比DELETE高</li></ul><h3 id="4、数据控制语言DCL"><a href="#4、数据控制语言DCL" class="headerlink" title="4、数据控制语言DCL"></a>4、数据控制语言DCL</h3><ul><li>GRANT：授权</li><li>REVOKE ：回收权限</li></ul><h3 id="还有事务控制语句TCL："><a href="#还有事务控制语句TCL：" class="headerlink" title="还有事务控制语句TCL："></a>还有事务控制语句TCL：</h3><ul><li>SAVEPOINT：保存点  </li><li>ROLLBACK：回退到某点   </li><li>COMMIT：提交事务  </li></ul>]]></content>
      
      
      <categories>
          
          <category> 数据库 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SQL </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>设计模式之----工厂模式</title>
      <link href="/dist/2021/01/17/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B----%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/"/>
      <url>/dist/2021/01/17/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E4%B9%8B----%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F/</url>
      
        <content type="html"><![CDATA[<h1 id="设计模式之—-工厂模式"><a href="#设计模式之—-工厂模式" class="headerlink" title="设计模式之—-工厂模式"></a>设计模式之—-工厂模式</h1><p>工厂模式（Factory Pattern）是java中最常用的设计模式之一，这种类型设计模式属于创建型模式，它提供了一种创建对象的最佳方式。在工厂模式中，我们在创建对象是不会对客户暴露创建逻辑，并且是通过使用一个共同的接口，以此来达到解耦的目的。    </p><p>下面的例子以造车为例来说明三种模式。</p><h2 id="分类"><a href="#分类" class="headerlink" title="分类"></a>分类</h2><h2 id="1、简单工厂模式-Simple-Factory"><a href="#1、简单工厂模式-Simple-Factory" class="headerlink" title="1、简单工厂模式 (Simple Factory)"></a>1、简单工厂模式 (Simple Factory)</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="class"><span class="keyword">class</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">CarType</span> </span>&#123;</span><br><span class="line">    BMW, AUDI, DAZHONG;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwCar</span> <span class="keyword">extends</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">BmwCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是宝马车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiCar</span> <span class="keyword">extends</span> <span class="title">Car</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">AudiCar</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是奥迪车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongCar</span> <span class="keyword">extends</span> <span class="title">Car</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">DaZhongCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;这是大众车&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CarFactory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 静态工厂方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> carType 车的类型</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Car <span class="title">createCar</span><span class="params">(CarType carType)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (carType) &#123;</span><br><span class="line">            <span class="keyword">case</span> BMW:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">            <span class="keyword">case</span> AUDI:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">            <span class="keyword">case</span> DAZHONG:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        CarFactory.createCar(CarType.AUDI);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是奥迪车</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>这种工厂模式，已经完成了我们工厂模式的基本的需求，创建对象和解耦<br>缺点：<br>1、用户调用需要知道自己要创建的对象在工厂中的类型<br>2、拓展很麻烦，如果新增一个产品，需要在产品的具体创建对象的实现，还需使工厂支持创建这种产品，这显然是违背开闭原则的  </p><h2 id="2、工厂方法模式（Factory-Method）"><a href="#2、工厂方法模式（Factory-Method）" class="headerlink" title="2、工厂方法模式（Factory Method）"></a>2、工厂方法模式（Factory Method）</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产车的方法</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Car <span class="title">createCar</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span></span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BmwFactory bmwFactory = <span class="keyword">new</span> BmwFactory();</span><br><span class="line">        bmwFactory.createCar();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>输出：</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">这是宝马车</span><br><span class="line"></span><br><span class="line">Process finished with exit code 0</span><br></pre></td></tr></table></figure><p>工厂方法模式组成：<br>       1)抽象工厂角色： 这是工厂方法模式的核心，它与应用程序无关。是具体工厂角色必须实现的接口或者必须继承的父类。在java中它由抽象类或者接口来实现。<br>       2)具体工厂角色：它含有和具体业务逻辑有关的代码。由应用程序调用以创建对应的具体产品的对象。<br>       3)抽象产品角色：它是具体产品继承的父类或者是实现的接口。在java中一般有抽象类或者接口来实现。<br>       4)具体产品角色：具体工厂角色所创建的对象就是此角色的实例。在java中由具体的类来实现。   </p><p>方法工厂模式和简单工厂模式最大的不同，就是将实现交给了具体的工厂，核心工厂只提供产品线，具体的实现工厂只需要去实现对应的需求即可。如果新增产，只需要去实现对应的产品工厂即可，显然这种方式是符合开闭原则的</p><h2 id="3、抽象工厂模式-Abstract-Factory"><a href="#3、抽象工厂模式-Abstract-Factory" class="headerlink" title="3、抽象工厂模式 (Abstract Factory)"></a>3、抽象工厂模式 (Abstract Factory)</h2><p>个人觉得抽象工厂模式和工厂方法模式区别不是很大。</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 生产车的方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 车的对象</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function">Car <span class="title">createCar</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取价钱</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 价钱</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AudiFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> AudiCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：20_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">20_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">BmwFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> BmwCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：25_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">25_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaZhongFactory</span> <span class="keyword">implements</span> <span class="title">Factory</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Car <span class="title">createCar</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DaZhongCar();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">pricing</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;定价：18_0000&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">18_0000</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//客户使用</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConsumerTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> BmwFactory bmwFactory = <span class="keyword">new</span> BmwFactory();</span><br><span class="line">        bmwFactory.createCar();</span><br><span class="line">        bmwFactory.pricing();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>总结：<br>无论是简单工厂模式，工厂方法模式，还是抽象工厂模式，他们都属于工厂模式，在形式和特点上也是极为相似的，他们的最终目的都是为了解耦。在使用时，我们不必去在意这个模式到底工厂方法模式还是抽象工厂模式，因为他们之间的演变常常是令人琢磨不透的。经常你会发现，明明使用的工厂方法模式，当新需求来临，稍加修改，加入了一个新方法后，由于类中的产品构成了不同等级结构中的产品族，它就变成抽象工厂模式了；而对于抽象工厂模式，当减少一个方法使的提供的产品不再构成产品族之后，它就演变成了工厂方法模式。<br>所以，在使用工厂模式时，只需要关心降低耦合度的目的是否达到了。</p>]]></content>
      
      
      <categories>
          
          <category> 设计模式 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 设计模式 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>DO、DTO、BO、VO、POJO的定义</title>
      <link href="/dist/2021/01/17/DO%E3%80%81DTO%E3%80%81BO%E3%80%81VO%E3%80%81POJO%E7%9A%84%E5%AE%9A%E4%B9%89/"/>
      <url>/dist/2021/01/17/DO%E3%80%81DTO%E3%80%81BO%E3%80%81VO%E3%80%81POJO%E7%9A%84%E5%AE%9A%E4%B9%89/</url>
      
        <content type="html"><![CDATA[<h1 id="DO、DTO、BO、VO、POJO的定义"><a href="#DO、DTO、BO、VO、POJO的定义" class="headerlink" title="DO、DTO、BO、VO、POJO的定义"></a>DO、DTO、BO、VO、POJO的定义</h1><h2 id="分层领域模型规约"><a href="#分层领域模型规约" class="headerlink" title="分层领域模型规约"></a>分层领域模型规约</h2><p>DO（ Data Object）：与数据库表结构一一对应，通过DAO层向上传输数据源对象。<br>DTO（ Data Transfer Object）：数据传输对象，Service或Manager向外传输的对象。<br>BO（ Business Object）：业务对象。 由Service层输出的封装业务逻辑的对象。<br>AO（ Application Object）：应用对象。 在Web层与Service层之间抽象的复用对象模型，极为贴近展示层，复用度不高。<br>VO（ View Object）：显示层对象，通常是Web向模板渲染引擎层传输的对象。<br>POJO（ Plain Ordinary Java Object）：在本手册中， POJO专指只有setter/getter/toString的简单类，包括DO/DTO/BO/VO等。<br>Query：数据查询对象，各层接收上层的查询请求。 注意超过2个参数的查询封装，禁止使用Map类来传输。  </p><h2 id="领域模型命名规约"><a href="#领域模型命名规约" class="headerlink" title="领域模型命名规约"></a>领域模型命名规约</h2><p>数据对象：xxxDO，xxx即为数据表名。<br>数据传输对象：xxxDTO，xxx为业务领域相关的名称。<br>展示对象：xxxVO，xxx一般为网页名称。<br>POJO: 专指只有 setter / getter / toString的简单类，包括DO/DTO/BO/VO等,禁止命名成 xxxPOJO</p>]]></content>
      
      
      <categories>
          
          <category> 代码规范 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 代码规范 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Mac的VM中设置虚拟机静态ip</title>
      <link href="/dist/2020/05/24/Mac%E7%9A%84VM%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%9D%99%E6%80%81ip/"/>
      <url>/dist/2020/05/24/Mac%E7%9A%84VM%E4%B8%AD%E8%AE%BE%E7%BD%AE%E8%99%9A%E6%8B%9F%E6%9C%BA%E9%9D%99%E6%80%81ip/</url>
      
        <content type="html"><![CDATA[<h2 id="Mac的VM中设置虚拟机静态ip"><a href="#Mac的VM中设置虚拟机静态ip" class="headerlink" title="Mac的VM中设置虚拟机静态ip"></a>Mac的VM中设置虚拟机静态ip</h2><p>闲来无事，想学习下spark相关的知识，于是需要几台服务器，无奈囊中羞涩双十一都买不起一台服务器，只能借助2015款的mac pro帮助虚拟几台服务器来暂时用用。</p><h3 id="准备过程"><a href="#准备过程" class="headerlink" title="准备过程"></a>准备过程</h3><p>FinalShell 一款国产的mac上可用的shell命令工具<br>VMware Fusion  mac上用来安装虚拟机的工具<br>centos7 的最简版镜像</p><h3 id="设置VMware-Fusion"><a href="#设置VMware-Fusion" class="headerlink" title="设置VMware Fusion"></a>设置VMware Fusion</h3><h4 id="第一步：修改vmware-配置网卡的配置文件"><a href="#第一步：修改vmware-配置网卡的配置文件" class="headerlink" title="第一步：修改vmware 配置网卡的配置文件"></a>第一步：修改vmware 配置网卡的配置文件</h4><p>只更改Vnet8 的网卡</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$ vim /Library/Preferences/VMware\ Fusion/networking</span><br><span class="line"></span><br><span class="line">VERSION=1,0</span><br><span class="line">answer VNET_1_DHCP yes</span><br><span class="line">answer VNET_1_DHCP_CFG_HASH EC13F23285B5086AFF5BDFFA85E8DE0338C2AF74</span><br><span class="line">answer VNET_1_HOSTONLY_NETMASK 255.255.255.0</span><br><span class="line">answer VNET_1_HOSTONLY_SUBNET 172.16.208.0</span><br><span class="line">answer VNET_1_VIRTUAL_ADAPTER yes</span><br><span class="line"><span class="comment">#关闭dhcp</span></span><br><span class="line">answer VNET_8_DHCP no</span><br><span class="line">answer VNET_8_DHCP_CFG_HASH 13FB4A1FC14575A20209A2C7C8C2E5EED98C6665</span><br><span class="line"><span class="comment"># 子网掩码</span></span><br><span class="line">answer VNET_8_HOSTONLY_NETMASK 255.255.255.0</span><br><span class="line"><span class="comment">#设置ip段</span></span><br><span class="line">answer VNET_8_HOSTONLY_SUBNET 192.168.100.0</span><br><span class="line">answer VNET_8_NAT yes</span><br><span class="line">answer VNET_8_VIRTUAL_ADAPTER yes</span><br><span class="line"><span class="comment"># vmnet8 的IP</span></span><br><span class="line">answer VNET_8_VIRTUAL_ADAPTER_ADDR 192.168.100.1</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="第二步：设置网关"><a href="#第二步：设置网关" class="headerlink" title="第二步：设置网关"></a>第二步：设置网关</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#配置nat.conf 这个文件</span></span><br><span class="line">vim /Library/Preferences/VMware\ Fusion/vmnet8/nat.conf </span><br><span class="line"></span><br><span class="line"><span class="comment">#设定nat网管和子网</span></span><br><span class="line"><span class="comment"># NAT gateway address</span></span><br><span class="line">ip = 192.168.100.2</span><br><span class="line">netmask = 255.255.255.0</span><br></pre></td></tr></table></figure><h4 id="第三步：-重启vmnet8网卡"><a href="#第三步：-重启vmnet8网卡" class="headerlink" title="第三步： 重启vmnet8网卡"></a>第三步： 重启vmnet8网卡</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 查看网卡状态</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --status  </span><br><span class="line"><span class="comment"># 关闭网卡</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --stop</span><br><span class="line"></span><br><span class="line"><span class="comment"># 启动网卡</span></span><br><span class="line">$ sudo /Applications/VMware\ Fusion.app/Contents/Library/vmnet-cli --start</span><br></pre></td></tr></table></figure><p>～～～～<br>中间省去在vm中创建centos的虚拟机步骤<br>～～～～</p><h4 id="第四步：设置centos网卡"><a href="#第四步：设置centos网卡" class="headerlink" title="第四步：设置centos网卡"></a>第四步：设置centos网卡</h4><h5 id="1、配置网卡"><a href="#1、配置网卡" class="headerlink" title="1、配置网卡"></a>1、配置网卡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> $ vi /etc/sysconfig/network-scripts/ifcfg-ens33 </span><br><span class="line"></span><br><span class="line">TYPE=Ethernet</span><br><span class="line">PROXY_METHOD=none</span><br><span class="line">BROWSER_ONLY=no</span><br><span class="line"><span class="comment"># 设置静态的ip，而不是dhcp方式</span></span><br><span class="line">BOOTPROTO=static</span><br><span class="line">DEFROUTE=yes</span><br><span class="line">IPV4_FAILURE_FATAL=no</span><br><span class="line">IPV6INIT=yes</span><br><span class="line">IPV6_AUTOCONF=yes</span><br><span class="line">IPV6_DEFROUTE=yes</span><br><span class="line">IPV6_FAILURE_FATAL=no</span><br><span class="line">IPV6_ADDR_GEN_MODE=stable-privacy</span><br><span class="line">NAME=ens33</span><br><span class="line">UUID=74ad3dd0-742d-422b-b165-6f0d0b6e2f6d</span><br><span class="line">DEVICE=ens33</span><br><span class="line"><span class="comment"># 设置网卡开机启动</span></span><br><span class="line">ONBOOT=yes</span><br><span class="line"><span class="comment"># 设置当前centos的ip地址</span></span><br><span class="line">IPADDR=192.168.100.15</span><br><span class="line"><span class="comment"># 设置网关</span></span><br><span class="line">GATEWAY=192.168.100.2</span><br><span class="line"><span class="comment"># 设置子网掩码</span></span><br><span class="line">NETMASK=255.255.255.0</span><br><span class="line"><span class="comment">#设置dns</span></span><br><span class="line">DNS1=119.29.29.29</span><br><span class="line">DNS2=182.254.116.116</span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2、重启centos网卡"><a href="#2、重启centos网卡" class="headerlink" title="2、重启centos网卡"></a>2、重启centos网卡</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#重启网卡</span></span><br><span class="line">systemctl restart network </span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看网卡</span></span><br><span class="line">ip addr </span><br><span class="line"></span><br></pre></td></tr></table></figure><h5 id="2、测试"><a href="#2、测试" class="headerlink" title="2、测试"></a>2、测试</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$ ip addr</span><br><span class="line"></span><br><span class="line">1: lo: &lt;LOOPBACK,UP,LOWER_UP&gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000</span><br><span class="line">    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00</span><br><span class="line">    inet 127.0.0.1/8 scope host lo</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 ::1/128 scope host </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">2: ens33: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc pfifo_fast state UP group default qlen 1000</span><br><span class="line">    link/ether 00:0c:29:dd:bc:55 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    inet 192.168.100.15/24 brd 192.168.100.255 scope global noprefixroute ens33</span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::a3c4:b923:6d37:e7aa/64 scope link tentative noprefixroute dadfailed </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::3427:d5be:210e:dce2/64 scope link tentative noprefixroute dadfailed </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::3f6a:22ae:8bdd:e0ac/64 scope link noprefixroute </span><br><span class="line">       valid_lft forever preferred_lft forever</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>测试发现ens33的ip地址已经变成了我们设置的ip了.</p><p>测试访问外网</p><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">$ ping www.baidu.com</span><br><span class="line"></span><br><span class="line">PING www.a.shifen.com (180.101.49.12) 56(84) bytes of data.</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=1 ttl=128 time=17.9 ms</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=2 ttl=128 time=117 ms</span><br><span class="line">64 bytes from 180.101.49.12 (180.101.49.12): icmp_seq=4 ttl=128 time=26.7 ms</span><br><span class="line">^C</span><br><span class="line">--- www.a.shifen.com ping statistics ---</span><br><span class="line">4 packets transmitted, 3 received, 25% packet loss, time 3004ms</span><br><span class="line">rtt min/avg/max/mdev = 17.996/54.184/117.813/45.134 ms</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>大工告成，开始happy！！！</p>]]></content>
      
      
      
        <tags>
            
            <tag> VM </tag>
            
            <tag> CentOS </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
